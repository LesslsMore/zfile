var ca=Object.defineProperty,ua=Object.defineProperties;var ha=Object.getOwnPropertyDescriptors;var ns=Object.getOwnPropertySymbols;var fa=Object.prototype.hasOwnProperty,pa=Object.prototype.propertyIsEnumerable;var os=Math.pow,as=(u,t,e)=>t in u?ca(u,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):u[t]=e,Nt=(u,t)=>{for(var e in t||(t={}))fa.call(t,e)&&as(u,e,t[e]);if(ns)for(var e of ns(t))pa.call(t,e)&&as(u,e,t[e]);return u},jt=(u,t)=>ua(u,ha(t));var zt=(u,t,e)=>new Promise((i,r)=>{var s=a=>{try{o(e.next(a))}catch(l){r(l)}},n=a=>{try{o(e.throw(a))}catch(l){r(l)}},o=a=>a.done?i(a.value):Promise.resolve(a.value).then(s,n);o((e=e.apply(u,t)).next())});import{D as ma}from"./base.b67810a8.js";import"./tooltip.afcd3f9d.js";import{E as ga}from"./popper.095a7e22.js";/* empty css               */import{bE as Pi,S as Oi,M as Or,a as hi,f as fi,m as Kt,J as ya,H as va,r as _a,o as xa,u as Pe,j as _e,e as Qt,O as xe,k as ls,F as Ea,g as ds,Q as ba,R as Ta}from"./index.a2819361.js";import{a as Sa,u as Aa,k as La,m as Ia}from"./useFileUpload.adc03cfd.js";import{u as wa,a as tr}from"./useCommon.6ffda7df.js";import{_ as Ra}from"./plugin-vue_export-helper.21dcd24c.js";import"./request.3c1ce344.js";import"./focus-trap.bdda507f.js";import"./common.f959769b.js";import"./checkbox.42e2dfcf.js";import"./event.776e7e11.js";import"./index.00248157.js";import"./_Uint8Array.57956811.js";/* empty css              */import"./index.c1cff4e1.js";import"./use-outside-click.ee54f844.js";import"./directive.6dc31605.js";import"./XCircleIcon.b423576d.js";import"./index.dc260b7d.js";import"./index.12c275de.js";import"./scroll.4e08625e.js";import"./validator.efe076db.js";import"./index.b1c54cd3.js";var Da="/assets/video-download.3a226681.png",ka="/assets/video-thunder.5e7f4cec.png",Ca="/assets/video-motrix.95ef7e61.png",Ma="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAOeUlEQVR4Xu3dy5EjuRWF4TMGyA550ibIgPZirJjFODIeaDVOaDMvSREKRdRKGy0UVF1mZTV5yGS+ACSA/G/EV1F1p7unu4pA4nEB6nK5fIeG/UN/vvyuL5df9fXyi75///zHq9/00+UP/fye+9vVr3q7cZnw7deMvy/+jPiz4s+MPz/+PyH+v//Wnx7+PmiKPIEKRUMbG/nYuIdG7Q34GPF3GTuJ4e/4hc6hDfIEDjY29njaRqN6/cSu29gxDCMTOoUKyRMoLIbS8dSs7ameS/wbx5FC/Nv9+4Gi5AlkNj7hhzl1/w1+ztghMEI4hDyBDOJJF8PgWFDzBoB745SB0UER8gQSGRs9T/nthl0MOoOM5AnswJM+n7EzYJqQlDyBDWL+OqzYP75wkd6w5fjl4eeA1eQJLDQU4MRqdrvbdK0bipWYIuwgT2AGT/s6xc+EjmA1eQITYt+auX394mfE9GAxeQI3YsGJlfw2DT+zrywaviZP4MNw8IX5fevoCF6SJ04tXiTDqTqe+L0ZOwL/mZ+cPHFaNPxzGEqPWSP4IE+cTrwYWNw7H3YNruSJ0/i2j//44sB5xGvgxOsD8sQpsMCHe/FaOOX6gDzRNYb7eCVeGyebFsgTXRrO4DPcxzIxQvTXUKfkie4M12uxuo91TrJbIE90g6c+Uuh8NCBPdGE4l89TH2l0vDYgTzRvuLf+8YcI7NfdToE80awY8nNMF7nFa6yjugF5okkM+VFSvNY6mRLIE81hyI9jdFE8JE80g1V+1CBeg/7abIg80YRo/FT0oRYNrwvIE9Vjvo8aNbouIE9UbXiHXA7xoFZvrXUC8kS1WOxDG95aKiGWJ6pE40d7mtghkCeqM5zd928uUL8GzhHIE1Vhmw+tq7wTkCeqQeNHLyruBOSJKtD40ZtKC4bkicPR+NGrCkcC8sShaPzoXWWdgDxxGFb7cRYVdQLyxCHY58f5VFEnIE8UN5T3+jcH6F8FFYPyRFHU9uPcDi8blieKiUMTNH7g0ANE8kQRcXaaI73AINrCQfcJyBNFcJkHcC8uFfF2UoA8kR17/cBzB2wPyhNZsd0HvFZ4UVCeyIZFP2CJoouC8kQWLPoByxVcFJQnsuAde4B1Ci0KyhPJMe8HtspeLixPJDXM+/0fBWCZ7OsB8kQyzPuB/aJmxttWQvJEMuz3A2lkrA+QJ5LghB+QVqapgDyRBEN/IK1oU97OEpAnduNmHyCPDFMBeWIXVv2BvBJPBeSJXTjlB+SVeFdAntiMgh+glGQFQvLEJrHnz0EfoJS3VGcF5IlN2PMHykr0TkPyxGos/AHHSLAgKE+sxsIfcIwEC4LyxCpU/AHH2nmDkDyxChV/wLF2VgjKE4ux7QfUYvO2oDyxGE9/oA47rhCTJxbh6b/Pv969/WXw9yf/HVhv0yhAnpjFRR/7/Pevl4f4zw90BNhn4yhAnpjF03+7eOJPxf/+Ofx3/z3AcqtHAfLELJ7+2z17+nvEr2E0gC027AjIEy+x77/Pmohpgf9+YN6qUYA88RJVf/usjZgWxIKh/znAlJXVgfLEJJ7++20NpgVYY0V1oDwxiXf32W9vsEiIJVa8q5A88RQn/tJIEUwLsMTCk4LyxFNc9JlGyqB2AK8svEBUnniK237SSB3UDmDa28Xb8RPyxAMW/9LJFbFIyLQAbsFioDzxgMW/dHIHtQO4tWAxUJ64M1z2+fgHY5sSwbQAt2bOB8gTd1j8S6tkUDuAMLMYKE/cofIvrSOC0cC5zVQGyhOf2PtP76igduDcXtQEyBOfGP6nd3RQO3BOL6YB8sQnhv/p1RJMC87lxTRAnrhi+J9HTUHtwLlMTAPkiSuG/3nUGNQOnMPENECeuKL4J49ag9qB/k0UBckTFP9kVHtQO9C3J0VB8gS1/xm1EkwL+vTkbIA8wVt9Z9RSUDvQnydvKS5PcOtvRi0G04J+PLk1WHcJtv/yajVYJOyHbQfq9osLb/qRV+tB7UAP7q4N1+0XzP8z6yUoKW6XrQPo9gvKfzPrKZgWtMnKgvX5Bfv/+fUYLBK256YeQOMn7P8X0HNQO9COm3oAjZ9Q/19A70HtQBtuzgVo/IT6/wLOEkwL6nZzLkDjJxQAFXC2YJGwTjcFQbp+wgJgGWcMpgV1+lgIVHygArCQMwe1A3X5WAhUfLhQAVjG2YPagZpcKwIVH6gALIQYgkXC431UBCo+sANQCHEf1A4c52MnQPGBEuBCiMdgkfAYHzsBig8X3v67DGI6mBaUd+0A2AIsh5gPFgnLeW/7YguwIGJZMC0o43d9EYeACiLWBbUDeV07AGoAyiHWB7UD+fyi78UpwIKI7cEiYXrXDoAioHKI/UHtQDrvbZ8OoCQiTbBImMZv+klUARZEpA2mBfv8oZ9FFWBBRJ5gkXCbawfARSDlEPmCacF6722fDqAkIn9QO7DGW9QBcA6gFKJMUDuw1LUD8CRyIcoGb2U2iw6gJOKYoHZgEh1AScRxEaMB/3mADqAo4thgXeABHUBJxLERi4P+Mzk5OoCSiOPDfyYnRwdQEnFssA7wgA6gJOLYYEvwAYVAJRHHBQuAz1AJWBRRPjgx+MobZwFKIsoF5cDzroeBOA5cDlEmOBC0zLUD4EKQcoi8Qe3/Otf7AOgAyiHyBMP9ba5XgnEnYDlE+mC4v931UlCuBS+HSBfcALTftQPgjUHKIdIEw/00Pt4XgLcGK4XYF+zpp/aVNwctidgWDPfzuL43IG8PXg6xPhju5/P+8H//ePnuQjlwGcTyYLif33vbj4/fUQ5cCDEfDPfLiDb/2QFQDFQG8Tq4vLOcaPOfHQDFQGUQz4PhfnnR5j87AGoByiDugxLeI3293IwAqAUogfgWDPePFW3+swNgK7AMguF+LaLNf3YA7ASUceZguF+Tt8tHu9f4CTsBBZw1OLFXl48dgKDxE04FFnC24IKOOkVbf+gAWAjM7yzBcL9uHwuAQeMnLAQWcIZguF+/jwXAoPGTKxYC8+o5GO634aMEeKTbL6gIzKzHYLjflo8KwJFuv7hQEZhXb8Fwv0XXCsCRbr/gcpDMeglO7LUr2vhkBxBYB8inh2C43y6b/wd5gnWAjFoOSnjbZ/P/IE9QD5BRi8Fwvx83+/8jeYJ6gIxaC4b7fbnZ/x/JE1e8YWgerQTD/f5Em/Z2PtkBcC4gj9qD4X6/bur/b8kTV2wH5lFzcEFH32z7byRPfGI7ML0ag+F+/55s/43kiU9MA9KrKSjhPY+J4X+QJz4xDUivlmC4fy4Tw/8gT9xhGpDW0cFw/3xeDP+DPHGHaUBaRwXD/fN6MfwP8sQdpgFpHRGc2Du3F8P/IE884LLQdEoGF3Tg5vLPKfLEA84GpFMiGO5j9KT238kTD4azAbx9eAq5g+E+vvm8+/8VeeIpjginkSsY7sM9Ofr7jDzxFIuBaaQOhvuYMrP4N5InJrEYuF/KYLiPKQsW/0byxCQWA/dLEZzYw5wFi38jeeIl7gnYZ28w3Mecmco/J0+8xLXh+2wNSnix3N2133PkiZdiS5DzAdutDYb7WCPa5pNrv16RJ2ZxPmC7NcFwH2vN1P0/I0/MojBouxjKzwXDfWzztvbpH+SJRRgFbBNP9alguI89Njz9gzyxCKOA7WL/3oPhPvbZ9PQP8sRi7AhsF0P8aPQ88ZHGqpX/W/LEYuwIAMfbsPJ/S55YhVEAcLTNT/8gT6xGdSBwjIl3+1lDnliNMwLAMVbU/E+RJzbhpCBQ1ooTf6/IE5sM9wWwLQiU8bb0vP8ceWIzioOAMjYW/TwjT2zGtiCQ38rjvnPkiV1YEATySrDwd0ue2I0LRIE8Fl70uYY8sRtTASC9nRV/U+SJJJgKAGklHvqP5IlkmAoAaWQY+o/kiWSYCgD7ZRr6j+SJpJgKAPskKviZIk8kR4EQsE3Cgp8p8kQWnBgE1klU6z9HnsiC9QBguczz/lvyRDasBwBLJDvos4Q8kRU3CAFzdt3ws5Y8kR31AcBzGff7p8gT2cXchkVB4F6C6722kCeKYFEQ+Kbgop+TJ4qIfyy3CAGh6KKfkyeKYmcA5/aW65DPUvJEcewM4KwObvxBnjgE5cI4n6LbfVPkicOwPYizKFDjv5Q8cSg6AfTugL3+V+SJw9EJoFeVNf4gT1SBdxpCbyps/EGeqAYjAfSi0sYf5Imq0AmgdRU3/iBPVIdOAK2qaLV/ijxRJeoE0J4q9vnnyBPVomIQbTi8vHcNeaJqw9kBDhChVoce7NlCnqhefIM5SozaxGuyscYf5IkmcKkIahJ1Kwed599LnmhGfMPZIcDRKt/mmyNPNIfFQRyjqcW+KfJEk1gXQEmNzvefkSeaFVMCzhAgt4bn+8/IE82jaAh5xPZzE8U9a8gTXWBKgJRix6mTIb+TJ7rBLgFSaKCefw95ojuxUstoAGvFa6aDVf458kSXGA1gjXjqd7TQ94o80TXWBvBKx3P9KfLEKQw7BRwqwqjLFf4l5InTYFqAEK+Bkwz3n5EnTmP8oceQj4NF5xMFPScb7j8jT5xWDAFZH+jfSVb3l5InTi1GBcPhItYHejN07qec578iT+AydAQsFPaBhv+SPAETHQFTg/bQ8BeRJzCBNYI2xIIuc/zF5AnMiBcXx47rw6r+JvIEFhqqClknOFKMyE5UtpuDPIENGBWU9Hb9XjPMT0KewA7jqIDCovSG7+lXnvZpyRNIZOwMWDjcLhp9fA+Z22cjTyADRgZLDcP7eNLT6IuQJ5DZcAjpy/UQCqODsTT3x+v3hOF9cfIECosnXTzxztIhDPv0NPhKyBM42DhCiClDDIdb7hTi7z78G76nwddJnkCFouHcjhSiUQ3rCTXUILxd/y5jQx/n7zT2JsgTaMzYOQxvnR7lyvG0jSH2t45iKJiJkUR0GKPHhjwaf/3YsIfpSexoDA08/l808i78HzPcPJXn8KhQAAAAAElFTkSuQmCC",Pa="/assets/video-iina.1db26170.png",Oa="/assets/video-vlc.54e63a7e.png",Na="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAK2UlEQVR4Xu2dC3BUZxXHD4g4VlukLRTEIKhYochjeBRaCoggpQaqBSrQWFuCwLbFDpRhQIs4Y8YRO1Lr4JSWJkCJVihgy0PerxapUhqaQrCFIkUghM1rs7sJVCYcz3d3v+Tuud+9e/dFdpPvP/OfwAzs3j0//v9zv2x2ANDS0tLS0tLS0tLS0tLS0tLS0tJqEHrhi1gJM+jrOqyAf2A5vEFeSr8exP+sVopFg59C9pJR6UrYRu7F/55WCkQJWGABoPY1Ss9K+tqZP4ZWkkQwRtGAryuG7+QAgfmFqDj+eFoJiob7nmLgbl1KNTYdEVrzx9WKQ1gFvRVDjt2VcIx8P398rRhFdfWoZbiJ2AvbCcxd/Hm0XIqAeCxDTdz19Lj5qBd/7EoREOkApWWJXvwxKMVADFdXQmkRLX7Qiz+6UgHkagXgyWrAzTWAvw0APh1s8Im5Qb34HZUMINfJ5yoBd/sAl/sB5zYCUHpOELaT+/Jr0YL4gVwmAIcpBQUEYKFi6C5cPy8I+TNr9eKPkFsgAQLwPgFYTzX0K+tw43ctBH4WgLwlevGHZAfkGu2BjwjAVgLwXOQeSJrnRLqU4OSORGjDr7FFSQIRe+A8pWAfQXiRaugZxQCTaQajwU8FoeSJlrz4j1SBZw2lYJFiaKk0BxGGYZiA4Owg7JpdC/359TZ7zQuAhw8rleYQzCBMMKTr6ff5U2rhy/y6m61uJBAnEAoYODPsWQGom9FSFv+NAhIPDAKBPyXnkh8nT/dD6fQAzG7Wiz/VQDgIFQwzCDMMAULCkP4xOccPJVOb6+JPJRAOgsPgqZAwZCrMMH4ShvEIeSr5R+TJftg3obkt/lQA4RDcwFBVlDkVAoSwAYI8iW7Nf0B3hxNqoH68Dwqyq6Arf20ZqWQC4QDcgrCDoUrFw/5GGNnkB8hjyCN8UDe8BvImZ/riTxYQDoGDsNsV5oqyS4WAIVPxkN9IhQFiLHmUgEG+hzzEBwjVUAYXBzwB+5dk5uJPFAiHoAJhB0O1uM2pUFWUTIWAIUAMEhAudUU4PQeheBfCOz6Ew36EQ/4SeNufzV9v2iteIByCHQwVCGEOQqbCXFEShLBIhYAhQEA5+VwOQsk6hCNlCP8MEogAgRAmGG+HfZD8ln8/HKzOnMWfTCBOu8IpFbyieCp6VxKAiw8ifLQC4djHCO8SgH+F3QDD3whDgBDeXxPy3pp62Fv9KuyuS//FHw8QDiIWGHxfqCpqXLWoodEI/1mKcPwownvBEAThIyYYAoSEYU7FwTCIfQYMhN1UY7vIO6vrYIcvD/5eeQufQ9ooViDxgHBa3MJTKAntL/emGlqEcHIvpYCGVxQMgVDBcKqoAyYYe3xmGAjbydsMl8OW6sf5LNJCsQCxA+EEwy4VA6taIVzw0DLeRMvYSxDqCIJwbSOIoyYQFhh+sbitFSVTIWBIEDsEDF8Ixpaw36xCeKPqZUBsxWfSpHIDxCkV0hyEeV8ICA+Ku6GL06iGChBOnCEINPz360IgGmC4SIWqosyp2OuLhCFSIZMhQGw2QCBsqgz5b1WL+EyaVNGAcBgcCE+GhDGNauhm71iET36P8CHtgeJgCIJ0BIjaRhgyFSoY5oqyLm5TRclUmEA0pCIMYiN5A/n1iquwtjZ93te3A8IhcBAcxgzy3RX9qIZ+iXCK9sBxGswHtZEQLKkQIEwVxUEYMEypiKgotridKmpzdSgVEoYBgrxOuBzhLxUL+FyaTBwIh6ACISsqu0rcDT1FNbSRaqgsBECagzDD4KlQwVClQsKQqZAVpV7c1lREwKhA+KuAIVy5jc+lySSBcAgqGI/QmaBVGR3IzuVTDZ0mCDTYD65EglDBsOwKxeK2gxHv4hapUFXUegajkPzn8nf5XJpMAgiHIEGIu6O+5fcjnF9GNUR74EQwBEH4eIww3KTC6WzBFzdPRcTiDleUJRXhinpNwqC7u7XkV737+FyaTHNMQASEMVV0HihdjHBmD0KJrxGA2W5ACMebCleL2xe5uLc6VJQqFRLGGgPI83wuTaaJPvAYe+CTDQj/LrUO3+xYU6GCwUHEe7YwUuGwuEVFOaVCwlgtvl4eyufSdDp51WMZvMoGiBhg8IqKNRXRKsq8uI2zBUuFZXFHVFQIhHDBpfRZ6IbcAHEDIu6K8lthSBDy2x92i5tXVMPZIkpFGSDIq8pOQUGgAx9J08oJiNuKkiAaYIRBqCrK6cTNzxY8FU6L21xRAgSvKJEKM4z8SzvgT95OfBxNLzsgqoriIOJOhaKilItbpsIEgqfCrqJUqRBeVVYKr5RN42NIH6mAcBDxwrA7catguF3cvKKUi7vcurgLvNdglfcP8MfT6futd0MSiKgntxVlt7hVFSXPFqoTd6oXt4SRX3YI8i9nyAeEJJBYQDilQllRNqmwragYFrdTKlZ7vbQrHku7b7E7SgBJFAYHwSvKdnErUqFa3KqKclrcKz6sh8cWvzhs2LD2/OWmv4oFEAcQsVaUanFLGDIVzu/mWVMRraJWX0CY9xL2HTsa87vdcQQBBvKXmTkqDjQCsQOhSkXK381jqTC+/WFKRd4W7PDQw/jz/t3xU6BSAqC/BLPIGf7RawGEg7CkQjjOVERb3KqKsqSC/NIxhNz5mDNiIJ6F1gKA9HVyAfl2/tIyU8W1ViDRUhENhtPibkiFCYQqFYXnEBa+gNnjx+CBrDvMAMwmSnAPf0mZLQ7EDgYHwRe307t5blKxkXbB0k1497SpuGbAN/nguenB4GlyZv64qKMkEA4iGRUVbXGvPIRZT87F34wZhFegLR+6yqKeCsnp8x540iWAcBiuKoqnIlxRTot73SmEZ5ehZ9I4PNPtK3zY0VxCHskvv/lJAnGbiljOFlvLEJa9hlOnP4pvDfk2H7Bb0xPCAnJbfunNU0UExHUqoi1uSsLqA/jdZ+bj+ux7ETu348ON1a+Ts/glN28JIBxGxOKWMGwqatNx7J23DJfnjMcrfboj3vYZxC+0QmxtGW4sPk3+Hr/UlqEiOofYpULcRfHFvfMCtl1eiM8+mYtnRw5A7EYp6HIzpeEmxHZtENtahhuLqTthMflz/DJbjo4SEBUMWVEH6ZZ07U6ctXghvjNxNGKfLog9b0P8xi2IXQlEFwLRke6Q2iWcis3k7vzyWp4EEH62eLMIf/jc87hlxkTE+76F2K8zgaDDWc+OiHfeHoIhU5F4RZ0lj+eX1XIlgOw5i/e9XIj582fhlQcGIw7thjj4q4iDskIwenUKpeLO9o0VJVMRf0V9Sv41+fP8klq0/pszzoPf6YE4/OuI9xKIIWEQ/ama+lEqeplSISsq8VTsJPfg16JFwlFf8+Dw7qFUSBgRFRVOhYDRWaRCLO64YZwnT+bXoGUSjiAgsqKMVIQrykjFreFUJFxR/yP/jpzZnyG/EcIhWZ5QRYVTwSsq8cV9gKz/iwu3olR4lBWV+NmilJxDzqD3s9NA2Kejx5IKubjjO1tcI79A/hJ/Li0Xwrs6TYpc3OFUxFdRh8n9+HNoxSDs2aFHEs4W5eRc1PWUHGGnmw7HubjrySvIt/LH1EpA2AaGUirEyZkP3MlHyYP5Y2klSTTcmRj6F88Hz11N9mDG/7hNBoiG/H3yxwoIwuJw9wo5zT5P0cyFMOCzNPQJGLp13UBeSZ5HTsPPUmhpaWlpaWlpaWlpaWlpaWlpaWlpaWklqv8Da8GBU4g36CAAAAAASUVORK5CYII=",Fa="/assets/video-mxplayer.5dfa69aa.png",Ba="/assets/video-mxplayer-pro.10406916.png",an={exports:{}};(function(u,t){/*!
 * artplayer.js v5.1.6
 * Github: https://github.com/zhw2590582/ArtPlayer
 * (c) 2017-2024 Harvey Zack
 * Released under the MIT License.
 */(function(e,i,r,s,n){var o=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:typeof Oi!="undefined"?Oi:{},a=typeof o[s]=="function"&&o[s],l=a.cache||{},d=typeof Pi=="function"&&Pi.bind(u);function c(p,g){if(!l[p]){if(!e[p]){var x=typeof o[s]=="function"&&o[s];if(!g&&x)return x(p,!0);if(a)return a(p,!0);if(d&&typeof p=="string")return d(p);var E=Error("Cannot find module '"+p+"'");throw E.code="MODULE_NOT_FOUND",E}O.resolve=function(T){var R=e[p][1][T];return R!=null?R:T},O.cache={};var k=l[p]=new c.Module(p);e[p][0].call(k.exports,O,k,k.exports,this)}return l[p].exports;function O(T){var R=O.resolve(T);return R===!1?{}:c(R)}}c.isParcelRequire=!0,c.Module=function(p){this.id=p,this.bundle=c,this.exports={}},c.modules=e,c.cache=l,c.parent=a,c.register=function(p,g){e[p]=[function(x,E){E.exports=g},{}]},Object.defineProperty(c,"root",{get:function(){return o[s]}}),o[s]=c;for(var f=0;f<i.length;f++)c(i[f]);if(r){var h=c(r);u.exports=h}})({abjMI:[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r);var n=e("bundle-text:./style/index.less"),o=s.interopDefault(n),a=e("option-validator"),l=s.interopDefault(a),d=e("./utils/emitter"),c=s.interopDefault(d),f=e("./utils"),h=e("./scheme"),p=s.interopDefault(h),g=e("./config"),x=s.interopDefault(g),E=e("./template"),k=s.interopDefault(E),O=e("./i18n"),T=s.interopDefault(O),R=e("./player"),C=s.interopDefault(R),b=e("./control"),A=s.interopDefault(b),L=e("./contextmenu"),I=s.interopDefault(L),j=e("./info"),F=s.interopDefault(j),$=e("./subtitle"),V=s.interopDefault($),Q=e("./events"),z=s.interopDefault(Q),B=e("./hotkey"),w=s.interopDefault(B),P=e("./layer"),G=s.interopDefault(P),et=e("./loading"),rt=s.interopDefault(et),dt=e("./notice"),vt=s.interopDefault(dt),Lt=e("./mask"),xt=s.interopDefault(Lt),it=e("./icons"),at=s.interopDefault(it),lt=e("./setting"),ct=s.interopDefault(lt),mt=e("./storage"),It=s.interopDefault(mt),Gt=e("./plugins"),Xt=s.interopDefault(Gt);let se=0,Yt=[];class Et extends c.default{constructor(le,Ae){super(),this.id=++se;let Be=f.mergeDeep(Et.option,le);if(Be.container=le.container,this.option=(0,l.default)(Be,p.default),this.isLock=!1,this.isReady=!1,this.isFocus=!1,this.isInput=!1,this.isRotate=!1,this.isDestroy=!1,this.template=new k.default(this),this.events=new z.default(this),this.storage=new It.default(this),this.icons=new at.default(this),this.i18n=new T.default(this),this.notice=new vt.default(this),this.player=new C.default(this),this.layers=new G.default(this),this.controls=new A.default(this),this.contextmenu=new I.default(this),this.subtitle=new V.default(this),this.info=new F.default(this),this.loading=new rt.default(this),this.hotkey=new w.default(this),this.mask=new xt.default(this),this.setting=new ct.default(this),this.plugins=new Xt.default(this),typeof Ae=="function"&&this.on("ready",()=>Ae.call(this,this)),Et.DEBUG){let Le=ge=>console.log(`[ART.${this.id}] -> ${ge}`);Le("Version@"+Et.version),Le("Env@"+Et.env),Le("Build@"+Et.build);for(let ge=0;ge<x.default.events.length;ge++)this.on("video:"+x.default.events[ge],ke=>Le("Event@"+ke.type))}Yt.push(this)}static get instances(){return Yt}static get version(){return"5.1.6"}static get env(){return"production"}static get build(){return"2024-06-15 19:54:25"}static get config(){return x.default}static get utils(){return f}static get scheme(){return p.default}static get Emitter(){return c.default}static get validator(){return l.default}static get kindOf(){return l.default.kindOf}static get html(){return k.default.html}static get option(){return{id:"",container:"#artplayer",url:"",poster:"",type:"",theme:"#f00",volume:.7,isLive:!1,muted:!1,autoplay:!1,autoSize:!1,autoMini:!1,loop:!1,flip:!1,playbackRate:!1,aspectRatio:!1,screenshot:!1,setting:!1,hotkey:!0,pip:!1,mutex:!0,backdrop:!0,fullscreen:!1,fullscreenWeb:!1,subtitleOffset:!1,miniProgressBar:!1,useSSR:!1,playsInline:!0,lock:!1,fastForward:!1,autoPlayback:!1,autoOrientation:!1,airplay:!1,layers:[],contextmenu:[],controls:[],settings:[],quality:[],highlight:[],plugins:[],thumbnails:{url:"",number:60,column:10,width:0,height:0},subtitle:{url:"",type:"",style:{},name:"",escape:!0,encoding:"utf-8",onVttLoad:le=>le},moreVideoAttr:{controls:!1,preload:f.isSafari?"auto":"metadata"},i18n:{},icons:{},cssVar:{},customType:{},lang:navigator.language.toLowerCase()}}get proxy(){return this.events.proxy}get query(){return this.template.query}get video(){return this.template.$video}destroy(le=!0){this.events.destroy(),this.template.destroy(le),Yt.splice(Yt.indexOf(this),1),this.isDestroy=!0,this.emit("destroy")}}r.default=Et,Et.DEBUG=!1,Et.CONTEXTMENU=!0,Et.NOTICE_TIME=2e3,Et.SETTING_WIDTH=250,Et.SETTING_ITEM_WIDTH=200,Et.SETTING_ITEM_HEIGHT=35,Et.RESIZE_TIME=200,Et.SCROLL_TIME=200,Et.SCROLL_GAP=50,Et.AUTO_PLAYBACK_MAX=10,Et.AUTO_PLAYBACK_MIN=5,Et.AUTO_PLAYBACK_TIMEOUT=3e3,Et.RECONNECT_TIME_MAX=5,Et.RECONNECT_SLEEP_TIME=1e3,Et.CONTROL_HIDE_TIME=3e3,Et.DBCLICK_TIME=300,Et.DBCLICK_FULLSCREEN=!0,Et.MOBILE_DBCLICK_PLAY=!0,Et.MOBILE_CLICK_PLAY=!1,Et.AUTO_ORIENTATION_TIME=200,Et.INFO_LOOP_TIME=1e3,Et.FAST_FORWARD_VALUE=3,Et.FAST_FORWARD_TIME=1e3,Et.TOUCH_MOVE_RATIO=.5,Et.VOLUME_STEP=.1,Et.SEEK_STEP=5,Et.PLAYBACK_RATE=[.5,.75,1,1.25,1.5,2],Et.ASPECT_RATIO=["default","4:3","16:9"],Et.FLIP=["normal","horizontal","vertical"],Et.FULLSCREEN_WEB_IN_BODY=!1,Et.LOG_VERSION=!0,Et.USE_RAF=!1,f.isBrowser&&(window.Artplayer=Et,f.setStyleText("artplayer-style",o.default),setTimeout(()=>{Et.LOG_VERSION&&console.log(`%c ArtPlayer %c ${Et.version} %c https://artplayer.org`,"color: #fff; background: #5f5f5f","color: #fff; background: #4bc729","")},100))},{"bundle-text:./style/index.less":"kfOe8","option-validator":"9I0i9","./utils/emitter":"2bGVu","./utils":"h3rH9","./scheme":"AdvwB","./config":"9Xmqu","./template":"2gKYH","./i18n":"1AdeF","./player":"556MW","./control":"14IBq","./contextmenu":"7iUum","./info":"hD2Lg","./subtitle":"lum0D","./events":"1Epl5","./hotkey":"eTow4","./layer":"4fDoD","./loading":"fE0Sp","./notice":"9PuGy","./mask":"2etr0","./icons":"6dYSr","./setting":"bRHiA","./storage":"f2Thp","./plugins":"96ThS","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],kfOe8:[function(e,i,r){i.exports='.art-video-player{--art-theme:red;--art-font-color:#fff;--art-background-color:#000;--art-text-shadow-color:#00000080;--art-transition-duration:.2s;--art-padding:10px;--art-border-radius:3px;--art-progress-height:6px;--art-progress-color:#ffffff40;--art-hover-color:#ffffff40;--art-loaded-color:#ffffff40;--art-state-size:80px;--art-state-opacity:.8;--art-bottom-height:100px;--art-bottom-offset:20px;--art-bottom-gap:5px;--art-highlight-width:8px;--art-highlight-color:#ffffff80;--art-control-height:46px;--art-control-opacity:.75;--art-control-icon-size:36px;--art-control-icon-scale:1.1;--art-volume-height:120px;--art-volume-handle-size:14px;--art-lock-size:36px;--art-indicator-scale:0;--art-indicator-size:16px;--art-fullscreen-web-index:9999;--art-settings-icon-size:24px;--art-settings-max-height:300px;--art-selector-max-height:300px;--art-contextmenus-min-width:250px;--art-subtitle-font-size:20px;--art-subtitle-gap:5px;--art-subtitle-bottom:15px;--art-subtitle-border:#000;--art-widget-background:#000000d9;--art-tip-background:#000000b3;--art-scrollbar-size:4px;--art-scrollbar-background:#ffffff40;--art-scrollbar-background-hover:#ffffff80;--art-mini-progress-height:2px}.art-bg-cover{background-position:50%;background-repeat:no-repeat;background-size:cover}.art-bottom-gradient{background-image:linear-gradient(#0000,#0006,#000);background-position:bottom;background-repeat:repeat-x}.art-backdrop-filter{backdrop-filter:saturate(180%)blur(20px);background-color:#000000bf!important}.art-truncate{text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.art-video-player{zoom:1;text-align:left;user-select:none;box-sizing:border-box;color:var(--art-font-color);background-color:var(--art-background-color);text-shadow:0 0 2px var(--art-text-shadow-color);-webkit-tap-highlight-color:#0000;-ms-touch-action:manipulation;touch-action:manipulation;-ms-high-contrast-adjust:none;direction:ltr;outline:0;width:100%;height:100%;margin:0 auto;padding:0;font-family:PingFang SC,Helvetica Neue,Microsoft YaHei,Roboto,Arial,sans-serif;font-size:14px;line-height:1.3;position:relative}.art-video-player *,.art-video-player :before,.art-video-player :after{box-sizing:border-box}.art-video-player ::-webkit-scrollbar{width:var(--art-scrollbar-size);height:var(--art-scrollbar-size)}.art-video-player ::-webkit-scrollbar-thumb{background-color:var(--art-scrollbar-background)}.art-video-player ::-webkit-scrollbar-thumb:hover{background-color:var(--art-scrollbar-background-hover)}.art-video-player img{vertical-align:top;max-width:100%}.art-video-player svg{fill:var(--art-font-color)}.art-video-player a{color:var(--art-font-color);text-decoration:none}.art-icon{justify-content:center;align-items:center;line-height:1;display:flex}.art-video-player.art-backdrop .art-contextmenus,.art-video-player.art-backdrop .art-info,.art-video-player.art-backdrop .art-settings,.art-video-player.art-backdrop .art-layer-auto-playback,.art-video-player.art-backdrop .art-selector-list,.art-video-player.art-backdrop .art-volume-inner{backdrop-filter:saturate(180%)blur(20px);background-color:#000000bf!important}.art-video{z-index:10;cursor:pointer;width:100%;height:100%;position:absolute;inset:0}.art-poster{z-index:11;pointer-events:none;background-position:50%;background-repeat:no-repeat;background-size:cover;width:100%;height:100%;position:absolute;inset:0}.art-video-player .art-subtitle{z-index:20;text-align:center;pointer-events:none;justify-content:center;align-items:center;gap:var(--art-subtitle-gap);bottom:var(--art-subtitle-bottom);font-size:var(--art-subtitle-font-size);transition:bottom var(--art-transition-duration)ease;text-shadow:var(--art-subtitle-border)1px 0 1px,var(--art-subtitle-border)0 1px 1px,var(--art-subtitle-border)-1px 0 1px,var(--art-subtitle-border)0 -1px 1px,var(--art-subtitle-border)1px 1px 1px,var(--art-subtitle-border)-1px -1px 1px,var(--art-subtitle-border)1px -1px 1px,var(--art-subtitle-border)-1px 1px 1px;flex-direction:column;width:100%;padding:0 5%;display:none;position:absolute}.art-video-player.art-subtitle-show .art-subtitle{display:flex}.art-video-player.art-control-show .art-subtitle{bottom:calc(var(--art-control-height) + var(--art-subtitle-bottom))}.art-danmuku{z-index:30;pointer-events:none;width:100%;height:100%;position:absolute;inset:0;overflow:hidden}.art-video-player .art-layers{z-index:40;pointer-events:none;width:100%;height:100%;display:none;position:absolute;inset:0}.art-video-player .art-layers .art-layer{pointer-events:auto}.art-video-player.art-layer-show .art-layers{display:flex}.art-video-player .art-mask{z-index:50;pointer-events:none;justify-content:center;align-items:center;width:100%;height:100%;display:flex;position:absolute;inset:0}.art-video-player .art-mask .art-state{opacity:0;width:var(--art-state-size);height:var(--art-state-size);transition:all var(--art-transition-duration)ease;justify-content:center;align-items:center;display:flex;transform:scale(2)}.art-video-player.art-mask-show .art-state{cursor:pointer;pointer-events:auto;opacity:var(--art-state-opacity);transform:scale(1)}.art-video-player.art-loading-show .art-state{display:none}.art-video-player .art-loading{z-index:70;pointer-events:none;justify-content:center;align-items:center;width:100%;height:100%;display:none;position:absolute;inset:0}.art-video-player.art-loading-show .art-loading{display:flex}.art-video-player .art-bottom{z-index:60;opacity:0;pointer-events:none;padding:0 var(--art-padding);transition:all var(--art-transition-duration)ease;background-size:100% var(--art-bottom-height);background-image:linear-gradient(#0000,#0006,#000);background-position:bottom;background-repeat:repeat-x;flex-direction:column;justify-content:flex-end;width:100%;height:100%;display:flex;position:absolute;inset:0;overflow:hidden}.art-video-player .art-bottom .art-controls,.art-video-player .art-bottom .art-progress{transform:translateY(var(--art-bottom-offset));transition:transform var(--art-transition-duration)ease}.art-video-player.art-control-show .art-bottom,.art-video-player.art-hover .art-bottom{opacity:1}.art-video-player.art-control-show .art-bottom .art-controls,.art-video-player.art-hover .art-bottom .art-controls,.art-video-player.art-control-show .art-bottom .art-progress,.art-video-player.art-hover .art-bottom .art-progress{transform:translateY(0)}.art-bottom .art-progress{z-index:0;pointer-events:auto;padding-bottom:var(--art-bottom-gap);position:relative}.art-bottom .art-progress .art-control-progress{cursor:pointer;height:var(--art-progress-height);justify-content:center;align-items:center;display:flex;position:relative}.art-bottom .art-progress .art-control-progress .art-control-progress-inner{transition:height var(--art-transition-duration)ease;background-color:var(--art-progress-color);align-items:center;width:100%;height:50%;display:flex;position:relative}.art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-hover{z-index:0;background-color:var(--art-hover-color);width:0%;height:100%;position:absolute;inset:0}.art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-loaded{z-index:10;background-color:var(--art-loaded-color);width:0%;height:100%;position:absolute;inset:0}.art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-played{z-index:20;background-color:var(--art-theme);width:0%;height:100%;position:absolute;inset:0}.art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-highlight{z-index:30;pointer-events:none;width:100%;height:100%;position:absolute;inset:0}.art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-highlight span{z-index:0;pointer-events:auto;transform:translateX(calc(var(--art-highlight-width)/-2));background-color:var(--art-highlight-color);width:100%;height:100%;position:absolute;inset:0 auto 0 0;width:var(--art-highlight-width)!important}.art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-indicator{z-index:40;width:var(--art-indicator-size);height:var(--art-indicator-size);transform:scale(var(--art-indicator-scale));margin-left:calc(var(--art-indicator-size)/-2);transition:transform var(--art-transition-duration)ease;border-radius:50%;justify-content:center;align-items:center;display:flex;position:absolute;left:0}.art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-indicator .art-icon{pointer-events:none;width:100%;height:100%}.art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-indicator:hover{transform:scale(1.2)!important}.art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-indicator:active{transform:scale(1)!important}.art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-tip{z-index:50;border-radius:var(--art-border-radius);white-space:nowrap;background-color:var(--art-tip-background);padding:3px 5px;font-size:12px;line-height:1;display:none;position:absolute;top:-25px;left:0}.art-bottom .art-progress .art-control-progress:hover .art-control-progress-inner{height:100%}.art-bottom .art-progress .art-control-thumbnails{bottom:calc(var(--art-bottom-gap) + 10px);border-radius:var(--art-border-radius);pointer-events:none;background-color:var(--art-widget-background);display:none;position:absolute;left:0;box-shadow:0 1px 3px #0003,0 1px 2px -1px #0003}.art-bottom:hover .art-progress .art-control-progress .art-control-progress-inner .art-progress-indicator{transform:scale(1)}.art-controls{z-index:10;pointer-events:auto;height:var(--art-control-height);justify-content:space-between;align-items:center;display:flex;position:relative}.art-controls .art-controls-left,.art-controls .art-controls-right{height:100%;display:flex}.art-controls .art-controls-center{flex:1;justify-content:center;align-items:center;height:100%;padding:0 10px;display:none}.art-controls .art-controls-right{justify-content:flex-end}.art-controls .art-control{cursor:pointer;white-space:nowrap;opacity:var(--art-control-opacity);min-height:var(--art-control-height);min-width:var(--art-control-height);transition:opacity var(--art-transition-duration)ease;flex-shrink:0;justify-content:center;align-items:center;display:flex}.art-controls .art-control .art-icon{height:var(--art-control-icon-size);width:var(--art-control-icon-size);transform:scale(var(--art-control-icon-scale));transition:transform var(--art-transition-duration)ease}.art-controls .art-control .art-icon:active{transform:scale(calc(var(--art-control-icon-scale)*.8))}.art-controls .art-control:hover{opacity:1}.art-control-volume{position:relative}.art-control-volume .art-volume-panel{text-align:center;cursor:default;opacity:0;pointer-events:none;left:0;right:0;bottom:var(--art-control-height);width:var(--art-control-height);height:var(--art-volume-height);transition:all var(--art-transition-duration)ease;justify-content:center;align-items:center;padding:0 5px;font-size:12px;display:flex;position:absolute;transform:translateY(10px)}.art-control-volume .art-volume-panel .art-volume-inner{border-radius:var(--art-border-radius);background-color:var(--art-widget-background);flex-direction:column;align-items:center;gap:10px;width:100%;height:100%;padding:10px 0 12px;display:flex}.art-control-volume .art-volume-panel .art-volume-inner .art-volume-slider{cursor:pointer;flex:1;justify-content:center;width:100%;display:flex;position:relative}.art-control-volume .art-volume-panel .art-volume-inner .art-volume-slider .art-volume-handle{border-radius:var(--art-border-radius);background-color:#ffffff40;justify-content:center;width:2px;display:flex;position:relative;overflow:hidden}.art-control-volume .art-volume-panel .art-volume-inner .art-volume-slider .art-volume-handle .art-volume-loaded{z-index:0;background-color:var(--art-theme);width:100%;height:100%;position:absolute;inset:0}.art-control-volume .art-volume-panel .art-volume-inner .art-volume-slider .art-volume-indicator{width:var(--art-volume-handle-size);height:var(--art-volume-handle-size);margin-top:calc(var(--art-volume-handle-size)/-2);background-color:var(--art-theme);transition:transform var(--art-transition-duration)ease;border-radius:100%;flex-shrink:0;position:absolute;transform:scale(1)}.art-control-volume .art-volume-panel .art-volume-inner .art-volume-slider:active .art-volume-indicator{transform:scale(.9)}.art-control-volume:hover .art-volume-panel{opacity:1;pointer-events:auto;transform:translateY(0)}.art-video-player .art-notice{z-index:80;padding:var(--art-padding);pointer-events:none;width:100%;height:auto;display:none;position:absolute;inset:0 0 auto}.art-video-player .art-notice .art-notice-inner{border-radius:var(--art-border-radius);background-color:var(--art-tip-background);padding:5px;line-height:1;display:inline-flex}.art-video-player.art-notice-show .art-notice{display:flex}.art-video-player .art-contextmenus{z-index:120;border-radius:var(--art-border-radius);background-color:var(--art-widget-background);min-width:var(--art-contextmenus-min-width);flex-direction:column;padding:5px 0;font-size:12px;display:none;position:absolute}.art-video-player .art-contextmenus .art-contextmenu{cursor:pointer;border-bottom:1px solid #ffffff1a;padding:10px 15px;display:flex}.art-video-player .art-contextmenus .art-contextmenu span{padding:0 8px}.art-video-player .art-contextmenus .art-contextmenu span:hover,.art-video-player .art-contextmenus .art-contextmenu span.art-current{color:var(--art-theme)}.art-video-player .art-contextmenus .art-contextmenu:hover{background-color:#ffffff1a}.art-video-player .art-contextmenus .art-contextmenu:last-child{border-bottom:none}.art-video-player.art-contextmenu-show .art-contextmenus{display:flex}.art-video-player .art-settings{z-index:90;border-radius:var(--art-border-radius);transform-origin:100% 100%;max-height:var(--art-settings-max-height);left:auto;right:var(--art-padding);bottom:var(--art-control-height);transform:scale(var(--art-settings-scale));transition:all var(--art-transition-duration)ease;background-color:var(--art-widget-background);flex-direction:column;display:none;position:absolute;overflow:hidden auto}.art-video-player .art-settings .art-setting-panel{flex-direction:column;display:none}.art-video-player .art-settings .art-setting-panel.art-current{display:flex}.art-video-player .art-settings .art-setting-panel .art-setting-item{cursor:pointer;transition:background-color var(--art-transition-duration)ease;justify-content:space-between;align-items:center;padding:0 5px;display:flex;overflow:hidden}.art-video-player .art-settings .art-setting-panel .art-setting-item:hover{background-color:#ffffff1a}.art-video-player .art-settings .art-setting-panel .art-setting-item.art-current{color:var(--art-theme)}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-icon-check{visibility:hidden;height:15px}.art-video-player .art-settings .art-setting-panel .art-setting-item.art-current .art-icon-check{visibility:visible}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-left{justify-content:center;align-items:center;gap:5px;display:flex}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-left .art-setting-item-left-icon{height:var(--art-settings-icon-size);width:var(--art-settings-icon-size);justify-content:center;align-items:center;display:flex}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-right{justify-content:center;align-items:center;gap:5px;font-size:12px;display:flex}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-right .art-setting-item-right-tooltip{white-space:nowrap;color:#ffffff80}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-right .art-setting-item-right-icon{justify-content:center;align-items:center;min-width:32px;height:24px;display:flex}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-right .art-setting-range{appearance:none;background-color:#fff3;outline:none;width:80px;height:3px}.art-video-player .art-settings .art-setting-panel .art-setting-item-back{border-bottom:1px solid #ffffff1a}.art-video-player.art-setting-show .art-settings{display:flex}.art-video-player .art-info{left:var(--art-padding);top:var(--art-padding);z-index:100;border-radius:var(--art-border-radius);background-color:var(--art-widget-background);padding:10px;font-size:12px;display:none;position:absolute}.art-video-player .art-info .art-info-panel{flex-direction:column;gap:5px;display:flex}.art-video-player .art-info .art-info-panel .art-info-item{align-items:center;gap:5px;display:flex}.art-video-player .art-info .art-info-panel .art-info-item .art-info-title{text-align:right;width:100px}.art-video-player .art-info .art-info-panel .art-info-item .art-info-content{text-overflow:ellipsis;white-space:nowrap;user-select:all;width:250px;overflow:hidden}.art-video-player .art-info .art-info-close{cursor:pointer;position:absolute;top:5px;right:5px}.art-video-player.art-info-show .art-info{display:flex}.art-hide-cursor *{cursor:none!important}.art-video-player[data-aspect-ratio]{overflow:hidden}.art-video-player[data-aspect-ratio] .art-video{object-fit:fill;box-sizing:content-box}.art-fullscreen{--art-progress-height:8px;--art-indicator-size:20px;--art-control-height:60px;--art-control-icon-scale:1.3}.art-fullscreen-web{--art-progress-height:8px;--art-indicator-size:20px;--art-control-height:60px;--art-control-icon-scale:1.3;z-index:var(--art-fullscreen-web-index);width:100%;height:100%;position:fixed;inset:0}.art-mini-popup{z-index:9999;border-radius:var(--art-border-radius);cursor:move;user-select:none;background:#000;width:320px;height:180px;transition:opacity .2s;position:fixed;overflow:hidden;box-shadow:0 0 5px #00000080}.art-mini-popup svg{fill:#fff}.art-mini-popup .art-video{pointer-events:none}.art-mini-popup .art-mini-close{z-index:20;cursor:pointer;opacity:0;transition:opacity .2s;position:absolute;top:10px;right:10px}.art-mini-popup .art-mini-state{z-index:30;pointer-events:none;opacity:0;background-color:#00000040;justify-content:center;align-items:center;width:100%;height:100%;transition:opacity .2s;display:flex;position:absolute;inset:0}.art-mini-popup .art-mini-state .art-icon{opacity:.75;cursor:pointer;pointer-events:auto;transition:transform .2s;transform:scale(3)}.art-mini-popup .art-mini-state .art-icon:active{transform:scale(2.5)}.art-mini-popup.art-mini-droging{opacity:.9}.art-mini-popup:hover .art-mini-close,.art-mini-popup:hover .art-mini-state{opacity:1}.art-video-player[data-flip=horizontal] .art-video{transform:scaleX(-1)}.art-video-player[data-flip=vertical] .art-video{transform:scaleY(-1)}.art-video-player .art-layer-lock{height:var(--art-lock-size);width:var(--art-lock-size);top:50%;left:var(--art-padding);background-color:var(--art-tip-background);border-radius:50%;justify-content:center;align-items:center;display:none;position:absolute;transform:translateY(-50%)}.art-video-player .art-layer-auto-playback{border-radius:var(--art-border-radius);left:var(--art-padding);bottom:calc(var(--art-control-height) + var(--art-bottom-gap) + 10px);background-color:var(--art-widget-background);align-items:center;gap:10px;padding:10px;line-height:1;display:none;position:absolute}.art-video-player .art-layer-auto-playback .art-auto-playback-close{cursor:pointer;justify-content:center;align-items:center;display:flex}.art-video-player .art-layer-auto-playback .art-auto-playback-close svg{fill:var(--art-theme);width:15px;height:15px}.art-video-player .art-layer-auto-playback .art-auto-playback-jump{color:var(--art-theme);cursor:pointer}.art-video-player.art-lock .art-subtitle{bottom:var(--art-subtitle-bottom)!important}.art-video-player.art-mini-progress-bar .art-bottom,.art-video-player.art-lock .art-bottom{opacity:1;background-image:none;padding:0}.art-video-player.art-mini-progress-bar .art-bottom .art-controls,.art-video-player.art-lock .art-bottom .art-controls,.art-video-player.art-mini-progress-bar .art-bottom .art-progress,.art-video-player.art-lock .art-bottom .art-progress{transform:translateY(calc(var(--art-control-height) + var(--art-bottom-gap) + var(--art-progress-height)/4))}.art-video-player.art-mini-progress-bar .art-bottom .art-progress-indicator,.art-video-player.art-lock .art-bottom .art-progress-indicator{display:none!important}.art-video-player.art-control-show .art-layer-lock{display:flex}.art-control-selector{position:relative}.art-control-selector .art-selector-list{text-align:center;border-radius:var(--art-border-radius);opacity:0;pointer-events:none;bottom:var(--art-control-height);max-height:var(--art-selector-max-height);background-color:var(--art-widget-background);transition:all var(--art-transition-duration)ease;flex-direction:column;align-items:center;display:flex;position:absolute;overflow:hidden auto;transform:translateY(10px)}.art-control-selector .art-selector-list .art-selector-item{flex-shrink:0;justify-content:center;align-items:center;width:100%;padding:10px 15px;line-height:1;display:flex}.art-control-selector .art-selector-list .art-selector-item:hover{background-color:#ffffff1a}.art-control-selector .art-selector-list .art-selector-item:hover,.art-control-selector .art-selector-list .art-selector-item.art-current{color:var(--art-theme)}.art-control-selector:hover .art-selector-list{opacity:1;pointer-events:auto;transform:translateY(0)}[class*=hint--]{font-style:normal;display:inline-block;position:relative}[class*=hint--]:before,[class*=hint--]:after{visibility:hidden;opacity:0;z-index:1000000;pointer-events:none;transition:all .3s;position:absolute;transform:translate(0,0)}[class*=hint--]:hover:before,[class*=hint--]:hover:after{visibility:visible;opacity:1;transition-delay:.1s}[class*=hint--]:before{content:"";z-index:1000001;background:0 0;border:6px solid #0000;position:absolute}[class*=hint--]:after{color:#fff;white-space:nowrap;background:#000;padding:8px 10px;font-family:Helvetica Neue,Helvetica,Arial,sans-serif;font-size:12px;line-height:12px}[class*=hint--][aria-label]:after{content:attr(aria-label)}[class*=hint--][data-hint]:after{content:attr(data-hint)}[aria-label=""]:before,[aria-label=""]:after,[data-hint=""]:before,[data-hint=""]:after{display:none!important}.hint--top-left:before,.hint--top-right:before,.hint--top:before{border-top-color:#000}.hint--bottom-left:before,.hint--bottom-right:before,.hint--bottom:before{border-bottom-color:#000}.hint--left:before{border-left-color:#000}.hint--right:before{border-right-color:#000}.hint--top:before{margin-bottom:-11px}.hint--top:before,.hint--top:after{bottom:100%;left:50%}.hint--top:before{left:calc(50% - 6px)}.hint--top:after{transform:translate(-50%)}.hint--top:hover:before{transform:translateY(-8px)}.hint--top:hover:after{transform:translate(-50%)translateY(-8px)}.hint--bottom:before{margin-top:-11px}.hint--bottom:before,.hint--bottom:after{top:100%;left:50%}.hint--bottom:before{left:calc(50% - 6px)}.hint--bottom:after{transform:translate(-50%)}.hint--bottom:hover:before{transform:translateY(8px)}.hint--bottom:hover:after{transform:translate(-50%)translateY(8px)}.hint--right:before{margin-bottom:-6px;margin-left:-11px}.hint--right:after{margin-bottom:-14px}.hint--right:before,.hint--right:after{bottom:50%;left:100%}.hint--right:hover:before,.hint--right:hover:after{transform:translate(8px)}.hint--left:before{margin-bottom:-6px;margin-right:-11px}.hint--left:after{margin-bottom:-14px}.hint--left:before,.hint--left:after{bottom:50%;right:100%}.hint--left:hover:before,.hint--left:hover:after{transform:translate(-8px)}.hint--top-left:before{margin-bottom:-11px}.hint--top-left:before,.hint--top-left:after{bottom:100%;left:50%}.hint--top-left:before{left:calc(50% - 6px)}.hint--top-left:after{margin-left:12px;transform:translate(-100%)}.hint--top-left:hover:before{transform:translateY(-8px)}.hint--top-left:hover:after{transform:translate(-100%)translateY(-8px)}.hint--top-right:before{margin-bottom:-11px}.hint--top-right:before,.hint--top-right:after{bottom:100%;left:50%}.hint--top-right:before{left:calc(50% - 6px)}.hint--top-right:after{margin-left:-12px;transform:translate(0)}.hint--top-right:hover:before,.hint--top-right:hover:after{transform:translateY(-8px)}.hint--bottom-left:before{margin-top:-11px}.hint--bottom-left:before,.hint--bottom-left:after{top:100%;left:50%}.hint--bottom-left:before{left:calc(50% - 6px)}.hint--bottom-left:after{margin-left:12px;transform:translate(-100%)}.hint--bottom-left:hover:before{transform:translateY(8px)}.hint--bottom-left:hover:after{transform:translate(-100%)translateY(8px)}.hint--bottom-right:before{margin-top:-11px}.hint--bottom-right:before,.hint--bottom-right:after{top:100%;left:50%}.hint--bottom-right:before{left:calc(50% - 6px)}.hint--bottom-right:after{margin-left:-12px;transform:translate(0)}.hint--bottom-right:hover:before,.hint--bottom-right:hover:after{transform:translateY(8px)}.hint--small:after,.hint--medium:after,.hint--large:after{white-space:normal;word-wrap:break-word;line-height:1.4em}.hint--small:after{width:80px}.hint--medium:after{width:150px}.hint--large:after{width:300px}[class*=hint--]:after{text-shadow:0 -1px #000;box-shadow:4px 4px 8px #0000004d}.hint--error:after{text-shadow:0 -1px #592726;background-color:#b34e4d}.hint--error.hint--top-left:before,.hint--error.hint--top-right:before,.hint--error.hint--top:before{border-top-color:#b34e4d}.hint--error.hint--bottom-left:before,.hint--error.hint--bottom-right:before,.hint--error.hint--bottom:before{border-bottom-color:#b34e4d}.hint--error.hint--left:before{border-left-color:#b34e4d}.hint--error.hint--right:before{border-right-color:#b34e4d}.hint--warning:after{text-shadow:0 -1px #6c5328;background-color:#c09854}.hint--warning.hint--top-left:before,.hint--warning.hint--top-right:before,.hint--warning.hint--top:before{border-top-color:#c09854}.hint--warning.hint--bottom-left:before,.hint--warning.hint--bottom-right:before,.hint--warning.hint--bottom:before{border-bottom-color:#c09854}.hint--warning.hint--left:before{border-left-color:#c09854}.hint--warning.hint--right:before{border-right-color:#c09854}.hint--info:after{text-shadow:0 -1px #1a3c4d;background-color:#3986ac}.hint--info.hint--top-left:before,.hint--info.hint--top-right:before,.hint--info.hint--top:before{border-top-color:#3986ac}.hint--info.hint--bottom-left:before,.hint--info.hint--bottom-right:before,.hint--info.hint--bottom:before{border-bottom-color:#3986ac}.hint--info.hint--left:before{border-left-color:#3986ac}.hint--info.hint--right:before{border-right-color:#3986ac}.hint--success:after{text-shadow:0 -1px #1a321a;background-color:#458746}.hint--success.hint--top-left:before,.hint--success.hint--top-right:before,.hint--success.hint--top:before{border-top-color:#458746}.hint--success.hint--bottom-left:before,.hint--success.hint--bottom-right:before,.hint--success.hint--bottom:before{border-bottom-color:#458746}.hint--success.hint--left:before{border-left-color:#458746}.hint--success.hint--right:before{border-right-color:#458746}.hint--always:after,.hint--always:before{opacity:1;visibility:visible}.hint--always.hint--top:before{transform:translateY(-8px)}.hint--always.hint--top:after{transform:translate(-50%)translateY(-8px)}.hint--always.hint--top-left:before{transform:translateY(-8px)}.hint--always.hint--top-left:after{transform:translate(-100%)translateY(-8px)}.hint--always.hint--top-right:before,.hint--always.hint--top-right:after{transform:translateY(-8px)}.hint--always.hint--bottom:before{transform:translateY(8px)}.hint--always.hint--bottom:after{transform:translate(-50%)translateY(8px)}.hint--always.hint--bottom-left:before{transform:translateY(8px)}.hint--always.hint--bottom-left:after{transform:translate(-100%)translateY(8px)}.hint--always.hint--bottom-right:before,.hint--always.hint--bottom-right:after{transform:translateY(8px)}.hint--always.hint--left:before,.hint--always.hint--left:after{transform:translate(-8px)}.hint--always.hint--right:before,.hint--always.hint--right:after{transform:translate(8px)}.hint--rounded:after{border-radius:4px}.hint--no-animate:before,.hint--no-animate:after{transition-duration:0s}.hint--bounce:before,.hint--bounce:after{-webkit-transition:opacity .3s,visibility .3s,-webkit-transform .3s cubic-bezier(.71,1.7,.77,1.24);-moz-transition:opacity .3s,visibility .3s,-moz-transform .3s cubic-bezier(.71,1.7,.77,1.24);transition:opacity .3s,visibility .3s,transform .3s cubic-bezier(.71,1.7,.77,1.24)}.hint--no-shadow:before,.hint--no-shadow:after{text-shadow:initial;box-shadow:initial}.hint--no-arrow:before{display:none}.art-video-player.art-mobile{--art-bottom-gap:10px;--art-control-height:38px;--art-control-icon-scale:1;--art-state-size:60px;--art-settings-max-height:180px;--art-selector-max-height:180px;--art-indicator-scale:1;--art-control-opacity:1}.art-video-player.art-mobile .art-controls-left{margin-left:calc(var(--art-padding)/-1)}.art-video-player.art-mobile .art-controls-right{margin-right:calc(var(--art-padding)/-1)}'},{}],"9I0i9":[function(e,i,r){var s;s=function(){function n(h){return(n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(p){return typeof p}:function(p){return p&&typeof Symbol=="function"&&p.constructor===Symbol&&p!==Symbol.prototype?"symbol":typeof p})(h)}var o=Object.prototype.toString,a=function(h){if(h===void 0)return"undefined";if(h===null)return"null";var p=n(h);if(p==="boolean")return"boolean";if(p==="string")return"string";if(p==="number")return"number";if(p==="symbol")return"symbol";if(p==="function")return l(h)==="GeneratorFunction"?"generatorfunction":"function";if(Array.isArray?Array.isArray(h):h instanceof Array)return"array";if(h.constructor&&typeof h.constructor.isBuffer=="function"&&h.constructor.isBuffer(h))return"buffer";if(function(g){try{if(typeof g.length=="number"&&typeof g.callee=="function")return!0}catch(x){if(x.message.indexOf("callee")!==-1)return!0}return!1}(h))return"arguments";if(h instanceof Date||typeof h.toDateString=="function"&&typeof h.getDate=="function"&&typeof h.setDate=="function")return"date";if(h instanceof Error||typeof h.message=="string"&&h.constructor&&typeof h.constructor.stackTraceLimit=="number")return"error";if(h instanceof RegExp||typeof h.flags=="string"&&typeof h.ignoreCase=="boolean"&&typeof h.multiline=="boolean"&&typeof h.global=="boolean")return"regexp";switch(l(h)){case"Symbol":return"symbol";case"Promise":return"promise";case"WeakMap":return"weakmap";case"WeakSet":return"weakset";case"Map":return"map";case"Set":return"set";case"Int8Array":return"int8array";case"Uint8Array":return"uint8array";case"Uint8ClampedArray":return"uint8clampedarray";case"Int16Array":return"int16array";case"Uint16Array":return"uint16array";case"Int32Array":return"int32array";case"Uint32Array":return"uint32array";case"Float32Array":return"float32array";case"Float64Array":return"float64array"}if(typeof h.throw=="function"&&typeof h.return=="function"&&typeof h.next=="function")return"generator";switch(p=o.call(h)){case"[object Object]":return"object";case"[object Map Iterator]":return"mapiterator";case"[object Set Iterator]":return"setiterator";case"[object String Iterator]":return"stringiterator";case"[object Array Iterator]":return"arrayiterator"}return p.slice(8,-1).toLowerCase().replace(/\s/g,"")};function l(h){return h.constructor?h.constructor.name:null}function d(h,p){var g=2<arguments.length&&arguments[2]!==void 0?arguments[2]:["option"];return c(h,p,g),f(h,p,g),function(x,E,k){var O=a(E),T=a(x);if(O==="object"){if(T!=="object")throw Error("[Type Error]: '".concat(k.join("."),"' require 'object' type, but got '").concat(T,"'"));Object.keys(E).forEach(function(R){var C=x[R],b=E[R],A=k.slice();A.push(R),c(C,b,A),f(C,b,A),d(C,b,A)})}if(O==="array"){if(T!=="array")throw Error("[Type Error]: '".concat(k.join("."),"' require 'array' type, but got '").concat(T,"'"));x.forEach(function(R,C){var b=x[C],A=E[C]||E[0],L=k.slice();L.push(C),c(b,A,L),f(b,A,L),d(b,A,L)})}}(h,p,g),h}function c(h,p,g){if(a(p)==="string"){var x=a(h);if(p[0]==="?"&&(p=p.slice(1)+"|undefined"),!(-1<p.indexOf("|")?p.split("|").map(function(E){return E.toLowerCase().trim()}).filter(Boolean).some(function(E){return x===E}):p.toLowerCase().trim()===x))throw Error("[Type Error]: '".concat(g.join("."),"' require '").concat(p,"' type, but got '").concat(x,"'"))}}function f(h,p,g){if(a(p)==="function"){var x=p(h,a(h),g);if(x!==!0){var E=a(x);throw E==="string"?Error(x):E==="error"?x:Error("[Validator Error]: The scheme for '".concat(g.join("."),"' validator require return true, but got '").concat(x,"'"))}}}return d.kindOf=a,d},i.exports=s()},{}],"2bGVu":[function(e,i,r){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(r),r.default=class{on(s,n,o){let a=this.e||(this.e={});return(a[s]||(a[s]=[])).push({fn:n,ctx:o}),this}once(s,n,o){let a=this;function l(...d){a.off(s,l),n.apply(o,d)}return l._=n,this.on(s,l,o)}emit(s,...n){let o=((this.e||(this.e={}))[s]||[]).slice();for(let a=0;a<o.length;a+=1)o[a].fn.apply(o[a].ctx,n);return this}off(s,n){let o=this.e||(this.e={}),a=o[s],l=[];if(a&&n)for(let d=0,c=a.length;d<c;d+=1)a[d].fn!==n&&a[d].fn._!==n&&l.push(a[d]);return l.length?o[s]=l:delete o[s],this}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],guZOB:[function(e,i,r){r.interopDefault=function(s){return s&&s.__esModule?s:{default:s}},r.defineInteropFlag=function(s){Object.defineProperty(s,"__esModule",{value:!0})},r.exportAll=function(s,n){return Object.keys(s).forEach(function(o){o==="default"||o==="__esModule"||Object.prototype.hasOwnProperty.call(n,o)||Object.defineProperty(n,o,{enumerable:!0,get:function(){return s[o]}})}),n},r.export=function(s,n,o){Object.defineProperty(s,n,{enumerable:!0,get:o})}},{}],h3rH9:[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r);var n=e("./dom");s.exportAll(n,r);var o=e("./error");s.exportAll(o,r);var a=e("./subtitle");s.exportAll(a,r);var l=e("./file");s.exportAll(l,r);var d=e("./property");s.exportAll(d,r);var c=e("./time");s.exportAll(c,r);var f=e("./format");s.exportAll(f,r);var h=e("./compatibility");s.exportAll(h,r)},{"./dom":"XgAQE","./error":"2nFlF","./subtitle":"yqFoT","./file":"1VRQn","./property":"3weX2","./time":"7kBIx","./format":"13atT","./compatibility":"luXC1","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],XgAQE:[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"query",()=>o),s.export(r,"queryAll",()=>a),s.export(r,"addClass",()=>l),s.export(r,"removeClass",()=>d),s.export(r,"hasClass",()=>c),s.export(r,"append",()=>f),s.export(r,"remove",()=>h),s.export(r,"setStyle",()=>p),s.export(r,"setStyles",()=>g),s.export(r,"getStyle",()=>x),s.export(r,"sublings",()=>E),s.export(r,"inverseClass",()=>k),s.export(r,"tooltip",()=>O),s.export(r,"isInViewport",()=>T),s.export(r,"includeFromEvent",()=>R),s.export(r,"replaceElement",()=>C),s.export(r,"createElement",()=>b),s.export(r,"getIcon",()=>A),s.export(r,"setStyleText",()=>L),s.export(r,"supportsFlex",()=>I),s.export(r,"getRect",()=>j);var n=e("./compatibility");function o(F,$=document){return $.querySelector(F)}function a(F,$=document){return Array.from($.querySelectorAll(F))}function l(F,$){return F.classList.add($)}function d(F,$){return F.classList.remove($)}function c(F,$){return F.classList.contains($)}function f(F,$){return $ instanceof Element?F.appendChild($):F.insertAdjacentHTML("beforeend",String($)),F.lastElementChild||F.lastChild}function h(F){return F.parentNode.removeChild(F)}function p(F,$,V){return F.style[$]=V,F}function g(F,$){for(let V in $)p(F,V,$[V]);return F}function x(F,$,V=!0){let Q=window.getComputedStyle(F,null).getPropertyValue($);return V?parseFloat(Q):Q}function E(F){return Array.from(F.parentElement.children).filter($=>$!==F)}function k(F,$){E(F).forEach(V=>d(V,$)),l(F,$)}function O(F,$,V="top"){n.isMobile||(F.setAttribute("aria-label",$),l(F,"hint--rounded"),l(F,`hint--${V}`))}function T(F,$=0){let V=F.getBoundingClientRect(),Q=window.innerHeight||document.documentElement.clientHeight,z=window.innerWidth||document.documentElement.clientWidth,B=V.top-$<=Q&&V.top+V.height+$>=0,w=V.left-$<=z+$&&V.left+V.width+$>=0;return B&&w}function R(F,$){return F.composedPath&&F.composedPath().indexOf($)>-1}function C(F,$){return $.parentNode.replaceChild(F,$),F}function b(F){return document.createElement(F)}function A(F="",$=""){let V=b("i");return l(V,"art-icon"),l(V,`art-icon-${F}`),f(V,$),V}function L(F,$){let V=document.getElementById(F);if(V)V.textContent=$;else{let Q=b("style");Q.id=F,Q.textContent=$,document.head.appendChild(Q)}}function I(){let F=document.createElement("div");return F.style.display="flex",F.style.display==="flex"}function j(F){return F.getBoundingClientRect()}},{"./compatibility":"luXC1","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],luXC1:[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"userAgent",()=>n),s.export(r,"isSafari",()=>o),s.export(r,"isWechat",()=>a),s.export(r,"isIE",()=>l),s.export(r,"isAndroid",()=>d),s.export(r,"isIOS",()=>c),s.export(r,"isIOS13",()=>f),s.export(r,"isMobile",()=>h),s.export(r,"isBrowser",()=>p);let n=typeof navigator!="undefined"?navigator.userAgent:"",o=/^((?!chrome|android).)*safari/i.test(n),a=/MicroMessenger/i.test(n),l=/MSIE|Trident/i.test(n),d=/android/i.test(n),c=/iPad|iPhone|iPod/i.test(n)&&!window.MSStream,f=c||n.includes("Macintosh")&&navigator.maxTouchPoints>=1,h=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(n)||f,p=typeof window!="undefined"},{"@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],"2nFlF":[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"ArtPlayerError",()=>n),s.export(r,"errorHandle",()=>o);class n extends Error{constructor(l,d){super(l),typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,d||this.constructor),this.name="ArtPlayerError"}}function o(a,l){if(!a)throw new n(l);return a}},{"@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],yqFoT:[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");function n(l){return`WEBVTT \r
\r
`.concat(l.replace(/(\d\d:\d\d:\d\d)[,.](\d+)/g,(d,c,f)=>{let h=f.slice(0,3);return f.length===1&&(h=f+"00"),f.length===2&&(h=f+"0"),`${c},${h}`}).replace(/\{\\([ibu])\}/g,"</$1>").replace(/\{\\([ibu])1\}/g,"<$1>").replace(/\{([ibu])\}/g,"<$1>").replace(/\{\/([ibu])\}/g,"</$1>").replace(/(\d\d:\d\d:\d\d),(\d\d\d)/g,"$1.$2").replace(/{[\s\S]*?}/g,"").concat(`\r
\r
`))}function o(l){return URL.createObjectURL(new Blob([l],{type:"text/vtt"}))}function a(l){let d=RegExp("Dialogue:\\s\\d,(\\d+:\\d\\d:\\d\\d.\\d\\d),(\\d+:\\d\\d:\\d\\d.\\d\\d),([^,]*),([^,]*),(?:[^,]*,){4}([\\s\\S]*)$","i");function c(f=""){return f.split(/[:.]/).map((h,p,g)=>{if(p===g.length-1){if(h.length===1)return`.${h}00`;if(h.length===2)return`.${h}0`}else if(h.length===1)return(p===0?"0":":0")+h;return p===0?h:p===g.length-1?`.${h}`:`:${h}`}).join("")}return`WEBVTT

`+l.split(/\r?\n/).map(f=>{let h=f.match(d);return h?{start:c(h[1].trim()),end:c(h[2].trim()),text:h[5].replace(/{[\s\S]*?}/g,"").replace(/(\\N)/g,`
`).trim().split(/\r?\n/).map(p=>p.trim()).join(`
`)}:null}).filter(f=>f).map((f,h)=>f?h+1+`
${f.start} --> ${f.end}
${f.text}`:"").filter(f=>f.trim()).join(`

`)}s.defineInteropFlag(r),s.export(r,"srtToVtt",()=>n),s.export(r,"vttToBlob",()=>o),s.export(r,"assToVtt",()=>a)},{"@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],"1VRQn":[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");function n(o,a){let l=document.createElement("a");l.style.display="none",l.href=o,l.download=a,document.body.appendChild(l),l.click(),document.body.removeChild(l)}s.defineInteropFlag(r),s.export(r,"getExt",()=>function o(a){return a.includes("?")?o(a.split("?")[0]):a.includes("#")?o(a.split("#")[0]):a.trim().toLowerCase().split(".").pop()}),s.export(r,"download",()=>n)},{"@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],"3weX2":[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"def",()=>n),s.export(r,"has",()=>a),s.export(r,"get",()=>l),s.export(r,"mergeDeep",()=>function d(...c){let f=h=>h&&typeof h=="object"&&!Array.isArray(h);return c.reduce((h,p)=>(Object.keys(p).forEach(g=>{let x=h[g],E=p[g];Array.isArray(x)&&Array.isArray(E)?h[g]=x.concat(...E):f(x)&&f(E)?h[g]=d(x,E):h[g]=E}),h),{})});let n=Object.defineProperty,{hasOwnProperty:o}=Object.prototype;function a(d,c){return o.call(d,c)}function l(d,c){return Object.getOwnPropertyDescriptor(d,c)}},{"@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],"7kBIx":[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");function n(l=0){return new Promise(d=>setTimeout(d,l))}function o(l,d){let c;return function(...f){clearTimeout(c),c=setTimeout(()=>(c=null,l.apply(this,f)),d)}}function a(l,d){let c=!1;return function(...f){c||(l.apply(this,f),c=!0,setTimeout(function(){c=!1},d))}}s.defineInteropFlag(r),s.export(r,"sleep",()=>n),s.export(r,"debounce",()=>o),s.export(r,"throttle",()=>a)},{"@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],"13atT":[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");function n(f,h,p){return Math.max(Math.min(f,Math.max(h,p)),Math.min(h,p))}function o(f){return f.charAt(0).toUpperCase()+f.slice(1)}function a(f){return["string","number"].includes(typeof f)}function l(f){if(!f)return"00:00";let h=Math.floor(f/3600),p=Math.floor((f-3600*h)/60),g=Math.floor(f-3600*h-60*p);return(h>0?[h,p,g]:[p,g]).map(x=>x<10?`0${x}`:String(x)).join(":")}function d(f){return f.replace(/[&<>'"]/g,h=>({"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"})[h]||h)}function c(f){let h={"&amp;":"&","&lt;":"<","&gt;":">","&#39;":"'","&quot;":'"'},p=RegExp(`(${Object.keys(h).join("|")})`,"g");return f.replace(p,g=>h[g]||g)}s.defineInteropFlag(r),s.export(r,"clamp",()=>n),s.export(r,"capitalize",()=>o),s.export(r,"isStringOrNumber",()=>a),s.export(r,"secondToTime",()=>l),s.export(r,"escape",()=>d),s.export(r,"unescape",()=>c)},{"@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],AdvwB:[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"ComponentOption",()=>p);var n=e("../utils");let o="array",a="boolean",l="string",d="number",c="object",f="function";function h(g,x,E){return(0,n.errorHandle)(x===l||x===d||g instanceof Element,`${E.join(".")} require '${l}' or 'Element' type`)}let p={html:h,disable:`?${a}`,name:`?${l}`,index:`?${d}`,style:`?${c}`,click:`?${f}`,mounted:`?${f}`,tooltip:`?${l}|${d}`,width:`?${d}`,selector:`?${o}`,onSelect:`?${f}`,switch:`?${a}`,onSwitch:`?${f}`,range:`?${o}`,onRange:`?${f}`,onChange:`?${f}`};r.default={id:l,container:h,url:l,poster:l,type:l,theme:l,lang:l,volume:d,isLive:a,muted:a,autoplay:a,autoSize:a,autoMini:a,loop:a,flip:a,playbackRate:a,aspectRatio:a,screenshot:a,setting:a,hotkey:a,pip:a,mutex:a,backdrop:a,fullscreen:a,fullscreenWeb:a,subtitleOffset:a,miniProgressBar:a,useSSR:a,playsInline:a,lock:a,fastForward:a,autoPlayback:a,autoOrientation:a,airplay:a,plugins:[f],layers:[p],contextmenu:[p],settings:[p],controls:[jt(Nt({},p),{position:(g,x,E)=>{let k=["top","left","right"];return(0,n.errorHandle)(k.includes(g),`${E.join(".")} only accept ${k.toString()} as parameters`)}})],quality:[{default:`?${a}`,html:l,url:l}],highlight:[{time:d,text:l}],thumbnails:{url:l,number:d,column:d,width:d,height:d},subtitle:{url:l,name:l,type:l,style:c,escape:a,encoding:l,onVttLoad:f},moreVideoAttr:c,i18n:c,icons:c,cssVar:c,customType:c}},{"../utils":"h3rH9","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],"9Xmqu":[function(e,i,r){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(r),r.default={propertys:["audioTracks","autoplay","buffered","controller","controls","crossOrigin","currentSrc","currentTime","defaultMuted","defaultPlaybackRate","duration","ended","error","loop","mediaGroup","muted","networkState","paused","playbackRate","played","preload","readyState","seekable","seeking","src","startDate","textTracks","videoTracks","volume"],methods:["addTextTrack","canPlayType","load","play","pause"],events:["abort","canplay","canplaythrough","durationchange","emptied","ended","error","loadeddata","loadedmetadata","loadstart","pause","play","playing","progress","ratechange","seeked","seeking","stalled","suspend","timeupdate","volumechange","waiting"],prototypes:["width","height","videoWidth","videoHeight","poster","webkitDecodedFrameCount","webkitDroppedFrameCount","playsInline","webkitSupportsFullscreen","webkitDisplayingFullscreen","onenterpictureinpicture","onleavepictureinpicture","disablePictureInPicture","cancelVideoFrameCallback","requestVideoFrameCallback","getVideoPlaybackQuality","requestPictureInPicture","webkitEnterFullScreen","webkitEnterFullscreen","webkitExitFullScreen","webkitExitFullscreen"]}},{"@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],"2gKYH":[function(e,i,r){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(r);var s=e("./utils");class n{constructor(a){this.art=a;let{option:l,constructor:d}=a;l.container instanceof Element?this.$container=l.container:(this.$container=(0,s.query)(l.container),(0,s.errorHandle)(this.$container,`No container element found by ${l.container}`)),(0,s.errorHandle)((0,s.supportsFlex)(),"The current browser does not support flex layout");let c=this.$container.tagName.toLowerCase();(0,s.errorHandle)(c==="div",`Unsupported container element type, only support 'div' but got '${c}'`),(0,s.errorHandle)(d.instances.every(f=>f.template.$container!==this.$container),"Cannot mount multiple instances on the same dom element"),this.query=this.query.bind(this),this.$container.dataset.artId=a.id,this.init()}static get html(){return'<div class="art-video-player art-subtitle-show art-layer-show art-control-show art-mask-show"><video class="art-video"><track default kind="metadata" src=""></track></video><div class="art-poster"></div><div class="art-subtitle"></div><div class="art-danmuku"></div><div class="art-layers"></div><div class="art-mask"><div class="art-state"></div></div><div class="art-bottom"><div class="art-progress"></div><div class="art-controls"><div class="art-controls-left"></div><div class="art-controls-center"></div><div class="art-controls-right"></div></div></div><div class="art-loading"></div><div class="art-notice"><div class="art-notice-inner"></div></div><div class="art-settings"></div><div class="art-info"><div class="art-info-panel"><div class="art-info-item"><div class="art-info-title">Player version:</div><div class="art-info-content">5.1.6</div></div><div class="art-info-item"><div class="art-info-title">Video url:</div><div class="art-info-content" data-video="src"></div></div><div class="art-info-item"><div class="art-info-title">Video volume:</div><div class="art-info-content" data-video="volume"></div></div><div class="art-info-item"><div class="art-info-title">Video time:</div><div class="art-info-content" data-video="currentTime"></div></div><div class="art-info-item"><div class="art-info-title">Video duration:</div><div class="art-info-content" data-video="duration"></div></div><div class="art-info-item"><div class="art-info-title">Video resolution:</div><div class="art-info-content"><span data-video="videoWidth"></span>x<span data-video="videoHeight"></span></div></div></div><div class="art-info-close">[x]</div></div><div class="art-contextmenus"></div></div>'}query(a){return(0,s.query)(a,this.$container)}init(){let{option:a}=this.art;a.useSSR||(this.$container.innerHTML=n.html),this.$player=this.query(".art-video-player"),this.$video=this.query(".art-video"),this.$track=this.query("track"),this.$poster=this.query(".art-poster"),this.$subtitle=this.query(".art-subtitle"),this.$danmuku=this.query(".art-danmuku"),this.$bottom=this.query(".art-bottom"),this.$progress=this.query(".art-progress"),this.$controls=this.query(".art-controls"),this.$controlsLeft=this.query(".art-controls-left"),this.$controlsCenter=this.query(".art-controls-center"),this.$controlsRight=this.query(".art-controls-right"),this.$layer=this.query(".art-layers"),this.$loading=this.query(".art-loading"),this.$notice=this.query(".art-notice"),this.$noticeInner=this.query(".art-notice-inner"),this.$mask=this.query(".art-mask"),this.$state=this.query(".art-state"),this.$setting=this.query(".art-settings"),this.$info=this.query(".art-info"),this.$infoPanel=this.query(".art-info-panel"),this.$infoClose=this.query(".art-info-close"),this.$contextmenu=this.query(".art-contextmenus"),a.backdrop&&(0,s.addClass)(this.$player,"art-backdrop"),s.isMobile&&(0,s.addClass)(this.$player,"art-mobile")}destroy(a){a?this.$container.innerHTML="":(0,s.addClass)(this.$player,"art-destroy")}}r.default=n},{"./utils":"h3rH9","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],"1AdeF":[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r);var n=e("../utils"),o=e("./zh-cn"),a=s.interopDefault(o);r.default=class{constructor(l){this.art=l,this.languages={"zh-cn":a.default},this.language={},this.update(l.option.i18n)}init(){let l=this.art.option.lang.toLowerCase();this.language=this.languages[l]||{}}get(l){return this.language[l]||l}update(l){this.languages=(0,n.mergeDeep)(this.languages,l),this.init()}}},{"../utils":"h3rH9","./zh-cn":"3ZSKq","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],"3ZSKq":[function(e,i,r){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(r);let s={"Video Info":"\u7EDF\u8BA1\u4FE1\u606F",Close:"\u5173\u95ED","Video Load Failed":"\u52A0\u8F7D\u5931\u8D25",Volume:"\u97F3\u91CF",Play:"\u64AD\u653E",Pause:"\u6682\u505C",Rate:"\u901F\u5EA6",Mute:"\u9759\u97F3","Video Flip":"\u753B\u9762\u7FFB\u8F6C",Horizontal:"\u6C34\u5E73",Vertical:"\u5782\u76F4",Reconnect:"\u91CD\u65B0\u8FDE\u63A5","Show Setting":"\u663E\u793A\u8BBE\u7F6E","Hide Setting":"\u9690\u85CF\u8BBE\u7F6E",Screenshot:"\u622A\u56FE","Play Speed":"\u64AD\u653E\u901F\u5EA6","Aspect Ratio":"\u753B\u9762\u6BD4\u4F8B",Default:"\u9ED8\u8BA4",Normal:"\u6B63\u5E38",Open:"\u6253\u5F00","Switch Video":"\u5207\u6362","Switch Subtitle":"\u5207\u6362\u5B57\u5E55",Fullscreen:"\u5168\u5C4F","Exit Fullscreen":"\u9000\u51FA\u5168\u5C4F","Web Fullscreen":"\u7F51\u9875\u5168\u5C4F","Exit Web Fullscreen":"\u9000\u51FA\u7F51\u9875\u5168\u5C4F","Mini Player":"\u8FF7\u4F60\u64AD\u653E\u5668","PIP Mode":"\u5F00\u542F\u753B\u4E2D\u753B","Exit PIP Mode":"\u9000\u51FA\u753B\u4E2D\u753B","PIP Not Supported":"\u4E0D\u652F\u6301\u753B\u4E2D\u753B","Fullscreen Not Supported":"\u4E0D\u652F\u6301\u5168\u5C4F","Subtitle Offset":"\u5B57\u5E55\u504F\u79FB","Last Seen":"\u4E0A\u6B21\u770B\u5230","Jump Play":"\u8DF3\u8F6C\u64AD\u653E",AirPlay:"\u9694\u7A7A\u64AD\u653E","AirPlay Not Available":"\u9694\u7A7A\u64AD\u653E\u4E0D\u53EF\u7528"};r.default=s,typeof window!="undefined"&&(window["artplayer-i18n-zh-cn"]=s)},{"@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],"556MW":[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r);var n=e("./urlMix"),o=s.interopDefault(n),a=e("./attrMix"),l=s.interopDefault(a),d=e("./playMix"),c=s.interopDefault(d),f=e("./pauseMix"),h=s.interopDefault(f),p=e("./toggleMix"),g=s.interopDefault(p),x=e("./seekMix"),E=s.interopDefault(x),k=e("./volumeMix"),O=s.interopDefault(k),T=e("./currentTimeMix"),R=s.interopDefault(T),C=e("./durationMix"),b=s.interopDefault(C),A=e("./switchMix"),L=s.interopDefault(A),I=e("./playbackRateMix"),j=s.interopDefault(I),F=e("./aspectRatioMix"),$=s.interopDefault(F),V=e("./screenshotMix"),Q=s.interopDefault(V),z=e("./fullscreenMix"),B=s.interopDefault(z),w=e("./fullscreenWebMix"),P=s.interopDefault(w),G=e("./pipMix"),et=s.interopDefault(G),rt=e("./loadedMix"),dt=s.interopDefault(rt),vt=e("./playedMix"),Lt=s.interopDefault(vt),xt=e("./playingMix"),it=s.interopDefault(xt),at=e("./autoSizeMix"),lt=s.interopDefault(at),ct=e("./rectMix"),mt=s.interopDefault(ct),It=e("./flipMix"),Gt=s.interopDefault(It),Xt=e("./miniMix"),se=s.interopDefault(Xt),Yt=e("./posterMix"),Et=s.interopDefault(Yt),We=e("./autoHeightMix"),le=s.interopDefault(We),Ae=e("./cssVarMix"),Be=s.interopDefault(Ae),Le=e("./themeMix"),ge=s.interopDefault(Le),ke=e("./typeMix"),li=s.interopDefault(ke),ti=e("./stateMix"),Ye=s.interopDefault(ti),Hi=e("./subtitleOffsetMix"),Ki=s.interopDefault(Hi),Wi=e("./airplayMix"),Yi=s.interopDefault(Wi),Ce=e("./qualityMix"),_i=s.interopDefault(Ce),xi=e("./optionInit"),Ue=s.interopDefault(xi),Ei=e("./eventInit"),ye=s.interopDefault(Ei);r.default=class{constructor(kt){(0,o.default)(kt),(0,l.default)(kt),(0,c.default)(kt),(0,h.default)(kt),(0,g.default)(kt),(0,E.default)(kt),(0,O.default)(kt),(0,R.default)(kt),(0,b.default)(kt),(0,L.default)(kt),(0,j.default)(kt),(0,$.default)(kt),(0,Q.default)(kt),(0,B.default)(kt),(0,P.default)(kt),(0,et.default)(kt),(0,dt.default)(kt),(0,Lt.default)(kt),(0,it.default)(kt),(0,lt.default)(kt),(0,mt.default)(kt),(0,Gt.default)(kt),(0,se.default)(kt),(0,Et.default)(kt),(0,le.default)(kt),(0,Be.default)(kt),(0,ge.default)(kt),(0,li.default)(kt),(0,Ye.default)(kt),(0,Ki.default)(kt),(0,Yi.default)(kt),(0,_i.default)(kt),(0,ye.default)(kt),(0,Ue.default)(kt)}}},{"./urlMix":"2mRAc","./attrMix":"2EA19","./playMix":"fD2Tc","./pauseMix":"c3LGJ","./toggleMix":"fVsAa","./seekMix":"dmROF","./volumeMix":"9jtfB","./currentTimeMix":"7NCDR","./durationMix":"YS7JL","./switchMix":"dzUqN","./playbackRateMix":"5I2mT","./aspectRatioMix":"7m6R8","./screenshotMix":"2dgtR","./fullscreenMix":"fKDW8","./fullscreenWebMix":"lNvYI","./pipMix":"8j7oC","./loadedMix":"dwVOT","./playedMix":"dDeLx","./playingMix":"ceoBp","./autoSizeMix":"lcWXX","./rectMix":"f7y88","./flipMix":"l4qt5","./miniMix":"9ZPBQ","./posterMix":"5K8hA","./autoHeightMix":"3T5ls","./cssVarMix":"6KfHs","./themeMix":"7lcSc","./typeMix":"8JgTw","./stateMix":"cebt1","./subtitleOffsetMix":"hJvIy","./airplayMix":"4Tp0U","./qualityMix":"3wZgN","./optionInit":"iPdgW","./eventInit":"3mj0J","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],"2mRAc":[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=e("../utils");function o(a){let{option:l,template:{$video:d}}=a;(0,n.def)(a,"url",{get:()=>d.src,set(f){return zt(this,null,function*(){if(f){let h=a.url,p=l.type||(0,n.getExt)(f),g=l.customType[p];p&&g?(yield(0,n.sleep)(),a.loading.show=!0,g.call(a,d,f,a)):(URL.revokeObjectURL(h),d.src=f),h!==a.url&&(a.option.url=f,a.isReady&&h&&a.once("video:canplay",()=>{a.emit("restart",f)}))}else yield(0,n.sleep)(),a.loading.show=!0})}})}},{"../utils":"h3rH9","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],"2EA19":[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=e("../utils");function o(a){let{template:{$video:l}}=a;(0,n.def)(a,"attr",{value(d,c){if(c===void 0)return l[d];l[d]=c}})}},{"../utils":"h3rH9","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],fD2Tc:[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=e("../utils");function o(a){let{i18n:l,notice:d,option:c,constructor:{instances:f},template:{$video:h}}=a;(0,n.def)(a,"play",{value:function(){return zt(this,null,function*(){let p=yield h.play();if(d.show=l.get("Play"),a.emit("play"),c.mutex)for(let g=0;g<f.length;g++){let x=f[g];x!==a&&x.pause()}return p})}})}},{"../utils":"h3rH9","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],c3LGJ:[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=e("../utils");function o(a){let{template:{$video:l},i18n:d,notice:c}=a;(0,n.def)(a,"pause",{value(){let f=l.pause();return c.show=d.get("Pause"),a.emit("pause"),f}})}},{"../utils":"h3rH9","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],fVsAa:[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=e("../utils");function o(a){(0,n.def)(a,"toggle",{value:()=>a.playing?a.pause():a.play()})}},{"../utils":"h3rH9","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],dmROF:[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=e("../utils");function o(a){let{notice:l}=a;(0,n.def)(a,"seek",{set(d){a.currentTime=d,a.emit("seek",a.currentTime),a.duration&&(l.show=`${(0,n.secondToTime)(a.currentTime)} / ${(0,n.secondToTime)(a.duration)}`)}}),(0,n.def)(a,"forward",{set(d){a.seek=a.currentTime+d}}),(0,n.def)(a,"backward",{set(d){a.seek=a.currentTime-d}})}},{"../utils":"h3rH9","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],"9jtfB":[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=e("../utils");function o(a){let{template:{$video:l},i18n:d,notice:c,storage:f}=a;(0,n.def)(a,"volume",{get:()=>l.volume||0,set:h=>{l.volume=(0,n.clamp)(h,0,1),c.show=`${d.get("Volume")}: ${parseInt(100*l.volume,10)}`,l.volume!==0&&f.set("volume",l.volume)}}),(0,n.def)(a,"muted",{get:()=>l.muted,set:h=>{l.muted=h,a.emit("muted",h)}})}},{"../utils":"h3rH9","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],"7NCDR":[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=e("../utils");function o(a){let{$video:l}=a.template;(0,n.def)(a,"currentTime",{get:()=>l.currentTime||0,set:d=>{Number.isNaN(d=parseFloat(d))||(l.currentTime=(0,n.clamp)(d,0,a.duration))}})}},{"../utils":"h3rH9","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],YS7JL:[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=e("../utils");function o(a){(0,n.def)(a,"duration",{get:()=>{let{duration:l}=a.template.$video;return l===1/0?0:l||0}})}},{"../utils":"h3rH9","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],dzUqN:[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=e("../utils");function o(a){function l(d,c){return new Promise((f,h)=>{if(d===a.url)return;let{playing:p,aspectRatio:g,playbackRate:x}=a;a.pause(),a.url=d,a.notice.show="",a.once("video:error",h),a.once("video:loadedmetadata",()=>{a.currentTime=c}),a.once("video:canplay",()=>zt(this,null,function*(){a.playbackRate=x,a.aspectRatio=g,p&&(yield a.play()),a.notice.show="",f()}))})}(0,n.def)(a,"switchQuality",{value:d=>l(d,a.currentTime)}),(0,n.def)(a,"switchUrl",{value:d=>l(d,0)}),(0,n.def)(a,"switch",{set:a.switchUrl})}},{"../utils":"h3rH9","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],"5I2mT":[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=e("../utils");function o(a){let{template:{$video:l},i18n:d,notice:c}=a;(0,n.def)(a,"playbackRate",{get:()=>l.playbackRate,set(f){f?f!==l.playbackRate&&(l.playbackRate=f,c.show=`${d.get("Rate")}: ${f===1?d.get("Normal"):`${f}x`}`):a.playbackRate=1}})}},{"../utils":"h3rH9","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],"7m6R8":[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=e("../utils");function o(a){let{i18n:l,notice:d,template:{$video:c,$player:f}}=a;(0,n.def)(a,"aspectRatio",{get:()=>f.dataset.aspectRatio||"default",set(h){if(h||(h="default"),h==="default")(0,n.setStyle)(c,"width",null),(0,n.setStyle)(c,"height",null),(0,n.setStyle)(c,"margin",null),delete f.dataset.aspectRatio;else{let p=h.split(":").map(Number),{clientWidth:g,clientHeight:x}=f,E=p[0]/p[1];g/x>E?((0,n.setStyle)(c,"width",`${E*x}px`),(0,n.setStyle)(c,"height","100%"),(0,n.setStyle)(c,"margin","0 auto")):((0,n.setStyle)(c,"width","100%"),(0,n.setStyle)(c,"height",`${g/E}px`),(0,n.setStyle)(c,"margin","auto 0")),f.dataset.aspectRatio=h}d.show=`${l.get("Aspect Ratio")}: ${h==="default"?l.get("Default"):h}`,a.emit("aspectRatio",h)}})}},{"../utils":"h3rH9","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],"2dgtR":[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=e("../utils");function o(a){let{notice:l,template:{$video:d}}=a,c=(0,n.createElement)("canvas");(0,n.def)(a,"getDataURL",{value:()=>new Promise((f,h)=>{try{c.width=d.videoWidth,c.height=d.videoHeight,c.getContext("2d").drawImage(d,0,0),f(c.toDataURL("image/png"))}catch(p){l.show=p,h(p)}})}),(0,n.def)(a,"getBlobUrl",{value:()=>new Promise((f,h)=>{try{c.width=d.videoWidth,c.height=d.videoHeight,c.getContext("2d").drawImage(d,0,0),c.toBlob(p=>{f(URL.createObjectURL(p))})}catch(p){l.show=p,h(p)}})}),(0,n.def)(a,"screenshot",{value:()=>zt(this,null,function*(){let f=yield a.getDataURL();return(0,n.download)(f,`artplayer_${(0,n.secondToTime)(d.currentTime)}.png`),a.emit("screenshot",f),f})})}},{"../utils":"h3rH9","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],fKDW8:[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>l);var n=e("../libs/screenfull"),o=s.interopDefault(n),a=e("../utils");function l(d){let{i18n:c,notice:f,template:{$video:h,$player:p}}=d,g=E=>{o.default.on("change",()=>{E.emit("fullscreen",o.default.isFullscreen)}),o.default.on("error",O=>{E.emit("fullscreenError",O)}),(0,a.def)(E,"fullscreen",{get:()=>o.default.isFullscreen,set(O){return zt(this,null,function*(){O?(E.state="fullscreen",yield o.default.request(p),(0,a.addClass)(p,"art-fullscreen")):(yield o.default.exit(),(0,a.removeClass)(p,"art-fullscreen")),E.emit("resize")})}})},x=E=>{E.proxy(document,"webkitfullscreenchange",()=>{E.emit("fullscreen",E.fullscreen),E.emit("resize")}),(0,a.def)(E,"fullscreen",{get:()=>document.fullscreenElement===h,set(k){k?(E.state="fullscreen",h.webkitEnterFullscreen()):h.webkitExitFullscreen()}})};d.once("video:loadedmetadata",()=>{o.default.isEnabled?g(d):h.webkitSupportsFullscreen?x(d):(0,a.def)(d,"fullscreen",{get:()=>!1,set(){f.show=c.get("Fullscreen Not Supported")}}),(0,a.def)(d,"fullscreen",(0,a.get)(d,"fullscreen"))})}},{"../libs/screenfull":"lUahW","../utils":"h3rH9","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],lUahW:[function(e,i,r){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(r);let s=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],n=(()=>{if(typeof document=="undefined")return!1;let l=s[0],d={};for(let c of s)if(c[1]in document){for(let[f,h]of c.entries())d[l[f]]=h;return d}return!1})(),o={change:n.fullscreenchange,error:n.fullscreenerror},a={request:(l=document.documentElement,d)=>new Promise((c,f)=>{let h=()=>{a.off("change",h),c()};a.on("change",h);let p=l[n.requestFullscreen](d);p instanceof Promise&&p.then(h).catch(f)}),exit:()=>new Promise((l,d)=>{if(!a.isFullscreen){l();return}let c=()=>{a.off("change",c),l()};a.on("change",c);let f=document[n.exitFullscreen]();f instanceof Promise&&f.then(c).catch(d)}),toggle:(l,d)=>a.isFullscreen?a.exit():a.request(l,d),onchange(l){a.on("change",l)},onerror(l){a.on("error",l)},on(l,d){let c=o[l];c&&document.addEventListener(c,d,!1)},off(l,d){let c=o[l];c&&document.removeEventListener(c,d,!1)},raw:n};Object.defineProperties(a,{isFullscreen:{get:()=>!!document[n.fullscreenElement]},element:{enumerable:!0,get:()=>document[n.fullscreenElement]},isEnabled:{enumerable:!0,get:()=>!!document[n.fullscreenEnabled]}}),n||(a={isEnabled:!1}),r.default=a},{"@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],lNvYI:[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=e("../utils");function o(a){let{constructor:l,template:{$container:d,$player:c}}=a,f="";(0,n.def)(a,"fullscreenWeb",{get:()=>(0,n.hasClass)(c,"art-fullscreen-web"),set(h){h?(f=c.style.cssText,l.FULLSCREEN_WEB_IN_BODY&&(0,n.append)(document.body,c),a.state="fullscreenWeb",(0,n.setStyle)(c,"width","100%"),(0,n.setStyle)(c,"height","100%"),(0,n.addClass)(c,"art-fullscreen-web"),a.emit("fullscreenWeb",!0)):(l.FULLSCREEN_WEB_IN_BODY&&(0,n.append)(d,c),f&&(c.style.cssText=f,f=""),(0,n.removeClass)(c,"art-fullscreen-web"),a.emit("fullscreenWeb",!1)),a.emit("resize")}})}},{"../utils":"h3rH9","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],"8j7oC":[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=e("../utils");function o(a){let{i18n:l,notice:d,template:{$video:c}}=a;document.pictureInPictureEnabled?function(f){let{template:{$video:h},proxy:p,notice:g}=f;h.disablePictureInPicture=!1,(0,n.def)(f,"pip",{get:()=>document.pictureInPictureElement,set(x){x?(f.state="pip",h.requestPictureInPicture().catch(E=>{throw g.show=E,E})):document.exitPictureInPicture().catch(E=>{throw g.show=E,E})}}),p(h,"enterpictureinpicture",()=>{f.emit("pip",!0)}),p(h,"leavepictureinpicture",()=>{f.emit("pip",!1)})}(a):c.webkitSupportsPresentationMode?function(f){let{$video:h}=f.template;h.webkitSetPresentationMode("inline"),(0,n.def)(f,"pip",{get:()=>h.webkitPresentationMode==="picture-in-picture",set(p){p?(f.state="pip",h.webkitSetPresentationMode("picture-in-picture"),f.emit("pip",!0)):(h.webkitSetPresentationMode("inline"),f.emit("pip",!1))}})}(a):(0,n.def)(a,"pip",{get:()=>!1,set(){d.show=l.get("PIP Not Supported")}})}},{"../utils":"h3rH9","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],dwVOT:[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=e("../utils");function o(a){let{$video:l}=a.template;(0,n.def)(a,"loaded",{get:()=>a.loadedTime/l.duration}),(0,n.def)(a,"loadedTime",{get:()=>l.buffered.length?l.buffered.end(l.buffered.length-1):0})}},{"../utils":"h3rH9","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],dDeLx:[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=e("../utils");function o(a){(0,n.def)(a,"played",{get:()=>a.currentTime/a.duration})}},{"../utils":"h3rH9","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],ceoBp:[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=e("../utils");function o(a){let{$video:l}=a.template;(0,n.def)(a,"playing",{get:()=>l.currentTime>0&&!l.paused&&!l.ended&&l.readyState>2})}},{"../utils":"h3rH9","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],lcWXX:[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=e("../utils");function o(a){let{$container:l,$player:d,$video:c}=a.template;(0,n.def)(a,"autoSize",{value(){let{videoWidth:f,videoHeight:h}=c,{width:p,height:g}=(0,n.getRect)(l),x=f/h;p/g>x?((0,n.setStyle)(d,"width",`${g*x/p*100}%`),(0,n.setStyle)(d,"height","100%")):((0,n.setStyle)(d,"width","100%"),(0,n.setStyle)(d,"height",`${p/x/g*100}%`)),a.emit("autoSize",{width:a.width,height:a.height})}})}},{"../utils":"h3rH9","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],f7y88:[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=e("../utils");function o(a){(0,n.def)(a,"rect",{get:()=>(0,n.getRect)(a.template.$player)});let l=["bottom","height","left","right","top","width"];for(let d=0;d<l.length;d++){let c=l[d];(0,n.def)(a,c,{get:()=>a.rect[c]})}(0,n.def)(a,"x",{get:()=>a.left+window.pageXOffset}),(0,n.def)(a,"y",{get:()=>a.top+window.pageYOffset})}},{"../utils":"h3rH9","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],l4qt5:[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=e("../utils");function o(a){let{template:{$player:l},i18n:d,notice:c}=a;(0,n.def)(a,"flip",{get:()=>l.dataset.flip||"normal",set(f){f||(f="normal"),f==="normal"?delete l.dataset.flip:l.dataset.flip=f,c.show=`${d.get("Video Flip")}: ${d.get((0,n.capitalize)(f))}`,a.emit("flip",f)}})}},{"../utils":"h3rH9","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],"9ZPBQ":[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=e("../utils");function o(a){let{icons:l,proxy:d,storage:c,template:{$player:f,$video:h}}=a,p=!1,g=0,x=0;function E(){let{$mini:T}=a.template;T&&((0,n.removeClass)(f,"art-mini"),(0,n.setStyle)(T,"display","none"),f.prepend(h),a.emit("mini",!1))}function k(T,R){a.playing?((0,n.setStyle)(T,"display","none"),(0,n.setStyle)(R,"display","flex")):((0,n.setStyle)(T,"display","flex"),(0,n.setStyle)(R,"display","none"))}function O(){let{$mini:T}=a.template,R=(0,n.getRect)(T),C=window.innerHeight-R.height-50,b=window.innerWidth-R.width-50;c.set("top",C),c.set("left",b),(0,n.setStyle)(T,"top",`${C}px`),(0,n.setStyle)(T,"left",`${b}px`)}(0,n.def)(a,"mini",{get:()=>(0,n.hasClass)(f,"art-mini"),set(T){if(T){a.state="mini",(0,n.addClass)(f,"art-mini");let R=function(){let{$mini:A}=a.template;if(A)return(0,n.append)(A,h),(0,n.setStyle)(A,"display","flex");{let L=(0,n.createElement)("div");(0,n.addClass)(L,"art-mini-popup"),(0,n.append)(document.body,L),a.template.$mini=L,(0,n.append)(L,h);let I=(0,n.append)(L,'<div class="art-mini-close"></div>');(0,n.append)(I,l.close),d(I,"click",E);let j=(0,n.append)(L,'<div class="art-mini-state"></div>'),F=(0,n.append)(j,l.play),$=(0,n.append)(j,l.pause);return d(F,"click",()=>a.play()),d($,"click",()=>a.pause()),k(F,$),a.on("video:playing",()=>k(F,$)),a.on("video:pause",()=>k(F,$)),a.on("video:timeupdate",()=>k(F,$)),d(L,"mousedown",V=>{p=V.button===0,g=V.pageX,x=V.pageY}),a.on("document:mousemove",V=>{if(p){(0,n.addClass)(L,"art-mini-droging");let Q=V.pageX-g,z=V.pageY-x;(0,n.setStyle)(L,"transform",`translate(${Q}px, ${z}px)`)}}),a.on("document:mouseup",()=>{if(p){p=!1,(0,n.removeClass)(L,"art-mini-droging");let V=(0,n.getRect)(L);c.set("left",V.left),c.set("top",V.top),(0,n.setStyle)(L,"left",`${V.left}px`),(0,n.setStyle)(L,"top",`${V.top}px`),(0,n.setStyle)(L,"transform",null)}}),L}}(),C=c.get("top"),b=c.get("left");C&&b?((0,n.setStyle)(R,"top",`${C}px`),(0,n.setStyle)(R,"left",`${b}px`),(0,n.isInViewport)(R)||O()):O(),a.emit("mini",!0)}else E()}})}},{"../utils":"h3rH9","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],"5K8hA":[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=e("../utils");function o(a){let{template:{$poster:l}}=a;(0,n.def)(a,"poster",{get:()=>{try{return l.style.backgroundImage.match(/"(.*)"/)[1]}catch(d){return""}},set(d){(0,n.setStyle)(l,"backgroundImage",`url(${d})`)}})}},{"../utils":"h3rH9","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],"3T5ls":[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=e("../utils");function o(a){let{template:{$container:l,$video:d}}=a;(0,n.def)(a,"autoHeight",{value(){let{clientWidth:c}=l,{videoHeight:f,videoWidth:h}=d,p=c/h*f;(0,n.setStyle)(l,"height",p+"px"),a.emit("autoHeight",p)}})}},{"../utils":"h3rH9","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],"6KfHs":[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=e("../utils");function o(a){let{$player:l}=a.template;(0,n.def)(a,"cssVar",{value:(d,c)=>c?l.style.setProperty(d,c):getComputedStyle(l).getPropertyValue(d)})}},{"../utils":"h3rH9","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],"7lcSc":[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=e("../utils");function o(a){(0,n.def)(a,"theme",{get:()=>a.cssVar("--art-theme"),set(l){a.cssVar("--art-theme",l)}})}},{"../utils":"h3rH9","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],"8JgTw":[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=e("../utils");function o(a){(0,n.def)(a,"type",{get:()=>a.option.type,set(l){a.option.type=l}})}},{"../utils":"h3rH9","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],cebt1:[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=e("../utils");function o(a){let l=["mini","pip","fullscreen","fullscreenWeb"];(0,n.def)(a,"state",{get:()=>l.find(d=>a[d])||"standard",set(d){for(let c=0;c<l.length;c++){let f=l[c];f!==d&&a[f]&&(a[f]=!1)}}})}},{"../utils":"h3rH9","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],hJvIy:[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=e("../utils");function o(a){let{clamp:l}=a.constructor.utils,{notice:d,template:c,i18n:f}=a,h=0,p=[];a.on("subtitle:switch",()=>{p=[]}),(0,n.def)(a,"subtitleOffset",{get:()=>h,set(g){if(c.$track&&c.$track.track){let x=Array.from(c.$track.track.cues);h=l(g,-5,5);for(let E=0;E<x.length;E++){let k=x[E];p[E]||(p[E]={startTime:k.startTime,endTime:k.endTime}),k.startTime=l(p[E].startTime+h,0,a.duration),k.endTime=l(p[E].endTime+h,0,a.duration)}a.subtitle.update(),d.show=`${f.get("Subtitle Offset")}: ${g}s`,a.emit("subtitleOffset",g)}else a.emit("subtitleOffset",0)}})}},{"../utils":"h3rH9","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],"4Tp0U":[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=e("../utils");function o(a){let{i18n:l,notice:d,proxy:c,template:{$video:f}}=a,h=!0;window.WebKitPlaybackTargetAvailabilityEvent&&f.webkitShowPlaybackTargetPicker?c(f,"webkitplaybacktargetavailabilitychanged",p=>{switch(p.availability){case"available":h=!0;break;case"not-available":h=!1}}):h=!1,(0,n.def)(a,"airplay",{value(){h?(f.webkitShowPlaybackTargetPicker(),a.emit("airplay")):d.show=l.get("AirPlay Not Available")}})}},{"../utils":"h3rH9","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],"3wZgN":[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=e("../utils");function o(a){(0,n.def)(a,"quality",{set(l){let{controls:d,notice:c,i18n:f}=a,h=l.find(g=>g.default)||l[0];d.update({name:"quality",position:"right",index:10,style:{marginRight:"10px"},html:h?h.html:"",selector:l,onSelect(g){return zt(this,null,function*(){yield a.switchQuality(g.url),c.show=`${f.get("Switch Video")}: ${g.html}`})}})}})}},{"../utils":"h3rH9","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],iPdgW:[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=e("../utils");function o(a){let{option:l,storage:d,template:{$video:c,$poster:f}}=a;for(let p in l.moreVideoAttr)a.attr(p,l.moreVideoAttr[p]);l.muted&&(a.muted=l.muted),l.volume&&(c.volume=(0,n.clamp)(l.volume,0,1));let h=d.get("volume");for(let p in typeof h=="number"&&(c.volume=(0,n.clamp)(h,0,1)),l.poster&&(0,n.setStyle)(f,"backgroundImage",`url(${l.poster})`),l.autoplay&&(c.autoplay=l.autoplay),l.playsInline&&(c.playsInline=!0,c["webkit-playsinline"]=!0),l.theme&&(l.cssVar["--art-theme"]=l.theme),l.cssVar)a.cssVar(p,l.cssVar[p]);a.url=l.url}},{"../utils":"h3rH9","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],"3mj0J":[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>l);var n=e("../config"),o=s.interopDefault(n),a=e("../utils");function l(d){let{i18n:c,notice:f,option:h,constructor:p,proxy:g,template:{$player:x,$video:E,$poster:k}}=d,O=0;for(let T=0;T<o.default.events.length;T++)g(E,o.default.events[T],R=>{d.emit(`video:${R.type}`,R)});d.on("video:canplay",()=>{O=0,d.loading.show=!1}),d.once("video:canplay",()=>{d.loading.show=!1,d.controls.show=!0,d.mask.show=!0,d.isReady=!0,d.emit("ready")}),d.on("video:ended",()=>{h.loop?(d.seek=0,d.play(),d.controls.show=!1,d.mask.show=!1):(d.controls.show=!0,d.mask.show=!0)}),d.on("video:error",T=>zt(this,null,function*(){O<p.RECONNECT_TIME_MAX?(yield(0,a.sleep)(p.RECONNECT_SLEEP_TIME),O+=1,d.url=h.url,f.show=`${c.get("Reconnect")}: ${O}`,d.emit("error",T,O)):(d.mask.show=!0,d.loading.show=!1,d.controls.show=!0,(0,a.addClass)(x,"art-error"),yield(0,a.sleep)(p.RECONNECT_SLEEP_TIME),f.show=c.get("Video Load Failed"))})),d.on("video:loadedmetadata",()=>{d.emit("resize"),a.isMobile&&(d.loading.show=!1,d.controls.show=!0,d.mask.show=!0)}),d.on("video:loadstart",()=>{d.loading.show=!0,d.mask.show=!1,d.controls.show=!0}),d.on("video:pause",()=>{d.controls.show=!0,d.mask.show=!0}),d.on("video:play",()=>{d.mask.show=!1,(0,a.setStyle)(k,"display","none")}),d.on("video:playing",()=>{d.mask.show=!1}),d.on("video:progress",()=>{d.playing&&(d.loading.show=!1)}),d.on("video:seeked",()=>{d.loading.show=!1,d.mask.show=!0}),d.on("video:seeking",()=>{d.loading.show=!0,d.mask.show=!1}),d.on("video:timeupdate",()=>{d.mask.show=!1}),d.on("video:waiting",()=>{d.loading.show=!0,d.mask.show=!1})}},{"../config":"9Xmqu","../utils":"h3rH9","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],"14IBq":[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r);var n=e("../utils"),o=e("../utils/component"),a=s.interopDefault(o),l=e("./fullscreen"),d=s.interopDefault(l),c=e("./fullscreenWeb"),f=s.interopDefault(c),h=e("./pip"),p=s.interopDefault(h),g=e("./playAndPause"),x=s.interopDefault(g),E=e("./progress"),k=s.interopDefault(E),O=e("./time"),T=s.interopDefault(O),R=e("./volume"),C=s.interopDefault(R),b=e("./setting"),A=s.interopDefault(b),L=e("./thumbnails"),I=s.interopDefault(L),j=e("./screenshot"),F=s.interopDefault(j),$=e("./airplay"),V=s.interopDefault($);class Q extends a.default{constructor(B){super(B),this.isHover=!1,this.name="control",this.timer=Date.now();let{constructor:w}=B,{$player:P,$bottom:G}=this.art.template;B.on("mousemove",()=>{n.isMobile||(this.show=!0)}),B.on("click",()=>{n.isMobile?this.toggle():this.show=!0}),B.on("document:mousemove",et=>{this.isHover=(0,n.includeFromEvent)(et,G)}),B.on("video:timeupdate",()=>{!B.setting.show&&!this.isHover&&!B.isInput&&B.playing&&this.show&&Date.now()-this.timer>=w.CONTROL_HIDE_TIME&&(this.show=!1)}),B.on("control",et=>{et?((0,n.removeClass)(P,"art-hide-cursor"),(0,n.addClass)(P,"art-hover"),this.timer=Date.now()):((0,n.addClass)(P,"art-hide-cursor"),(0,n.removeClass)(P,"art-hover"))}),this.init()}init(){let{option:B}=this.art;B.isLive||this.add((0,k.default)({name:"progress",position:"top",index:10})),B.thumbnails.url&&!B.isLive&&this.add((0,I.default)({name:"thumbnails",position:"top",index:20})),this.add((0,x.default)({name:"playAndPause",position:"left",index:10})),this.add((0,C.default)({name:"volume",position:"left",index:20})),B.isLive||this.add((0,T.default)({name:"time",position:"left",index:30})),B.quality.length&&(0,n.sleep)().then(()=>{this.art.quality=B.quality}),B.screenshot&&!n.isMobile&&this.add((0,F.default)({name:"screenshot",position:"right",index:20})),B.setting&&this.add((0,A.default)({name:"setting",position:"right",index:30})),B.pip&&this.add((0,p.default)({name:"pip",position:"right",index:40})),B.airplay&&window.WebKitPlaybackTargetAvailabilityEvent&&this.add((0,V.default)({name:"airplay",position:"right",index:50})),B.fullscreenWeb&&this.add((0,f.default)({name:"fullscreenWeb",position:"right",index:60})),B.fullscreen&&this.add((0,d.default)({name:"fullscreen",position:"right",index:70}));for(let w=0;w<B.controls.length;w++)this.add(B.controls[w])}add(B){let w=typeof B=="function"?B(this.art):B,{$progress:P,$controlsLeft:G,$controlsRight:et}=this.art.template;switch(w.position){case"top":this.$parent=P;break;case"left":this.$parent=G;break;case"right":this.$parent=et;break;default:(0,n.errorHandle)(!1,"Control option.position must one of 'top', 'left', 'right'")}super.add(w)}}r.default=Q},{"../utils":"h3rH9","../utils/component":"guki8","./fullscreen":"cxHNK","./fullscreenWeb":"66eEC","./pip":"kCFkA","./playAndPause":"iRhgD","./progress":"aBBSH","./time":"7H0CE","./volume":"lMwFm","./setting":"8BrCu","./thumbnails":"2HiWx","./screenshot":"c1GeG","./airplay":"6GRju","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],guki8:[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r);var n=e("./dom"),o=e("./format"),a=e("./error"),l=e("option-validator"),d=s.interopDefault(l),c=e("../scheme");r.default=class{constructor(f){this.id=0,this.art=f,this.cache=new Map,this.add=this.add.bind(this),this.remove=this.remove.bind(this),this.update=this.update.bind(this)}get show(){return(0,n.hasClass)(this.art.template.$player,`art-${this.name}-show`)}set show(f){let{$player:h}=this.art.template,p=`art-${this.name}-show`;f?(0,n.addClass)(h,p):(0,n.removeClass)(h,p),this.art.emit(this.name,f)}toggle(){this.show=!this.show}add(f){let h=typeof f=="function"?f(this.art):f;if(h.html=h.html||"",(0,d.default)(h,c.ComponentOption),!this.$parent||!this.name||h.disable)return;let p=h.name||`${this.name}${this.id}`,g=this.cache.get(p);(0,a.errorHandle)(!g,`Can't add an existing [${p}] to the [${this.name}]`),this.id+=1;let x=(0,n.createElement)("div");(0,n.addClass)(x,`art-${this.name}`),(0,n.addClass)(x,`art-${this.name}-${p}`);let E=Array.from(this.$parent.children);x.dataset.index=h.index||this.id;let k=E.find(T=>Number(T.dataset.index)>=Number(x.dataset.index));k?k.insertAdjacentElement("beforebegin",x):(0,n.append)(this.$parent,x),h.html&&(0,n.append)(x,h.html),h.style&&(0,n.setStyles)(x,h.style),h.tooltip&&(0,n.tooltip)(x,h.tooltip);let O=[];if(h.click){let T=this.art.events.proxy(x,"click",R=>{R.preventDefault(),h.click.call(this.art,this,R)});O.push(T)}return h.selector&&["left","right"].includes(h.position)&&this.addSelector(h,x,O),this[p]=x,this.cache.set(p,{$ref:x,events:O,option:h}),h.mounted&&h.mounted.call(this.art,x),x}addSelector(f,h,p){let{hover:g,proxy:x}=this.art.events;(0,n.addClass)(h,"art-control-selector");let E=(0,n.createElement)("div");(0,n.addClass)(E,"art-selector-value"),(0,n.append)(E,f.html),h.innerText="",(0,n.append)(h,E);let k=f.selector.map((C,b)=>`<div class="art-selector-item ${C.default?"art-current":""}" data-index="${b}">${C.html}</div>`).join(""),O=(0,n.createElement)("div");(0,n.addClass)(O,"art-selector-list"),(0,n.append)(O,k),(0,n.append)(h,O);let T=()=>{let C=(0,n.getStyle)(h,"width"),b=(0,n.getStyle)(O,"width");O.style.left=`${C/2-b/2}px`};g(h,T);let R=x(O,"click",C=>zt(this,null,function*(){let b=(C.composedPath()||[]).find(I=>(0,n.hasClass)(I,"art-selector-item"));if(!b)return;(0,n.inverseClass)(b,"art-current");let A=Number(b.dataset.index),L=f.selector[A]||{};if(E.innerText=b.innerText,f.onSelect){let I=yield f.onSelect.call(this.art,L,b,C);(0,o.isStringOrNumber)(I)&&(E.innerHTML=I)}T()}));p.push(R)}remove(f){let h=this.cache.get(f);(0,a.errorHandle)(h,`Can't find [${f}] from the [${this.name}]`),h.option.beforeUnmount&&h.option.beforeUnmount.call(this.art,h.$ref);for(let p=0;p<h.events.length;p++)this.art.events.remove(h.events[p]);this.cache.delete(f),delete this[f],(0,n.remove)(h.$ref)}update(f){let h=this.cache.get(f.name);return h&&(f=Object.assign(h.option,f),this.remove(f.name)),this.add(f)}}},{"./dom":"XgAQE","./format":"13atT","./error":"2nFlF","option-validator":"9I0i9","../scheme":"AdvwB","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],cxHNK:[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=e("../utils");function o(a){return l=>jt(Nt({},a),{tooltip:l.i18n.get("Fullscreen"),mounted:d=>{let{proxy:c,icons:f,i18n:h}=l,p=(0,n.append)(d,f.fullscreenOn),g=(0,n.append)(d,f.fullscreenOff);(0,n.setStyle)(g,"display","none"),c(d,"click",()=>{l.fullscreen=!l.fullscreen}),l.on("fullscreen",x=>{x?((0,n.tooltip)(d,h.get("Exit Fullscreen")),(0,n.setStyle)(p,"display","none"),(0,n.setStyle)(g,"display","inline-flex")):((0,n.tooltip)(d,h.get("Fullscreen")),(0,n.setStyle)(p,"display","inline-flex"),(0,n.setStyle)(g,"display","none"))})}})}},{"../utils":"h3rH9","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],"66eEC":[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=e("../utils");function o(a){return l=>jt(Nt({},a),{tooltip:l.i18n.get("Web Fullscreen"),mounted:d=>{let{proxy:c,icons:f,i18n:h}=l,p=(0,n.append)(d,f.fullscreenWebOn),g=(0,n.append)(d,f.fullscreenWebOff);(0,n.setStyle)(g,"display","none"),c(d,"click",()=>{l.fullscreenWeb=!l.fullscreenWeb}),l.on("fullscreenWeb",x=>{x?((0,n.tooltip)(d,h.get("Exit Web Fullscreen")),(0,n.setStyle)(p,"display","none"),(0,n.setStyle)(g,"display","inline-flex")):((0,n.tooltip)(d,h.get("Web Fullscreen")),(0,n.setStyle)(p,"display","inline-flex"),(0,n.setStyle)(g,"display","none"))})}})}},{"../utils":"h3rH9","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],kCFkA:[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=e("../utils");function o(a){return l=>jt(Nt({},a),{tooltip:l.i18n.get("PIP Mode"),mounted:d=>{let{proxy:c,icons:f,i18n:h}=l;(0,n.append)(d,f.pip),c(d,"click",()=>{l.pip=!l.pip}),l.on("pip",p=>{(0,n.tooltip)(d,h.get(p?"Exit PIP Mode":"PIP Mode"))})}})}},{"../utils":"h3rH9","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],iRhgD:[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=e("../utils");function o(a){return l=>jt(Nt({},a),{mounted:d=>{let{proxy:c,icons:f,i18n:h}=l,p=(0,n.append)(d,f.play),g=(0,n.append)(d,f.pause);function x(){(0,n.setStyle)(p,"display","flex"),(0,n.setStyle)(g,"display","none")}function E(){(0,n.setStyle)(p,"display","none"),(0,n.setStyle)(g,"display","flex")}(0,n.tooltip)(p,h.get("Play")),(0,n.tooltip)(g,h.get("Pause")),c(p,"click",()=>{l.play()}),c(g,"click",()=>{l.pause()}),l.playing?E():x(),l.on("video:playing",()=>{E()}),l.on("video:pause",()=>{x()})}})}},{"../utils":"h3rH9","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],aBBSH:[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"getPosFromEvent",()=>o),s.export(r,"setCurrentTime",()=>a),s.export(r,"default",()=>l);var n=e("../utils");function o(d,c){let{$progress:f}=d.template,{left:h}=(0,n.getRect)(f),p=n.isMobile?c.touches[0].clientX:c.clientX,g=(0,n.clamp)(p-h,0,f.clientWidth),x=g/f.clientWidth*d.duration,E=(0,n.secondToTime)(x),k=(0,n.clamp)(g/f.clientWidth,0,1);return{second:x,time:E,width:g,percentage:k}}function a(d,c){if(d.isRotate){let f=c.touches[0].clientY/d.height,h=f*d.duration;d.emit("setBar","played",f,c),d.seek=h}else{let{second:f,percentage:h}=o(d,c);d.emit("setBar","played",h,c),d.seek=f}}function l(d){return c=>{let{icons:f,option:h,proxy:p}=c;return jt(Nt({},d),{html:'<div class="art-control-progress-inner"><div class="art-progress-hover"></div><div class="art-progress-loaded"></div><div class="art-progress-played"></div><div class="art-progress-highlight"></div><div class="art-progress-indicator"></div><div class="art-progress-tip"></div></div>',mounted:g=>{let x=null,E=!1,k=(0,n.query)(".art-progress-hover",g),O=(0,n.query)(".art-progress-loaded",g),T=(0,n.query)(".art-progress-played",g),R=(0,n.query)(".art-progress-highlight",g),C=(0,n.query)(".art-progress-indicator",g),b=(0,n.query)(".art-progress-tip",g);function A(L,I){let{width:j,time:F}=I||o(c,L);b.innerText=F;let $=b.clientWidth;j<=$/2?(0,n.setStyle)(b,"left",0):j>g.clientWidth-$/2?(0,n.setStyle)(b,"left",`${g.clientWidth-$}px`):(0,n.setStyle)(b,"left",`${j-$/2}px`)}f.indicator?(0,n.append)(C,f.indicator):(0,n.setStyle)(C,"backgroundColor","var(--art-theme)"),c.on("setBar",function(L,I,j){let F=L==="played"&&j&&n.isMobile;L==="loaded"&&(0,n.setStyle)(O,"width",`${100*I}%`),L==="hover"&&(0,n.setStyle)(k,"width",`${100*I}%`),L==="played"&&((0,n.setStyle)(T,"width",`${100*I}%`),(0,n.setStyle)(C,"left",`${100*I}%`)),F&&((0,n.setStyle)(b,"display","flex"),A(j,{width:g.clientWidth*I,time:(0,n.secondToTime)(I*c.duration)}),clearTimeout(x),x=setTimeout(()=>{(0,n.setStyle)(b,"display","none")},500))}),c.on("video:loadedmetadata",function(){R.innerText="";for(let L=0;L<h.highlight.length;L++){let I=h.highlight[L],j=(0,n.clamp)(I.time,0,c.duration)/c.duration*100,F=`<span data-text="${I.text}" data-time="${I.time}" style="left: ${j}%"></span>`;(0,n.append)(R,F)}}),c.on("video:progress",()=>{c.emit("setBar","loaded",c.loaded)}),c.constructor.USE_RAF?c.on("raf",()=>{c.emit("setBar","played",c.played)}):c.on("video:timeupdate",()=>{c.emit("setBar","played",c.played)}),c.on("video:ended",()=>{c.emit("setBar","played",1)}),c.emit("setBar","loaded",c.loaded||0),n.isMobile||(p(g,"click",L=>{L.target!==C&&a(c,L)}),p(g,"mousemove",L=>{let{percentage:I}=o(c,L);c.emit("setBar","hover",I,L),(0,n.setStyle)(b,"display","flex"),(0,n.includeFromEvent)(L,R)?function(j){let{width:F}=o(c,j),{text:$}=j.target.dataset;b.innerText=$;let V=b.clientWidth;F<=V/2?(0,n.setStyle)(b,"left",0):F>g.clientWidth-V/2?(0,n.setStyle)(b,"left",`${g.clientWidth-V}px`):(0,n.setStyle)(b,"left",`${F-V/2}px`)}(L):A(L)}),p(g,"mouseleave",L=>{(0,n.setStyle)(b,"display","none"),c.emit("setBar","hover",0,L)}),p(g,"mousedown",L=>{E=L.button===0}),c.on("document:mousemove",L=>{if(E){let{second:I,percentage:j}=o(c,L);c.emit("setBar","played",j,L),c.seek=I}}),c.on("document:mouseup",()=>{E&&(E=!1)}))}})}}},{"../utils":"h3rH9","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],"7H0CE":[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=e("../utils");function o(a){return l=>jt(Nt({},a),{style:n.isMobile?{fontSize:"12px",padding:"0 5px"}:{cursor:"auto",padding:"0 10px"},mounted:d=>{function c(){let h=`${(0,n.secondToTime)(l.currentTime)} / ${(0,n.secondToTime)(l.duration)}`;h!==d.innerText&&(d.innerText=h)}c();let f=["video:loadedmetadata","video:timeupdate","video:progress"];for(let h=0;h<f.length;h++)l.on(f[h],c)}})}},{"../utils":"h3rH9","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],lMwFm:[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=e("../utils");function o(a){return l=>jt(Nt({},a),{mounted:d=>{let{proxy:c,icons:f}=l,h=(0,n.append)(d,f.volume),p=(0,n.append)(d,f.volumeClose),g=(0,n.append)(d,'<div class="art-volume-panel"></div>'),x=(0,n.append)(g,'<div class="art-volume-inner"></div>'),E=(0,n.append)(x,'<div class="art-volume-val"></div>'),k=(0,n.append)(x,'<div class="art-volume-slider"></div>'),O=(0,n.append)(k,'<div class="art-volume-handle"></div>'),T=(0,n.append)(O,'<div class="art-volume-loaded"></div>'),R=(0,n.append)(k,'<div class="art-volume-indicator"></div>');function C(A){let{top:L,height:I}=(0,n.getRect)(k);return 1-(A.clientY-L)/I}function b(){if(l.muted||l.volume===0)(0,n.setStyle)(h,"display","none"),(0,n.setStyle)(p,"display","flex"),(0,n.setStyle)(R,"top","100%"),(0,n.setStyle)(T,"top","100%"),E.innerText=0;else{let A=100*l.volume;(0,n.setStyle)(h,"display","flex"),(0,n.setStyle)(p,"display","none"),(0,n.setStyle)(R,"top",`${100-A}%`),(0,n.setStyle)(T,"top",`${100-A}%`),E.innerText=Math.floor(A)}}if(b(),l.on("video:volumechange",b),c(h,"click",()=>{l.muted=!0}),c(p,"click",()=>{l.muted=!1}),n.isMobile)(0,n.setStyle)(g,"display","none");else{let A=!1;c(k,"mousedown",L=>{A=L.button===0,l.volume=C(L)}),l.on("document:mousemove",L=>{A&&(l.muted=!1,l.volume=C(L))}),l.on("document:mouseup",()=>{A&&(A=!1)})}}})}},{"../utils":"h3rH9","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],"8BrCu":[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=e("../utils");function o(a){return l=>jt(Nt({},a),{tooltip:l.i18n.get("Show Setting"),mounted:d=>{let{proxy:c,icons:f,i18n:h}=l;(0,n.append)(d,f.setting),c(d,"click",()=>{l.setting.toggle(),l.setting.updateStyle()}),l.on("setting",p=>{(0,n.tooltip)(d,h.get(p?"Hide Setting":"Show Setting"))})}})}},{"../utils":"h3rH9","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],"2HiWx":[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=e("../utils");function o(a){return l=>jt(Nt({},a),{mounted:d=>{let{option:c,events:{loadImg:f},template:{$progress:h,$video:p}}=l,g=null,x=null,E=!1,k=!1;l.on("setBar",(O,T,R)=>zt(this,null,function*(){let C=O==="played"&&R&&n.isMobile;if(O==="hover"||C){if(E||(E=!0,x=yield f(c.thumbnails.url),k=!0),!k)return;let b=h.clientWidth*T;(0,n.setStyle)(d,"display","flex"),b>0&&b<h.clientWidth?function(A){let{url:L,number:I,column:j,width:F,height:$}=c.thumbnails,V=F||x.naturalWidth/j,Q=$||V/(p.videoWidth/p.videoHeight),z=Math.floor(A/(h.clientWidth/I)),B=Math.ceil(z/j)-1;(0,n.setStyle)(d,"backgroundImage",`url(${L})`),(0,n.setStyle)(d,"height",`${Q}px`),(0,n.setStyle)(d,"width",`${V}px`),(0,n.setStyle)(d,"backgroundPosition",`-${(z%j||j-1)*V}px -${B*Q}px`),A<=V/2?(0,n.setStyle)(d,"left",0):A>h.clientWidth-V/2?(0,n.setStyle)(d,"left",`${h.clientWidth-V}px`):(0,n.setStyle)(d,"left",`${A-V/2}px`)}(b):n.isMobile||(0,n.setStyle)(d,"display","none"),C&&(clearTimeout(g),g=setTimeout(()=>{(0,n.setStyle)(d,"display","none")},500))}}))}})}},{"../utils":"h3rH9","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],c1GeG:[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=e("../utils");function o(a){return l=>jt(Nt({},a),{tooltip:l.i18n.get("Screenshot"),mounted:d=>{let{proxy:c,icons:f}=l;(0,n.append)(d,f.screenshot),c(d,"click",()=>{l.screenshot()})}})}},{"../utils":"h3rH9","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],"6GRju":[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=e("../utils");function o(a){return l=>jt(Nt({},a),{tooltip:l.i18n.get("AirPlay"),mounted:d=>{let{proxy:c,icons:f}=l;(0,n.append)(d,f.airplay),c(d,"click",()=>l.airplay())}})}},{"../utils":"h3rH9","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],"7iUum":[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r);var n=e("../utils"),o=e("../utils/component"),a=s.interopDefault(o),l=e("./playbackRate"),d=s.interopDefault(l),c=e("./aspectRatio"),f=s.interopDefault(c),h=e("./flip"),p=s.interopDefault(h),g=e("./info"),x=s.interopDefault(g),E=e("./version"),k=s.interopDefault(E),O=e("./close"),T=s.interopDefault(O);class R extends a.default{constructor(b){super(b),this.name="contextmenu",this.$parent=b.template.$contextmenu,n.isMobile||this.init()}init(){let{option:b,proxy:A,template:{$player:L,$contextmenu:I}}=this.art;b.playbackRate&&this.add((0,d.default)({name:"playbackRate",index:10})),b.aspectRatio&&this.add((0,f.default)({name:"aspectRatio",index:20})),b.flip&&this.add((0,p.default)({name:"flip",index:30})),this.add((0,x.default)({name:"info",index:40})),this.add((0,k.default)({name:"version",index:50})),this.add((0,T.default)({name:"close",index:60}));for(let j=0;j<b.contextmenu.length;j++)this.add(b.contextmenu[j]);A(L,"contextmenu",j=>{if(j.preventDefault(),!this.art.constructor.CONTEXTMENU)return;this.show=!0;let F=j.clientX,$=j.clientY,{height:V,width:Q,left:z,top:B}=(0,n.getRect)(L),{height:w,width:P}=(0,n.getRect)(I),G=F-z,et=$-B;F+P>z+Q&&(G=Q-P),$+w>B+V&&(et=V-w),(0,n.setStyles)(I,{top:`${et}px`,left:`${G}px`})}),A(L,"click",j=>{(0,n.includeFromEvent)(j,I)||(this.show=!1)}),this.art.on("blur",()=>{this.show=!1})}}r.default=R},{"../utils":"h3rH9","../utils/component":"guki8","./playbackRate":"f1W36","./aspectRatio":"afxZC","./flip":"9jCuX","./info":"k8wIZ","./version":"bb0TU","./close":"9zTkI","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],f1W36:[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=e("../utils");function o(a){return l=>{let{i18n:d,constructor:{PLAYBACK_RATE:c}}=l,f=c.map(h=>`<span data-value="${h}">${h===1?d.get("Normal"):h.toFixed(1)}</span>`).join("");return jt(Nt({},a),{html:`${d.get("Play Speed")}: ${f}`,click:(h,p)=>{let{value:g}=p.target.dataset;g&&(l.playbackRate=Number(g),h.show=!1)},mounted:h=>{let p=(0,n.query)('[data-value="1"]',h);p&&(0,n.inverseClass)(p,"art-current"),l.on("video:ratechange",()=>{let g=(0,n.queryAll)("span",h).find(x=>Number(x.dataset.value)===l.playbackRate);g&&(0,n.inverseClass)(g,"art-current")})}})}}},{"../utils":"h3rH9","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],afxZC:[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=e("../utils");function o(a){return l=>{let{i18n:d,constructor:{ASPECT_RATIO:c}}=l,f=c.map(h=>`<span data-value="${h}">${h==="default"?d.get("Default"):h}</span>`).join("");return jt(Nt({},a),{html:`${d.get("Aspect Ratio")}: ${f}`,click:(h,p)=>{let{value:g}=p.target.dataset;g&&(l.aspectRatio=g,h.show=!1)},mounted:h=>{let p=(0,n.query)('[data-value="default"]',h);p&&(0,n.inverseClass)(p,"art-current"),l.on("aspectRatio",g=>{let x=(0,n.queryAll)("span",h).find(E=>E.dataset.value===g);x&&(0,n.inverseClass)(x,"art-current")})}})}}},{"../utils":"h3rH9","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],"9jCuX":[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=e("../utils");function o(a){return l=>{let{i18n:d,constructor:{FLIP:c}}=l,f=c.map(h=>`<span data-value="${h}">${d.get((0,n.capitalize)(h))}</span>`).join("");return jt(Nt({},a),{html:`${d.get("Video Flip")}: ${f}`,click:(h,p)=>{let{value:g}=p.target.dataset;g&&(l.flip=g.toLowerCase(),h.show=!1)},mounted:h=>{let p=(0,n.query)('[data-value="normal"]',h);p&&(0,n.inverseClass)(p,"art-current"),l.on("flip",g=>{let x=(0,n.queryAll)("span",h).find(E=>E.dataset.value===g);x&&(0,n.inverseClass)(x,"art-current")})}})}}},{"../utils":"h3rH9","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],k8wIZ:[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");function n(o){return a=>jt(Nt({},o),{html:a.i18n.get("Video Info"),click:l=>{a.info.show=!0,l.show=!1}})}s.defineInteropFlag(r),s.export(r,"default",()=>n)},{"@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],bb0TU:[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");function n(o){return jt(Nt({},o),{html:'<a href="https://artplayer.org" target="_blank">ArtPlayer 5.1.6</a>'})}s.defineInteropFlag(r),s.export(r,"default",()=>n)},{"@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],"9zTkI":[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");function n(o){return a=>jt(Nt({},o),{html:a.i18n.get("Close"),click:l=>{l.show=!1}})}s.defineInteropFlag(r),s.export(r,"default",()=>n)},{"@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],hD2Lg:[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r);var n=e("./utils"),o=e("./utils/component"),a=s.interopDefault(o);class l extends a.default{constructor(c){super(c),this.name="info",n.isMobile||this.init()}init(){let{proxy:c,constructor:f,template:{$infoPanel:h,$infoClose:p,$video:g}}=this.art;c(p,"click",()=>{this.show=!1});let x=null,E=(0,n.queryAll)("[data-video]",h)||[];this.art.on("destroy",()=>clearTimeout(x)),function k(){for(let O=0;O<E.length;O++){let T=E[O],R=g[T.dataset.video],C=typeof R=="number"?R.toFixed(2):R;T.innerText!==C&&(T.innerText=C)}x=setTimeout(k,f.INFO_LOOP_TIME)}()}}r.default=l},{"./utils":"h3rH9","./utils/component":"guki8","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],lum0D:[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r);var n=e("./utils"),o=e("./utils/component"),a=s.interopDefault(o),l=e("option-validator"),d=s.interopDefault(l),c=e("./scheme"),f=s.interopDefault(c);class h extends a.default{constructor(g){super(g),this.name="subtitle",this.eventDestroy=()=>null,this.init(g.option.subtitle);let x=!1;g.on("video:timeupdate",()=>{if(!this.url)return;let E=this.art.template.$video.webkitDisplayingFullscreen;typeof E=="boolean"&&E!==x&&(x=E,this.createTrack(E?"subtitles":"metadata",this.url))})}get url(){return this.art.template.$track.src}set url(g){this.switch(g)}get textTrack(){return this.art.template.$video.textTracks[0]}get activeCue(){return this.textTrack.activeCues[0]}style(g,x){let{$subtitle:E}=this.art.template;return typeof g=="object"?(0,n.setStyles)(E,g):(0,n.setStyle)(E,g,x)}update(){let{$subtitle:g}=this.art.template;g.innerHTML="",this.activeCue&&(this.art.option.subtitle.escape?g.innerHTML=this.activeCue.text.split(/\r?\n/).map(x=>`<div class="art-subtitle-line">${(0,n.escape)(x)}</div>`).join(""):g.innerHTML=this.activeCue.text,this.art.emit("subtitleUpdate",this.activeCue.text))}switch(E){return zt(this,arguments,function*(g,x={}){let{i18n:k,notice:O,option:T}=this.art,R=jt(Nt(Nt({},T.subtitle),x),{url:g}),C=yield this.init(R);return x.name&&(O.show=`${k.get("Switch Subtitle")}: ${x.name}`),C})}createTrack(g,x){let{template:E,proxy:k,option:O}=this.art,{$video:T,$track:R}=E,C=(0,n.createElement)("track");C.default=!0,C.kind=g,C.src=x,C.label=O.subtitle.name||"Artplayer",C.track.mode="hidden",this.eventDestroy(),(0,n.remove)(R),(0,n.append)(T,C),E.$track=C,this.eventDestroy=k(this.textTrack,"cuechange",()=>this.update())}init(g){return zt(this,null,function*(){let{notice:x,template:{$subtitle:E}}=this.art;if((0,d.default)(g,f.default.subtitle),g.url)return this.style(g.style),fetch(g.url).then(k=>k.arrayBuffer()).then(k=>{let O=new TextDecoder(g.encoding).decode(k);switch(this.art.emit("subtitleLoad",g.url),g.type||(0,n.getExt)(g.url)){case"srt":{let T=(0,n.srtToVtt)(O),R=g.onVttLoad(T);return(0,n.vttToBlob)(R)}case"ass":{let T=(0,n.assToVtt)(O),R=g.onVttLoad(T);return(0,n.vttToBlob)(R)}case"vtt":{let T=g.onVttLoad(O);return(0,n.vttToBlob)(T)}default:return g.url}}).then(k=>(E.innerHTML="",this.url===k||(URL.revokeObjectURL(this.url),this.createTrack("metadata",k),this.art.emit("subtitleSwitch",k)),k)).catch(k=>{throw E.innerHTML="",x.show=k,k})})}}r.default=h},{"./utils":"h3rH9","./utils/component":"guki8","option-validator":"9I0i9","./scheme":"AdvwB","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],"1Epl5":[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r);var n=e("../utils/error"),o=e("./clickInit"),a=s.interopDefault(o),l=e("./hoverInit"),d=s.interopDefault(l),c=e("./moveInit"),f=s.interopDefault(c),h=e("./resizeInit"),p=s.interopDefault(h),g=e("./gestureInit"),x=s.interopDefault(g),E=e("./viewInit"),k=s.interopDefault(E),O=e("./documentInit"),T=s.interopDefault(O),R=e("./updateInit"),C=s.interopDefault(R);r.default=class{constructor(b){this.destroyEvents=[],this.proxy=this.proxy.bind(this),this.hover=this.hover.bind(this),this.loadImg=this.loadImg.bind(this),(0,a.default)(b,this),(0,d.default)(b,this),(0,f.default)(b,this),(0,p.default)(b,this),(0,x.default)(b,this),(0,k.default)(b,this),(0,T.default)(b,this),(0,C.default)(b,this)}proxy(b,A,L,I={}){if(Array.isArray(A))return A.map(F=>this.proxy(b,F,L,I));b.addEventListener(A,L,I);let j=()=>b.removeEventListener(A,L,I);return this.destroyEvents.push(j),j}hover(b,A,L){A&&this.proxy(b,"mouseenter",A),L&&this.proxy(b,"mouseleave",L)}loadImg(b){return new Promise((A,L)=>{let I;if(b instanceof HTMLImageElement)I=b;else{if(typeof b!="string")return L(new n.ArtPlayerError("Unable to get Image"));(I=new Image).src=b}if(I.complete)return A(I);this.proxy(I,"load",()=>A(I)),this.proxy(I,"error",()=>L(new n.ArtPlayerError(`Failed to load Image: ${I.src}`)))})}remove(b){let A=this.destroyEvents.indexOf(b);A>-1&&(b(),this.destroyEvents.splice(A,1))}destroy(){for(let b=0;b<this.destroyEvents.length;b++)this.destroyEvents[b]()}}},{"../utils/error":"2nFlF","./clickInit":"gzL6e","./hoverInit":"kpTJf","./moveInit":"ef6qz","./resizeInit":"9TXOX","./gestureInit":"dePMU","./viewInit":"hDyWF","./documentInit":"7RjDP","./updateInit":"8SmBT","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],gzL6e:[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=e("../utils");function o(a,l){let{constructor:d,template:{$player:c,$video:f}}=a;l.proxy(document,["click","contextmenu"],p=>{(0,n.includeFromEvent)(p,c)?(a.isInput=p.target.tagName==="INPUT",a.isFocus=!0,a.emit("focus",p)):(a.isInput=!1,a.isFocus=!1,a.emit("blur",p))});let h=[];l.proxy(f,"click",p=>{let g=Date.now();h.push(g);let{MOBILE_CLICK_PLAY:x,DBCLICK_TIME:E,MOBILE_DBCLICK_PLAY:k,DBCLICK_FULLSCREEN:O}=d,T=h.filter(R=>g-R<=E);switch(T.length){case 1:a.emit("click",p),n.isMobile?!a.isLock&&x&&a.toggle():a.toggle(),h=T;break;case 2:a.emit("dblclick",p),n.isMobile?!a.isLock&&k&&a.toggle():O&&(a.fullscreen=!a.fullscreen),h=[];break;default:h=[]}})}},{"../utils":"h3rH9","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],kpTJf:[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=e("../utils");function o(a,l){let{$player:d}=a.template;l.hover(d,c=>{(0,n.addClass)(d,"art-hover"),a.emit("hover",!0,c)},c=>{(0,n.removeClass)(d,"art-hover"),a.emit("hover",!1,c)})}},{"../utils":"h3rH9","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],ef6qz:[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");function n(o,a){let{$player:l}=o.template;a.proxy(l,"mousemove",d=>{o.emit("mousemove",d)})}s.defineInteropFlag(r),s.export(r,"default",()=>n)},{"@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],"9TXOX":[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=e("../utils");function o(a,l){let{option:d,constructor:c}=a;a.on("resize",()=>{let{aspectRatio:h,notice:p}=a;a.state==="standard"&&d.autoSize&&a.autoSize(),a.aspectRatio=h,p.show=""});let f=(0,n.debounce)(()=>a.emit("resize"),c.RESIZE_TIME);l.proxy(window,["orientationchange","resize"],()=>f()),screen&&screen.orientation&&screen.orientation.onchange&&l.proxy(screen.orientation,"change",()=>f())}},{"../utils":"h3rH9","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],dePMU:[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>a);var n=e("../utils"),o=e("../control/progress");function a(l,d){if(n.isMobile&&!l.option.isLive){let{$video:c,$progress:f}=l.template,h=null,p=!1,g=0,x=0,E=0,k=T=>{if(T.touches.length===1&&!l.isLock){h===f&&(0,o.setCurrentTime)(l,T),p=!0;let{pageX:R,pageY:C}=T.touches[0];g=R,x=C,E=l.currentTime}},O=T=>{if(T.touches.length===1&&p&&l.duration){let{pageX:R,pageY:C}=T.touches[0],b=function(I,j,F,$){var V=j-$,Q=F-I,z=0;if(2>Math.abs(Q)&&2>Math.abs(V))return z;var B=180*Math.atan2(V,Q)/Math.PI;return B>=-45&&B<45?z=4:B>=45&&B<135?z=1:B>=-135&&B<-45?z=2:(B>=135&&B<=180||B>=-180&&B<-135)&&(z=3),z}(g,x,R,C),A=[3,4].includes(b),L=[1,2].includes(b);if(A&&!l.isRotate||L&&l.isRotate){let I=(0,n.clamp)((R-g)/l.width,-1,1),j=(0,n.clamp)((C-x)/l.height,-1,1),F=l.isRotate?j:I,$=h===c?l.constructor.TOUCH_MOVE_RATIO:1,V=(0,n.clamp)(E+l.duration*F*$,0,l.duration);l.seek=V,l.emit("setBar","played",(0,n.clamp)(V/l.duration,0,1),T),l.notice.show=`${(0,n.secondToTime)(V)} / ${(0,n.secondToTime)(l.duration)}`}}};d.proxy(f,"touchstart",T=>{h=f,k(T)}),d.proxy(c,"touchstart",T=>{h=c,k(T)}),d.proxy(c,"touchmove",O),d.proxy(f,"touchmove",O),d.proxy(document,"touchend",()=>{p&&(g=0,x=0,E=0,p=!1,h=null)})}}},{"../utils":"h3rH9","../control/progress":"aBBSH","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],hDyWF:[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=e("../utils");function o(a,l){let{option:d,constructor:c,template:{$container:f}}=a,h=(0,n.throttle)(()=>{a.emit("view",(0,n.isInViewport)(f,c.SCROLL_GAP))},c.SCROLL_TIME);l.proxy(window,"scroll",()=>h()),a.on("view",p=>{d.autoMini&&(a.mini=!p)})}},{"../utils":"h3rH9","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],"7RjDP":[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");function n(o,a){a.proxy(document,"mousemove",l=>{o.emit("document:mousemove",l)}),a.proxy(document,"mouseup",l=>{o.emit("document:mouseup",l)})}s.defineInteropFlag(r),s.export(r,"default",()=>n)},{"@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],"8SmBT":[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");function n(o){if(o.constructor.USE_RAF){let a=null;(function l(){o.playing&&o.emit("raf"),o.isDestroy||(a=requestAnimationFrame(l))})(),o.on("destroy",()=>{cancelAnimationFrame(a)})}}s.defineInteropFlag(r),s.export(r,"default",()=>n)},{"@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],eTow4:[function(e,i,r){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(r);var s=e("./utils");r.default=class{constructor(n){this.art=n,this.keys={},n.option.hotkey&&!s.isMobile&&this.init()}init(){let{proxy:n,constructor:o}=this.art;this.add(27,()=>{this.art.fullscreenWeb&&(this.art.fullscreenWeb=!1)}),this.add(32,()=>{this.art.toggle()}),this.add(37,()=>{this.art.backward=o.SEEK_STEP}),this.add(38,()=>{this.art.volume+=o.VOLUME_STEP}),this.add(39,()=>{this.art.forward=o.SEEK_STEP}),this.add(40,()=>{this.art.volume-=o.VOLUME_STEP}),n(window,"keydown",a=>{if(this.art.isFocus){let l=document.activeElement.tagName.toUpperCase(),d=document.activeElement.getAttribute("contenteditable");if(l!=="INPUT"&&l!=="TEXTAREA"&&d!==""&&d!=="true"&&!a.altKey&&!a.ctrlKey&&!a.metaKey&&!a.shiftKey){let c=this.keys[a.keyCode];if(c){a.preventDefault();for(let f=0;f<c.length;f++)c[f].call(this.art,a);this.art.emit("hotkey",a)}}}})}add(n,o){return this.keys[n]?this.keys[n].push(o):this.keys[n]=[o],this}remove(n,o){if(this.keys[n]){let a=this.keys[n].indexOf(o);a!==-1&&this.keys[n].splice(a,1)}return this}}},{"./utils":"h3rH9","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],"4fDoD":[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r);var n=e("./utils/component"),o=s.interopDefault(n);class a extends o.default{constructor(d){super(d);let{option:c,template:{$layer:f}}=d;this.name="layer",this.$parent=f;for(let h=0;h<c.layers.length;h++)this.add(c.layers[h])}}r.default=a},{"./utils/component":"guki8","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],fE0Sp:[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r);var n=e("./utils"),o=e("./utils/component"),a=s.interopDefault(o);class l extends a.default{constructor(c){super(c),this.name="loading",(0,n.append)(c.template.$loading,c.icons.loading)}}r.default=l},{"./utils":"h3rH9","./utils/component":"guki8","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],"9PuGy":[function(e,i,r){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(r);var s=e("./utils");r.default=class{constructor(n){this.art=n,this.timer=null}set show(n){let{constructor:o,template:{$player:a,$noticeInner:l}}=this.art;n?(l.innerText=n instanceof Error?n.message.trim():n,(0,s.addClass)(a,"art-notice-show"),clearTimeout(this.timer),this.timer=setTimeout(()=>{l.innerText="",(0,s.removeClass)(a,"art-notice-show")},o.NOTICE_TIME)):(0,s.removeClass)(a,"art-notice-show")}}},{"./utils":"h3rH9","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],"2etr0":[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r);var n=e("./utils"),o=e("./utils/component"),a=s.interopDefault(o);class l extends a.default{constructor(c){super(c),this.name="mask";let{template:f,icons:h,events:p}=c,g=(0,n.append)(f.$state,h.state),x=(0,n.append)(f.$state,h.error);(0,n.setStyle)(x,"display","none"),c.on("destroy",()=>{(0,n.setStyle)(g,"display","none"),(0,n.setStyle)(x,"display",null)}),p.proxy(f.$state,"click",()=>c.play())}}r.default=l},{"./utils":"h3rH9","./utils/component":"guki8","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],"6dYSr":[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r);var n=e("../utils"),o=e("bundle-text:./loading.svg"),a=s.interopDefault(o),l=e("bundle-text:./state.svg"),d=s.interopDefault(l),c=e("bundle-text:./check.svg"),f=s.interopDefault(c),h=e("bundle-text:./play.svg"),p=s.interopDefault(h),g=e("bundle-text:./pause.svg"),x=s.interopDefault(g),E=e("bundle-text:./volume.svg"),k=s.interopDefault(E),O=e("bundle-text:./volume-close.svg"),T=s.interopDefault(O),R=e("bundle-text:./screenshot.svg"),C=s.interopDefault(R),b=e("bundle-text:./setting.svg"),A=s.interopDefault(b),L=e("bundle-text:./arrow-left.svg"),I=s.interopDefault(L),j=e("bundle-text:./arrow-right.svg"),F=s.interopDefault(j),$=e("bundle-text:./playback-rate.svg"),V=s.interopDefault($),Q=e("bundle-text:./aspect-ratio.svg"),z=s.interopDefault(Q),B=e("bundle-text:./config.svg"),w=s.interopDefault(B),P=e("bundle-text:./pip.svg"),G=s.interopDefault(P),et=e("bundle-text:./lock.svg"),rt=s.interopDefault(et),dt=e("bundle-text:./unlock.svg"),vt=s.interopDefault(dt),Lt=e("bundle-text:./fullscreen-off.svg"),xt=s.interopDefault(Lt),it=e("bundle-text:./fullscreen-on.svg"),at=s.interopDefault(it),lt=e("bundle-text:./fullscreen-web-off.svg"),ct=s.interopDefault(lt),mt=e("bundle-text:./fullscreen-web-on.svg"),It=s.interopDefault(mt),Gt=e("bundle-text:./switch-on.svg"),Xt=s.interopDefault(Gt),se=e("bundle-text:./switch-off.svg"),Yt=s.interopDefault(se),Et=e("bundle-text:./flip.svg"),We=s.interopDefault(Et),le=e("bundle-text:./error.svg"),Ae=s.interopDefault(le),Be=e("bundle-text:./close.svg"),Le=s.interopDefault(Be),ge=e("bundle-text:./airplay.svg"),ke=s.interopDefault(ge);r.default=class{constructor(li){let ti=Nt({loading:a.default,state:d.default,play:p.default,pause:x.default,check:f.default,volume:k.default,volumeClose:T.default,screenshot:C.default,setting:A.default,pip:G.default,arrowLeft:I.default,arrowRight:F.default,playbackRate:V.default,aspectRatio:z.default,config:w.default,lock:rt.default,flip:We.default,unlock:vt.default,fullscreenOff:xt.default,fullscreenOn:at.default,fullscreenWebOff:ct.default,fullscreenWebOn:It.default,switchOn:Xt.default,switchOff:Yt.default,error:Ae.default,close:Le.default,airplay:ke.default},li.option.icons);for(let Ye in ti)(0,n.def)(this,Ye,{get:()=>(0,n.getIcon)(Ye,ti[Ye])})}}},{"../utils":"h3rH9","bundle-text:./loading.svg":"fY5Gt","bundle-text:./state.svg":"iNfLt","bundle-text:./check.svg":"jtE9u","bundle-text:./play.svg":"elgfY","bundle-text:./pause.svg":"eKokJ","bundle-text:./volume.svg":"hNB4y","bundle-text:./volume-close.svg":"i9vta","bundle-text:./screenshot.svg":"kB3Mf","bundle-text:./setting.svg":"3MONs","bundle-text:./arrow-left.svg":"iMCpk","bundle-text:./arrow-right.svg":"3oe4L","bundle-text:./playback-rate.svg":"liE22","bundle-text:./aspect-ratio.svg":"8HqYc","bundle-text:./config.svg":"hYAAH","bundle-text:./pip.svg":"jmNrH","bundle-text:./lock.svg":"cIqko","bundle-text:./unlock.svg":"65zy4","bundle-text:./fullscreen-off.svg":"jaJRT","bundle-text:./fullscreen-on.svg":"cRY1X","bundle-text:./fullscreen-web-off.svg":"3aVGL","bundle-text:./fullscreen-web-on.svg":"4DiVn","bundle-text:./switch-on.svg":"kwdKE","bundle-text:./switch-off.svg":"bWfXZ","bundle-text:./flip.svg":"h3zZ9","bundle-text:./error.svg":"7Oyth","bundle-text:./close.svg":"U5Jcy","bundle-text:./airplay.svg":"jK5Fx","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],fY5Gt:[function(e,i,r){i.exports='<svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" class="uil-default"><path fill="none" class="bk" d="M0 0h100v100H0z"/><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="translate(0 -30)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-1s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(30 105.98 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.9166666666666666s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(60 75.98 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.8333333333333334s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(90 65 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.75s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(120 58.66 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.6666666666666666s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(150 54.02 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.5833333333333334s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(180 50 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.5s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(-150 45.98 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.4166666666666667s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(-120 41.34 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.3333333333333333s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(-90 35 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.25s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(-60 24.02 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.16666666666666666s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(-30 -5.98 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.08333333333333333s" repeatCount="indefinite"/></rect></svg>'},{}],iNfLt:[function(e,i,r){i.exports='<svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" viewBox="0 0 24 24"><path fill="#fff" d="M9.5 9.325v5.35q0 .575.525.875t1.025-.05l4.15-2.65q.475-.3.475-.85t-.475-.85L11.05 8.5q-.5-.35-1.025-.05t-.525.875ZM12 22q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22Z"/></svg>'},{}],jtE9u:[function(e,i,r){i.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style="width:100%;height:100%"><path d="M9 16.2 4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z" fill="#fff"/></svg>'},{}],elgfY:[function(e,i,r){i.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22"><path d="M17.982 9.275 8.06 3.27A2.013 2.013 0 0 0 5 4.994v12.011a2.017 2.017 0 0 0 3.06 1.725l9.922-6.005a2.017 2.017 0 0 0 0-3.45z"/></svg>'},{}],eKokJ:[function(e,i,r){i.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22"><path d="M7 3a2 2 0 0 0-2 2v12a2 2 0 1 0 4 0V5a2 2 0 0 0-2-2zm8 0a2 2 0 0 0-2 2v12a2 2 0 1 0 4 0V5a2 2 0 0 0-2-2z"/></svg>'},{}],hNB4y:[function(e,i,r){i.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22"><path d="M10.188 4.65 6 8H5a2 2 0 0 0-2 2v2a2 2 0 0 0 2 2h1l4.188 3.35a.5.5 0 0 0 .812-.39V5.04a.498.498 0 0 0-.812-.39zm4.258-.872a1 1 0 0 0-.862 1.804 6.002 6.002 0 0 1-.007 10.838 1 1 0 0 0 .86 1.806A8.001 8.001 0 0 0 19 11a8.001 8.001 0 0 0-4.554-7.222z"/><path d="M15 11a3.998 3.998 0 0 0-2-3.465v6.93A3.998 3.998 0 0 0 15 11z"/></svg>'},{}],i9vta:[function(e,i,r){i.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22"><path d="M15 11a3.998 3.998 0 0 0-2-3.465v2.636l1.865 1.865A4.02 4.02 0 0 0 15 11z"/><path d="M13.583 5.583A5.998 5.998 0 0 1 17 11a6 6 0 0 1-.585 2.587l1.477 1.477a8.001 8.001 0 0 0-3.446-11.286 1 1 0 0 0-.863 1.805zm5.195 13.195-2.121-2.121-1.414-1.414-1.415-1.415L13 13l-2-2-3.889-3.889-3.889-3.889a.999.999 0 1 0-1.414 1.414L5.172 8H5a2 2 0 0 0-2 2v2a2 2 0 0 0 2 2h1l4.188 3.35a.5.5 0 0 0 .812-.39v-3.131l2.587 2.587-.01.005a1 1 0 0 0 .86 1.806c.215-.102.424-.214.627-.333l2.3 2.3a1.001 1.001 0 0 0 1.414-1.416zM11 5.04a.5.5 0 0 0-.813-.39L8.682 5.854 11 8.172V5.04z"/></svg>'},{}],kB3Mf:[function(e,i,r){i.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22" viewBox="0 0 50 50"><path d="M19.402 6a5 5 0 0 0-4.902 4.012L14.098 12H9a5 5 0 0 0-5 5v21a5 5 0 0 0 5 5h32a5 5 0 0 0 5-5V17a5 5 0 0 0-5-5h-5.098l-.402-1.988A5 5 0 0 0 30.598 6ZM25 17c5.52 0 10 4.48 10 10s-4.48 10-10 10-10-4.48-10-10 4.48-10 10-10Zm0 2c-4.41 0-8 3.59-8 8s3.59 8 8 8 8-3.59 8-8-3.59-8-8-8Z"/></svg>'},{}],"3MONs":[function(e,i,r){i.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22"><circle cx="11" cy="11" r="2"/><path d="M19.164 8.861 17.6 8.6a6.978 6.978 0 0 0-1.186-2.099l.574-1.533a1 1 0 0 0-.436-1.217l-1.997-1.153a1.001 1.001 0 0 0-1.272.23l-1.008 1.225a7.04 7.04 0 0 0-2.55.001L8.716 2.829a1 1 0 0 0-1.272-.23L5.447 3.751a1 1 0 0 0-.436 1.217l.574 1.533A6.997 6.997 0 0 0 4.4 8.6l-1.564.261A.999.999 0 0 0 2 9.847v2.306c0 .489.353.906.836.986l1.613.269a7 7 0 0 0 1.228 2.075l-.558 1.487a1 1 0 0 0 .436 1.217l1.997 1.153c.423.244.961.147 1.272-.23l1.04-1.263a7.089 7.089 0 0 0 2.272 0l1.04 1.263a1 1 0 0 0 1.272.23l1.997-1.153a1 1 0 0 0 .436-1.217l-.557-1.487c.521-.61.94-1.31 1.228-2.075l1.613-.269a.999.999 0 0 0 .835-.986V9.847a.999.999 0 0 0-.836-.986zM11 15a4 4 0 1 1 0-8 4 4 0 0 1 0 8z"/></svg>'},{}],iMCpk:[function(e,i,r){i.exports='<svg xmlns="http://www.w3.org/2000/svg" height="32" width="32"><path d="m19.41 20.09-4.58-4.59 4.58-4.59L18 9.5l-6 6 6 6z" fill="#fff"/></svg>'},{}],"3oe4L":[function(e,i,r){i.exports='<svg xmlns="http://www.w3.org/2000/svg" height="32" width="32"><path d="m12.59 20.34 4.58-4.59-4.58-4.59L14 9.75l6 6-6 6z" fill="#fff"/></svg>'},{}],liE22:[function(e,i,r){i.exports='<svg height="24" width="24"><path d="M10 8v8l6-4-6-4zM6.3 5l-.6-.8C7.2 3 9 2.2 11 2l.1 1c-1.8.2-3.4.9-4.8 2zM5 6.3l-.8-.6C3 7.2 2.2 9 2 11l1 .1c.2-1.8.9-3.4 2-4.8zm0 11.4c-1.1-1.4-1.8-3.1-2-4.8L2 13c.2 2 1 3.8 2.2 5.4l.8-.7zm6.1 3.3c-1.8-.2-3.4-.9-4.8-2l-.6.8C7.2 21 9 21.8 11 22l.1-1zM22 12c0-5.2-3.9-9.4-9-10l-.1 1c4.6.5 8.1 4.3 8.1 9s-3.5 8.5-8.1 9l.1 1c5.2-.5 9-4.8 9-10z" fill="#fff" style="--darkreader-inline-fill:#a8a6a4"/></svg>'},{}],"8HqYc":[function(e,i,r){i.exports=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 88 88" style="width:100%;height:100%;transform:translate(0,0)"><defs><clipPath id="__lottie_element_216"><path d="M0 0h88v88H0z"/></clipPath></defs><g style="display:block" clip-path="url('#__lottie_element_216')"><path fill="#FFF" d="m12.438-12.702-2.82 2.82c-.79.79-.79 2.05 0 2.83l7.07 7.07-7.07 7.07c-.79.79-.79 2.05 0 2.83l2.82 2.83c.79.78 2.05.78 2.83 0l11.32-11.31c.78-.78.78-2.05 0-2.83l-11.32-11.31c-.78-.79-2.04-.79-2.83 0zm-24.88 0c-.74-.74-1.92-.78-2.7-.12l-.13.12-11.31 11.31a2 2 0 0 0-.12 2.7l.12.13 11.31 11.31a2 2 0 0 0 2.7.12l.13-.12 2.83-2.83c.74-.74.78-1.91.11-2.7l-.11-.13-7.07-7.07 7.07-7.07c.74-.74.78-1.91.11-2.7l-.11-.13-2.83-2.82zM28-28c4.42 0 8 3.58 8 8v40c0 4.42-3.58 8-8 8h-56c-4.42 0-8-3.58-8-8v-40c0-4.42 3.58-8 8-8h56z" style="--darkreader-inline-fill:#a8a6a4" transform="translate(44 44)"/></g></svg>`},{}],hYAAH:[function(e,i,r){i.exports='<svg height="24" width="24"><path d="M15 17h6v1h-6v-1zm-4 0H3v1h8v2h1v-5h-1v2zm3-9h1V3h-1v2H3v1h11v2zm4-3v1h3V5h-3zM6 14h1V9H6v2H3v1h3v2zm4-2h11v-1H10v1z" fill="#fff" style="--darkreader-inline-fill:#a8a6a4"/></svg>'},{}],jmNrH:[function(e,i,r){i.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 36" height="32" width="32"><path d="M25 17h-8v6h8v-6Zm4 8V10.98C29 9.88 28.1 9 27 9H9c-1.1 0-2 .88-2 1.98V25c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2Zm-2 .02H9V10.97h18v14.05Z"/></svg>'},{}],cIqko:[function(e,i,r){i.exports='<svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="20" height="20"><path d="M298.667 426.667v-85.334a213.333 213.333 0 1 1 426.666 0v85.334H768A85.333 85.333 0 0 1 853.333 512v256A85.333 85.333 0 0 1 768 853.333H256A85.333 85.333 0 0 1 170.667 768V512A85.333 85.333 0 0 1 256 426.667h42.667zM512 213.333a128 128 0 0 0-128 128v85.334h256v-85.334a128 128 0 0 0-128-128z" fill="#fff"/></svg>'},{}],"65zy4":[function(e,i,r){i.exports='<svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="20" height="20"><path d="m666.752 194.517-49.365 74.112A128 128 0 0 0 384 341.333l.043 85.334h384A85.333 85.333 0 0 1 853.376 512v256a85.333 85.333 0 0 1-85.333 85.333H256A85.333 85.333 0 0 1 170.667 768V512A85.333 85.333 0 0 1 256 426.667h42.667v-85.334a213.333 213.333 0 0 1 368.085-146.816z" fill="#fff"/></svg>'},{}],jaJRT:[function(e,i,r){i.exports='<svg class="icon" width="22" height="22" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M768 298.667h170.667V384h-256V128H768v170.667zM341.333 384h-256v-85.333H256V128h85.333v256zM768 725.333V896h-85.333V640h256v85.333H768zM341.333 640v256H256V725.333H85.333V640h256z"/></svg>'},{}],cRY1X:[function(e,i,r){i.exports='<svg class="icon" width="22" height="22" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M625.778 256H768v142.222h113.778v-256h-256V256zM256 398.222V256h142.222V142.222h-256v256H256zm512 227.556V768H625.778v113.778h256v-256H768zM398.222 768H256V625.778H142.222v256h256V768z"/></svg>'},{}],"3aVGL":[function(e,i,r){i.exports='<svg class="icon" width="18" height="18" viewBox="0 0 1152 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M1075.2 0H76.8A76.8 76.8 0 0 0 0 76.8v870.4a76.8 76.8 0 0 0 76.8 76.8h998.4a76.8 76.8 0 0 0 76.8-76.8V76.8A76.8 76.8 0 0 0 1075.2 0zM1024 128v768H128V128h896zM896 512a64 64 0 0 1 7.488 127.552L896 640H768v128a64 64 0 0 1-56.512 63.552L704 832a64 64 0 0 1-63.552-56.512L640 768V582.592c0-34.496 25.024-66.112 61.632-70.208l8-.384H896zm-640 0a64 64 0 0 1-7.488-127.552L256 384h128V256a64 64 0 0 1 56.512-63.552L448 192a64 64 0 0 1 63.552 56.512L512 256v185.408c0 34.432-25.024 66.112-61.632 70.144l-8 .448H256z"/></svg>'},{}],"4DiVn":[function(e,i,r){i.exports='<svg class="icon" width="18" height="18" viewBox="0 0 1152 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M1075.2 0H76.8A76.8 76.8 0 0 0 0 76.8v870.4a76.8 76.8 0 0 0 76.8 76.8h998.4a76.8 76.8 0 0 0 76.8-76.8V76.8A76.8 76.8 0 0 0 1075.2 0zM1024 128v768H128V128h896zm-576 64a64 64 0 0 1 7.488 127.552L448 320H320v128a64 64 0 0 1-56.512 63.552L256 512a64 64 0 0 1-63.552-56.512L192 448V262.592c0-34.432 25.024-66.112 61.632-70.144l8-.448H448zm256 640a64 64 0 0 1-7.488-127.552L704 704h128V576a64 64 0 0 1 56.512-63.552L896 512a64 64 0 0 1 63.552 56.512L960 576v185.408c0 34.496-25.024 66.112-61.632 70.208l-8 .384H704z"/></svg>'},{}],kwdKE:[function(e,i,r){i.exports='<svg class="icon" width="26" height="26" viewBox="0 0 1664 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#648FFC" d="M1152 0H512a512 512 0 0 0 0 1024h640a512 512 0 0 0 0-1024zm0 960a448 448 0 1 1 448-448 448 448 0 0 1-448 448z"/></svg>'},{}],bWfXZ:[function(e,i,r){i.exports='<svg class="icon" width="26" height="26" viewBox="0 0 1740 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M511.898 1024h670.515c282.419-.41 511.18-229.478 511.18-511.898 0-282.419-228.761-511.488-511.18-511.897H511.898C229.478.615.717 229.683.717 512.102c0 282.42 228.761 511.488 511.18 511.898zm-.564-975.36A464.589 464.589 0 1 1 48.026 513.024 463.872 463.872 0 0 1 511.334 48.435v.205z"/></svg>'},{}],h3zZ9:[function(e,i,r){i.exports='<svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="24" height="24"><path d="M554.667 810.667V896h-85.334v-85.333h85.334zm-384-632.662a42.667 42.667 0 0 1 34.986 18.219l203.904 291.328a42.667 42.667 0 0 1 0 48.896L205.611 827.776A42.667 42.667 0 0 1 128 803.328V220.672a42.667 42.667 0 0 1 42.667-42.667zm682.666 0a42.667 42.667 0 0 1 42.368 37.718l.299 4.949v582.656a42.667 42.667 0 0 1-74.24 28.63l-3.413-4.182-203.904-291.328a42.667 42.667 0 0 1-3.03-43.861l3.03-5.035 203.946-291.328a42.667 42.667 0 0 1 34.944-18.219zM554.667 640v85.333h-85.334V640h85.334zm-358.4-320.896V716.8L335.957 512 196.31 319.104zm358.4 150.23v85.333h-85.334v-85.334h85.334zm0-170.667V384h-85.334v-85.333h85.334zm0-170.667v85.333h-85.334V128h85.334z" fill="#fff"/></svg>'},{}],"7Oyth":[function(e,i,r){i.exports='<svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="50" height="50"><path d="M593.818 168.55 949.82 763.76c26.153 43.746 10.732 99.738-34.447 125.052-14.397 8.069-30.72 12.308-47.37 12.308H155.976c-52.224 0-94.536-40.96-94.536-91.505 0-16.097 4.383-31.928 12.718-45.875l356.004-595.19c26.173-43.724 84.009-58.654 129.208-33.341a93.082 93.082 0 0 1 34.448 33.341zM512 819.2a61.44 61.44 0 1 0 0-122.88 61.44 61.44 0 0 0 0 122.88zm0-512a72.315 72.315 0 0 0-71.762 81.306l25.723 205.721a46.408 46.408 0 0 0 92.078 0l25.723-205.742A72.315 72.315 0 0 0 512 307.2z"/></svg>'},{}],U5Jcy:[function(e,i,r){i.exports='<svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="22" height="22"><path d="m571.733 512 268.8-268.8c17.067-17.067 17.067-42.667 0-59.733-17.066-17.067-42.666-17.067-59.733 0L512 452.267l-268.8-268.8c-17.067-17.067-42.667-17.067-59.733 0-17.067 17.066-17.067 42.666 0 59.733l268.8 268.8-268.8 268.8c-17.067 17.067-17.067 42.667 0 59.733 8.533 8.534 19.2 12.8 29.866 12.8s21.334-4.266 29.867-12.8l268.8-268.8 268.8 268.8c8.533 8.534 19.2 12.8 29.867 12.8s21.333-4.266 29.866-12.8c17.067-17.066 17.067-42.666 0-59.733L571.733 512z"/></svg>'},{}],jK5Fx:[function(e,i,r){i.exports='<svg width="18" height="18" xmlns="http://www.w3.org/2000/svg"><g fill="#fff"><path d="M16 1H2a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h3v-2H3V3h12v8h-2v2h3a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1Z"/><path d="M4 17h10l-5-6z"/></g></svg>'},{}],bRHiA:[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r);var n=e("./flip"),o=s.interopDefault(n),a=e("./aspectRatio"),l=s.interopDefault(a),d=e("./playbackRate"),c=s.interopDefault(d),f=e("./subtitleOffset"),h=s.interopDefault(f),p=e("../utils/component"),g=s.interopDefault(p),x=e("../utils/error"),E=e("../utils");class k extends g.default{constructor(T){super(T);let{option:R,controls:C,template:{$setting:b}}=T;this.name="setting",this.$parent=b,this.option=[],this.events=[],this.cache=new Map,R.setting&&(this.init(),T.on("blur",()=>{this.show&&(this.show=!1,this.render(this.option))}),T.on("focus",A=>{let L=(0,E.includeFromEvent)(A,C.setting),I=(0,E.includeFromEvent)(A,this.$parent);!this.show||L||I||(this.show=!1,this.render(this.option))}))}static makeRecursion(T,R,C){for(let b=0;b<T.length;b++){let A=T[b];A.$parentItem=R,A.$parentList=C,k.makeRecursion(A.selector||[],A,T)}return T}get defaultSettings(){let T=[],{option:R}=this.art;return R.playbackRate&&T.push((0,c.default)(this.art)),R.aspectRatio&&T.push((0,l.default)(this.art)),R.flip&&T.push((0,o.default)(this.art)),R.subtitleOffset&&T.push((0,h.default)(this.art)),T}init(){let{option:T}=this.art,R=[...this.defaultSettings,...T.settings];this.option=k.makeRecursion(R),this.destroy(),this.render(this.option)}destroy(){for(let T=0;T<this.events.length;T++)this.art.events.remove(this.events[T]);this.$parent.innerHTML="",this.events=[],this.cache=new Map}find(T="",R=this.option){for(let C=0;C<R.length;C++){let b=R[C];if(b.name===T)return b;{let A=this.find(T,b.selector||[]);if(A)return A}}}remove(T){let R=this.find(T);(0,x.errorHandle)(R,`Can't find [${T}] from the [setting]`);let C=R.$parentItem?R.$parentItem.selector:this.option;return C.splice(C.indexOf(R),1),this.option=k.makeRecursion(this.option),this.destroy(),this.render(this.option),this.option}update(T){let R=this.find(T.name);return R?(Object.assign(R,T),this.option=k.makeRecursion(this.option),this.destroy(),this.render(this.option)):this.add(T),this.option}add(T){return this.option.push(T),this.option=k.makeRecursion(this.option),this.destroy(),this.render(this.option),this.option}creatHeader(T){let{icons:R,proxy:C,constructor:b}=this.art,A=(0,E.createElement)("div");(0,E.setStyle)(A,"height",`${b.SETTING_ITEM_HEIGHT}px`),(0,E.addClass)(A,"art-setting-item"),(0,E.addClass)(A,"art-setting-item-back");let L=(0,E.append)(A,'<div class="art-setting-item-left"></div>'),I=(0,E.createElement)("div");(0,E.addClass)(I,"art-setting-item-left-icon"),(0,E.append)(I,R.arrowLeft),(0,E.append)(L,I),(0,E.append)(L,T.$parentItem.html);let j=C(A,"click",()=>this.render(T.$parentList));return this.events.push(j),A}creatItem(T,R){let{icons:C,proxy:b,constructor:A}=this.art,L=(0,E.createElement)("div");(0,E.addClass)(L,"art-setting-item"),(0,E.setStyle)(L,"height",`${A.SETTING_ITEM_HEIGHT}px`),(0,E.isStringOrNumber)(R.name)&&(L.dataset.name=R.name),(0,E.isStringOrNumber)(R.value)&&(L.dataset.value=R.value);let I=(0,E.append)(L,'<div class="art-setting-item-left"></div>'),j=(0,E.append)(L,'<div class="art-setting-item-right"></div>'),F=(0,E.createElement)("div");switch((0,E.addClass)(F,"art-setting-item-left-icon"),T){case"switch":case"range":(0,E.append)(F,(0,E.isStringOrNumber)(R.icon)||R.icon instanceof Element?R.icon:C.config);break;case"selector":R.selector&&R.selector.length?(0,E.append)(F,(0,E.isStringOrNumber)(R.icon)||R.icon instanceof Element?R.icon:C.config):(0,E.append)(F,C.check)}(0,E.append)(I,F),R.$icon=F,(0,E.def)(R,"icon",{configurable:!0,get:()=>F.innerHTML,set(Q){(0,E.isStringOrNumber)(Q)&&(F.innerHTML=Q)}});let $=(0,E.createElement)("div");(0,E.addClass)($,"art-setting-item-left-text"),(0,E.append)($,R.html||""),(0,E.append)(I,$),R.$html=$,(0,E.def)(R,"html",{configurable:!0,get:()=>$.innerHTML,set(Q){(0,E.isStringOrNumber)(Q)&&($.innerHTML=Q)}});let V=(0,E.createElement)("div");switch((0,E.addClass)(V,"art-setting-item-right-tooltip"),(0,E.append)(V,R.tooltip||""),(0,E.append)(j,V),R.$tooltip=V,(0,E.def)(R,"tooltip",{configurable:!0,get:()=>V.innerHTML,set(Q){(0,E.isStringOrNumber)(Q)&&(V.innerHTML=Q)}}),T){case"switch":{let Q=(0,E.createElement)("div");(0,E.addClass)(Q,"art-setting-item-right-icon");let z=(0,E.append)(Q,C.switchOn),B=(0,E.append)(Q,C.switchOff);(0,E.setStyle)(R.switch?B:z,"display","none"),(0,E.append)(j,Q),R.$switch=R.switch,(0,E.def)(R,"switch",{configurable:!0,get:()=>R.$switch,set(w){R.$switch=w,w?((0,E.setStyle)(B,"display","none"),(0,E.setStyle)(z,"display",null)):((0,E.setStyle)(B,"display",null),(0,E.setStyle)(z,"display","none"))}});break}case"range":{let Q=(0,E.createElement)("div");(0,E.addClass)(Q,"art-setting-item-right-icon");let z=(0,E.append)(Q,'<input type="range">');z.value=R.range[0]||0,z.min=R.range[1]||0,z.max=R.range[2]||10,z.step=R.range[3]||1,(0,E.addClass)(z,"art-setting-range"),(0,E.append)(j,Q),R.$range=z,(0,E.def)(R,"range",{configurable:!0,get:()=>z.valueAsNumber,set(B){z.value=Number(B)}})}break;case"selector":if(R.selector&&R.selector.length){let Q=(0,E.createElement)("div");(0,E.addClass)(Q,"art-setting-item-right-icon"),(0,E.append)(Q,C.arrowRight),(0,E.append)(j,Q)}}switch(T){case"switch":if(R.onSwitch){let Q=b(L,"click",z=>zt(this,null,function*(){R.switch=yield R.onSwitch.call(this.art,R,L,z)}));this.events.push(Q)}break;case"range":if(R.$range){if(R.onRange){let Q=b(R.$range,"change",z=>zt(this,null,function*(){R.tooltip=yield R.onRange.call(this.art,R,L,z)}));this.events.push(Q)}if(R.onChange){let Q=b(R.$range,"input",z=>zt(this,null,function*(){R.tooltip=yield R.onChange.call(this.art,R,L,z)}));this.events.push(Q)}}break;case"selector":{let Q=b(L,"click",z=>zt(this,null,function*(){if(R.selector&&R.selector.length)this.render(R.selector,R.width);else{(0,E.inverseClass)(L,"art-current");for(let B=0;B<R.$parentItem.selector.length;B++){let w=R.$parentItem.selector[B];w.default=w===R}if(R.$parentList&&this.render(R.$parentList),R.$parentItem&&R.$parentItem.onSelect){let B=yield R.$parentItem.onSelect.call(this.art,R,L,z);R.$parentItem.$tooltip&&(0,E.isStringOrNumber)(B)&&(R.$parentItem.$tooltip.innerHTML=B)}}}));this.events.push(Q),R.default&&(0,E.addClass)(L,"art-current")}}return L}updateStyle(T){let{controls:R,constructor:C,template:{$player:b,$setting:A}}=this.art;if(R.setting&&!E.isMobile){let L=T||C.SETTING_WIDTH,{left:I,width:j}=(0,E.getRect)(R.setting),{left:F,width:$}=(0,E.getRect)(b),V=I-F+j/2-L/2;V+L>$?((0,E.setStyle)(A,"left",null),(0,E.setStyle)(A,"right",null)):((0,E.setStyle)(A,"left",`${V}px`),(0,E.setStyle)(A,"right","auto"))}}render(T,R){let{constructor:C}=this.art;if(this.cache.has(T)){let b=this.cache.get(T);(0,E.inverseClass)(b,"art-current"),(0,E.setStyle)(this.$parent,"width",`${b.dataset.width}px`),(0,E.setStyle)(this.$parent,"height",`${b.dataset.height}px`),this.updateStyle(Number(b.dataset.width))}else{let b=(0,E.createElement)("div");(0,E.addClass)(b,"art-setting-panel"),b.dataset.width=R||C.SETTING_WIDTH,b.dataset.height=T.length*C.SETTING_ITEM_HEIGHT,T[0]&&T[0].$parentItem&&((0,E.append)(b,this.creatHeader(T[0])),b.dataset.height=Number(b.dataset.height)+C.SETTING_ITEM_HEIGHT);for(let A=0;A<T.length;A++){let L=T[A];(0,E.has)(L,"switch")?(0,E.append)(b,this.creatItem("switch",L)):(0,E.has)(L,"range")?(0,E.append)(b,this.creatItem("range",L)):(0,E.append)(b,this.creatItem("selector",L))}(0,E.append)(this.$parent,b),this.cache.set(T,b),(0,E.inverseClass)(b,"art-current"),(0,E.setStyle)(this.$parent,"width",`${b.dataset.width}px`),(0,E.setStyle)(this.$parent,"height",`${b.dataset.height}px`),this.updateStyle(Number(b.dataset.width)),T[0]&&T[0].$parentItem&&T[0].$parentItem.mounted&&T[0].$parentItem.mounted.call(this.art,b,T[0].$parentItem)}}}r.default=k},{"./flip":"bNOaj","./aspectRatio":"5lAsp","./playbackRate":"e6hsR","./subtitleOffset":"fFNEr","../utils/component":"guki8","../utils/error":"2nFlF","../utils":"h3rH9","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],bNOaj:[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=e("../utils");function o(a){let{i18n:l,icons:d,constructor:{SETTING_ITEM_WIDTH:c,FLIP:f}}=a;function h(p,g,x){g&&(g.innerText=l.get((0,n.capitalize)(x)));let E=(0,n.queryAll)(".art-setting-item",p).find(k=>k.dataset.value===x);E&&(0,n.inverseClass)(E,"art-current")}return{width:c,name:"flip",html:l.get("Video Flip"),tooltip:l.get((0,n.capitalize)(a.flip)),icon:d.flip,selector:f.map(p=>({value:p,name:`aspect-ratio-${p}`,default:p===a.flip,html:l.get((0,n.capitalize)(p))})),onSelect:p=>(a.flip=p.value,p.html),mounted:(p,g)=>{h(p,g.$tooltip,a.flip),a.on("flip",()=>{h(p,g.$tooltip,a.flip)})}}}},{"../utils":"h3rH9","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],"5lAsp":[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=e("../utils");function o(a){let{i18n:l,icons:d,constructor:{SETTING_ITEM_WIDTH:c,ASPECT_RATIO:f}}=a;function h(g){return g==="default"?l.get("Default"):g}function p(g,x,E){x&&(x.innerText=h(E));let k=(0,n.queryAll)(".art-setting-item",g).find(O=>O.dataset.value===E);k&&(0,n.inverseClass)(k,"art-current")}return{width:c,name:"aspect-ratio",html:l.get("Aspect Ratio"),icon:d.aspectRatio,tooltip:h(a.aspectRatio),selector:f.map(g=>({value:g,name:`aspect-ratio-${g}`,default:g===a.aspectRatio,html:h(g)})),onSelect:g=>(a.aspectRatio=g.value,g.html),mounted:(g,x)=>{p(g,x.$tooltip,a.aspectRatio),a.on("aspectRatio",()=>{p(g,x.$tooltip,a.aspectRatio)})}}}},{"../utils":"h3rH9","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],e6hsR:[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=e("../utils");function o(a){let{i18n:l,icons:d,constructor:{SETTING_ITEM_WIDTH:c,PLAYBACK_RATE:f}}=a;function h(g){return g===1?l.get("Normal"):g.toFixed(1)}function p(g,x,E){x&&(x.innerText=h(E));let k=(0,n.queryAll)(".art-setting-item",g).find(O=>Number(O.dataset.value)===E);k&&(0,n.inverseClass)(k,"art-current")}return{width:c,name:"playback-rate",html:l.get("Play Speed"),tooltip:h(a.playbackRate),icon:d.playbackRate,selector:f.map(g=>({value:g,name:`aspect-ratio-${g}`,default:g===a.playbackRate,html:h(g)})),onSelect:g=>(a.playbackRate=g.value,g.html),mounted:(g,x)=>{p(g,x.$tooltip,a.playbackRate),a.on("video:ratechange",()=>{p(g,x.$tooltip,a.playbackRate)})}}}},{"../utils":"h3rH9","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],fFNEr:[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");function n(o){let{i18n:a,icons:l,constructor:d}=o;return{width:d.SETTING_ITEM_WIDTH,name:"subtitle-offset",html:a.get("Subtitle Offset"),icon:l.subtitle,tooltip:"0s",range:[0,-5,5,.1],onChange:c=>(o.subtitleOffset=c.range,c.range+"s")}}s.defineInteropFlag(r),s.export(r,"default",()=>n)},{"@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],f2Thp:[function(e,i,r){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(r),r.default=class{constructor(){this.name="artplayer_settings",this.settings={}}get(s){try{let n=JSON.parse(window.localStorage.getItem(this.name))||{};return s?n[s]:n}catch(n){return s?this.settings[s]:this.settings}}set(s,n){try{let o=Object.assign({},this.get(),{[s]:n});window.localStorage.setItem(this.name,JSON.stringify(o))}catch(o){this.settings[s]=n}}del(s){try{let n=this.get();delete n[s],window.localStorage.setItem(this.name,JSON.stringify(n))}catch(n){delete this.settings[s]}}clear(){try{window.localStorage.removeItem(this.name)}catch(s){this.settings={}}}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],"96ThS":[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r);var n=e("../utils"),o=e("./miniProgressBar"),a=s.interopDefault(o),l=e("./autoOrientation"),d=s.interopDefault(l),c=e("./autoPlayback"),f=s.interopDefault(c),h=e("./fastForward"),p=s.interopDefault(h),g=e("./lock"),x=s.interopDefault(g);r.default=class{constructor(E){this.art=E,this.id=0;let{option:k}=E;k.miniProgressBar&&!k.isLive&&this.add(a.default),k.lock&&n.isMobile&&this.add(x.default),k.autoPlayback&&!k.isLive&&this.add(f.default),k.autoOrientation&&n.isMobile&&this.add(d.default),k.fastForward&&n.isMobile&&!k.isLive&&this.add(p.default);for(let O=0;O<k.plugins.length;O++)this.add(k.plugins[O])}add(E){this.id+=1;let k=E.call(this.art,this.art);return k instanceof Promise?k.then(O=>this.next(E,O)):this.next(E,k)}next(E,k){let O=k&&k.name||E.name||`plugin${this.id}`;return(0,n.errorHandle)(!(0,n.has)(this,O),`Cannot add a plugin that already has the same name: ${O}`),(0,n.def)(this,O,{value:k}),this}}},{"../utils":"h3rH9","./miniProgressBar":"iBx4M","./autoOrientation":"2O9qO","./autoPlayback":"iiOc1","./fastForward":"d9NUE","./lock":"5dnKh","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],iBx4M:[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=e("../utils");function o(a){return a.on("control",l=>{l?(0,n.removeClass)(a.template.$player,"art-mini-progress-bar"):(0,n.addClass)(a.template.$player,"art-mini-progress-bar")}),{name:"mini-progress-bar"}}},{"../utils":"h3rH9","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],"2O9qO":[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=e("../utils");function o(a){let{constructor:l,template:{$player:d,$video:c}}=a;return a.on("fullscreenWeb",f=>{if(f){let{videoWidth:h,videoHeight:p}=c,{clientWidth:g,clientHeight:x}=document.documentElement;(h>p&&g<x||h<p&&g>x)&&setTimeout(()=>{(0,n.setStyle)(d,"width",`${x}px`),(0,n.setStyle)(d,"height",`${g}px`),(0,n.setStyle)(d,"transform-origin","0 0"),(0,n.setStyle)(d,"transform",`rotate(90deg) translate(0, -${g}px)`),(0,n.addClass)(d,"art-auto-orientation"),a.isRotate=!0,a.emit("resize")},l.AUTO_ORIENTATION_TIME)}else(0,n.hasClass)(d,"art-auto-orientation")&&((0,n.removeClass)(d,"art-auto-orientation"),a.isRotate=!1,a.emit("resize"))}),a.on("fullscreen",f=>zt(this,null,function*(){var p;if(!((p=screen==null?void 0:screen.orientation)!=null&&p.lock))return;let h=screen.orientation.type;if(f){let{videoWidth:g,videoHeight:x}=c,{clientWidth:E,clientHeight:k}=document.documentElement;if(g>x&&E<k||g<x&&E>k){let O=h.startsWith("portrait")?"landscape":"portrait";yield screen.orientation.lock(O),(0,n.addClass)(d,"art-auto-orientation-fullscreen")}}else(0,n.hasClass)(d,"art-auto-orientation-fullscreen")&&(yield screen.orientation.lock(h),(0,n.removeClass)(d,"art-auto-orientation-fullscreen"))})),{name:"autoOrientation",get state(){return(0,n.hasClass)(d,"art-auto-orientation")}}}},{"../utils":"h3rH9","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],iiOc1:[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=e("../utils");function o(a){let{i18n:l,icons:d,storage:c,constructor:f,proxy:h,template:{$poster:p}}=a,g=a.layers.add({name:"auto-playback",html:'<div class="art-auto-playback-close"></div><div class="art-auto-playback-last"></div><div class="art-auto-playback-jump"></div>'}),x=(0,n.query)(".art-auto-playback-last",g),E=(0,n.query)(".art-auto-playback-jump",g),k=(0,n.query)(".art-auto-playback-close",g);return a.on("video:timeupdate",()=>{if(a.playing){let O=c.get("times")||{},T=Object.keys(O);T.length>f.AUTO_PLAYBACK_MAX&&delete O[T[0]],O[a.option.id||a.option.url]=a.currentTime,c.set("times",O)}}),a.on("ready",()=>{let O=(c.get("times")||{})[a.option.id||a.option.url];O&&O>=f.AUTO_PLAYBACK_MIN&&((0,n.append)(k,d.close),(0,n.setStyle)(g,"display","flex"),x.innerText=`${l.get("Last Seen")} ${(0,n.secondToTime)(O)}`,E.innerText=l.get("Jump Play"),h(k,"click",()=>{(0,n.setStyle)(g,"display","none")}),h(E,"click",()=>{a.seek=O,a.play(),(0,n.setStyle)(p,"display","none"),(0,n.setStyle)(g,"display","none")}),a.once("video:timeupdate",()=>{setTimeout(()=>{(0,n.setStyle)(g,"display","none")},f.AUTO_PLAYBACK_TIMEOUT)}))}),{name:"auto-playback",get times(){return c.get("times")||{}},clear:()=>c.del("times"),delete(O){let T=c.get("times")||{};return delete T[O],c.set("times",T),T}}}},{"../utils":"h3rH9","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],d9NUE:[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=e("../utils");function o(a){let{constructor:l,proxy:d,template:{$player:c,$video:f}}=a,h=null,p=!1,g=1,x=()=>{clearTimeout(h),p&&(p=!1,a.playbackRate=g,(0,n.removeClass)(c,"art-fast-forward"))};return d(f,"touchstart",E=>{E.touches.length===1&&a.playing&&!a.isLock&&(h=setTimeout(()=>{p=!0,g=a.playbackRate,a.playbackRate=l.FAST_FORWARD_VALUE,(0,n.addClass)(c,"art-fast-forward")},l.FAST_FORWARD_TIME))}),d(document,"touchmove",x),d(document,"touchend",x),{name:"fastForward",get state(){return(0,n.hasClass)(c,"art-fast-forward")}}}},{"../utils":"h3rH9","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}],"5dnKh":[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>o);var n=e("../utils");function o(a){let{layers:l,icons:d,template:{$player:c}}=a;function f(){return(0,n.hasClass)(c,"art-lock")}function h(){(0,n.addClass)(c,"art-lock"),a.isLock=!0,a.emit("lock",!0)}function p(){(0,n.removeClass)(c,"art-lock"),a.isLock=!1,a.emit("lock",!1)}return l.add({name:"lock",mounted(g){let x=(0,n.append)(g,d.lock),E=(0,n.append)(g,d.unlock);(0,n.setStyle)(x,"display","none"),a.on("lock",k=>{k?((0,n.setStyle)(x,"display","inline-flex"),(0,n.setStyle)(E,"display","none")):((0,n.setStyle)(x,"display","none"),(0,n.setStyle)(E,"display","inline-flex"))})},click(){f()?p():h()}}),{name:"lock",get state(){return f()},set state(g){g?h():p()}}}},{"../utils":"h3rH9","@parcel/transformer-js/src/esmodule-helpers.js":"guZOB"}]},["abjMI"],"abjMI","parcelRequireb749")})(an);var Ua=Or(an.exports);const ja={style:{transform:"scale(-1,1)"},height:"25",width:"25",viewBox:"0 0 22 22",version:"1.1",xmlns:"http://www.w3.org/2000/svg"},$a=Kt("path",{d:"M16 5a1 1 0 00-1 1v4.615a1.431 1.431 0 00-.615-.829L7.21 5.23A1.439 1.439 0 005 6.445v9.11a1.44 1.44 0 002.21 1.215l7.175-4.555a1.436 1.436 0 00.616-.828V16a1 1 0 002 0V6C17 5.448 16.552 5 16 5z"},null,-1),Ga=[$a];function Va(u,t){return hi(),fi("svg",ja,Ga)}var za={name:"custom-prev",render:Va};const Ha={height:"25",width:"25",viewBox:"0 0 22 22",version:"1.1",xmlns:"http://www.w3.org/2000/svg"},Ka=Kt("path",{d:"M16 5a1 1 0 00-1 1v4.615a1.431 1.431 0 00-.615-.829L7.21 5.23A1.439 1.439 0 005 6.445v9.11a1.44 1.44 0 002.21 1.215l7.175-4.555a1.436 1.436 0 00.616-.828V16a1 1 0 002 0V6C17 5.448 16.552 5 16 5z"},null,-1),Wa=[Ka];function Ya(u,t){return hi(),fi("svg",Ha,Wa)}var qa={name:"custom-next",render:Ya},on={exports:{}};(function(u,t){(function(e,i){u.exports=i()})(window,function(){return function(e){var i={};function r(s){if(i[s])return i[s].exports;var n=i[s]={i:s,l:!1,exports:{}};return e[s].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=i,r.d=function(s,n,o){r.o(s,n)||Object.defineProperty(s,n,{enumerable:!0,get:o})},r.r=function(s){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(s,"__esModule",{value:!0})},r.t=function(s,n){if(1&n&&(s=r(s)),8&n||4&n&&typeof s=="object"&&s&&s.__esModule)return s;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:s}),2&n&&typeof s!="string")for(var a in s)r.d(o,a,function(l){return s[l]}.bind(null,a));return o},r.n=function(s){var n=s&&s.__esModule?function(){return s.default}:function(){return s};return r.d(n,"a",n),n},r.o=function(s,n){return Object.prototype.hasOwnProperty.call(s,n)},r.p="",r(r.s=14)}([function(e,i,r){var s=r(6),n=r.n(s),o=function(){function a(){}return a.e=function(l,d){l&&!a.FORCE_GLOBAL_TAG||(l=a.GLOBAL_TAG);var c="["+l+"] > "+d;a.ENABLE_CALLBACK&&a.emitter.emit("log","error",c),a.ENABLE_ERROR&&(console.error?console.error(c):console.warn?console.warn(c):console.log(c))},a.i=function(l,d){l&&!a.FORCE_GLOBAL_TAG||(l=a.GLOBAL_TAG);var c="["+l+"] > "+d;a.ENABLE_CALLBACK&&a.emitter.emit("log","info",c),a.ENABLE_INFO&&(console.info?console.info(c):console.log(c))},a.w=function(l,d){l&&!a.FORCE_GLOBAL_TAG||(l=a.GLOBAL_TAG);var c="["+l+"] > "+d;a.ENABLE_CALLBACK&&a.emitter.emit("log","warn",c),a.ENABLE_WARN&&(console.warn?console.warn(c):console.log(c))},a.d=function(l,d){l&&!a.FORCE_GLOBAL_TAG||(l=a.GLOBAL_TAG);var c="["+l+"] > "+d;a.ENABLE_CALLBACK&&a.emitter.emit("log","debug",c),a.ENABLE_DEBUG&&(console.debug?console.debug(c):console.log(c))},a.v=function(l,d){l&&!a.FORCE_GLOBAL_TAG||(l=a.GLOBAL_TAG);var c="["+l+"] > "+d;a.ENABLE_CALLBACK&&a.emitter.emit("log","verbose",c),a.ENABLE_VERBOSE&&console.log(c)},a}();o.GLOBAL_TAG="mpegts.js",o.FORCE_GLOBAL_TAG=!1,o.ENABLE_ERROR=!0,o.ENABLE_INFO=!0,o.ENABLE_WARN=!0,o.ENABLE_DEBUG=!0,o.ENABLE_VERBOSE=!0,o.ENABLE_CALLBACK=!1,o.emitter=new n.a,i.a=o},function(e,i,r){i.a={IO_ERROR:"io_error",DEMUX_ERROR:"demux_error",INIT_SEGMENT:"init_segment",MEDIA_SEGMENT:"media_segment",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",METADATA_ARRIVED:"metadata_arrived",SCRIPTDATA_ARRIVED:"scriptdata_arrived",TIMED_ID3_METADATA_ARRIVED:"timed_id3_metadata_arrived",SMPTE2038_METADATA_ARRIVED:"smpte2038_metadata_arrived",SCTE35_METADATA_ARRIVED:"scte35_metadata_arrived",PES_PRIVATE_DATA_DESCRIPTOR:"pes_private_data_descriptor",PES_PRIVATE_DATA_ARRIVED:"pes_private_data_arrived",STATISTICS_INFO:"statistics_info",RECOMMEND_SEEKPOINT:"recommend_seekpoint"}},function(e,i,r){r.d(i,"c",function(){return n}),r.d(i,"b",function(){return o}),r.d(i,"a",function(){return a});var s=r(3),n={kIdle:0,kConnecting:1,kBuffering:2,kError:3,kComplete:4},o={OK:"OK",EXCEPTION:"Exception",HTTP_STATUS_CODE_INVALID:"HttpStatusCodeInvalid",CONNECTING_TIMEOUT:"ConnectingTimeout",EARLY_EOF:"EarlyEof",UNRECOVERABLE_EARLY_EOF:"UnrecoverableEarlyEof"},a=function(){function l(d){this._type=d||"undefined",this._status=n.kIdle,this._needStash=!1,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null}return l.prototype.destroy=function(){this._status=n.kIdle,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null},l.prototype.isWorking=function(){return this._status===n.kConnecting||this._status===n.kBuffering},Object.defineProperty(l.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"status",{get:function(){return this._status},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"needStashBuffer",{get:function(){return this._needStash},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"onContentLengthKnown",{get:function(){return this._onContentLengthKnown},set:function(d){this._onContentLengthKnown=d},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"onURLRedirect",{get:function(){return this._onURLRedirect},set:function(d){this._onURLRedirect=d},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(d){this._onDataArrival=d},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"onError",{get:function(){return this._onError},set:function(d){this._onError=d},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"onComplete",{get:function(){return this._onComplete},set:function(d){this._onComplete=d},enumerable:!1,configurable:!0}),l.prototype.open=function(d,c){throw new s.c("Unimplemented abstract function!")},l.prototype.abort=function(){throw new s.c("Unimplemented abstract function!")},l}()},function(e,i,r){r.d(i,"d",function(){return o}),r.d(i,"a",function(){return a}),r.d(i,"b",function(){return l}),r.d(i,"c",function(){return d});var s,n=(s=function(c,f){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,p){h.__proto__=p}||function(h,p){for(var g in p)p.hasOwnProperty(g)&&(h[g]=p[g])})(c,f)},function(c,f){function h(){this.constructor=c}s(c,f),c.prototype=f===null?Object.create(f):(h.prototype=f.prototype,new h)}),o=function(){function c(f){this._message=f}return Object.defineProperty(c.prototype,"name",{get:function(){return"RuntimeException"},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"message",{get:function(){return this._message},enumerable:!1,configurable:!0}),c.prototype.toString=function(){return this.name+": "+this.message},c}(),a=function(c){function f(h){return c.call(this,h)||this}return n(f,c),Object.defineProperty(f.prototype,"name",{get:function(){return"IllegalStateException"},enumerable:!1,configurable:!0}),f}(o),l=function(c){function f(h){return c.call(this,h)||this}return n(f,c),Object.defineProperty(f.prototype,"name",{get:function(){return"InvalidArgumentException"},enumerable:!1,configurable:!0}),f}(o),d=function(c){function f(h){return c.call(this,h)||this}return n(f,c),Object.defineProperty(f.prototype,"name",{get:function(){return"NotImplementedException"},enumerable:!1,configurable:!0}),f}(o)},function(e,i,r){var s={};(function(){var n=self.navigator.userAgent.toLowerCase(),o=/(edge)\/([\w.]+)/.exec(n)||/(opr)[\/]([\w.]+)/.exec(n)||/(chrome)[ \/]([\w.]+)/.exec(n)||/(iemobile)[\/]([\w.]+)/.exec(n)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(n)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(n)||/(webkit)[ \/]([\w.]+)/.exec(n)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(n)||/(msie) ([\w.]+)/.exec(n)||n.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(n)||n.indexOf("compatible")<0&&/(firefox)[ \/]([\w.]+)/.exec(n)||[],a=/(ipad)/.exec(n)||/(ipod)/.exec(n)||/(windows phone)/.exec(n)||/(iphone)/.exec(n)||/(kindle)/.exec(n)||/(android)/.exec(n)||/(windows)/.exec(n)||/(mac)/.exec(n)||/(linux)/.exec(n)||/(cros)/.exec(n)||[],l={browser:o[5]||o[3]||o[1]||"",version:o[2]||o[4]||"0",majorVersion:o[4]||o[2]||"0",platform:a[0]||""},d={};if(l.browser){d[l.browser]=!0;var c=l.majorVersion.split(".");d.version={major:parseInt(l.majorVersion,10),string:l.version},c.length>1&&(d.version.minor=parseInt(c[1],10)),c.length>2&&(d.version.build=parseInt(c[2],10))}l.platform&&(d[l.platform]=!0),(d.chrome||d.opr||d.safari)&&(d.webkit=!0),(d.rv||d.iemobile)&&(d.rv&&delete d.rv,l.browser="msie",d.msie=!0),d.edge&&(delete d.edge,l.browser="msedge",d.msedge=!0),d.opr&&(l.browser="opera",d.opera=!0),d.safari&&d.android&&(l.browser="android",d.android=!0);for(var f in d.name=l.browser,d.platform=l.platform,s)s.hasOwnProperty(f)&&delete s[f];Object.assign(s,d)})(),i.a=s},function(e,i,r){i.a={OK:"OK",FORMAT_ERROR:"FormatError",FORMAT_UNSUPPORTED:"FormatUnsupported",CODEC_UNSUPPORTED:"CodecUnsupported"}},function(e,i,r){var s,n=typeof Reflect=="object"?Reflect:null,o=n&&typeof n.apply=="function"?n.apply:function(T,R,C){return Function.prototype.apply.call(T,R,C)};s=n&&typeof n.ownKeys=="function"?n.ownKeys:Object.getOwnPropertySymbols?function(T){return Object.getOwnPropertyNames(T).concat(Object.getOwnPropertySymbols(T))}:function(T){return Object.getOwnPropertyNames(T)};var a=Number.isNaN||function(T){return T!=T};function l(){l.init.call(this)}e.exports=l,e.exports.once=function(T,R){return new Promise(function(C,b){function A(I){T.removeListener(R,L),b(I)}function L(){typeof T.removeListener=="function"&&T.removeListener("error",A),C([].slice.call(arguments))}O(T,R,L,{once:!0}),R!=="error"&&function(I,j,F){typeof I.on=="function"&&O(I,"error",j,F)}(T,A,{once:!0})})},l.EventEmitter=l,l.prototype._events=void 0,l.prototype._eventsCount=0,l.prototype._maxListeners=void 0;var d=10;function c(T){if(typeof T!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof T)}function f(T){return T._maxListeners===void 0?l.defaultMaxListeners:T._maxListeners}function h(T,R,C,b){var A,L,I,j;if(c(C),(L=T._events)===void 0?(L=T._events=Object.create(null),T._eventsCount=0):(L.newListener!==void 0&&(T.emit("newListener",R,C.listener?C.listener:C),L=T._events),I=L[R]),I===void 0)I=L[R]=C,++T._eventsCount;else if(typeof I=="function"?I=L[R]=b?[C,I]:[I,C]:b?I.unshift(C):I.push(C),(A=f(T))>0&&I.length>A&&!I.warned){I.warned=!0;var F=new Error("Possible EventEmitter memory leak detected. "+I.length+" "+String(R)+" listeners added. Use emitter.setMaxListeners() to increase limit");F.name="MaxListenersExceededWarning",F.emitter=T,F.type=R,F.count=I.length,j=F,console&&console.warn&&console.warn(j)}return T}function p(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function g(T,R,C){var b={fired:!1,wrapFn:void 0,target:T,type:R,listener:C},A=p.bind(b);return A.listener=C,b.wrapFn=A,A}function x(T,R,C){var b=T._events;if(b===void 0)return[];var A=b[R];return A===void 0?[]:typeof A=="function"?C?[A.listener||A]:[A]:C?function(L){for(var I=new Array(L.length),j=0;j<I.length;++j)I[j]=L[j].listener||L[j];return I}(A):k(A,A.length)}function E(T){var R=this._events;if(R!==void 0){var C=R[T];if(typeof C=="function")return 1;if(C!==void 0)return C.length}return 0}function k(T,R){for(var C=new Array(R),b=0;b<R;++b)C[b]=T[b];return C}function O(T,R,C,b){if(typeof T.on=="function")b.once?T.once(R,C):T.on(R,C);else{if(typeof T.addEventListener!="function")throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof T);T.addEventListener(R,function A(L){b.once&&T.removeEventListener(R,A),C(L)})}}Object.defineProperty(l,"defaultMaxListeners",{enumerable:!0,get:function(){return d},set:function(T){if(typeof T!="number"||T<0||a(T))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+T+".");d=T}}),l.init=function(){this._events!==void 0&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},l.prototype.setMaxListeners=function(T){if(typeof T!="number"||T<0||a(T))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+T+".");return this._maxListeners=T,this},l.prototype.getMaxListeners=function(){return f(this)},l.prototype.emit=function(T){for(var R=[],C=1;C<arguments.length;C++)R.push(arguments[C]);var b=T==="error",A=this._events;if(A!==void 0)b=b&&A.error===void 0;else if(!b)return!1;if(b){var L;if(R.length>0&&(L=R[0]),L instanceof Error)throw L;var I=new Error("Unhandled error."+(L?" ("+L.message+")":""));throw I.context=L,I}var j=A[T];if(j===void 0)return!1;if(typeof j=="function")o(j,this,R);else{var F=j.length,$=k(j,F);for(C=0;C<F;++C)o($[C],this,R)}return!0},l.prototype.addListener=function(T,R){return h(this,T,R,!1)},l.prototype.on=l.prototype.addListener,l.prototype.prependListener=function(T,R){return h(this,T,R,!0)},l.prototype.once=function(T,R){return c(R),this.on(T,g(this,T,R)),this},l.prototype.prependOnceListener=function(T,R){return c(R),this.prependListener(T,g(this,T,R)),this},l.prototype.removeListener=function(T,R){var C,b,A,L,I;if(c(R),(b=this._events)===void 0)return this;if((C=b[T])===void 0)return this;if(C===R||C.listener===R)--this._eventsCount==0?this._events=Object.create(null):(delete b[T],b.removeListener&&this.emit("removeListener",T,C.listener||R));else if(typeof C!="function"){for(A=-1,L=C.length-1;L>=0;L--)if(C[L]===R||C[L].listener===R){I=C[L].listener,A=L;break}if(A<0)return this;A===0?C.shift():function(j,F){for(;F+1<j.length;F++)j[F]=j[F+1];j.pop()}(C,A),C.length===1&&(b[T]=C[0]),b.removeListener!==void 0&&this.emit("removeListener",T,I||R)}return this},l.prototype.off=l.prototype.removeListener,l.prototype.removeAllListeners=function(T){var R,C,b;if((C=this._events)===void 0)return this;if(C.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):C[T]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete C[T]),this;if(arguments.length===0){var A,L=Object.keys(C);for(b=0;b<L.length;++b)(A=L[b])!=="removeListener"&&this.removeAllListeners(A);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(typeof(R=C[T])=="function")this.removeListener(T,R);else if(R!==void 0)for(b=R.length-1;b>=0;b--)this.removeListener(T,R[b]);return this},l.prototype.listeners=function(T){return x(this,T,!0)},l.prototype.rawListeners=function(T){return x(this,T,!1)},l.listenerCount=function(T,R){return typeof T.listenerCount=="function"?T.listenerCount(R):E.call(T,R)},l.prototype.listenerCount=E,l.prototype.eventNames=function(){return this._eventsCount>0?s(this._events):[]}},function(e,i,r){r.d(i,"d",function(){return s}),r.d(i,"b",function(){return n}),r.d(i,"a",function(){return o}),r.d(i,"c",function(){return a});var s=function(l,d,c,f,h){this.dts=l,this.pts=d,this.duration=c,this.originalDts=f,this.isSyncPoint=h,this.fileposition=null},n=function(){function l(){this.beginDts=0,this.endDts=0,this.beginPts=0,this.endPts=0,this.originalBeginDts=0,this.originalEndDts=0,this.syncPoints=[],this.firstSample=null,this.lastSample=null}return l.prototype.appendSyncPoint=function(d){d.isSyncPoint=!0,this.syncPoints.push(d)},l}(),o=function(){function l(){this._list=[]}return l.prototype.clear=function(){this._list=[]},l.prototype.appendArray=function(d){var c=this._list;d.length!==0&&(c.length>0&&d[0].originalDts<c[c.length-1].originalDts&&this.clear(),Array.prototype.push.apply(c,d))},l.prototype.getLastSyncPointBeforeDts=function(d){if(this._list.length==0)return null;var c=this._list,f=0,h=c.length-1,p=0,g=0,x=h;for(d<c[0].dts&&(f=0,g=x+1);g<=x;){if((p=g+Math.floor((x-g)/2))===h||d>=c[p].dts&&d<c[p+1].dts){f=p;break}c[p].dts<d?g=p+1:x=p-1}return this._list[f]},l}(),a=function(){function l(d){this._type=d,this._list=[],this._lastAppendLocation=-1}return Object.defineProperty(l.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"length",{get:function(){return this._list.length},enumerable:!1,configurable:!0}),l.prototype.isEmpty=function(){return this._list.length===0},l.prototype.clear=function(){this._list=[],this._lastAppendLocation=-1},l.prototype._searchNearestSegmentBefore=function(d){var c=this._list;if(c.length===0)return-2;var f=c.length-1,h=0,p=0,g=f,x=0;if(d<c[0].originalBeginDts)return x=-1;for(;p<=g;){if((h=p+Math.floor((g-p)/2))===f||d>c[h].lastSample.originalDts&&d<c[h+1].originalBeginDts){x=h;break}c[h].originalBeginDts<d?p=h+1:g=h-1}return x},l.prototype._searchNearestSegmentAfter=function(d){return this._searchNearestSegmentBefore(d)+1},l.prototype.append=function(d){var c=this._list,f=d,h=this._lastAppendLocation,p=0;h!==-1&&h<c.length&&f.originalBeginDts>=c[h].lastSample.originalDts&&(h===c.length-1||h<c.length-1&&f.originalBeginDts<c[h+1].originalBeginDts)?p=h+1:c.length>0&&(p=this._searchNearestSegmentBefore(f.originalBeginDts)+1),this._lastAppendLocation=p,this._list.splice(p,0,f)},l.prototype.getLastSegmentBefore=function(d){var c=this._searchNearestSegmentBefore(d);return c>=0?this._list[c]:null},l.prototype.getLastSampleBefore=function(d){var c=this.getLastSegmentBefore(d);return c!=null?c.lastSample:null},l.prototype.getLastSyncPointBefore=function(d){for(var c=this._searchNearestSegmentBefore(d),f=this._list[c].syncPoints;f.length===0&&c>0;)c--,f=this._list[c].syncPoints;return f.length>0?f[f.length-1]:null},l}()},function(e,i,r){var s=function(){function n(){this.mimeType=null,this.duration=null,this.hasAudio=null,this.hasVideo=null,this.audioCodec=null,this.videoCodec=null,this.audioDataRate=null,this.videoDataRate=null,this.audioSampleRate=null,this.audioChannelCount=null,this.width=null,this.height=null,this.fps=null,this.profile=null,this.level=null,this.refFrames=null,this.chromaFormat=null,this.sarNum=null,this.sarDen=null,this.metadata=null,this.segments=null,this.segmentCount=null,this.hasKeyframesIndex=null,this.keyframesIndex=null}return n.prototype.isComplete=function(){var o=this.hasAudio===!1||this.hasAudio===!0&&this.audioCodec!=null&&this.audioSampleRate!=null&&this.audioChannelCount!=null,a=this.hasVideo===!1||this.hasVideo===!0&&this.videoCodec!=null&&this.width!=null&&this.height!=null&&this.fps!=null&&this.profile!=null&&this.level!=null&&this.refFrames!=null&&this.chromaFormat!=null&&this.sarNum!=null&&this.sarDen!=null;return this.mimeType!=null&&o&&a},n.prototype.isSeekable=function(){return this.hasKeyframesIndex===!0},n.prototype.getNearestKeyframe=function(o){if(this.keyframesIndex==null)return null;var a=this.keyframesIndex,l=this._search(a.times,o);return{index:l,milliseconds:a.times[l],fileposition:a.filepositions[l]}},n.prototype._search=function(o,a){var l=0,d=o.length-1,c=0,f=0,h=d;for(a<o[0]&&(l=0,f=h+1);f<=h;){if((c=f+Math.floor((h-f)/2))===d||a>=o[c]&&a<o[c+1]){l=c;break}o[c]<a?f=c+1:h=c-1}return l},n}();i.a=s},function(e,i,r){var s=r(6),n=r.n(s),o=r(0),a=function(){function l(){}return Object.defineProperty(l,"forceGlobalTag",{get:function(){return o.a.FORCE_GLOBAL_TAG},set:function(d){o.a.FORCE_GLOBAL_TAG=d,l._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(l,"globalTag",{get:function(){return o.a.GLOBAL_TAG},set:function(d){o.a.GLOBAL_TAG=d,l._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(l,"enableAll",{get:function(){return o.a.ENABLE_VERBOSE&&o.a.ENABLE_DEBUG&&o.a.ENABLE_INFO&&o.a.ENABLE_WARN&&o.a.ENABLE_ERROR},set:function(d){o.a.ENABLE_VERBOSE=d,o.a.ENABLE_DEBUG=d,o.a.ENABLE_INFO=d,o.a.ENABLE_WARN=d,o.a.ENABLE_ERROR=d,l._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(l,"enableDebug",{get:function(){return o.a.ENABLE_DEBUG},set:function(d){o.a.ENABLE_DEBUG=d,l._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(l,"enableVerbose",{get:function(){return o.a.ENABLE_VERBOSE},set:function(d){o.a.ENABLE_VERBOSE=d,l._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(l,"enableInfo",{get:function(){return o.a.ENABLE_INFO},set:function(d){o.a.ENABLE_INFO=d,l._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(l,"enableWarn",{get:function(){return o.a.ENABLE_WARN},set:function(d){o.a.ENABLE_WARN=d,l._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(l,"enableError",{get:function(){return o.a.ENABLE_ERROR},set:function(d){o.a.ENABLE_ERROR=d,l._notifyChange()},enumerable:!1,configurable:!0}),l.getConfig=function(){return{globalTag:o.a.GLOBAL_TAG,forceGlobalTag:o.a.FORCE_GLOBAL_TAG,enableVerbose:o.a.ENABLE_VERBOSE,enableDebug:o.a.ENABLE_DEBUG,enableInfo:o.a.ENABLE_INFO,enableWarn:o.a.ENABLE_WARN,enableError:o.a.ENABLE_ERROR,enableCallback:o.a.ENABLE_CALLBACK}},l.applyConfig=function(d){o.a.GLOBAL_TAG=d.globalTag,o.a.FORCE_GLOBAL_TAG=d.forceGlobalTag,o.a.ENABLE_VERBOSE=d.enableVerbose,o.a.ENABLE_DEBUG=d.enableDebug,o.a.ENABLE_INFO=d.enableInfo,o.a.ENABLE_WARN=d.enableWarn,o.a.ENABLE_ERROR=d.enableError,o.a.ENABLE_CALLBACK=d.enableCallback},l._notifyChange=function(){var d=l.emitter;if(d.listenerCount("change")>0){var c=l.getConfig();d.emit("change",c)}},l.registerListener=function(d){l.emitter.addListener("change",d)},l.removeListener=function(d){l.emitter.removeListener("change",d)},l.addLogListener=function(d){o.a.emitter.addListener("log",d),o.a.emitter.listenerCount("log")>0&&(o.a.ENABLE_CALLBACK=!0,l._notifyChange())},l.removeLogListener=function(d){o.a.emitter.removeListener("log",d),o.a.emitter.listenerCount("log")===0&&(o.a.ENABLE_CALLBACK=!1,l._notifyChange())},l}();a.emitter=new n.a,i.a=a},function(e,i,r){var s=r(6),n=r.n(s),o=r(0),a=r(4),l=r(8);function d(_,y,v){var m=_;if(y+v<m.length){for(;v--;)if((192&m[++y])!=128)return!1;return!0}return!1}var c,f=function(_){for(var y=[],v=_,m=0,S=_.length;m<S;)if(v[m]<128)y.push(String.fromCharCode(v[m])),++m;else{if(!(v[m]<192)){if(v[m]<224){if(d(v,m,1)&&(N=(31&v[m])<<6|63&v[m+1])>=128){y.push(String.fromCharCode(65535&N)),m+=2;continue}}else if(v[m]<240){if(d(v,m,2)&&(N=(15&v[m])<<12|(63&v[m+1])<<6|63&v[m+2])>=2048&&(63488&N)!=55296){y.push(String.fromCharCode(65535&N)),m+=3;continue}}else if(v[m]<248){var N;if(d(v,m,3)&&(N=(7&v[m])<<18|(63&v[m+1])<<12|(63&v[m+2])<<6|63&v[m+3])>65536&&N<1114112){N-=65536,y.push(String.fromCharCode(N>>>10|55296)),y.push(String.fromCharCode(1023&N|56320)),m+=4;continue}}}y.push(String.fromCharCode(65533)),++m}return y.join("")},h=r(3),p=(c=new ArrayBuffer(2),new DataView(c).setInt16(0,256,!0),new Int16Array(c)[0]===256),g=function(){function _(){}return _.parseScriptData=function(y,v,m){var S={};try{var N=_.parseValue(y,v,m),M=_.parseValue(y,v+N.size,m-N.size);S[N.data]=M.data}catch(U){o.a.e("AMF",U.toString())}return S},_.parseObject=function(y,v,m){if(m<3)throw new h.a("Data not enough when parse ScriptDataObject");var S=_.parseString(y,v,m),N=_.parseValue(y,v+S.size,m-S.size),M=N.objectEnd;return{data:{name:S.data,value:N.data},size:S.size+N.size,objectEnd:M}},_.parseVariable=function(y,v,m){return _.parseObject(y,v,m)},_.parseString=function(y,v,m){if(m<2)throw new h.a("Data not enough when parse String");var S=new DataView(y,v,m).getUint16(0,!p);return{data:S>0?f(new Uint8Array(y,v+2,S)):"",size:2+S}},_.parseLongString=function(y,v,m){if(m<4)throw new h.a("Data not enough when parse LongString");var S=new DataView(y,v,m).getUint32(0,!p);return{data:S>0?f(new Uint8Array(y,v+4,S)):"",size:4+S}},_.parseDate=function(y,v,m){if(m<10)throw new h.a("Data size invalid when parse Date");var S=new DataView(y,v,m),N=S.getFloat64(0,!p),M=S.getInt16(8,!p);return{data:new Date(N+=60*M*1e3),size:10}},_.parseValue=function(y,v,m){if(m<1)throw new h.a("Data not enough when parse Value");var S,N=new DataView(y,v,m),M=1,U=N.getUint8(0),W=!1;try{switch(U){case 0:S=N.getFloat64(1,!p),M+=8;break;case 1:S=!!N.getUint8(1),M+=1;break;case 2:var K=_.parseString(y,v+1,m-1);S=K.data,M+=K.size;break;case 3:S={};var q=0;for((16777215&N.getUint32(m-4,!p))==9&&(q=3);M<m-4;){var J=_.parseObject(y,v+M,m-M-q);if(J.objectEnd)break;S[J.data.name]=J.data.value,M+=J.size}M<=m-3&&(16777215&N.getUint32(M-1,!p))===9&&(M+=3);break;case 8:for(S={},M+=4,q=0,(16777215&N.getUint32(m-4,!p))==9&&(q=3);M<m-8;){var Y=_.parseVariable(y,v+M,m-M-q);if(Y.objectEnd)break;S[Y.data.name]=Y.data.value,M+=Y.size}M<=m-3&&(16777215&N.getUint32(M-1,!p))===9&&(M+=3);break;case 9:S=void 0,M=1,W=!0;break;case 10:S=[];var X=N.getUint32(1,!p);M+=4;for(var st=0;st<X;st++){var ht=_.parseValue(y,v+M,m-M);S.push(ht.data),M+=ht.size}break;case 11:var ot=_.parseDate(y,v+1,m-1);S=ot.data,M+=ot.size;break;case 12:var gt=_.parseString(y,v+1,m-1);S=gt.data,M+=gt.size;break;default:M=m,o.a.w("AMF","Unsupported AMF value type "+U)}}catch(yt){o.a.e("AMF",yt.toString())}return{data:S,size:M,objectEnd:W}},_}(),x=function(){function _(y){this.TAG="ExpGolomb",this._buffer=y,this._buffer_index=0,this._total_bytes=y.byteLength,this._total_bits=8*y.byteLength,this._current_word=0,this._current_word_bits_left=0}return _.prototype.destroy=function(){this._buffer=null},_.prototype._fillCurrentWord=function(){var y=this._total_bytes-this._buffer_index;if(y<=0)throw new h.a("ExpGolomb: _fillCurrentWord() but no bytes available");var v=Math.min(4,y),m=new Uint8Array(4);m.set(this._buffer.subarray(this._buffer_index,this._buffer_index+v)),this._current_word=new DataView(m.buffer).getUint32(0,!1),this._buffer_index+=v,this._current_word_bits_left=8*v},_.prototype.readBits=function(y){if(y>32)throw new h.b("ExpGolomb: readBits() bits exceeded max 32bits!");if(y<=this._current_word_bits_left){var v=this._current_word>>>32-y;return this._current_word<<=y,this._current_word_bits_left-=y,v}var m=this._current_word_bits_left?this._current_word:0;m>>>=32-this._current_word_bits_left;var S=y-this._current_word_bits_left;this._fillCurrentWord();var N=Math.min(S,this._current_word_bits_left),M=this._current_word>>>32-N;return this._current_word<<=N,this._current_word_bits_left-=N,m=m<<N|M},_.prototype.readBool=function(){return this.readBits(1)===1},_.prototype.readByte=function(){return this.readBits(8)},_.prototype._skipLeadingZero=function(){var y;for(y=0;y<this._current_word_bits_left;y++)if((this._current_word&2147483648>>>y)!=0)return this._current_word<<=y,this._current_word_bits_left-=y,y;return this._fillCurrentWord(),y+this._skipLeadingZero()},_.prototype.readUEG=function(){var y=this._skipLeadingZero();return this.readBits(y+1)-1},_.prototype.readSEG=function(){var y=this.readUEG();return 1&y?y+1>>>1:-1*(y>>>1)},_}(),E=function(){function _(){}return _._ebsp2rbsp=function(y){for(var v=y,m=v.byteLength,S=new Uint8Array(m),N=0,M=0;M<m;M++)M>=2&&v[M]===3&&v[M-1]===0&&v[M-2]===0||(S[N]=v[M],N++);return new Uint8Array(S.buffer,0,N)},_.parseSPS=function(y){for(var v=y.subarray(1,4),m="avc1.",S=0;S<3;S++){var N=v[S].toString(16);N.length<2&&(N="0"+N),m+=N}var M=_._ebsp2rbsp(y),U=new x(M);U.readByte();var W=U.readByte();U.readByte();var K=U.readByte();U.readUEG();var q=_.getProfileString(W),J=_.getLevelString(K),Y=1,X=420,st=8,ht=8;if((W===100||W===110||W===122||W===244||W===44||W===83||W===86||W===118||W===128||W===138||W===144)&&((Y=U.readUEG())===3&&U.readBits(1),Y<=3&&(X=[0,420,422,444][Y]),st=U.readUEG()+8,ht=U.readUEG()+8,U.readBits(1),U.readBool()))for(var ot=Y!==3?8:12,gt=0;gt<ot;gt++)U.readBool()&&(gt<6?_._skipScalingList(U,16):_._skipScalingList(U,64));U.readUEG();var yt=U.readUEG();if(yt===0)U.readUEG();else if(yt===1){U.readBits(1),U.readSEG(),U.readSEG();var ft=U.readUEG();for(gt=0;gt<ft;gt++)U.readSEG()}var Rt=U.readUEG();U.readBits(1);var pt=U.readUEG(),ut=U.readUEG(),St=U.readBits(1);St===0&&U.readBits(1),U.readBits(1);var Ct=0,qt=0,Dt=0,Ft=0;U.readBool()&&(Ct=U.readUEG(),qt=U.readUEG(),Dt=U.readUEG(),Ft=U.readUEG());var Ut=1,wt=1,Ot=0,Zt=!0,ne=0,je=0;if(U.readBool()){if(U.readBool()){var ve=U.readByte();ve>0&&ve<16?(Ut=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][ve-1],wt=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][ve-1]):ve===255&&(Ut=U.readByte()<<8|U.readByte(),wt=U.readByte()<<8|U.readByte())}if(U.readBool()&&U.readBool(),U.readBool()&&(U.readBits(4),U.readBool()&&U.readBits(24)),U.readBool()&&(U.readUEG(),U.readUEG()),U.readBool()){var Vt=U.readBits(32),ei=U.readBits(32);Zt=U.readBool(),Ot=(ne=ei)/(je=2*Vt)}}var $e=1;Ut===1&&wt===1||($e=Ut/wt);var oe=0,ee=0;Y===0?(oe=1,ee=2-St):(oe=Y===3?1:2,ee=(Y===1?2:1)*(2-St));var Ge=16*(pt+1),Me=16*(ut+1)*(2-St);Ge-=(Ct+qt)*oe,Me-=(Dt+Ft)*ee;var qe=Math.ceil(Ge*$e);return U.destroy(),U=null,{codec_mimetype:m,profile_idc:W,level_idc:K,profile_string:q,level_string:J,chroma_format_idc:Y,bit_depth:st,bit_depth_luma:st,bit_depth_chroma:ht,ref_frames:Rt,chroma_format:X,chroma_format_string:_.getChromaFormatString(X),frame_rate:{fixed:Zt,fps:Ot,fps_den:je,fps_num:ne},sar_ratio:{width:Ut,height:wt},codec_size:{width:Ge,height:Me},present_size:{width:qe,height:Me}}},_._skipScalingList=function(y,v){for(var m=8,S=8,N=0;N<v;N++)S!==0&&(S=(m+y.readSEG()+256)%256),m=S===0?m:S},_.getProfileString=function(y){switch(y){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}},_.getLevelString=function(y){return(y/10).toFixed(1)},_.getChromaFormatString=function(y){switch(y){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}},_}(),k=r(5),O=function(){function _(){}return _._ebsp2rbsp=function(y){for(var v=y,m=v.byteLength,S=new Uint8Array(m),N=0,M=0;M<m;M++)M>=2&&v[M]===3&&v[M-1]===0&&v[M-2]===0||(S[N]=v[M],N++);return new Uint8Array(S.buffer,0,N)},_.parseVPS=function(y){var v=_._ebsp2rbsp(y),m=new x(v);return m.readByte(),m.readByte(),m.readBits(4),m.readBits(2),m.readBits(6),{num_temporal_layers:m.readBits(3)+1,temporal_id_nested:m.readBool()}},_.parseSPS=function(y){var v=_._ebsp2rbsp(y),m=new x(v);m.readByte(),m.readByte(),m.readBits(4);for(var S=m.readBits(3),N=(m.readBool(),m.readBits(2)),M=m.readBool(),U=m.readBits(5),W=m.readByte(),K=m.readByte(),q=m.readByte(),J=m.readByte(),Y=m.readByte(),X=m.readByte(),st=m.readByte(),ht=m.readByte(),ot=m.readByte(),gt=m.readByte(),yt=m.readByte(),ft=[],Rt=[],pt=0;pt<S;pt++)ft.push(m.readBool()),Rt.push(m.readBool());if(S>0)for(pt=S;pt<8;pt++)m.readBits(2);for(pt=0;pt<S;pt++)ft[pt]&&(m.readByte(),m.readByte(),m.readByte(),m.readByte(),m.readByte(),m.readByte(),m.readByte(),m.readByte(),m.readByte(),m.readByte(),m.readByte()),Rt[pt]&&m.readByte();m.readUEG();var ut=m.readUEG();ut==3&&m.readBits(1);var St=m.readUEG(),Ct=m.readUEG();m.readBool()&&(m.readUEG(),m.readUEG(),m.readUEG(),m.readUEG());var qt=m.readUEG(),Dt=m.readUEG(),Ft=m.readUEG();for(pt=m.readBool()?0:S;pt<=S;pt++)m.readUEG(),m.readUEG(),m.readUEG();if(m.readUEG(),m.readUEG(),m.readUEG(),m.readUEG(),m.readUEG(),m.readUEG(),m.readBool()&&m.readBool())for(var Ut=0;Ut<4;Ut++)for(var wt=0;wt<(Ut===3?2:6);wt++)if(m.readBool()){var Ot=Math.min(64,1<<4+(Ut<<1));for(Ut>1&&m.readSEG(),pt=0;pt<Ot;pt++)m.readSEG()}else m.readUEG();m.readBool(),m.readBool(),m.readBool()&&(m.readByte(),m.readUEG(),m.readUEG(),m.readBool());var Zt=m.readUEG(),ne=0;for(pt=0;pt<Zt;pt++){var je=!1;if(pt!==0&&(je=m.readBool()),je){pt===Zt&&m.readUEG(),m.readBool(),m.readUEG();for(var ve=0,Vt=0;Vt<=ne;Vt++){var ei=m.readBool(),$e=!1;ei||($e=m.readBool()),(ei||$e)&&ve++}ne=ve}else{var oe=m.readUEG(),ee=m.readUEG();for(ne=oe+ee,Vt=0;Vt<oe;Vt++)m.readUEG(),m.readBool();for(Vt=0;Vt<ee;Vt++)m.readUEG(),m.readBool()}}if(m.readBool()){var Ge=m.readUEG();for(pt=0;pt<Ge;pt++){for(Vt=0;Vt<Ft+4;Vt++)m.readBits(1);m.readBits(1)}}var Me=0,qe=1,di=1,Qr=!1,qi=1,Zi=1;if(m.readBool(),m.readBool(),m.readBool()){if(m.readBool()){var ci=m.readByte();ci>0&&ci<16?(qe=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][ci-1],di=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][ci-1]):ci===255&&(qe=m.readBits(16),di=m.readBits(16))}if(m.readBool()&&m.readBool(),m.readBool()&&(m.readBits(3),m.readBool(),m.readBool()&&(m.readByte(),m.readByte(),m.readByte())),m.readBool()&&(m.readUEG(),m.readUEG()),m.readBool(),m.readBool(),m.readBool(),m.readBool()&&(m.readUEG(),m.readUEG(),m.readUEG(),m.readUEG()),m.readBool()&&(qi=m.readBits(32),Zi=m.readBits(32),m.readBool()&&(m.readUEG(),m.readBool()))){var Xi=!1,Qi=!1,bi=!1;for(Xi=m.readBool(),Qi=m.readBool(),(Xi||Qi)&&((bi=m.readBool())&&(m.readByte(),m.readBits(5),m.readBool(),m.readBits(5)),m.readBits(4),m.readBits(4),bi&&m.readBits(4),m.readBits(5),m.readBits(5),m.readBits(5)),pt=0;pt<=S;pt++){var Jr=m.readBool();Qr=Jr;var ts=!1,Ji=1;Jr||(ts=m.readBool());var es=!1;if(ts?m.readSEG():es=m.readBool(),es||(Ji=m.readUEG()+1),Xi)for(Vt=0;Vt<Ji;Vt++)m.readUEG(),m.readUEG(),bi&&(m.readUEG(),m.readUEG());if(Qi)for(Vt=0;Vt<Ji;Vt++)m.readUEG(),m.readUEG(),bi&&(m.readUEG(),m.readUEG())}}m.readBool()&&(m.readBool(),m.readBool(),m.readBool(),Me=m.readUEG(),m.readUEG(),m.readUEG(),m.readUEG(),m.readUEG())}m.readBool();var da="hvc1."+U+".1.L"+yt+".B0",is=St,rs=Ct,ss=1;return qe!==1&&di!==1&&(ss=qe/di),m.destroy(),m=null,{codec_mimetype:da,level_string:_.getLevelString(yt),profile_idc:U,bit_depth:qt+8,ref_frames:1,chroma_format:ut,chroma_format_string:_.getChromaFormatString(ut),general_level_idc:yt,general_profile_space:N,general_tier_flag:M,general_profile_idc:U,general_profile_compatibility_flags_1:W,general_profile_compatibility_flags_2:K,general_profile_compatibility_flags_3:q,general_profile_compatibility_flags_4:J,general_constraint_indicator_flags_1:Y,general_constraint_indicator_flags_2:X,general_constraint_indicator_flags_3:st,general_constraint_indicator_flags_4:ht,general_constraint_indicator_flags_5:ot,general_constraint_indicator_flags_6:gt,min_spatial_segmentation_idc:Me,constant_frame_rate:0,chroma_format_idc:ut,bit_depth_luma_minus8:qt,bit_depth_chroma_minus8:Dt,frame_rate:{fixed:Qr,fps:Zi/qi,fps_den:qi,fps_num:Zi},sar_ratio:{width:qe,height:di},codec_size:{width:is,height:rs},present_size:{width:is*ss,height:rs}}},_.parsePPS=function(y){var v=_._ebsp2rbsp(y),m=new x(v);m.readByte(),m.readByte(),m.readUEG(),m.readUEG(),m.readBool(),m.readBool(),m.readBits(3),m.readBool(),m.readBool(),m.readUEG(),m.readUEG(),m.readSEG(),m.readBool(),m.readBool(),m.readBool()&&m.readUEG(),m.readSEG(),m.readSEG(),m.readBool(),m.readBool(),m.readBool(),m.readBool();var S=m.readBool(),N=m.readBool(),M=1;return N&&S?M=0:N?M=3:S&&(M=2),{parallelismType:M}},_.getChromaFormatString=function(y){switch(y){case 0:return"4:0:0";case 1:return"4:2:0";case 2:return"4:2:2";case 3:return"4:4:4";default:return"Unknown"}},_.getProfileString=function(y){switch(y){case 1:return"Main";case 2:return"Main10";case 3:return"MainSP";case 4:return"Rext";case 9:return"SCC";default:return"Unknown"}},_.getLevelString=function(y){return(y/30).toFixed(1)},_}();function T(_){return _.byteOffset%2==0&&_.byteLength%2==0}function R(_){return _.byteOffset%4==0&&_.byteLength%4==0}function C(_,y){for(var v=0;v<_.length;v++)if(_[v]!==y[v])return!1;return!0}var b=function(_,y){return _.byteLength===y.byteLength&&(R(_)&&R(y)?function(v,m){return C(new Uint32Array(v.buffer,v.byteOffset,v.byteLength/4),new Uint32Array(m.buffer,m.byteOffset,m.byteLength/4))}(_,y):T(_)&&T(y)?function(v,m){return C(new Uint16Array(v.buffer,v.byteOffset,v.byteLength/2),new Uint16Array(m.buffer,m.byteOffset,m.byteLength/2))}(_,y):function(v,m){return C(v,m)}(_,y))},A,L=function(){function _(y,v){this.TAG="FLVDemuxer",this._config=v,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null,this._dataOffset=y.dataOffset,this._firstParse=!0,this._dispatch=!1,this._hasAudio=y.hasAudioTrack,this._hasVideo=y.hasVideoTrack,this._hasAudioFlagOverrided=!1,this._hasVideoFlagOverrided=!1,this._audioInitialMetadataDispatched=!1,this._videoInitialMetadataDispatched=!1,this._mediaInfo=new l.a,this._mediaInfo.hasAudio=this._hasAudio,this._mediaInfo.hasVideo=this._hasVideo,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._naluLengthSize=4,this._timestampBase=0,this._timescale=1e3,this._duration=0,this._durationOverrided=!1,this._referenceFrameRate={fixed:!0,fps:23.976,fps_num:23976,fps_den:1e3},this._flvSoundRateTable=[5500,11025,22050,44100,48e3],this._mpegSamplingRates=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],this._mpegAudioV10SampleRateTable=[44100,48e3,32e3,0],this._mpegAudioV20SampleRateTable=[22050,24e3,16e3,0],this._mpegAudioV25SampleRateTable=[11025,12e3,8e3,0],this._mpegAudioL1BitRateTable=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],this._mpegAudioL2BitRateTable=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],this._mpegAudioL3BitRateTable=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],this._videoTrack={type:"video",id:1,sequenceNumber:0,samples:[],length:0},this._audioTrack={type:"audio",id:2,sequenceNumber:0,samples:[],length:0},this._littleEndian=function(){var m=new ArrayBuffer(2);return new DataView(m).setInt16(0,256,!0),new Int16Array(m)[0]===256}()}return _.prototype.destroy=function(){this._mediaInfo=null,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._videoTrack=null,this._audioTrack=null,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null},_.probe=function(y){var v=new Uint8Array(y);if(v.byteLength<9)return{needMoreData:!0};var m={match:!1};if(v[0]!==70||v[1]!==76||v[2]!==86||v[3]!==1)return m;var S,N,M=(4&v[4])>>>2!=0,U=(1&v[4])!=0,W=(S=v)[N=5]<<24|S[N+1]<<16|S[N+2]<<8|S[N+3];return W<9?m:{match:!0,consumed:W,dataOffset:W,hasAudioTrack:M,hasVideoTrack:U}},_.prototype.bindDataSource=function(y){return y.onDataArrival=this.parseChunks.bind(this),this},Object.defineProperty(_.prototype,"onTrackMetadata",{get:function(){return this._onTrackMetadata},set:function(y){this._onTrackMetadata=y},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"onMediaInfo",{get:function(){return this._onMediaInfo},set:function(y){this._onMediaInfo=y},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"onMetaDataArrived",{get:function(){return this._onMetaDataArrived},set:function(y){this._onMetaDataArrived=y},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"onScriptDataArrived",{get:function(){return this._onScriptDataArrived},set:function(y){this._onScriptDataArrived=y},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"onError",{get:function(){return this._onError},set:function(y){this._onError=y},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"onDataAvailable",{get:function(){return this._onDataAvailable},set:function(y){this._onDataAvailable=y},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"timestampBase",{get:function(){return this._timestampBase},set:function(y){this._timestampBase=y},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"overridedDuration",{get:function(){return this._duration},set:function(y){this._durationOverrided=!0,this._duration=y,this._mediaInfo.duration=y},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"overridedHasAudio",{set:function(y){this._hasAudioFlagOverrided=!0,this._hasAudio=y,this._mediaInfo.hasAudio=y},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"overridedHasVideo",{set:function(y){this._hasVideoFlagOverrided=!0,this._hasVideo=y,this._mediaInfo.hasVideo=y},enumerable:!1,configurable:!0}),_.prototype.resetMediaInfo=function(){this._mediaInfo=new l.a},_.prototype._isInitialMetadataDispatched=function(){return this._hasAudio&&this._hasVideo?this._audioInitialMetadataDispatched&&this._videoInitialMetadataDispatched:this._hasAudio&&!this._hasVideo?this._audioInitialMetadataDispatched:!(this._hasAudio||!this._hasVideo)&&this._videoInitialMetadataDispatched},_.prototype.parseChunks=function(y,v){if(!(this._onError&&this._onMediaInfo&&this._onTrackMetadata&&this._onDataAvailable))throw new h.a("Flv: onError & onMediaInfo & onTrackMetadata & onDataAvailable callback must be specified");var m=0,S=this._littleEndian;if(v===0){if(!(y.byteLength>13))return 0;m=_.probe(y).dataOffset}for(this._firstParse&&(this._firstParse=!1,v+m!==this._dataOffset&&o.a.w(this.TAG,"First time parsing but chunk byteStart invalid!"),(N=new DataView(y,m)).getUint32(0,!S)!==0&&o.a.w(this.TAG,"PrevTagSize0 !== 0 !!!"),m+=4);m<y.byteLength;){this._dispatch=!0;var N=new DataView(y,m);if(m+11+4>y.byteLength)break;var M=N.getUint8(0),U=16777215&N.getUint32(0,!S);if(m+11+U+4>y.byteLength)break;if(M===8||M===9||M===18){var W=N.getUint8(4),K=N.getUint8(5),q=N.getUint8(6)|K<<8|W<<16|N.getUint8(7)<<24;(16777215&N.getUint32(7,!S))!==0&&o.a.w(this.TAG,"Meet tag which has StreamID != 0!");var J=m+11;switch(M){case 8:this._parseAudioData(y,J,U,q);break;case 9:this._parseVideoData(y,J,U,q,v+m);break;case 18:this._parseScriptData(y,J,U)}var Y=N.getUint32(11+U,!S);Y!==11+U&&o.a.w(this.TAG,"Invalid PrevTagSize "+Y),m+=11+U+4}else o.a.w(this.TAG,"Unsupported tag type "+M+", skipped"),m+=11+U+4}return this._isInitialMetadataDispatched()&&this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack),m},_.prototype._parseScriptData=function(y,v,m){var S=g.parseScriptData(y,v,m);if(S.hasOwnProperty("onMetaData")){if(S.onMetaData==null||typeof S.onMetaData!="object")return void o.a.w(this.TAG,"Invalid onMetaData structure!");this._metadata&&o.a.w(this.TAG,"Found another onMetaData tag!"),this._metadata=S;var N=this._metadata.onMetaData;if(this._onMetaDataArrived&&this._onMetaDataArrived(Object.assign({},N)),typeof N.hasAudio=="boolean"&&this._hasAudioFlagOverrided===!1&&(this._hasAudio=N.hasAudio,this._mediaInfo.hasAudio=this._hasAudio),typeof N.hasVideo=="boolean"&&this._hasVideoFlagOverrided===!1&&(this._hasVideo=N.hasVideo,this._mediaInfo.hasVideo=this._hasVideo),typeof N.audiodatarate=="number"&&(this._mediaInfo.audioDataRate=N.audiodatarate),typeof N.videodatarate=="number"&&(this._mediaInfo.videoDataRate=N.videodatarate),typeof N.width=="number"&&(this._mediaInfo.width=N.width),typeof N.height=="number"&&(this._mediaInfo.height=N.height),typeof N.duration=="number"){if(!this._durationOverrided){var M=Math.floor(N.duration*this._timescale);this._duration=M,this._mediaInfo.duration=M}}else this._mediaInfo.duration=0;if(typeof N.framerate=="number"){var U=Math.floor(1e3*N.framerate);if(U>0){var W=U/1e3;this._referenceFrameRate.fixed=!0,this._referenceFrameRate.fps=W,this._referenceFrameRate.fps_num=U,this._referenceFrameRate.fps_den=1e3,this._mediaInfo.fps=W}}if(typeof N.keyframes=="object"){this._mediaInfo.hasKeyframesIndex=!0;var K=N.keyframes;this._mediaInfo.keyframesIndex=this._parseKeyframesIndex(K),N.keyframes=null}else this._mediaInfo.hasKeyframesIndex=!1;this._dispatch=!1,this._mediaInfo.metadata=N,o.a.v(this.TAG,"Parsed onMetaData"),this._mediaInfo.isComplete()&&this._onMediaInfo(this._mediaInfo)}Object.keys(S).length>0&&this._onScriptDataArrived&&this._onScriptDataArrived(Object.assign({},S))},_.prototype._parseKeyframesIndex=function(y){for(var v=[],m=[],S=1;S<y.times.length;S++){var N=this._timestampBase+Math.floor(1e3*y.times[S]);v.push(N),m.push(y.filepositions[S])}return{times:v,filepositions:m}},_.prototype._parseAudioData=function(y,v,m,S){if(m<=1)o.a.w(this.TAG,"Flv: Invalid audio packet, missing SoundData payload!");else if(this._hasAudioFlagOverrided!==!0||this._hasAudio!==!1){this._littleEndian;var N=new DataView(y,v,m).getUint8(0),M=N>>>4;if(M===2||M===10){var U=0,W=(12&N)>>>2;if(W>=0&&W<=4){U=this._flvSoundRateTable[W];var K=1&N,q=this._audioMetadata,J=this._audioTrack;if(q||(this._hasAudio===!1&&this._hasAudioFlagOverrided===!1&&(this._hasAudio=!0,this._mediaInfo.hasAudio=!0),(q=this._audioMetadata={}).type="audio",q.id=J.id,q.timescale=this._timescale,q.duration=this._duration,q.audioSampleRate=U,q.channelCount=K===0?1:2),M===10){var Y=this._parseAACAudioData(y,v+1,m-1);if(Y==null)return;if(Y.packetType===0){if(q.config){if(b(Y.data.config,q.config))return;o.a.w(this.TAG,"AudioSpecificConfig has been changed, re-generate initialization segment")}var X=Y.data;q.audioSampleRate=X.samplingRate,q.channelCount=X.channelCount,q.codec=X.codec,q.originalCodec=X.originalCodec,q.config=X.config,q.refSampleDuration=1024/q.audioSampleRate*q.timescale,o.a.v(this.TAG,"Parsed AudioSpecificConfig"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._audioInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("audio",q),(ot=this._mediaInfo).audioCodec=q.originalCodec,ot.audioSampleRate=q.audioSampleRate,ot.audioChannelCount=q.channelCount,ot.hasVideo?ot.videoCodec!=null&&(ot.mimeType='video/x-flv; codecs="'+ot.videoCodec+","+ot.audioCodec+'"'):ot.mimeType='video/x-flv; codecs="'+ot.audioCodec+'"',ot.isComplete()&&this._onMediaInfo(ot)}else if(Y.packetType===1){var st=this._timestampBase+S,ht={unit:Y.data,length:Y.data.byteLength,dts:st,pts:st};J.samples.push(ht),J.length+=Y.data.length}else o.a.e(this.TAG,"Flv: Unsupported AAC data type "+Y.packetType)}else if(M===2){if(!q.codec){var ot;if((X=this._parseMP3AudioData(y,v+1,m-1,!0))==null)return;q.audioSampleRate=X.samplingRate,q.channelCount=X.channelCount,q.codec=X.codec,q.originalCodec=X.originalCodec,q.refSampleDuration=1152/q.audioSampleRate*q.timescale,o.a.v(this.TAG,"Parsed MPEG Audio Frame Header"),this._audioInitialMetadataDispatched=!0,this._onTrackMetadata("audio",q),(ot=this._mediaInfo).audioCodec=q.codec,ot.audioSampleRate=q.audioSampleRate,ot.audioChannelCount=q.channelCount,ot.audioDataRate=X.bitRate,ot.hasVideo?ot.videoCodec!=null&&(ot.mimeType='video/x-flv; codecs="'+ot.videoCodec+","+ot.audioCodec+'"'):ot.mimeType='video/x-flv; codecs="'+ot.audioCodec+'"',ot.isComplete()&&this._onMediaInfo(ot)}var gt=this._parseMP3AudioData(y,v+1,m-1,!1);if(gt==null)return;st=this._timestampBase+S;var yt={unit:gt,length:gt.byteLength,dts:st,pts:st};J.samples.push(yt),J.length+=gt.length}}else this._onError(k.a.FORMAT_ERROR,"Flv: Invalid audio sample rate idx: "+W)}else this._onError(k.a.CODEC_UNSUPPORTED,"Flv: Unsupported audio codec idx: "+M)}},_.prototype._parseAACAudioData=function(y,v,m){if(!(m<=1)){var S={},N=new Uint8Array(y,v,m);return S.packetType=N[0],N[0]===0?S.data=this._parseAACAudioSpecificConfig(y,v+1,m-1):S.data=N.subarray(1),S}o.a.w(this.TAG,"Flv: Invalid AAC packet, missing AACPacketType or/and Data!")},_.prototype._parseAACAudioSpecificConfig=function(y,v,m){var S,N,M=new Uint8Array(y,v,m),U=null,W=0,K=null;if(W=S=M[0]>>>3,(N=(7&M[0])<<1|M[1]>>>7)<0||N>=this._mpegSamplingRates.length)this._onError(k.a.FORMAT_ERROR,"Flv: AAC invalid sampling frequency index!");else{var q=this._mpegSamplingRates[N],J=(120&M[1])>>>3;if(!(J<0||J>=8)){W===5&&(K=(7&M[1])<<1|M[2]>>>7,(124&M[2])>>>2);var Y=self.navigator.userAgent.toLowerCase();return Y.indexOf("firefox")!==-1?N>=6?(W=5,U=new Array(4),K=N-3):(W=2,U=new Array(2),K=N):Y.indexOf("android")!==-1?(W=2,U=new Array(2),K=N):(W=5,K=N,U=new Array(4),N>=6?K=N-3:J===1&&(W=2,U=new Array(2),K=N)),U[0]=W<<3,U[0]|=(15&N)>>>1,U[1]=(15&N)<<7,U[1]|=(15&J)<<3,W===5&&(U[1]|=(15&K)>>>1,U[2]=(1&K)<<7,U[2]|=8,U[3]=0),{config:U,samplingRate:q,channelCount:J,codec:"mp4a.40."+W,originalCodec:"mp4a.40."+S}}this._onError(k.a.FORMAT_ERROR,"Flv: AAC invalid channel configuration")}},_.prototype._parseMP3AudioData=function(y,v,m,S){if(!(m<4)){this._littleEndian;var N=new Uint8Array(y,v,m),M=null;if(S){if(N[0]!==255)return;var U=N[1]>>>3&3,W=(6&N[1])>>1,K=(240&N[2])>>>4,q=(12&N[2])>>>2,J=(N[3]>>>6&3)!==3?2:1,Y=0,X=0;switch(U){case 0:Y=this._mpegAudioV25SampleRateTable[q];break;case 2:Y=this._mpegAudioV20SampleRateTable[q];break;case 3:Y=this._mpegAudioV10SampleRateTable[q]}switch(W){case 1:K<this._mpegAudioL3BitRateTable.length&&(X=this._mpegAudioL3BitRateTable[K]);break;case 2:K<this._mpegAudioL2BitRateTable.length&&(X=this._mpegAudioL2BitRateTable[K]);break;case 3:K<this._mpegAudioL1BitRateTable.length&&(X=this._mpegAudioL1BitRateTable[K])}M={bitRate:X,samplingRate:Y,channelCount:J,codec:"mp3",originalCodec:"mp3"}}else M=N;return M}o.a.w(this.TAG,"Flv: Invalid MP3 packet, header missing!")},_.prototype._parseVideoData=function(y,v,m,S,N){if(m<=1)o.a.w(this.TAG,"Flv: Invalid video packet, missing VideoData payload!");else if(this._hasVideoFlagOverrided!==!0||this._hasVideo!==!1){var M=new Uint8Array(y,v,m)[0],U=(240&M)>>>4,W=15&M;if(W===7)this._parseAVCVideoPacket(y,v+1,m-1,S,N,U);else{if(W!==12)return void this._onError(k.a.CODEC_UNSUPPORTED,"Flv: Unsupported codec in video frame: "+W);this._parseHEVCVideoPacket(y,v+1,m-1,S,N,U)}}},_.prototype._parseAVCVideoPacket=function(y,v,m,S,N,M){if(m<4)o.a.w(this.TAG,"Flv: Invalid AVC packet, missing AVCPacketType or/and CompositionTime");else{var U=this._littleEndian,W=new DataView(y,v,m),K=W.getUint8(0),q=(16777215&W.getUint32(0,!U))<<8>>8;if(K===0)this._parseAVCDecoderConfigurationRecord(y,v+4,m-4);else if(K===1)this._parseAVCVideoData(y,v+4,m-4,S,N,M,q);else if(K!==2)return void this._onError(k.a.FORMAT_ERROR,"Flv: Invalid video packet type "+K)}},_.prototype._parseHEVCVideoPacket=function(y,v,m,S,N,M){if(m<4)o.a.w(this.TAG,"Flv: Invalid HEVC packet, missing HEVCPacketType or/and CompositionTime");else{var U=this._littleEndian,W=new DataView(y,v,m),K=W.getUint8(0),q=(16777215&W.getUint32(0,!U))<<8>>8;if(K===0)this._parseHEVCDecoderConfigurationRecord(y,v+4,m-4);else if(K===1)this._parseHEVCVideoData(y,v+4,m-4,S,N,M,q);else if(K!==2)return void this._onError(k.a.FORMAT_ERROR,"Flv: Invalid video packet type "+K)}},_.prototype._parseAVCDecoderConfigurationRecord=function(y,v,m){if(m<7)o.a.w(this.TAG,"Flv: Invalid AVCDecoderConfigurationRecord, lack of data!");else{var S=this._videoMetadata,N=this._videoTrack,M=this._littleEndian,U=new DataView(y,v,m);if(S){if(S.avcc!==void 0){var W=new Uint8Array(y,v,m);if(b(W,S.avcc))return;o.a.w(this.TAG,"AVCDecoderConfigurationRecord has been changed, re-generate initialization segment")}}else this._hasVideo===!1&&this._hasVideoFlagOverrided===!1&&(this._hasVideo=!0,this._mediaInfo.hasVideo=!0),(S=this._videoMetadata={}).type="video",S.id=N.id,S.timescale=this._timescale,S.duration=this._duration;var K=U.getUint8(0),q=U.getUint8(1);if(U.getUint8(2),U.getUint8(3),K===1&&q!==0)if(this._naluLengthSize=1+(3&U.getUint8(4)),this._naluLengthSize===3||this._naluLengthSize===4){var J=31&U.getUint8(5);if(J!==0){J>1&&o.a.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: SPS Count = "+J);for(var Y=6,X=0;X<J;X++){var st=U.getUint16(Y,!M);if(Y+=2,st!==0){var ht=new Uint8Array(y,v+Y,st);Y+=st;var ot=E.parseSPS(ht);if(X===0){S.codecWidth=ot.codec_size.width,S.codecHeight=ot.codec_size.height,S.presentWidth=ot.present_size.width,S.presentHeight=ot.present_size.height,S.profile=ot.profile_string,S.level=ot.level_string,S.bitDepth=ot.bit_depth,S.chromaFormat=ot.chroma_format,S.sarRatio=ot.sar_ratio,S.frameRate=ot.frame_rate,ot.frame_rate.fixed!==!1&&ot.frame_rate.fps_num!==0&&ot.frame_rate.fps_den!==0||(S.frameRate=this._referenceFrameRate);var gt=S.frameRate.fps_den,yt=S.frameRate.fps_num;S.refSampleDuration=S.timescale*(gt/yt);for(var ft=ht.subarray(1,4),Rt="avc1.",pt=0;pt<3;pt++){var ut=ft[pt].toString(16);ut.length<2&&(ut="0"+ut),Rt+=ut}S.codec=Rt;var St=this._mediaInfo;St.width=S.codecWidth,St.height=S.codecHeight,St.fps=S.frameRate.fps,St.profile=S.profile,St.level=S.level,St.refFrames=ot.ref_frames,St.chromaFormat=ot.chroma_format_string,St.sarNum=S.sarRatio.width,St.sarDen=S.sarRatio.height,St.videoCodec=Rt,St.hasAudio?St.audioCodec!=null&&(St.mimeType='video/x-flv; codecs="'+St.videoCodec+","+St.audioCodec+'"'):St.mimeType='video/x-flv; codecs="'+St.videoCodec+'"',St.isComplete()&&this._onMediaInfo(St)}}}var Ct=U.getUint8(Y);if(Ct!==0){for(Ct>1&&o.a.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: PPS Count = "+Ct),Y++,X=0;X<Ct;X++)st=U.getUint16(Y,!M),Y+=2,st!==0&&(Y+=st);S.avcc=new Uint8Array(m),S.avcc.set(new Uint8Array(y,v,m),0),o.a.v(this.TAG,"Parsed AVCDecoderConfigurationRecord"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._videoInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("video",S)}else this._onError(k.a.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No PPS")}else this._onError(k.a.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No SPS")}else this._onError(k.a.FORMAT_ERROR,"Flv: Strange NaluLengthSizeMinusOne: "+(this._naluLengthSize-1));else this._onError(k.a.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord")}},_.prototype._parseHEVCDecoderConfigurationRecord=function(y,v,m){if(m<22)o.a.w(this.TAG,"Flv: Invalid HEVCDecoderConfigurationRecord, lack of data!");else{var S=this._videoMetadata,N=this._videoTrack,M=this._littleEndian,U=new DataView(y,v,m);if(S){if(S.hvcc!==void 0){var W=new Uint8Array(y,v,m);if(b(W,S.hvcc))return;o.a.w(this.TAG,"HEVCDecoderConfigurationRecord has been changed, re-generate initialization segment")}}else this._hasVideo===!1&&this._hasVideoFlagOverrided===!1&&(this._hasVideo=!0,this._mediaInfo.hasVideo=!0),(S=this._videoMetadata={}).type="video",S.id=N.id,S.timescale=this._timescale,S.duration=this._duration;var K=U.getUint8(0),q=31&U.getUint8(1);if(K===1&&q!==0)if(this._naluLengthSize=1+(3&U.getUint8(21)),this._naluLengthSize===3||this._naluLengthSize===4){for(var J=U.getUint8(22),Y=0,X=23;Y<J;Y++){var st=63&U.getUint8(X+0),ht=U.getUint16(X+1,!M);X+=3;for(var ot=0;ot<ht;ot++){var gt=U.getUint16(X+0,!M);if(ot===0)if(st===33){X+=2;var yt=new Uint8Array(y,v+X,gt),ft=O.parseSPS(yt);S.codecWidth=ft.codec_size.width,S.codecHeight=ft.codec_size.height,S.presentWidth=ft.present_size.width,S.presentHeight=ft.present_size.height,S.profile=ft.profile_string,S.level=ft.level_string,S.bitDepth=ft.bit_depth,S.chromaFormat=ft.chroma_format,S.sarRatio=ft.sar_ratio,S.frameRate=ft.frame_rate,ft.frame_rate.fixed!==!1&&ft.frame_rate.fps_num!==0&&ft.frame_rate.fps_den!==0||(S.frameRate=this._referenceFrameRate);var Rt=S.frameRate.fps_den,pt=S.frameRate.fps_num;S.refSampleDuration=S.timescale*(Rt/pt),S.codec=ft.codec_mimetype;var ut=this._mediaInfo;ut.width=S.codecWidth,ut.height=S.codecHeight,ut.fps=S.frameRate.fps,ut.profile=S.profile,ut.level=S.level,ut.refFrames=ft.ref_frames,ut.chromaFormat=ft.chroma_format_string,ut.sarNum=S.sarRatio.width,ut.sarDen=S.sarRatio.height,ut.videoCodec=ft.codec_mimetype,ut.hasAudio?ut.audioCodec!=null&&(ut.mimeType='video/x-flv; codecs="'+ut.videoCodec+","+ut.audioCodec+'"'):ut.mimeType='video/x-flv; codecs="'+ut.videoCodec+'"',ut.isComplete()&&this._onMediaInfo(ut),X+=gt}else X+=2+gt;else X+=2+gt}}S.hvcc=new Uint8Array(m),S.hvcc.set(new Uint8Array(y,v,m),0),o.a.v(this.TAG,"Parsed HEVCDecoderConfigurationRecord"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._videoInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("video",S)}else this._onError(k.a.FORMAT_ERROR,"Flv: Strange NaluLengthSizeMinusOne: "+(this._naluLengthSize-1));else this._onError(k.a.FORMAT_ERROR,"Flv: Invalid HEVCDecoderConfigurationRecord")}},_.prototype._parseAVCVideoData=function(y,v,m,S,N,M,U){for(var W=this._littleEndian,K=new DataView(y,v,m),q=[],J=0,Y=0,X=this._naluLengthSize,st=this._timestampBase+S,ht=M===1;Y<m;){if(Y+4>=m){o.a.w(this.TAG,"Malformed Nalu near timestamp "+st+", offset = "+Y+", dataSize = "+m);break}var ot=K.getUint32(Y,!W);if(X===3&&(ot>>>=8),ot>m-X)return void o.a.w(this.TAG,"Malformed Nalus near timestamp "+st+", NaluSize > DataSize!");var gt=31&K.getUint8(Y+X);gt===5&&(ht=!0);var yt=new Uint8Array(y,v+Y,X+ot),ft={type:gt,data:yt};q.push(ft),J+=yt.byteLength,Y+=X+ot}if(q.length){var Rt=this._videoTrack,pt={units:q,length:J,isKeyframe:ht,dts:st,cts:U,pts:st+U};ht&&(pt.fileposition=N),Rt.samples.push(pt),Rt.length+=J}},_.prototype._parseHEVCVideoData=function(y,v,m,S,N,M,U){for(var W=this._littleEndian,K=new DataView(y,v,m),q=[],J=0,Y=0,X=this._naluLengthSize,st=this._timestampBase+S,ht=M===1;Y<m;){if(Y+4>=m){o.a.w(this.TAG,"Malformed Nalu near timestamp "+st+", offset = "+Y+", dataSize = "+m);break}var ot=K.getUint32(Y,!W);if(X===3&&(ot>>>=8),ot>m-X)return void o.a.w(this.TAG,"Malformed Nalus near timestamp "+st+", NaluSize > DataSize!");var gt=31&K.getUint8(Y+X);gt!==19&&gt!==20||(ht=!0);var yt=new Uint8Array(y,v+Y,X+ot),ft={type:gt,data:yt};q.push(ft),J+=yt.byteLength,Y+=X+ot}if(q.length){var Rt=this._videoTrack,pt={units:q,length:J,isKeyframe:ht,dts:st,cts:U,pts:st+U};ht&&(pt.fileposition=N),Rt.samples.push(pt),Rt.length+=J}},_}(),I=function(){function _(){}return _.prototype.destroy=function(){this.onError=null,this.onMediaInfo=null,this.onMetaDataArrived=null,this.onTrackMetadata=null,this.onDataAvailable=null,this.onTimedID3Metadata=null,this.onSMPTE2038Metadata=null,this.onSCTE35Metadata=null,this.onPESPrivateData=null,this.onPESPrivateDataDescriptor=null},_}(),j=function(){this.program_pmt_pid={}};(function(_){_[_.kMPEG1Audio=3]="kMPEG1Audio",_[_.kMPEG2Audio=4]="kMPEG2Audio",_[_.kPESPrivateData=6]="kPESPrivateData",_[_.kADTSAAC=15]="kADTSAAC",_[_.kID3=21]="kID3",_[_.kSCTE35=134]="kSCTE35",_[_.kH264=27]="kH264",_[_.kH265=36]="kH265"})(A||(A={}));var F,$=function(){this.pid_stream_type={},this.common_pids={h264:void 0,h265:void 0,adts_aac:void 0,mp3:void 0},this.pes_private_data_pids={},this.timed_id3_pids={},this.scte_35_pids={},this.smpte2038_pids={}},V=function(){},Q=function(){},z=function(){this.slices=[],this.total_length=0,this.expected_length=0,this.file_position=0};(function(_){_[_.kUnspecified=0]="kUnspecified",_[_.kSliceNonIDR=1]="kSliceNonIDR",_[_.kSliceDPA=2]="kSliceDPA",_[_.kSliceDPB=3]="kSliceDPB",_[_.kSliceDPC=4]="kSliceDPC",_[_.kSliceIDR=5]="kSliceIDR",_[_.kSliceSEI=6]="kSliceSEI",_[_.kSliceSPS=7]="kSliceSPS",_[_.kSlicePPS=8]="kSlicePPS",_[_.kSliceAUD=9]="kSliceAUD",_[_.kEndOfSequence=10]="kEndOfSequence",_[_.kEndOfStream=11]="kEndOfStream",_[_.kFiller=12]="kFiller",_[_.kSPSExt=13]="kSPSExt",_[_.kReserved0=14]="kReserved0"})(F||(F={}));var B,w,P=function(){},G=function(_){var y=_.data.byteLength;this.type=_.type,this.data=new Uint8Array(4+y),new DataView(this.data.buffer).setUint32(0,y),this.data.set(_.data,4)},et=function(){function _(y){this.TAG="H264AnnexBParser",this.current_startcode_offset_=0,this.eof_flag_=!1,this.data_=y,this.current_startcode_offset_=this.findNextStartCodeOffset(0),this.eof_flag_&&o.a.e(this.TAG,"Could not find H264 startcode until payload end!")}return _.prototype.findNextStartCodeOffset=function(y){for(var v=y,m=this.data_;;){if(v+3>=m.byteLength)return this.eof_flag_=!0,m.byteLength;var S=m[v+0]<<24|m[v+1]<<16|m[v+2]<<8|m[v+3],N=m[v+0]<<16|m[v+1]<<8|m[v+2];if(S===1||N===1)return v;v++}},_.prototype.readNextNaluPayload=function(){for(var y=this.data_,v=null;v==null&&!this.eof_flag_;){var m=this.current_startcode_offset_,S=31&y[m+=(y[m]<<24|y[m+1]<<16|y[m+2]<<8|y[m+3])===1?4:3],N=(128&y[m])>>>7,M=this.findNextStartCodeOffset(m);if(this.current_startcode_offset_=M,!(S>=F.kReserved0)&&N===0){var U=y.subarray(m,M);(v=new P).type=S,v.data=U}}return v},_}(),rt=function(){function _(y,v,m){var S=8+y.byteLength+1+2+v.byteLength,N=!1;y[3]!==66&&y[3]!==77&&y[3]!==88&&(N=!0,S+=4);var M=this.data=new Uint8Array(S);M[0]=1,M[1]=y[1],M[2]=y[2],M[3]=y[3],M[4]=255,M[5]=225;var U=y.byteLength;M[6]=U>>>8,M[7]=255&U;var W=8;M.set(y,8),M[W+=U]=1;var K=v.byteLength;M[W+1]=K>>>8,M[W+2]=255&K,M.set(v,W+3),W+=3+K,N&&(M[W]=252|m.chroma_format_idc,M[W+1]=248|m.bit_depth_luma-8,M[W+2]=248|m.bit_depth_chroma-8,M[W+3]=0,W+=4)}return _.prototype.getData=function(){return this.data},_}();(function(_){_[_.kNull=0]="kNull",_[_.kAACMain=1]="kAACMain",_[_.kAAC_LC=2]="kAAC_LC",_[_.kAAC_SSR=3]="kAAC_SSR",_[_.kAAC_LTP=4]="kAAC_LTP",_[_.kAAC_SBR=5]="kAAC_SBR",_[_.kAAC_Scalable=6]="kAAC_Scalable",_[_.kLayer1=32]="kLayer1",_[_.kLayer2=33]="kLayer2",_[_.kLayer3=34]="kLayer3"})(B||(B={})),function(_){_[_.k96000Hz=0]="k96000Hz",_[_.k88200Hz=1]="k88200Hz",_[_.k64000Hz=2]="k64000Hz",_[_.k48000Hz=3]="k48000Hz",_[_.k44100Hz=4]="k44100Hz",_[_.k32000Hz=5]="k32000Hz",_[_.k24000Hz=6]="k24000Hz",_[_.k22050Hz=7]="k22050Hz",_[_.k16000Hz=8]="k16000Hz",_[_.k12000Hz=9]="k12000Hz",_[_.k11025Hz=10]="k11025Hz",_[_.k8000Hz=11]="k8000Hz",_[_.k7350Hz=12]="k7350Hz"}(w||(w={}));var dt,vt=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],Lt=function(){},xt=function(){function _(y){this.TAG="AACADTSParser",this.data_=y,this.current_syncword_offset_=this.findNextSyncwordOffset(0),this.eof_flag_&&o.a.e(this.TAG,"Could not found ADTS syncword until payload end")}return _.prototype.findNextSyncwordOffset=function(y){for(var v=y,m=this.data_;;){if(v+7>=m.byteLength)return this.eof_flag_=!0,m.byteLength;if((m[v+0]<<8|m[v+1])>>>4===4095)return v;v++}},_.prototype.readNextAACFrame=function(){for(var y=this.data_,v=null;v==null&&!this.eof_flag_;){var m=this.current_syncword_offset_,S=(8&y[m+1])>>>3,N=(6&y[m+1])>>>1,M=1&y[m+1],U=(192&y[m+2])>>>6,W=(60&y[m+2])>>>2,K=(1&y[m+2])<<2|(192&y[m+3])>>>6,q=(3&y[m+3])<<11|y[m+4]<<3|(224&y[m+5])>>>5;if(y[m+6],m+q>this.data_.byteLength){this.eof_flag_=!0,this.has_last_incomplete_data=!0;break}var J=M===1?7:9,Y=q-J;m+=J;var X=this.findNextSyncwordOffset(m+Y);if(this.current_syncword_offset_=X,(S===0||S===1)&&N===0){var st=y.subarray(m,m+Y);(v=new Lt).audio_object_type=U+1,v.sampling_freq_index=W,v.sampling_frequency=vt[W],v.channel_config=K,v.data=st}}return v},_.prototype.hasIncompleteData=function(){return this.has_last_incomplete_data},_.prototype.getIncompleteData=function(){return this.has_last_incomplete_data?this.data_.subarray(this.current_syncword_offset_):null},_}(),it=function(_){var y=null,v=_.audio_object_type,m=_.audio_object_type,S=_.sampling_freq_index,N=_.channel_config,M=0,U=navigator.userAgent.toLowerCase();U.indexOf("firefox")!==-1?S>=6?(m=5,y=new Array(4),M=S-3):(m=2,y=new Array(2),M=S):U.indexOf("android")!==-1?(m=2,y=new Array(2),M=S):(m=5,M=S,y=new Array(4),S>=6?M=S-3:N===1&&(m=2,y=new Array(2),M=S)),y[0]=m<<3,y[0]|=(15&S)>>>1,y[1]=(15&S)<<7,y[1]|=(15&N)<<3,m===5&&(y[1]|=(15&M)>>>1,y[2]=(1&M)<<7,y[2]|=8,y[3]=0),this.config=y,this.sampling_rate=vt[S],this.channel_count=N,this.codec_mimetype="mp4a.40."+m,this.original_codec_mimetype="mp4a.40."+v},at=function(){},lt=function(){};(function(_){_[_.kSpliceNull=0]="kSpliceNull",_[_.kSpliceSchedule=4]="kSpliceSchedule",_[_.kSpliceInsert=5]="kSpliceInsert",_[_.kTimeSignal=6]="kTimeSignal",_[_.kBandwidthReservation=7]="kBandwidthReservation",_[_.kPrivateCommand=255]="kPrivateCommand"})(dt||(dt={}));var ct,mt=function(_){var y=_.readBool();return y?(_.readBits(6),{time_specified_flag:y,pts_time:4*_.readBits(31)+_.readBits(2)}):(_.readBits(7),{time_specified_flag:y})},It=function(_){var y=_.readBool();return _.readBits(6),{auto_return:y,duration:4*_.readBits(31)+_.readBits(2)}},Gt=function(_,y){var v=y.readBits(8);return _?{component_tag:v}:{component_tag:v,splice_time:mt(y)}},Xt=function(_){return{component_tag:_.readBits(8),utc_splice_time:_.readBits(32)}},se=function(_){var y=_.readBits(32),v=_.readBool();_.readBits(7);var m={splice_event_id:y,splice_event_cancel_indicator:v};if(v)return m;if(m.out_of_network_indicator=_.readBool(),m.program_splice_flag=_.readBool(),m.duration_flag=_.readBool(),_.readBits(5),m.program_splice_flag)m.utc_splice_time=_.readBits(32);else{m.component_count=_.readBits(8),m.components=[];for(var S=0;S<m.component_count;S++)m.components.push(Xt(_))}return m.duration_flag&&(m.break_duration=It(_)),m.unique_program_id=_.readBits(16),m.avail_num=_.readBits(8),m.avails_expected=_.readBits(8),m},Yt=function(_,y,v,m){return{descriptor_tag:_,descriptor_length:y,identifier:v,provider_avail_id:m.readBits(32)}},Et=function(_,y,v,m){var S=m.readBits(8),N=m.readBits(3);m.readBits(5);for(var M="",U=0;U<N;U++)M+=String.fromCharCode(m.readBits(8));return{descriptor_tag:_,descriptor_length:y,identifier:v,preroll:S,dtmf_count:N,DTMF_char:M}},We=function(_){var y=_.readBits(8);return _.readBits(7),{component_tag:y,pts_offset:4*_.readBits(31)+_.readBits(2)}},le=function(_,y,v,m){var S=m.readBits(32),N=m.readBool();m.readBits(7);var M={descriptor_tag:_,descriptor_length:y,identifier:v,segmentation_event_id:S,segmentation_event_cancel_indicator:N};if(N)return M;if(M.program_segmentation_flag=m.readBool(),M.segmentation_duration_flag=m.readBool(),M.delivery_not_restricted_flag=m.readBool(),M.delivery_not_restricted_flag?m.readBits(5):(M.web_delivery_allowed_flag=m.readBool(),M.no_regional_blackout_flag=m.readBool(),M.archive_allowed_flag=m.readBool(),M.device_restrictions=m.readBits(2)),!M.program_segmentation_flag){M.component_count=m.readBits(8),M.components=[];for(var U=0;U<M.component_count;U++)M.components.push(We(m))}M.segmentation_duration_flag&&(M.segmentation_duration=m.readBits(40)),M.segmentation_upid_type=m.readBits(8),M.segmentation_upid_length=m.readBits(8);var W=new Uint8Array(M.segmentation_upid_length);for(U=0;U<M.segmentation_upid_length;U++)W[U]=m.readBits(8);return M.segmentation_upid=W.buffer,M.segmentation_type_id=m.readBits(8),M.segment_num=m.readBits(8),M.segments_expected=m.readBits(8),M.segmentation_type_id!==52&&M.segmentation_type_id!==54&&M.segmentation_type_id!==56&&M.segmentation_type_id!==58||(M.sub_segment_num=m.readBits(8),M.sub_segments_expected=m.readBits(8)),M},Ae=function(_,y,v,m){return{descriptor_tag:_,descriptor_length:y,identifier:v,TAI_seconds:m.readBits(48),TAI_ns:m.readBits(32),UTC_offset:m.readBits(16)}},Be=function(_){return{component_tag:_.readBits(8),ISO_code:String.fromCharCode(_.readBits(8),_.readBits(8),_.readBits(8)),Bit_Stream_Mode:_.readBits(3),Num_Channels:_.readBits(4),Full_Srvc_Audio:_.readBool()}},Le=function(_,y,v,m){for(var S=m.readBits(4),N=[],M=0;M<S;M++)N.push(Be(m));return{descriptor_tag:_,descriptor_length:y,identifier:v,audio_count:S,components:N}},ge=function(_){var y=new x(_),v=y.readBits(8),m=y.readBool(),S=y.readBool();y.readBits(2);var N=y.readBits(12),M=y.readBits(8),U=y.readBool(),W=y.readBits(6),K=4*y.readBits(31)+y.readBits(2),q=y.readBits(8),J=y.readBits(12),Y=y.readBits(12),X=y.readBits(8),st=null;X===dt.kSpliceNull?st={}:X===dt.kSpliceSchedule?st=function(Dt){for(var Ft=Dt.readBits(8),Ut=[],wt=0;wt<Ft;wt++)Ut.push(se(Dt));return{splice_count:Ft,events:Ut}}(y):X===dt.kSpliceInsert?st=function(Dt){var Ft=Dt.readBits(32),Ut=Dt.readBool();Dt.readBits(7);var wt={splice_event_id:Ft,splice_event_cancel_indicator:Ut};if(Ut)return wt;if(wt.out_of_network_indicator=Dt.readBool(),wt.program_splice_flag=Dt.readBool(),wt.duration_flag=Dt.readBool(),wt.splice_immediate_flag=Dt.readBool(),Dt.readBits(4),wt.program_splice_flag&&!wt.splice_immediate_flag&&(wt.splice_time=mt(Dt)),!wt.program_splice_flag){wt.component_count=Dt.readBits(8),wt.components=[];for(var Ot=0;Ot<wt.component_count;Ot++)wt.components.push(Gt(wt.splice_immediate_flag,Dt))}return wt.duration_flag&&(wt.break_duration=It(Dt)),wt.unique_program_id=Dt.readBits(16),wt.avail_num=Dt.readBits(8),wt.avails_expected=Dt.readBits(8),wt}(y):X===dt.kTimeSignal?st=function(Dt){return{splice_time:mt(Dt)}}(y):X===dt.kBandwidthReservation?st={}:X===dt.kPrivateCommand?st=function(Dt,Ft){for(var Ut=String.fromCharCode(Ft.readBits(8),Ft.readBits(8),Ft.readBits(8),Ft.readBits(8)),wt=new Uint8Array(Dt-4),Ot=0;Ot<Dt-4;Ot++)wt[Ot]=Ft.readBits(8);return{identifier:Ut,private_data:wt.buffer}}(Y,y):y.readBits(8*Y);for(var ht=[],ot=y.readBits(16),gt=0;gt<ot;){var yt=y.readBits(8),ft=y.readBits(8),Rt=String.fromCharCode(y.readBits(8),y.readBits(8),y.readBits(8),y.readBits(8));yt===0?ht.push(Yt(yt,ft,Rt,y)):yt===1?ht.push(Et(yt,ft,Rt,y)):yt===2?ht.push(le(yt,ft,Rt,y)):yt===3?ht.push(Ae(yt,ft,Rt,y)):yt===4?ht.push(Le(yt,ft,Rt,y)):y.readBits(8*(ft-4)),gt+=2+ft}var pt={table_id:v,section_syntax_indicator:m,private_indicator:S,section_length:N,protocol_version:M,encrypted_packet:U,encryption_algorithm:W,pts_adjustment:K,cw_index:q,tier:J,splice_command_length:Y,splice_command_type:X,splice_command:st,descriptor_loop_length:ot,splice_descriptors:ht,E_CRC32:U?y.readBits(32):void 0,CRC32:y.readBits(32)};if(X===dt.kSpliceInsert){var ut=st;if(ut.splice_event_cancel_indicator)return{splice_command_type:X,detail:pt,data:_};if(ut.program_splice_flag&&!ut.splice_immediate_flag){var St=ut.duration_flag?ut.break_duration.auto_return:void 0,Ct=ut.duration_flag?ut.break_duration.duration/90:void 0;return ut.splice_time.time_specified_flag?{splice_command_type:X,pts:(K+ut.splice_time.pts_time)%Math.pow(2,33),auto_return:St,duraiton:Ct,detail:pt,data:_}:{splice_command_type:X,auto_return:St,duraiton:Ct,detail:pt,data:_}}return{splice_command_type:X,auto_return:St=ut.duration_flag?ut.break_duration.auto_return:void 0,duraiton:Ct=ut.duration_flag?ut.break_duration.duration/90:void 0,detail:pt,data:_}}if(X===dt.kTimeSignal){var qt=st;return qt.splice_time.time_specified_flag?{splice_command_type:X,pts:(K+qt.splice_time.pts_time)%Math.pow(2,33),detail:pt,data:_}:{splice_command_type:X,detail:pt,data:_}}return{splice_command_type:X,detail:pt,data:_}};(function(_){_[_.kSliceIDR_W_RADL=19]="kSliceIDR_W_RADL",_[_.kSliceIDR_N_LP=20]="kSliceIDR_N_LP",_[_.kSliceCRA_NUT=21]="kSliceCRA_NUT",_[_.kSliceVPS=32]="kSliceVPS",_[_.kSliceSPS=33]="kSliceSPS",_[_.kSlicePPS=34]="kSlicePPS",_[_.kSliceAUD=35]="kSliceAUD"})(ct||(ct={}));var ke,li=function(){},ti=function(_){var y=_.data.byteLength;this.type=_.type,this.data=new Uint8Array(4+y),new DataView(this.data.buffer).setUint32(0,y),this.data.set(_.data,4)},Ye=function(){function _(y){this.TAG="H265AnnexBParser",this.current_startcode_offset_=0,this.eof_flag_=!1,this.data_=y,this.current_startcode_offset_=this.findNextStartCodeOffset(0),this.eof_flag_&&o.a.e(this.TAG,"Could not find H265 startcode until payload end!")}return _.prototype.findNextStartCodeOffset=function(y){for(var v=y,m=this.data_;;){if(v+3>=m.byteLength)return this.eof_flag_=!0,m.byteLength;var S=m[v+0]<<24|m[v+1]<<16|m[v+2]<<8|m[v+3],N=m[v+0]<<16|m[v+1]<<8|m[v+2];if(S===1||N===1)return v;v++}},_.prototype.readNextNaluPayload=function(){for(var y=this.data_,v=null;v==null&&!this.eof_flag_;){var m=this.current_startcode_offset_,S=y[m+=(y[m]<<24|y[m+1]<<16|y[m+2]<<8|y[m+3])===1?4:3]>>1&63,N=(128&y[m])>>>7,M=this.findNextStartCodeOffset(m);if(this.current_startcode_offset_=M,N===0){var U=y.subarray(m,M);(v=new li).type=S,v.data=U}}return v},_}(),Hi=function(){function _(y,v,m,S){var N=23+(5+y.byteLength)+(5+v.byteLength)+(5+m.byteLength),M=this.data=new Uint8Array(N);M[0]=1,M[1]=(3&S.general_profile_space)<<6|(S.general_tier_flag?1:0)<<5|31&S.general_profile_idc,M[2]=S.general_profile_compatibility_flags_1,M[3]=S.general_profile_compatibility_flags_2,M[4]=S.general_profile_compatibility_flags_3,M[5]=S.general_profile_compatibility_flags_4,M[6]=S.general_constraint_indicator_flags_1,M[7]=S.general_constraint_indicator_flags_2,M[8]=S.general_constraint_indicator_flags_3,M[9]=S.general_constraint_indicator_flags_4,M[10]=S.general_constraint_indicator_flags_5,M[11]=S.general_constraint_indicator_flags_6,M[12]=60,M[13]=240|(3840&S.min_spatial_segmentation_idc)>>8,M[14]=255&S.min_spatial_segmentation_idc,M[15]=252|3&S.parallelismType,M[16]=252|3&S.chroma_format_idc,M[17]=248|7&S.bit_depth_luma_minus8,M[18]=248|7&S.bit_depth_chroma_minus8,M[19]=0,M[20]=0,M[21]=(3&S.constant_frame_rate)<<6|(7&S.num_temporal_layers)<<3|(S.temporal_id_nested?1:0)<<2|3,M[22]=3,M[23]=128|ct.kSliceVPS,M[24]=0,M[25]=1,M[26]=(65280&y.byteLength)>>8,M[27]=(255&y.byteLength)>>0,M.set(y,28),M[23+(5+y.byteLength)+0]=128|ct.kSliceSPS,M[23+(5+y.byteLength)+1]=0,M[23+(5+y.byteLength)+2]=1,M[23+(5+y.byteLength)+3]=(65280&v.byteLength)>>8,M[23+(5+y.byteLength)+4]=(255&v.byteLength)>>0,M.set(v,23+(5+y.byteLength)+5),M[23+(5+y.byteLength+5+v.byteLength)+0]=128|ct.kSlicePPS,M[23+(5+y.byteLength+5+v.byteLength)+1]=0,M[23+(5+y.byteLength+5+v.byteLength)+2]=1,M[23+(5+y.byteLength+5+v.byteLength)+3]=(65280&m.byteLength)>>8,M[23+(5+y.byteLength+5+v.byteLength)+4]=(255&m.byteLength)>>0,M.set(m,23+(5+y.byteLength+5+v.byteLength)+5)}return _.prototype.getData=function(){return this.data},_}(),Ki=function(){},Wi=function(){},Yi=(ke=function(_,y){return(ke=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(v,m){v.__proto__=m}||function(v,m){for(var S in m)m.hasOwnProperty(S)&&(v[S]=m[S])})(_,y)},function(_,y){function v(){this.constructor=_}ke(_,y),_.prototype=y===null?Object.create(y):(v.prototype=y.prototype,new v)}),Ce=function(){return(Ce=Object.assign||function(_){for(var y,v=1,m=arguments.length;v<m;v++)for(var S in y=arguments[v])Object.prototype.hasOwnProperty.call(y,S)&&(_[S]=y[S]);return _}).apply(this,arguments)},_i=function(_){function y(v,m){var S=_.call(this)||this;return S.TAG="TSDemuxer",S.first_parse_=!0,S.media_info_=new l.a,S.timescale_=90,S.duration_=0,S.current_pmt_pid_=-1,S.program_pmt_map_={},S.pes_slice_queues_={},S.section_slice_queues_={},S.video_metadata_={vps:void 0,sps:void 0,pps:void 0,details:void 0},S.audio_metadata_={codec:void 0,audio_object_type:void 0,sampling_freq_index:void 0,sampling_frequency:void 0,channel_config:void 0},S.aac_last_sample_pts_=void 0,S.aac_last_incomplete_data_=null,S.has_video_=!1,S.has_audio_=!1,S.video_init_segment_dispatched_=!1,S.audio_init_segment_dispatched_=!1,S.video_metadata_changed_=!1,S.audio_metadata_changed_=!1,S.video_track_={type:"video",id:1,sequenceNumber:0,samples:[],length:0},S.audio_track_={type:"audio",id:2,sequenceNumber:0,samples:[],length:0},S.ts_packet_size_=v.ts_packet_size,S.sync_offset_=v.sync_offset,S.config_=m,S}return Yi(y,_),y.prototype.destroy=function(){this.media_info_=null,this.pes_slice_queues_=null,this.section_slice_queues_=null,this.video_metadata_=null,this.audio_metadata_=null,this.aac_last_incomplete_data_=null,this.video_track_=null,this.audio_track_=null,_.prototype.destroy.call(this)},y.probe=function(v){var m=new Uint8Array(v),S=-1,N=188;if(m.byteLength<=3*N)return{needMoreData:!0};for(;S===-1;){for(var M=Math.min(1e3,m.byteLength-3*N),U=0;U<M;){if(m[U]===71&&m[U+N]===71&&m[U+2*N]===71){S=U;break}U++}if(S===-1)if(N===188)N=192;else{if(N!==192)break;N=204}}return S===-1?{match:!1}:(N===192&&S>=4?(o.a.v("TSDemuxer","ts_packet_size = 192, m2ts mode"),S-=4):N===204&&o.a.v("TSDemuxer","ts_packet_size = 204, RS encoded MPEG2-TS stream"),{match:!0,consumed:0,ts_packet_size:N,sync_offset:S})},y.prototype.bindDataSource=function(v){return v.onDataArrival=this.parseChunks.bind(this),this},y.prototype.resetMediaInfo=function(){this.media_info_=new l.a},y.prototype.parseChunks=function(v,m){if(!(this.onError&&this.onMediaInfo&&this.onTrackMetadata&&this.onDataAvailable))throw new h.a("onError & onMediaInfo & onTrackMetadata & onDataAvailable callback must be specified");var S=0;for(this.first_parse_&&(this.first_parse_=!1,S=this.sync_offset_);S+this.ts_packet_size_<=v.byteLength;){var N=m+S;this.ts_packet_size_===192&&(S+=4);var M=new Uint8Array(v,S,188),U=M[0];if(U!==71){o.a.e(this.TAG,"sync_byte = "+U+", not 0x47");break}var W=(64&M[1])>>>6,K=(M[1],(31&M[1])<<8|M[2]),q=(48&M[3])>>>4,J=15&M[3],Y={},X=4;if(q==2||q==3){var st=M[4];if(5+st===188){S+=188,this.ts_packet_size_===204&&(S+=16);continue}st>0&&(Y=this.parseAdaptationField(v,S+4,1+st)),X=5+st}if(q==1||q==3){if(K===0||K===this.current_pmt_pid_||this.pmt_!=null&&this.pmt_.pid_stream_type[K]===A.kSCTE35){var ht=188-X;this.handleSectionSlice(v,S+X,ht,{pid:K,file_position:N,payload_unit_start_indicator:W,continuity_conunter:J,random_access_indicator:Y.random_access_indicator})}else if(this.pmt_!=null&&this.pmt_.pid_stream_type[K]!=null){ht=188-X;var ot=this.pmt_.pid_stream_type[K];K!==this.pmt_.common_pids.h264&&K!==this.pmt_.common_pids.h265&&K!==this.pmt_.common_pids.adts_aac&&K!==this.pmt_.common_pids.mp3&&this.pmt_.pes_private_data_pids[K]!==!0&&this.pmt_.timed_id3_pids[K]!==!0||this.handlePESSlice(v,S+X,ht,{pid:K,stream_type:ot,file_position:N,payload_unit_start_indicator:W,continuity_conunter:J,random_access_indicator:Y.random_access_indicator})}}S+=188,this.ts_packet_size_===204&&(S+=16)}return this.dispatchAudioVideoMediaSegment(),S},y.prototype.parseAdaptationField=function(v,m,S){var N=new Uint8Array(v,m,S),M=N[0];return M>0?M>183?(o.a.w(this.TAG,"Illegal adaptation_field_length: "+M),{}):{discontinuity_indicator:(128&N[1])>>>7,random_access_indicator:(64&N[1])>>>6,elementary_stream_priority_indicator:(32&N[1])>>>5}:{}},y.prototype.handleSectionSlice=function(v,m,S,N){var M=new Uint8Array(v,m,S),U=this.section_slice_queues_[N.pid];if(N.payload_unit_start_indicator){var W=M[0];if(U!=null&&U.total_length!==0){var K=new Uint8Array(v,m+1,Math.min(S,W));U.slices.push(K),U.total_length+=K.byteLength,U.total_length===U.expected_length?this.emitSectionSlices(U,N):this.clearSlices(U,N)}for(var q=1+W;q<M.byteLength&&M[q+0]!==255;){var J=(15&M[q+1])<<8|M[q+2];this.section_slice_queues_[N.pid]=new z,(U=this.section_slice_queues_[N.pid]).expected_length=J+3,U.file_position=N.file_position,U.random_access_indicator=N.random_access_indicator,K=new Uint8Array(v,m+q,Math.min(S-q,U.expected_length-U.total_length)),U.slices.push(K),U.total_length+=K.byteLength,U.total_length===U.expected_length?this.emitSectionSlices(U,N):U.total_length>=U.expected_length&&this.clearSlices(U,N),q+=K.byteLength}}else U!=null&&U.total_length!==0&&(K=new Uint8Array(v,m,Math.min(S,U.expected_length-U.total_length)),U.slices.push(K),U.total_length+=K.byteLength,U.total_length===U.expected_length?this.emitSectionSlices(U,N):U.total_length>=U.expected_length&&this.clearSlices(U,N))},y.prototype.handlePESSlice=function(v,m,S,N){var M=new Uint8Array(v,m,S),U=M[0]<<16|M[1]<<8|M[2],W=(M[3],M[4]<<8|M[5]);if(N.payload_unit_start_indicator){if(U!==1)return void o.a.e(this.TAG,"handlePESSlice: packet_start_code_prefix should be 1 but with value "+U);var K=this.pes_slice_queues_[N.pid];K&&(K.expected_length===0||K.expected_length===K.total_length?this.emitPESSlices(K,N):this.clearSlices(K,N)),this.pes_slice_queues_[N.pid]=new z,this.pes_slice_queues_[N.pid].file_position=N.file_position,this.pes_slice_queues_[N.pid].random_access_indicator=N.random_access_indicator}if(this.pes_slice_queues_[N.pid]!=null){var q=this.pes_slice_queues_[N.pid];q.slices.push(M),N.payload_unit_start_indicator&&(q.expected_length=W===0?0:W+6),q.total_length+=M.byteLength,q.expected_length>0&&q.expected_length===q.total_length?this.emitPESSlices(q,N):q.expected_length>0&&q.expected_length<q.total_length&&this.clearSlices(q,N)}},y.prototype.emitSectionSlices=function(v,m){for(var S=new Uint8Array(v.total_length),N=0,M=0;N<v.slices.length;N++){var U=v.slices[N];S.set(U,M),M+=U.byteLength}v.slices=[],v.expected_length=-1,v.total_length=0;var W=new Q;W.pid=m.pid,W.data=S,W.file_position=v.file_position,W.random_access_indicator=v.random_access_indicator,this.parseSection(W)},y.prototype.emitPESSlices=function(v,m){for(var S=new Uint8Array(v.total_length),N=0,M=0;N<v.slices.length;N++){var U=v.slices[N];S.set(U,M),M+=U.byteLength}v.slices=[],v.expected_length=-1,v.total_length=0;var W=new V;W.pid=m.pid,W.data=S,W.stream_type=m.stream_type,W.file_position=v.file_position,W.random_access_indicator=v.random_access_indicator,this.parsePES(W)},y.prototype.clearSlices=function(v,m){v.slices=[],v.expected_length=-1,v.total_length=0},y.prototype.parseSection=function(v){var m=v.data,S=v.pid;S===0?this.parsePAT(m):S===this.current_pmt_pid_?this.parsePMT(m):this.pmt_!=null&&this.pmt_.scte_35_pids[S]&&this.parseSCTE35(m)},y.prototype.parsePES=function(v){var m=v.data,S=m[0]<<16|m[1]<<8|m[2],N=m[3],M=m[4]<<8|m[5];if(S===1)if(N!==188&&N!==190&&N!==191&&N!==240&&N!==241&&N!==255&&N!==242&&N!==248){m[6];var U=(192&m[7])>>>6,W=m[8],K=void 0,q=void 0;U!==2&&U!==3||(K=536870912*(14&m[9])+4194304*(255&m[10])+16384*(254&m[11])+128*(255&m[12])+(254&m[13])/2,q=U===3?536870912*(14&m[14])+4194304*(255&m[15])+16384*(254&m[16])+128*(255&m[17])+(254&m[18])/2:K);var J=9+W,Y=void 0;if(M!==0){if(M<3+W)return void o.a.v(this.TAG,"Malformed PES: PES_packet_length < 3 + PES_header_data_length");Y=M-3-W}else Y=m.byteLength-J;var X=m.subarray(J,J+Y);switch(v.stream_type){case A.kMPEG1Audio:case A.kMPEG2Audio:this.parseMP3Payload(X,K);break;case A.kPESPrivateData:this.pmt_.smpte2038_pids[v.pid]?this.parseSMPTE2038MetadataPayload(X,K,q,v.pid,N):this.parsePESPrivateDataPayload(X,K,q,v.pid,N);break;case A.kADTSAAC:this.parseAACPayload(X,K);break;case A.kID3:this.parseTimedID3MetadataPayload(X,K,q,v.pid,N);break;case A.kH264:this.parseH264Payload(X,K,q,v.file_position,v.random_access_indicator);break;case A.kH265:this.parseH265Payload(X,K,q,v.file_position,v.random_access_indicator)}}else(N===188||N===191||N===240||N===241||N===255||N===242||N===248)&&v.stream_type===A.kPESPrivateData&&(J=6,Y=void 0,Y=M!==0?M:m.byteLength-J,X=m.subarray(J,J+Y),this.parsePESPrivateDataPayload(X,void 0,void 0,v.pid,N));else o.a.e(this.TAG,"parsePES: packet_start_code_prefix should be 1 but with value "+S)},y.prototype.parsePAT=function(v){var m=v[0];if(m===0){var S=(15&v[1])<<8|v[2],N=(v[3],v[4],(62&v[5])>>>1),M=1&v[5],U=v[6],W=(v[7],null);if(M===1&&U===0)(W=new j).version_number=N;else if((W=this.pat_)==null)return;for(var K=S-5-4,q=-1,J=-1,Y=8;Y<8+K;Y+=4){var X=v[Y]<<8|v[Y+1],st=(31&v[Y+2])<<8|v[Y+3];X===0?W.network_pid=st:(W.program_pmt_pid[X]=st,q===-1&&(q=X),J===-1&&(J=st))}M===1&&U===0&&(this.pat_==null&&o.a.v(this.TAG,"Parsed first PAT: "+JSON.stringify(W)),this.pat_=W,this.current_program_=q,this.current_pmt_pid_=J)}else o.a.e(this.TAG,"parsePAT: table_id "+m+" is not corresponded to PAT!")},y.prototype.parsePMT=function(v){var m=v[0];if(m===2){var S=(15&v[1])<<8|v[2],N=v[3]<<8|v[4],M=(62&v[5])>>>1,U=1&v[5],W=v[6],K=(v[7],null);if(U===1&&W===0)(K=new $).program_number=N,K.version_number=M,this.program_pmt_map_[N]=K;else if((K=this.program_pmt_map_[N])==null)return;v[8],v[9];for(var q=(15&v[10])<<8|v[11],J=12+q,Y=S-9-q-4,X=J;X<J+Y;){var st=v[X],ht=(31&v[X+1])<<8|v[X+2],ot=(15&v[X+3])<<8|v[X+4];if(K.pid_stream_type[ht]=st,st!==A.kH264||K.common_pids.h264||K.common_pids.h265)if(st!==A.kH265||K.common_pids.h264||K.common_pids.h265)if(st!==A.kADTSAAC||K.common_pids.adts_aac)if(st!==A.kMPEG1Audio&&st!==A.kMPEG2Audio||K.common_pids.mp3)if(st===A.kPESPrivateData){if(K.pes_private_data_pids[ht]=!0,ot>0){for(var gt=X+5;gt<X+5+ot;){var yt=v[gt+0],ft=v[gt+1];yt===5&&String.fromCharCode.apply(String,Array.from(v.subarray(gt+2,gt+2+ft)))==="VANC"&&(K.smpte2038_pids[ht]=!0),gt+=2+ft}var Rt=v.subarray(X+5,X+5+ot);this.dispatchPESPrivateDataDescriptor(ht,st,Rt)}}else st===A.kID3?K.timed_id3_pids[ht]=!0:st===A.kSCTE35&&(K.scte_35_pids[ht]=!0);else K.common_pids.mp3=ht;else K.common_pids.adts_aac=ht;else K.common_pids.h265=ht;else K.common_pids.h264=ht;X+=5+ot}N===this.current_program_&&(this.pmt_==null&&o.a.v(this.TAG,"Parsed first PMT: "+JSON.stringify(K)),this.pmt_=K,(K.common_pids.h264||K.common_pids.h265)&&(this.has_video_=!0),(K.common_pids.adts_aac||K.common_pids.mp3)&&(this.has_audio_=!0))}else o.a.e(this.TAG,"parsePMT: table_id "+m+" is not corresponded to PMT!")},y.prototype.parseSCTE35=function(v){var m=ge(v);if(m.pts!=null){var S=Math.floor(m.pts/this.timescale_);m.pts=S}else m.nearest_pts=this.aac_last_sample_pts_;this.onSCTE35Metadata&&this.onSCTE35Metadata(m)},y.prototype.parseH264Payload=function(v,m,S,N,M){for(var U=new et(v),W=null,K=[],q=0,J=!1;(W=U.readNextNaluPayload())!=null;){var Y=new G(W);if(Y.type===F.kSliceSPS){var X=E.parseSPS(W.data);this.video_init_segment_dispatched_?this.detectVideoMetadataChange(Y,X)===!0&&(o.a.v(this.TAG,"H264: Critical h264 metadata has been changed, attempt to re-generate InitSegment"),this.video_metadata_changed_=!0,this.video_metadata_={vps:void 0,sps:Y,pps:void 0,details:X}):(this.video_metadata_.sps=Y,this.video_metadata_.details=X)}else Y.type===F.kSlicePPS?this.video_init_segment_dispatched_&&!this.video_metadata_changed_||(this.video_metadata_.pps=Y,this.video_metadata_.sps&&this.video_metadata_.pps&&(this.video_metadata_changed_&&this.dispatchVideoMediaSegment(),this.dispatchVideoInitSegment())):(Y.type===F.kSliceIDR||Y.type===F.kSliceNonIDR&&M===1)&&(J=!0);this.video_init_segment_dispatched_&&(K.push(Y),q+=Y.data.byteLength)}var st=Math.floor(m/this.timescale_),ht=Math.floor(S/this.timescale_);if(K.length){var ot=this.video_track_,gt={units:K,length:q,isKeyframe:J,dts:ht,pts:st,cts:st-ht,file_position:N};ot.samples.push(gt),ot.length+=q}},y.prototype.parseH265Payload=function(v,m,S,N,M){for(var U=new Ye(v),W=null,K=[],q=0,J=!1;(W=U.readNextNaluPayload())!=null;){var Y=new ti(W);if(Y.type===ct.kSliceVPS){if(!this.video_init_segment_dispatched_){var X=O.parseVPS(W.data);this.video_metadata_.vps=Y,this.video_metadata_.details=Ce(Ce({},this.video_metadata_.details),X)}}else Y.type===ct.kSliceSPS?(X=O.parseSPS(W.data),this.video_init_segment_dispatched_?this.detectVideoMetadataChange(Y,X)===!0&&(o.a.v(this.TAG,"H265: Critical h265 metadata has been changed, attempt to re-generate InitSegment"),this.video_metadata_changed_=!0,this.video_metadata_={vps:void 0,sps:Y,pps:void 0,details:X}):(this.video_metadata_.sps=Y,this.video_metadata_.details=Ce(Ce({},this.video_metadata_.details),X))):Y.type===ct.kSlicePPS?(!this.video_init_segment_dispatched_||this.video_metadata_changed_)&&(X=O.parsePPS(W.data),this.video_metadata_.pps=Y,this.video_metadata_.details=Ce(Ce({},this.video_metadata_.details),X),this.video_metadata_.vps&&this.video_metadata_.sps&&this.video_metadata_.pps&&(this.video_metadata_changed_&&this.dispatchVideoMediaSegment(),this.dispatchVideoInitSegment())):Y.type!==ct.kSliceIDR_W_RADL&&Y.type!==ct.kSliceIDR_N_LP&&Y.type!==ct.kSliceCRA_NUT||(J=!0);this.video_init_segment_dispatched_&&(K.push(Y),q+=Y.data.byteLength)}var st=Math.floor(m/this.timescale_),ht=Math.floor(S/this.timescale_);if(K.length){var ot=this.video_track_,gt={units:K,length:q,isKeyframe:J,dts:ht,pts:st,cts:st-ht,file_position:N};ot.samples.push(gt),ot.length+=q}},y.prototype.detectVideoMetadataChange=function(v,m){if(m.codec_mimetype!==this.video_metadata_.details.codec_mimetype)return o.a.v(this.TAG,"Video: Codec mimeType changed from "+this.video_metadata_.details.codec_mimetype+" to "+m.codec_mimetype),!0;if(m.codec_size.width!==this.video_metadata_.details.codec_size.width||m.codec_size.height!==this.video_metadata_.details.codec_size.height){var S=this.video_metadata_.details.codec_size,N=m.codec_size;return o.a.v(this.TAG,"Video: Coded Resolution changed from "+S.width+"x"+S.height+" to "+N.width+"x"+N.height),!0}return m.present_size.width!==this.video_metadata_.details.present_size.width&&(o.a.v(this.TAG,"Video: Present resolution width changed from "+this.video_metadata_.details.present_size.width+" to "+m.present_size.width),!0)},y.prototype.isInitSegmentDispatched=function(){return this.has_video_&&this.has_audio_?this.video_init_segment_dispatched_&&this.audio_init_segment_dispatched_:this.has_video_&&!this.has_audio_?this.video_init_segment_dispatched_:!(this.has_video_||!this.has_audio_)&&this.audio_init_segment_dispatched_},y.prototype.dispatchVideoInitSegment=function(){var v=this.video_metadata_.details,m={type:"video"};m.id=this.video_track_.id,m.timescale=1e3,m.duration=this.duration_,m.codecWidth=v.codec_size.width,m.codecHeight=v.codec_size.height,m.presentWidth=v.present_size.width,m.presentHeight=v.present_size.height,m.profile=v.profile_string,m.level=v.level_string,m.bitDepth=v.bit_depth,m.chromaFormat=v.chroma_format,m.sarRatio=v.sar_ratio,m.frameRate=v.frame_rate;var S=m.frameRate.fps_den,N=m.frameRate.fps_num;if(m.refSampleDuration=S/N*1e3,m.codec=v.codec_mimetype,this.video_metadata_.vps){var M=this.video_metadata_.vps.data.subarray(4),U=this.video_metadata_.sps.data.subarray(4),W=this.video_metadata_.pps.data.subarray(4),K=new Hi(M,U,W,v);m.hvcc=K.getData(),this.video_init_segment_dispatched_==0&&o.a.v(this.TAG,"Generated first HEVCDecoderConfigurationRecord for mimeType: "+m.codec)}else{U=this.video_metadata_.sps.data.subarray(4),W=this.video_metadata_.pps.data.subarray(4);var q=new rt(U,W,v);m.avcc=q.getData(),this.video_init_segment_dispatched_==0&&o.a.v(this.TAG,"Generated first AVCDecoderConfigurationRecord for mimeType: "+m.codec)}this.onTrackMetadata("video",m),this.video_init_segment_dispatched_=!0,this.video_metadata_changed_=!1;var J=this.media_info_;J.hasVideo=!0,J.width=m.codecWidth,J.height=m.codecHeight,J.fps=m.frameRate.fps,J.profile=m.profile,J.level=m.level,J.refFrames=v.ref_frames,J.chromaFormat=v.chroma_format_string,J.sarNum=m.sarRatio.width,J.sarDen=m.sarRatio.height,J.videoCodec=m.codec,J.hasAudio&&J.audioCodec?J.mimeType='video/mp2t; codecs="'+J.videoCodec+","+J.audioCodec+'"':J.mimeType='video/mp2t; codecs="'+J.videoCodec+'"',J.isComplete()&&this.onMediaInfo(J)},y.prototype.dispatchVideoMediaSegment=function(){this.isInitSegmentDispatched()&&this.video_track_.length&&this.onDataAvailable(null,this.video_track_)},y.prototype.dispatchAudioMediaSegment=function(){this.isInitSegmentDispatched()&&this.audio_track_.length&&this.onDataAvailable(this.audio_track_,null)},y.prototype.dispatchAudioVideoMediaSegment=function(){this.isInitSegmentDispatched()&&(this.audio_track_.length||this.video_track_.length)&&this.onDataAvailable(this.audio_track_,this.video_track_)},y.prototype.parseAACPayload=function(v,m){if(!this.has_video_||this.video_init_segment_dispatched_){if(this.aac_last_incomplete_data_){var S=new Uint8Array(v.byteLength+this.aac_last_incomplete_data_.byteLength);S.set(this.aac_last_incomplete_data_,0),S.set(v,this.aac_last_incomplete_data_.byteLength),v=S}var N,M;if(m!=null&&(M=m/this.timescale_),this.audio_metadata_.codec==="aac"){if(m==null&&this.aac_last_sample_pts_!=null)N=1024/this.audio_metadata_.sampling_frequency*1e3,M=this.aac_last_sample_pts_+N;else if(m==null)return void o.a.w(this.TAG,"AAC: Unknown pts");if(this.aac_last_incomplete_data_&&this.aac_last_sample_pts_){N=1024/this.audio_metadata_.sampling_frequency*1e3;var U=this.aac_last_sample_pts_+N;Math.abs(U-M)>1&&(o.a.w(this.TAG,"AAC: Detected pts overlapped, expected: "+U+"ms, PES pts: "+M+"ms"),M=U)}}for(var W,K=new xt(v),q=null,J=M;(q=K.readNextAACFrame())!=null;){N=1024/q.sampling_frequency*1e3;var Y={codec:"aac",data:q};this.audio_init_segment_dispatched_==0?(this.audio_metadata_={codec:"aac",audio_object_type:q.audio_object_type,sampling_freq_index:q.sampling_freq_index,sampling_frequency:q.sampling_frequency,channel_config:q.channel_config},this.dispatchAudioInitSegment(Y)):this.detectAudioMetadataChange(Y)&&(this.dispatchAudioMediaSegment(),this.dispatchAudioInitSegment(Y)),W=J;var X=Math.floor(J),st={unit:q.data,length:q.data.byteLength,pts:X,dts:X};this.audio_track_.samples.push(st),this.audio_track_.length+=q.data.byteLength,J+=N}K.hasIncompleteData()&&(this.aac_last_incomplete_data_=K.getIncompleteData()),W&&(this.aac_last_sample_pts_=W)}},y.prototype.parseMP3Payload=function(v,m){if(!this.has_video_||this.video_init_segment_dispatched_){var S=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],N=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],M=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],U=v[1]>>>3&3,W=(6&v[1])>>1,K=(240&v[2])>>>4,q=(12&v[2])>>>2,J=(v[3]>>>6&3)!==3?2:1,Y=0,X=34;switch(U){case 0:Y=[11025,12e3,8e3,0][q];break;case 2:Y=[22050,24e3,16e3,0][q];break;case 3:Y=[44100,48e3,32e3,0][q]}switch(W){case 1:X=34,K<M.length&&M[K];break;case 2:X=33,K<N.length&&N[K];break;case 3:X=32,K<S.length&&S[K]}var st=new Wi;st.object_type=X,st.sample_rate=Y,st.channel_count=J,st.data=v;var ht={codec:"mp3",data:st};this.audio_init_segment_dispatched_==0?(this.audio_metadata_={codec:"mp3",object_type:X,sample_rate:Y,channel_count:J},this.dispatchAudioInitSegment(ht)):this.detectAudioMetadataChange(ht)&&(this.dispatchAudioMediaSegment(),this.dispatchAudioInitSegment(ht));var ot={unit:v,length:v.byteLength,pts:m/this.timescale_,dts:m/this.timescale_};this.audio_track_.samples.push(ot),this.audio_track_.length+=v.byteLength}},y.prototype.detectAudioMetadataChange=function(v){if(v.codec!==this.audio_metadata_.codec)return o.a.v(this.TAG,"Audio: Audio Codecs changed from "+this.audio_metadata_.codec+" to "+v.codec),!0;if(v.codec==="aac"&&this.audio_metadata_.codec==="aac"){var m=v.data;if(m.audio_object_type!==this.audio_metadata_.audio_object_type)return o.a.v(this.TAG,"AAC: AudioObjectType changed from "+this.audio_metadata_.audio_object_type+" to "+m.audio_object_type),!0;if(m.sampling_freq_index!==this.audio_metadata_.sampling_freq_index)return o.a.v(this.TAG,"AAC: SamplingFrequencyIndex changed from "+this.audio_metadata_.sampling_freq_index+" to "+m.sampling_freq_index),!0;if(m.channel_config!==this.audio_metadata_.channel_config)return o.a.v(this.TAG,"AAC: Channel configuration changed from "+this.audio_metadata_.channel_config+" to "+m.channel_config),!0}else if(v.codec==="mp3"&&this.audio_metadata_.codec==="mp3"){var S=v.data;if(S.object_type!==this.audio_metadata_.object_type)return o.a.v(this.TAG,"MP3: AudioObjectType changed from "+this.audio_metadata_.object_type+" to "+S.object_type),!0;if(S.sample_rate!==this.audio_metadata_.sample_rate)return o.a.v(this.TAG,"MP3: SamplingFrequencyIndex changed from "+this.audio_metadata_.sample_rate+" to "+S.sample_rate),!0;if(S.channel_count!==this.audio_metadata_.channel_count)return o.a.v(this.TAG,"MP3: Channel count changed from "+this.audio_metadata_.channel_count+" to "+S.channel_count),!0}return!1},y.prototype.dispatchAudioInitSegment=function(v){var m={type:"audio"};if(m.id=this.audio_track_.id,m.timescale=1e3,m.duration=this.duration_,this.audio_metadata_.codec==="aac"){var S=v.data,N=new it(S);m.audioSampleRate=N.sampling_rate,m.channelCount=N.channel_count,m.codec=N.codec_mimetype,m.originalCodec=N.original_codec_mimetype,m.config=N.config}else this.audio_metadata_.codec==="mp3"&&(m.audioSampleRate=this.audio_metadata_.sample_rate,m.channelCount=this.audio_metadata_.channel_count,m.codec="mp3",m.originalCodec="mp3",m.config=void 0);m.refSampleDuration=1024/m.audioSampleRate*m.timescale,this.audio_init_segment_dispatched_==0&&o.a.v(this.TAG,"Generated first AudioSpecificConfig for mimeType: "+m.codec),this.onTrackMetadata("audio",m),this.audio_init_segment_dispatched_=!0,this.video_metadata_changed_=!1;var M=this.media_info_;M.hasAudio=!0,M.audioCodec=m.originalCodec,M.audioSampleRate=m.audioSampleRate,M.audioChannelCount=m.channelCount,M.hasVideo&&M.videoCodec?M.mimeType='video/mp2t; codecs="'+M.videoCodec+","+M.audioCodec+'"':M.mimeType='video/mp2t; codecs="'+M.audioCodec+'"',M.isComplete()&&this.onMediaInfo(M)},y.prototype.dispatchPESPrivateDataDescriptor=function(v,m,S){var N=new lt;N.pid=v,N.stream_type=m,N.descriptor=S,this.onPESPrivateDataDescriptor&&this.onPESPrivateDataDescriptor(N)},y.prototype.parsePESPrivateDataPayload=function(v,m,S,N,M){var U=new at;if(U.pid=N,U.stream_id=M,U.len=v.byteLength,U.data=v,m!=null){var W=Math.floor(m/this.timescale_);U.pts=W}else U.nearest_pts=this.aac_last_sample_pts_;if(S!=null){var K=Math.floor(S/this.timescale_);U.dts=K}this.onPESPrivateData&&this.onPESPrivateData(U)},y.prototype.parseTimedID3MetadataPayload=function(v,m,S,N,M){var U=new at;if(U.pid=N,U.stream_id=M,U.len=v.byteLength,U.data=v,m!=null){var W=Math.floor(m/this.timescale_);U.pts=W}if(S!=null){var K=Math.floor(S/this.timescale_);U.dts=K}this.onTimedID3Metadata&&this.onTimedID3Metadata(U)},y.prototype.parseSMPTE2038MetadataPayload=function(v,m,S,N,M){var U=new Ki;if(U.pid=N,U.stream_id=M,U.len=v.byteLength,U.data=v,m!=null){var W=Math.floor(m/this.timescale_);U.pts=W}if(U.nearest_pts=this.aac_last_sample_pts_,S!=null){var K=Math.floor(S/this.timescale_);U.dts=K}U.ancillaries=function(q){for(var J=new x(q),Y=0,X=[];Y+=6,J.readBits(6)===0;){var st=J.readBool();Y+=1;var ht=J.readBits(11);Y+=11;var ot=J.readBits(12);Y+=12;var gt=255&J.readBits(10);Y+=10;var yt=255&J.readBits(10);Y+=10;var ft=255&J.readBits(10);Y+=10;for(var Rt=new Uint8Array(ft),pt=0;pt<ft;pt++){var ut=255&J.readBits(10);Y+=10,Rt[pt]=ut}J.readBits(10),Y+=10;var St="User Defined";gt===65?yt===7&&(St="SCTE-104"):gt===95?yt===220?St="ARIB STD-B37 (1SEG)":yt===221?St="ARIB STD-B37 (ANALOG)":yt===222?St="ARIB STD-B37 (SD)":yt===223&&(St="ARIB STD-B37 (HD)"):gt===97&&(yt===1?St="EIA-708":yt===2&&(St="EIA-608")),X.push({yc_indicator:st,line_number:ht,horizontal_offset:ot,did:gt,sdid:yt,user_data:Rt,description:St,information:{}}),J.readBits(8-(Y-Math.floor(Y/8))%8),Y+=(8-(Y-Math.floor(Y/8)))%8}return J.destroy(),J=null,X}(v),this.onSMPTE2038Metadata&&this.onSMPTE2038Metadata(U)},y}(I),xi=function(){function _(){}return _.init=function(){for(var y in _.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],hvc1:[],hvcC:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[],".mp3":[]},_.types)_.types.hasOwnProperty(y)&&(_.types[y]=[y.charCodeAt(0),y.charCodeAt(1),y.charCodeAt(2),y.charCodeAt(3)]);var v=_.constants={};v.FTYP=new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]),v.STSD_PREFIX=new Uint8Array([0,0,0,0,0,0,0,1]),v.STTS=new Uint8Array([0,0,0,0,0,0,0,0]),v.STSC=v.STCO=v.STTS,v.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),v.HDLR_VIDEO=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),v.HDLR_AUDIO=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),v.DREF=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),v.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),v.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])},_.box=function(y){for(var v=8,m=null,S=Array.prototype.slice.call(arguments,1),N=S.length,M=0;M<N;M++)v+=S[M].byteLength;(m=new Uint8Array(v))[0]=v>>>24&255,m[1]=v>>>16&255,m[2]=v>>>8&255,m[3]=255&v,m.set(y,4);var U=8;for(M=0;M<N;M++)m.set(S[M],U),U+=S[M].byteLength;return m},_.generateInitSegment=function(y){var v=_.box(_.types.ftyp,_.constants.FTYP),m=_.moov(y),S=new Uint8Array(v.byteLength+m.byteLength);return S.set(v,0),S.set(m,v.byteLength),S},_.moov=function(y){var v=_.mvhd(y.timescale,y.duration),m=_.trak(y),S=_.mvex(y);return _.box(_.types.moov,v,m,S)},_.mvhd=function(y,v){return _.box(_.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,y>>>24&255,y>>>16&255,y>>>8&255,255&y,v>>>24&255,v>>>16&255,v>>>8&255,255&v,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]))},_.trak=function(y){return _.box(_.types.trak,_.tkhd(y),_.mdia(y))},_.tkhd=function(y){var v=y.id,m=y.duration,S=y.presentWidth,N=y.presentHeight;return _.box(_.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,v>>>24&255,v>>>16&255,v>>>8&255,255&v,0,0,0,0,m>>>24&255,m>>>16&255,m>>>8&255,255&m,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,S>>>8&255,255&S,0,0,N>>>8&255,255&N,0,0]))},_.mdia=function(y){return _.box(_.types.mdia,_.mdhd(y),_.hdlr(y),_.minf(y))},_.mdhd=function(y){var v=y.timescale,m=y.duration;return _.box(_.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,v>>>24&255,v>>>16&255,v>>>8&255,255&v,m>>>24&255,m>>>16&255,m>>>8&255,255&m,85,196,0,0]))},_.hdlr=function(y){var v=null;return v=y.type==="audio"?_.constants.HDLR_AUDIO:_.constants.HDLR_VIDEO,_.box(_.types.hdlr,v)},_.minf=function(y){var v=null;return v=y.type==="audio"?_.box(_.types.smhd,_.constants.SMHD):_.box(_.types.vmhd,_.constants.VMHD),_.box(_.types.minf,v,_.dinf(),_.stbl(y))},_.dinf=function(){return _.box(_.types.dinf,_.box(_.types.dref,_.constants.DREF))},_.stbl=function(y){return _.box(_.types.stbl,_.stsd(y),_.box(_.types.stts,_.constants.STTS),_.box(_.types.stsc,_.constants.STSC),_.box(_.types.stsz,_.constants.STSZ),_.box(_.types.stco,_.constants.STCO))},_.stsd=function(y){return y.type==="audio"?y.codec==="mp3"?_.box(_.types.stsd,_.constants.STSD_PREFIX,_.mp3(y)):_.box(_.types.stsd,_.constants.STSD_PREFIX,_.mp4a(y)):y.type==="video"&&y.codec.startsWith("hvc1")?_.box(_.types.stsd,_.constants.STSD_PREFIX,_.hvc1(y)):_.box(_.types.stsd,_.constants.STSD_PREFIX,_.avc1(y))},_.mp3=function(y){var v=y.channelCount,m=y.audioSampleRate,S=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,v,0,16,0,0,0,0,m>>>8&255,255&m,0,0]);return _.box(_.types[".mp3"],S)},_.mp4a=function(y){var v=y.channelCount,m=y.audioSampleRate,S=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,v,0,16,0,0,0,0,m>>>8&255,255&m,0,0]);return _.box(_.types.mp4a,S,_.esds(y))},_.esds=function(y){var v=y.config||[],m=v.length,S=new Uint8Array([0,0,0,0,3,23+m,0,1,0,4,15+m,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([m]).concat(v).concat([6,1,2]));return _.box(_.types.esds,S)},_.avc1=function(y){var v=y.avcc,m=y.codecWidth,S=y.codecHeight,N=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,m>>>8&255,255&m,S>>>8&255,255&S,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return _.box(_.types.avc1,N,_.box(_.types.avcC,v))},_.hvc1=function(y){var v=y.hvcc,m=y.codecWidth,S=y.codecHeight,N=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,m>>>8&255,255&m,S>>>8&255,255&S,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return _.box(_.types.hvc1,N,_.box(_.types.hvcC,v))},_.mvex=function(y){return _.box(_.types.mvex,_.trex(y))},_.trex=function(y){var v=y.id,m=new Uint8Array([0,0,0,0,v>>>24&255,v>>>16&255,v>>>8&255,255&v,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return _.box(_.types.trex,m)},_.moof=function(y,v){return _.box(_.types.moof,_.mfhd(y.sequenceNumber),_.traf(y,v))},_.mfhd=function(y){var v=new Uint8Array([0,0,0,0,y>>>24&255,y>>>16&255,y>>>8&255,255&y]);return _.box(_.types.mfhd,v)},_.traf=function(y,v){var m=y.id,S=_.box(_.types.tfhd,new Uint8Array([0,0,0,0,m>>>24&255,m>>>16&255,m>>>8&255,255&m])),N=_.box(_.types.tfdt,new Uint8Array([0,0,0,0,v>>>24&255,v>>>16&255,v>>>8&255,255&v])),M=_.sdtp(y),U=_.trun(y,M.byteLength+16+16+8+16+8+8);return _.box(_.types.traf,S,N,U,M)},_.sdtp=function(y){for(var v=y.samples||[],m=v.length,S=new Uint8Array(4+m),N=0;N<m;N++){var M=v[N].flags;S[N+4]=M.isLeading<<6|M.dependsOn<<4|M.isDependedOn<<2|M.hasRedundancy}return _.box(_.types.sdtp,S)},_.trun=function(y,v){var m=y.samples||[],S=m.length,N=12+16*S,M=new Uint8Array(N);v+=8+N,M.set([0,0,15,1,S>>>24&255,S>>>16&255,S>>>8&255,255&S,v>>>24&255,v>>>16&255,v>>>8&255,255&v],0);for(var U=0;U<S;U++){var W=m[U].duration,K=m[U].size,q=m[U].flags,J=m[U].cts;M.set([W>>>24&255,W>>>16&255,W>>>8&255,255&W,K>>>24&255,K>>>16&255,K>>>8&255,255&K,q.isLeading<<2|q.dependsOn,q.isDependedOn<<6|q.hasRedundancy<<4|q.isNonSync,0,0,J>>>24&255,J>>>16&255,J>>>8&255,255&J],12+16*U)}return _.box(_.types.trun,M)},_.mdat=function(y){return _.box(_.types.mdat,y)},_}();xi.init();var Ue=xi,Ei=function(){function _(){}return _.getSilentFrame=function(y,v){if(y==="mp4a.40.2"){if(v===1)return new Uint8Array([0,200,0,128,35,128]);if(v===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(v===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(v===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(v===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(v===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(v===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(v===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(v===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},_}(),ye=r(7),kt=function(){function _(y){this.TAG="MP4Remuxer",this._config=y,this._isLive=y.isLive===!0,this._dtsBase=-1,this._dtsBaseInited=!1,this._audioDtsBase=1/0,this._videoDtsBase=1/0,this._audioNextDts=void 0,this._videoNextDts=void 0,this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList=new ye.c("audio"),this._videoSegmentInfoList=new ye.c("video"),this._onInitSegment=null,this._onMediaSegment=null,this._forceFirstIDR=!(!a.a.chrome||!(a.a.version.major<50||a.a.version.major===50&&a.a.version.build<2661)),this._fillSilentAfterSeek=a.a.msedge||a.a.msie,this._mp3UseMpegAudio=!a.a.firefox,this._fillAudioTimestampGap=this._config.fixAudioTimestampGap}return _.prototype.destroy=function(){this._dtsBase=-1,this._dtsBaseInited=!1,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList.clear(),this._audioSegmentInfoList=null,this._videoSegmentInfoList.clear(),this._videoSegmentInfoList=null,this._onInitSegment=null,this._onMediaSegment=null},_.prototype.bindDataSource=function(y){return y.onDataAvailable=this.remux.bind(this),y.onTrackMetadata=this._onTrackMetadataReceived.bind(this),this},Object.defineProperty(_.prototype,"onInitSegment",{get:function(){return this._onInitSegment},set:function(y){this._onInitSegment=y},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"onMediaSegment",{get:function(){return this._onMediaSegment},set:function(y){this._onMediaSegment=y},enumerable:!1,configurable:!0}),_.prototype.insertDiscontinuity=function(){this._audioNextDts=this._videoNextDts=void 0},_.prototype.seek=function(y){this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._videoSegmentInfoList.clear(),this._audioSegmentInfoList.clear()},_.prototype.remux=function(y,v){if(!this._onMediaSegment)throw new h.a("MP4Remuxer: onMediaSegment callback must be specificed!");this._dtsBaseInited||this._calculateDtsBase(y,v),v&&this._remuxVideo(v),y&&this._remuxAudio(y)},_.prototype._onTrackMetadataReceived=function(y,v){var m=null,S="mp4",N=v.codec;if(y==="audio")this._audioMeta=v,v.codec==="mp3"&&this._mp3UseMpegAudio?(S="mpeg",N="",m=new Uint8Array):m=Ue.generateInitSegment(v);else{if(y!=="video")return;this._videoMeta=v,m=Ue.generateInitSegment(v)}if(!this._onInitSegment)throw new h.a("MP4Remuxer: onInitSegment callback must be specified!");this._onInitSegment(y,{type:y,data:m.buffer,codec:N,container:y+"/"+S,mediaDuration:v.duration})},_.prototype._calculateDtsBase=function(y,v){this._dtsBaseInited||(y&&y.samples&&y.samples.length&&(this._audioDtsBase=y.samples[0].dts),v&&v.samples&&v.samples.length&&(this._videoDtsBase=v.samples[0].dts),this._dtsBase=Math.min(this._audioDtsBase,this._videoDtsBase),this._dtsBaseInited=!0)},_.prototype.getTimestampBase=function(){if(this._dtsBaseInited)return this._dtsBase},_.prototype.flushStashedSamples=function(){var y=this._videoStashedLastSample,v=this._audioStashedLastSample,m={type:"video",id:1,sequenceNumber:0,samples:[],length:0};y!=null&&(m.samples.push(y),m.length=y.length);var S={type:"audio",id:2,sequenceNumber:0,samples:[],length:0};v!=null&&(S.samples.push(v),S.length=v.length),this._videoStashedLastSample=null,this._audioStashedLastSample=null,this._remuxVideo(m,!0),this._remuxAudio(S,!0)},_.prototype._remuxAudio=function(y,v){if(this._audioMeta!=null){var m,S=y,N=S.samples,M=void 0,U=-1,W=this._audioMeta.refSampleDuration,K=this._audioMeta.codec==="mp3"&&this._mp3UseMpegAudio,q=this._dtsBaseInited&&this._audioNextDts===void 0,J=!1;if(N&&N.length!==0&&(N.length!==1||v)){var Y=0,X=null,st=0;K?(Y=0,st=S.length):(Y=8,st=8+S.length);var ht=null;if(N.length>1&&(st-=(ht=N.pop()).length),this._audioStashedLastSample!=null){var ot=this._audioStashedLastSample;this._audioStashedLastSample=null,N.unshift(ot),st+=ot.length}ht!=null&&(this._audioStashedLastSample=ht);var gt=N[0].dts-this._dtsBase;if(this._audioNextDts)M=gt-this._audioNextDts;else if(this._audioSegmentInfoList.isEmpty())M=0,this._fillSilentAfterSeek&&!this._videoSegmentInfoList.isEmpty()&&this._audioMeta.originalCodec!=="mp3"&&(J=!0);else{var yt=this._audioSegmentInfoList.getLastSampleBefore(gt);if(yt!=null){var ft=gt-(yt.originalDts+yt.duration);ft<=3&&(ft=0),M=gt-(yt.dts+yt.duration+ft)}else M=0}if(J){var Rt=gt-M,pt=this._videoSegmentInfoList.getLastSegmentBefore(gt);if(pt!=null&&pt.beginDts<Rt){if(ne=Ei.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount)){var ut=pt.beginDts,St=Rt-pt.beginDts;o.a.v(this.TAG,"InsertPrefixSilentAudio: dts: "+ut+", duration: "+St),N.unshift({unit:ne,dts:ut,pts:ut}),st+=ne.byteLength}}else J=!1}for(var Ct=[],qt=0;qt<N.length;qt++){var Dt=(ot=N[qt]).unit,Ft=ot.dts-this._dtsBase,Ut=(ut=Ft,!1),wt=null,Ot=0;if(!(Ft<-.001)){if(this._audioMeta.codec!=="mp3"){var Zt=Ft;if(this._audioNextDts&&(Zt=this._audioNextDts),(M=Ft-Zt)<=-3*W){o.a.w(this.TAG,"Dropping 1 audio frame (originalDts: "+Ft+" ms ,curRefDts: "+Zt+" ms)  due to dtsCorrection: "+M+" ms overlap.");continue}if(M>=3*W&&this._fillAudioTimestampGap&&!a.a.safari){Ut=!0;var ne,je=Math.floor(M/W);o.a.w(this.TAG,`Large audio timestamp gap detected, may cause AV sync to drift. Silent frames will be generated to avoid unsync.
originalDts: `+Ft+" ms, curRefDts: "+Zt+" ms, dtsCorrection: "+Math.round(M)+" ms, generate: "+je+" frames"),ut=Math.floor(Zt),Ot=Math.floor(Zt+W)-ut,(ne=Ei.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount))==null&&(o.a.w(this.TAG,"Unable to generate silent frame for "+this._audioMeta.originalCodec+" with "+this._audioMeta.channelCount+" channels, repeat last frame"),ne=Dt),wt=[];for(var ve=0;ve<je;ve++){Zt+=W;var Vt=Math.floor(Zt),ei=Math.floor(Zt+W)-Vt,$e={dts:Vt,pts:Vt,cts:0,unit:ne,size:ne.byteLength,duration:ei,originalDts:Ft,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}};wt.push($e),st+=$e.size}this._audioNextDts=Zt+W}else ut=Math.floor(Zt),Ot=Math.floor(Zt+W)-ut,this._audioNextDts=Zt+W}else ut=Ft-M,qt!==N.length-1?Ot=N[qt+1].dts-this._dtsBase-M-ut:ht!=null?Ot=ht.dts-this._dtsBase-M-ut:Ot=Ct.length>=1?Ct[Ct.length-1].duration:Math.floor(W),this._audioNextDts=ut+Ot;U===-1&&(U=ut),Ct.push({dts:ut,pts:ut,cts:0,unit:ot.unit,size:ot.unit.byteLength,duration:Ot,originalDts:Ft,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}}),Ut&&Ct.push.apply(Ct,wt)}}if(Ct.length===0)return S.samples=[],void(S.length=0);for(K?X=new Uint8Array(st):((X=new Uint8Array(st))[0]=st>>>24&255,X[1]=st>>>16&255,X[2]=st>>>8&255,X[3]=255&st,X.set(Ue.types.mdat,4)),qt=0;qt<Ct.length;qt++)Dt=Ct[qt].unit,X.set(Dt,Y),Y+=Dt.byteLength;var oe=Ct[Ct.length-1];m=oe.dts+oe.duration;var ee=new ye.b;ee.beginDts=U,ee.endDts=m,ee.beginPts=U,ee.endPts=m,ee.originalBeginDts=Ct[0].originalDts,ee.originalEndDts=oe.originalDts+oe.duration,ee.firstSample=new ye.d(Ct[0].dts,Ct[0].pts,Ct[0].duration,Ct[0].originalDts,!1),ee.lastSample=new ye.d(oe.dts,oe.pts,oe.duration,oe.originalDts,!1),this._isLive||this._audioSegmentInfoList.append(ee),S.samples=Ct,S.sequenceNumber++;var Ge=null;Ge=K?new Uint8Array:Ue.moof(S,U),S.samples=[],S.length=0;var Me={type:"audio",data:this._mergeBoxes(Ge,X).buffer,sampleCount:Ct.length,info:ee};K&&q&&(Me.timestampOffset=U),this._onMediaSegment("audio",Me)}}},_.prototype._remuxVideo=function(y,v){if(this._videoMeta!=null){var m,S,N=y,M=N.samples,U=void 0,W=-1,K=-1;if(M&&M.length!==0&&(M.length!==1||v)){var q=8,J=null,Y=8+y.length,X=null;if(M.length>1&&(Y-=(X=M.pop()).length),this._videoStashedLastSample!=null){var st=this._videoStashedLastSample;this._videoStashedLastSample=null,M.unshift(st),Y+=st.length}X!=null&&(this._videoStashedLastSample=X);var ht=M[0].dts-this._dtsBase;if(this._videoNextDts)U=ht-this._videoNextDts;else if(this._videoSegmentInfoList.isEmpty())U=0;else{var ot=this._videoSegmentInfoList.getLastSampleBefore(ht);if(ot!=null){var gt=ht-(ot.originalDts+ot.duration);gt<=3&&(gt=0),U=ht-(ot.dts+ot.duration+gt)}else U=0}for(var yt=new ye.b,ft=[],Rt=0;Rt<M.length;Rt++){var pt=(st=M[Rt]).dts-this._dtsBase,ut=st.isKeyframe,St=pt-U,Ct=st.cts,qt=St+Ct;W===-1&&(W=St,K=qt);var Dt=0;if(Rt!==M.length-1?Dt=M[Rt+1].dts-this._dtsBase-U-St:X!=null?Dt=X.dts-this._dtsBase-U-St:Dt=ft.length>=1?ft[ft.length-1].duration:Math.floor(this._videoMeta.refSampleDuration),ut){var Ft=new ye.d(St,qt,Dt,st.dts,!0);Ft.fileposition=st.fileposition,yt.appendSyncPoint(Ft)}ft.push({dts:St,pts:qt,cts:Ct,units:st.units,size:st.length,isKeyframe:ut,duration:Dt,originalDts:pt,flags:{isLeading:0,dependsOn:ut?2:1,isDependedOn:ut?1:0,hasRedundancy:0,isNonSync:ut?0:1}})}for((J=new Uint8Array(Y))[0]=Y>>>24&255,J[1]=Y>>>16&255,J[2]=Y>>>8&255,J[3]=255&Y,J.set(Ue.types.mdat,4),Rt=0;Rt<ft.length;Rt++)for(var Ut=ft[Rt].units;Ut.length;){var wt=Ut.shift().data;J.set(wt,q),q+=wt.byteLength}var Ot=ft[ft.length-1];if(m=Ot.dts+Ot.duration,S=Ot.pts+Ot.duration,this._videoNextDts=m,yt.beginDts=W,yt.endDts=m,yt.beginPts=K,yt.endPts=S,yt.originalBeginDts=ft[0].originalDts,yt.originalEndDts=Ot.originalDts+Ot.duration,yt.firstSample=new ye.d(ft[0].dts,ft[0].pts,ft[0].duration,ft[0].originalDts,ft[0].isKeyframe),yt.lastSample=new ye.d(Ot.dts,Ot.pts,Ot.duration,Ot.originalDts,Ot.isKeyframe),this._isLive||this._videoSegmentInfoList.append(yt),N.samples=ft,N.sequenceNumber++,this._forceFirstIDR){var Zt=ft[0].flags;Zt.dependsOn=2,Zt.isNonSync=0}var ne=Ue.moof(N,W);N.samples=[],N.length=0,this._onMediaSegment("video",{type:"video",data:this._mergeBoxes(ne,J).buffer,sampleCount:ft.length,info:yt})}}},_.prototype._mergeBoxes=function(y,v){var m=new Uint8Array(y.byteLength+v.byteLength);return m.set(y,0),m.set(v,y.byteLength),m},_}(),oa=r(11),te=r(1),la=function(){function _(y,v){this.TAG="TransmuxingController",this._emitter=new n.a,this._config=v,y.segments||(y.segments=[{duration:y.duration,filesize:y.filesize,url:y.url}]),typeof y.cors!="boolean"&&(y.cors=!0),typeof y.withCredentials!="boolean"&&(y.withCredentials=!1),this._mediaDataSource=y,this._currentSegmentIndex=0;var m=0;this._mediaDataSource.segments.forEach(function(S){S.timestampBase=m,m+=S.duration,S.cors=y.cors,S.withCredentials=y.withCredentials,v.referrerPolicy&&(S.referrerPolicy=v.referrerPolicy)}),isNaN(m)||this._mediaDataSource.duration===m||(this._mediaDataSource.duration=m),this._mediaInfo=null,this._demuxer=null,this._remuxer=null,this._ioctl=null,this._pendingSeekTime=null,this._pendingResolveSeekPoint=null,this._statisticsReporter=null}return _.prototype.destroy=function(){this._mediaInfo=null,this._mediaDataSource=null,this._statisticsReporter&&this._disableStatisticsReporter(),this._ioctl&&(this._ioctl.destroy(),this._ioctl=null),this._demuxer&&(this._demuxer.destroy(),this._demuxer=null),this._remuxer&&(this._remuxer.destroy(),this._remuxer=null),this._emitter.removeAllListeners(),this._emitter=null},_.prototype.on=function(y,v){this._emitter.addListener(y,v)},_.prototype.off=function(y,v){this._emitter.removeListener(y,v)},_.prototype.start=function(){this._loadSegment(0),this._enableStatisticsReporter()},_.prototype._loadSegment=function(y,v){this._currentSegmentIndex=y;var m=this._mediaDataSource.segments[y],S=this._ioctl=new oa.a(m,this._config,y);S.onError=this._onIOException.bind(this),S.onSeeked=this._onIOSeeked.bind(this),S.onComplete=this._onIOComplete.bind(this),S.onRedirect=this._onIORedirect.bind(this),S.onRecoveredEarlyEof=this._onIORecoveredEarlyEof.bind(this),v?this._demuxer.bindDataSource(this._ioctl):S.onDataArrival=this._onInitChunkArrival.bind(this),S.open(v)},_.prototype.stop=function(){this._internalAbort(),this._disableStatisticsReporter()},_.prototype._internalAbort=function(){this._ioctl&&(this._ioctl.destroy(),this._ioctl=null)},_.prototype.pause=function(){this._ioctl&&this._ioctl.isWorking()&&(this._ioctl.pause(),this._disableStatisticsReporter())},_.prototype.resume=function(){this._ioctl&&this._ioctl.isPaused()&&(this._ioctl.resume(),this._enableStatisticsReporter())},_.prototype.seek=function(y){if(this._mediaInfo!=null&&this._mediaInfo.isSeekable()){var v=this._searchSegmentIndexContains(y);if(v===this._currentSegmentIndex){var m=this._mediaInfo.segments[v];if(m==null)this._pendingSeekTime=y;else{var S=m.getNearestKeyframe(y);this._remuxer.seek(S.milliseconds),this._ioctl.seek(S.fileposition),this._pendingResolveSeekPoint=S.milliseconds}}else{var N=this._mediaInfo.segments[v];N==null?(this._pendingSeekTime=y,this._internalAbort(),this._remuxer.seek(),this._remuxer.insertDiscontinuity(),this._loadSegment(v)):(S=N.getNearestKeyframe(y),this._internalAbort(),this._remuxer.seek(y),this._remuxer.insertDiscontinuity(),this._demuxer.resetMediaInfo(),this._demuxer.timestampBase=this._mediaDataSource.segments[v].timestampBase,this._loadSegment(v,S.fileposition),this._pendingResolveSeekPoint=S.milliseconds,this._reportSegmentMediaInfo(v))}this._enableStatisticsReporter()}},_.prototype._searchSegmentIndexContains=function(y){for(var v=this._mediaDataSource.segments,m=v.length-1,S=0;S<v.length;S++)if(y<v[S].timestampBase){m=S-1;break}return m},_.prototype._onInitChunkArrival=function(y,v){var m=this,S=0;if(v>0)this._demuxer.bindDataSource(this._ioctl),this._demuxer.timestampBase=this._mediaDataSource.segments[this._currentSegmentIndex].timestampBase,S=this._demuxer.parseChunks(y,v);else{var N=null;(N=L.probe(y)).match&&(this._setupFLVDemuxerRemuxer(N),S=this._demuxer.parseChunks(y,v)),N.match||N.needMoreData||(N=_i.probe(y)).match&&(this._setupTSDemuxerRemuxer(N),S=this._demuxer.parseChunks(y,v)),N.match||N.needMoreData||(N=null,o.a.e(this.TAG,"Non MPEG-TS/FLV, Unsupported media type!"),Promise.resolve().then(function(){m._internalAbort()}),this._emitter.emit(te.a.DEMUX_ERROR,k.a.FORMAT_UNSUPPORTED,"Non MPEG-TS/FLV, Unsupported media type!"))}return S},_.prototype._setupFLVDemuxerRemuxer=function(y){this._demuxer=new L(y,this._config),this._remuxer||(this._remuxer=new kt(this._config));var v=this._mediaDataSource;v.duration==null||isNaN(v.duration)||(this._demuxer.overridedDuration=v.duration),typeof v.hasAudio=="boolean"&&(this._demuxer.overridedHasAudio=v.hasAudio),typeof v.hasVideo=="boolean"&&(this._demuxer.overridedHasVideo=v.hasVideo),this._demuxer.timestampBase=v.segments[this._currentSegmentIndex].timestampBase,this._demuxer.onError=this._onDemuxException.bind(this),this._demuxer.onMediaInfo=this._onMediaInfo.bind(this),this._demuxer.onMetaDataArrived=this._onMetaDataArrived.bind(this),this._demuxer.onScriptDataArrived=this._onScriptDataArrived.bind(this),this._remuxer.bindDataSource(this._demuxer.bindDataSource(this._ioctl)),this._remuxer.onInitSegment=this._onRemuxerInitSegmentArrival.bind(this),this._remuxer.onMediaSegment=this._onRemuxerMediaSegmentArrival.bind(this)},_.prototype._setupTSDemuxerRemuxer=function(y){var v=this._demuxer=new _i(y,this._config);this._remuxer||(this._remuxer=new kt(this._config)),v.onError=this._onDemuxException.bind(this),v.onMediaInfo=this._onMediaInfo.bind(this),v.onMetaDataArrived=this._onMetaDataArrived.bind(this),v.onTimedID3Metadata=this._onTimedID3Metadata.bind(this),v.onSMPTE2038Metadata=this._onSMPTE2038Metadata.bind(this),v.onSCTE35Metadata=this._onSCTE35Metadata.bind(this),v.onPESPrivateDataDescriptor=this._onPESPrivateDataDescriptor.bind(this),v.onPESPrivateData=this._onPESPrivateData.bind(this),this._remuxer.bindDataSource(this._demuxer),this._demuxer.bindDataSource(this._ioctl),this._remuxer.onInitSegment=this._onRemuxerInitSegmentArrival.bind(this),this._remuxer.onMediaSegment=this._onRemuxerMediaSegmentArrival.bind(this)},_.prototype._onMediaInfo=function(y){var v=this;this._mediaInfo==null&&(this._mediaInfo=Object.assign({},y),this._mediaInfo.keyframesIndex=null,this._mediaInfo.segments=[],this._mediaInfo.segmentCount=this._mediaDataSource.segments.length,Object.setPrototypeOf(this._mediaInfo,l.a.prototype));var m=Object.assign({},y);Object.setPrototypeOf(m,l.a.prototype),this._mediaInfo.segments[this._currentSegmentIndex]=m,this._reportSegmentMediaInfo(this._currentSegmentIndex),this._pendingSeekTime!=null&&Promise.resolve().then(function(){var S=v._pendingSeekTime;v._pendingSeekTime=null,v.seek(S)})},_.prototype._onMetaDataArrived=function(y){this._emitter.emit(te.a.METADATA_ARRIVED,y)},_.prototype._onScriptDataArrived=function(y){this._emitter.emit(te.a.SCRIPTDATA_ARRIVED,y)},_.prototype._onTimedID3Metadata=function(y){var v=this._remuxer.getTimestampBase();v!=null&&(y.pts!=null&&(y.pts-=v),y.dts!=null&&(y.dts-=v),this._emitter.emit(te.a.TIMED_ID3_METADATA_ARRIVED,y))},_.prototype._onSMPTE2038Metadata=function(y){var v=this._remuxer.getTimestampBase();v!=null&&(y.pts!=null&&(y.pts-=v),y.dts!=null&&(y.dts-=v),y.nearest_pts!=null&&(y.nearest_pts-=v),this._emitter.emit(te.a.SMPTE2038_METADATA_ARRIVED,y))},_.prototype._onSCTE35Metadata=function(y){var v=this._remuxer.getTimestampBase();v!=null&&(y.pts!=null&&(y.pts-=v),y.nearest_pts!=null&&(y.nearest_pts-=v),this._emitter.emit(te.a.SCTE35_METADATA_ARRIVED,y))},_.prototype._onPESPrivateDataDescriptor=function(y){this._emitter.emit(te.a.PES_PRIVATE_DATA_DESCRIPTOR,y)},_.prototype._onPESPrivateData=function(y){var v=this._remuxer.getTimestampBase();v!=null&&(y.pts!=null&&(y.pts-=v),y.nearest_pts!=null&&(y.nearest_pts-=v),y.dts!=null&&(y.dts-=v),this._emitter.emit(te.a.PES_PRIVATE_DATA_ARRIVED,y))},_.prototype._onIOSeeked=function(){this._remuxer.insertDiscontinuity()},_.prototype._onIOComplete=function(y){var v=y+1;v<this._mediaDataSource.segments.length?(this._internalAbort(),this._remuxer&&this._remuxer.flushStashedSamples(),this._loadSegment(v)):(this._remuxer&&this._remuxer.flushStashedSamples(),this._emitter.emit(te.a.LOADING_COMPLETE),this._disableStatisticsReporter())},_.prototype._onIORedirect=function(y){var v=this._ioctl.extraData;this._mediaDataSource.segments[v].redirectedURL=y},_.prototype._onIORecoveredEarlyEof=function(){this._emitter.emit(te.a.RECOVERED_EARLY_EOF)},_.prototype._onIOException=function(y,v){o.a.e(this.TAG,"IOException: type = "+y+", code = "+v.code+", msg = "+v.msg),this._emitter.emit(te.a.IO_ERROR,y,v),this._disableStatisticsReporter()},_.prototype._onDemuxException=function(y,v){o.a.e(this.TAG,"DemuxException: type = "+y+", info = "+v),this._emitter.emit(te.a.DEMUX_ERROR,y,v)},_.prototype._onRemuxerInitSegmentArrival=function(y,v){this._emitter.emit(te.a.INIT_SEGMENT,y,v)},_.prototype._onRemuxerMediaSegmentArrival=function(y,v){if(this._pendingSeekTime==null&&(this._emitter.emit(te.a.MEDIA_SEGMENT,y,v),this._pendingResolveSeekPoint!=null&&y==="video")){var m=v.info.syncPoints,S=this._pendingResolveSeekPoint;this._pendingResolveSeekPoint=null,a.a.safari&&m.length>0&&m[0].originalDts===S&&(S=m[0].pts),this._emitter.emit(te.a.RECOMMEND_SEEKPOINT,S)}},_.prototype._enableStatisticsReporter=function(){this._statisticsReporter==null&&(this._statisticsReporter=self.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval))},_.prototype._disableStatisticsReporter=function(){this._statisticsReporter&&(self.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},_.prototype._reportSegmentMediaInfo=function(y){var v=this._mediaInfo.segments[y],m=Object.assign({},v);m.duration=this._mediaInfo.duration,m.segmentCount=this._mediaInfo.segmentCount,delete m.segments,delete m.keyframesIndex,this._emitter.emit(te.a.MEDIA_INFO,m)},_.prototype._reportStatisticsInfo=function(){var y={};y.url=this._ioctl.currentURL,y.hasRedirect=this._ioctl.hasRedirect,y.hasRedirect&&(y.redirectedURL=this._ioctl.currentRedirectedURL),y.speed=this._ioctl.currentSpeed,y.loaderType=this._ioctl.loaderType,y.currentSegmentIndex=this._currentSegmentIndex,y.totalSegmentCount=this._mediaDataSource.segments.length,this._emitter.emit(te.a.STATISTICS_INFO,y)},_}();i.a=la},function(e,i,r){var s,n=r(0),o=function(){function C(){this._firstCheckpoint=0,this._lastCheckpoint=0,this._intervalBytes=0,this._totalBytes=0,this._lastSecondBytes=0,self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now}return C.prototype.reset=function(){this._firstCheckpoint=this._lastCheckpoint=0,this._totalBytes=this._intervalBytes=0,this._lastSecondBytes=0},C.prototype.addBytes=function(b){this._firstCheckpoint===0?(this._firstCheckpoint=this._now(),this._lastCheckpoint=this._firstCheckpoint,this._intervalBytes+=b,this._totalBytes+=b):this._now()-this._lastCheckpoint<1e3?(this._intervalBytes+=b,this._totalBytes+=b):(this._lastSecondBytes=this._intervalBytes,this._intervalBytes=b,this._totalBytes+=b,this._lastCheckpoint=this._now())},Object.defineProperty(C.prototype,"currentKBps",{get:function(){this.addBytes(0);var b=(this._now()-this._lastCheckpoint)/1e3;return b==0&&(b=1),this._intervalBytes/b/1024},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"lastSecondKBps",{get:function(){return this.addBytes(0),this._lastSecondBytes!==0?this._lastSecondBytes/1024:this._now()-this._lastCheckpoint>=500?this.currentKBps:0},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"averageKBps",{get:function(){var b=(this._now()-this._firstCheckpoint)/1e3;return this._totalBytes/b/1024},enumerable:!1,configurable:!0}),C}(),a=r(2),l=r(4),d=r(3),c=(s=function(C,b){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(A,L){A.__proto__=L}||function(A,L){for(var I in L)L.hasOwnProperty(I)&&(A[I]=L[I])})(C,b)},function(C,b){function A(){this.constructor=C}s(C,b),C.prototype=b===null?Object.create(b):(A.prototype=b.prototype,new A)}),f=function(C){function b(A,L){var I=C.call(this,"fetch-stream-loader")||this;return I.TAG="FetchStreamLoader",I._seekHandler=A,I._config=L,I._needStash=!0,I._requestAbort=!1,I._abortController=null,I._contentLength=null,I._receivedLength=0,I}return c(b,C),b.isSupported=function(){try{var A=l.a.msedge&&l.a.version.minor>=15048,L=!l.a.msedge||A;return self.fetch&&self.ReadableStream&&L}catch(I){return!1}},b.prototype.destroy=function(){this.isWorking()&&this.abort(),C.prototype.destroy.call(this)},b.prototype.open=function(A,L){var I=this;this._dataSource=A,this._range=L;var j=A.url;this._config.reuseRedirectedURL&&A.redirectedURL!=null&&(j=A.redirectedURL);var F=this._seekHandler.getConfig(j,L),$=new self.Headers;if(typeof F.headers=="object"){var V=F.headers;for(var Q in V)V.hasOwnProperty(Q)&&$.append(Q,V[Q])}var z={method:"GET",headers:$,mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade"};if(typeof this._config.headers=="object")for(var Q in this._config.headers)$.append(Q,this._config.headers[Q]);A.cors===!1&&(z.mode="same-origin"),A.withCredentials&&(z.credentials="include"),A.referrerPolicy&&(z.referrerPolicy=A.referrerPolicy),self.AbortController&&(this._abortController=new self.AbortController,z.signal=this._abortController.signal),this._status=a.c.kConnecting,self.fetch(F.url,z).then(function(B){if(I._requestAbort)return I._status=a.c.kIdle,void B.body.cancel();if(B.ok&&B.status>=200&&B.status<=299){if(B.url!==F.url&&I._onURLRedirect){var w=I._seekHandler.removeURLParameters(B.url);I._onURLRedirect(w)}var P=B.headers.get("Content-Length");return P!=null&&(I._contentLength=parseInt(P),I._contentLength!==0&&I._onContentLengthKnown&&I._onContentLengthKnown(I._contentLength)),I._pump.call(I,B.body.getReader())}if(I._status=a.c.kError,!I._onError)throw new d.d("FetchStreamLoader: Http code invalid, "+B.status+" "+B.statusText);I._onError(a.b.HTTP_STATUS_CODE_INVALID,{code:B.status,msg:B.statusText})}).catch(function(B){if(!I._abortController||!I._abortController.signal.aborted){if(I._status=a.c.kError,!I._onError)throw B;I._onError(a.b.EXCEPTION,{code:-1,msg:B.message})}})},b.prototype.abort=function(){if(this._requestAbort=!0,(this._status!==a.c.kBuffering||!l.a.chrome)&&this._abortController)try{this._abortController.abort()}catch(A){}},b.prototype._pump=function(A){var L=this;return A.read().then(function(I){if(I.done)if(L._contentLength!==null&&L._receivedLength<L._contentLength){L._status=a.c.kError;var j=a.b.EARLY_EOF,F={code:-1,msg:"Fetch stream meet Early-EOF"};if(!L._onError)throw new d.d(F.msg);L._onError(j,F)}else L._status=a.c.kComplete,L._onComplete&&L._onComplete(L._range.from,L._range.from+L._receivedLength-1);else{if(L._abortController&&L._abortController.signal.aborted)return void(L._status=a.c.kComplete);if(L._requestAbort===!0)return L._status=a.c.kComplete,A.cancel();L._status=a.c.kBuffering;var $=I.value.buffer,V=L._range.from+L._receivedLength;L._receivedLength+=$.byteLength,L._onDataArrival&&L._onDataArrival($,V,L._receivedLength),L._pump(A)}}).catch(function(I){if(L._abortController&&L._abortController.signal.aborted)L._status=a.c.kComplete;else if(I.code!==11||!l.a.msedge){L._status=a.c.kError;var j=0,F=null;if(I.code!==19&&I.message!=="network error"||!(L._contentLength===null||L._contentLength!==null&&L._receivedLength<L._contentLength)?(j=a.b.EXCEPTION,F={code:I.code,msg:I.message}):(j=a.b.EARLY_EOF,F={code:I.code,msg:"Fetch stream meet Early-EOF"}),!L._onError)throw new d.d(F.msg);L._onError(j,F)}})},b}(a.a),h=function(){var C=function(b,A){return(C=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(L,I){L.__proto__=I}||function(L,I){for(var j in I)I.hasOwnProperty(j)&&(L[j]=I[j])})(b,A)};return function(b,A){function L(){this.constructor=b}C(b,A),b.prototype=A===null?Object.create(A):(L.prototype=A.prototype,new L)}}(),p=function(C){function b(A,L){var I=C.call(this,"xhr-moz-chunked-loader")||this;return I.TAG="MozChunkedLoader",I._seekHandler=A,I._config=L,I._needStash=!0,I._xhr=null,I._requestAbort=!1,I._contentLength=null,I._receivedLength=0,I}return h(b,C),b.isSupported=function(){try{var A=new XMLHttpRequest;return A.open("GET","https://example.com",!0),A.responseType="moz-chunked-arraybuffer",A.responseType==="moz-chunked-arraybuffer"}catch(L){return n.a.w("MozChunkedLoader",L.message),!1}},b.prototype.destroy=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onloadend=null,this._xhr.onerror=null,this._xhr=null),C.prototype.destroy.call(this)},b.prototype.open=function(A,L){this._dataSource=A,this._range=L;var I=A.url;this._config.reuseRedirectedURL&&A.redirectedURL!=null&&(I=A.redirectedURL);var j=this._seekHandler.getConfig(I,L);this._requestURL=j.url;var F=this._xhr=new XMLHttpRequest;if(F.open("GET",j.url,!0),F.responseType="moz-chunked-arraybuffer",F.onreadystatechange=this._onReadyStateChange.bind(this),F.onprogress=this._onProgress.bind(this),F.onloadend=this._onLoadEnd.bind(this),F.onerror=this._onXhrError.bind(this),A.withCredentials&&(F.withCredentials=!0),typeof j.headers=="object"){var $=j.headers;for(var V in $)$.hasOwnProperty(V)&&F.setRequestHeader(V,$[V])}if(typeof this._config.headers=="object"){$=this._config.headers;for(var V in $)$.hasOwnProperty(V)&&F.setRequestHeader(V,$[V])}this._status=a.c.kConnecting,F.send()},b.prototype.abort=function(){this._requestAbort=!0,this._xhr&&this._xhr.abort(),this._status=a.c.kComplete},b.prototype._onReadyStateChange=function(A){var L=A.target;if(L.readyState===2){if(L.responseURL!=null&&L.responseURL!==this._requestURL&&this._onURLRedirect){var I=this._seekHandler.removeURLParameters(L.responseURL);this._onURLRedirect(I)}if(L.status!==0&&(L.status<200||L.status>299)){if(this._status=a.c.kError,!this._onError)throw new d.d("MozChunkedLoader: Http code invalid, "+L.status+" "+L.statusText);this._onError(a.b.HTTP_STATUS_CODE_INVALID,{code:L.status,msg:L.statusText})}else this._status=a.c.kBuffering}},b.prototype._onProgress=function(A){if(this._status!==a.c.kError){this._contentLength===null&&A.total!==null&&A.total!==0&&(this._contentLength=A.total,this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength));var L=A.target.response,I=this._range.from+this._receivedLength;this._receivedLength+=L.byteLength,this._onDataArrival&&this._onDataArrival(L,I,this._receivedLength)}},b.prototype._onLoadEnd=function(A){this._requestAbort!==!0?this._status!==a.c.kError&&(this._status=a.c.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1)):this._requestAbort=!1},b.prototype._onXhrError=function(A){this._status=a.c.kError;var L=0,I=null;if(this._contentLength&&A.loaded<this._contentLength?(L=a.b.EARLY_EOF,I={code:-1,msg:"Moz-Chunked stream meet Early-Eof"}):(L=a.b.EXCEPTION,I={code:-1,msg:A.constructor.name+" "+A.type}),!this._onError)throw new d.d(I.msg);this._onError(L,I)},b}(a.a),g=function(){var C=function(b,A){return(C=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(L,I){L.__proto__=I}||function(L,I){for(var j in I)I.hasOwnProperty(j)&&(L[j]=I[j])})(b,A)};return function(b,A){function L(){this.constructor=b}C(b,A),b.prototype=A===null?Object.create(A):(L.prototype=A.prototype,new L)}}(),x=function(C){function b(A,L){var I=C.call(this,"xhr-range-loader")||this;return I.TAG="RangeLoader",I._seekHandler=A,I._config=L,I._needStash=!1,I._chunkSizeKBList=[128,256,384,512,768,1024,1536,2048,3072,4096,5120,6144,7168,8192],I._currentChunkSizeKB=384,I._currentSpeedNormalized=0,I._zeroSpeedChunkCount=0,I._xhr=null,I._speedSampler=new o,I._requestAbort=!1,I._waitForTotalLength=!1,I._totalLengthReceived=!1,I._currentRequestURL=null,I._currentRedirectedURL=null,I._currentRequestRange=null,I._totalLength=null,I._contentLength=null,I._receivedLength=0,I._lastTimeLoaded=0,I}return g(b,C),b.isSupported=function(){try{var A=new XMLHttpRequest;return A.open("GET","https://example.com",!0),A.responseType="arraybuffer",A.responseType==="arraybuffer"}catch(L){return n.a.w("RangeLoader",L.message),!1}},b.prototype.destroy=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr=null),C.prototype.destroy.call(this)},Object.defineProperty(b.prototype,"currentSpeed",{get:function(){return this._speedSampler.lastSecondKBps},enumerable:!1,configurable:!0}),b.prototype.open=function(A,L){this._dataSource=A,this._range=L,this._status=a.c.kConnecting;var I=!1;this._dataSource.filesize!=null&&this._dataSource.filesize!==0&&(I=!0,this._totalLength=this._dataSource.filesize),this._totalLengthReceived||I?this._openSubRange():(this._waitForTotalLength=!0,this._internalOpen(this._dataSource,{from:0,to:-1}))},b.prototype._openSubRange=function(){var A=1024*this._currentChunkSizeKB,L=this._range.from+this._receivedLength,I=L+A;this._contentLength!=null&&I-this._range.from>=this._contentLength&&(I=this._range.from+this._contentLength-1),this._currentRequestRange={from:L,to:I},this._internalOpen(this._dataSource,this._currentRequestRange)},b.prototype._internalOpen=function(A,L){this._lastTimeLoaded=0;var I=A.url;this._config.reuseRedirectedURL&&(this._currentRedirectedURL!=null?I=this._currentRedirectedURL:A.redirectedURL!=null&&(I=A.redirectedURL));var j=this._seekHandler.getConfig(I,L);this._currentRequestURL=j.url;var F=this._xhr=new XMLHttpRequest;if(F.open("GET",j.url,!0),F.responseType="arraybuffer",F.onreadystatechange=this._onReadyStateChange.bind(this),F.onprogress=this._onProgress.bind(this),F.onload=this._onLoad.bind(this),F.onerror=this._onXhrError.bind(this),A.withCredentials&&(F.withCredentials=!0),typeof j.headers=="object"){var $=j.headers;for(var V in $)$.hasOwnProperty(V)&&F.setRequestHeader(V,$[V])}if(typeof this._config.headers=="object"){$=this._config.headers;for(var V in $)$.hasOwnProperty(V)&&F.setRequestHeader(V,$[V])}F.send()},b.prototype.abort=function(){this._requestAbort=!0,this._internalAbort(),this._status=a.c.kComplete},b.prototype._internalAbort=function(){this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr.abort(),this._xhr=null)},b.prototype._onReadyStateChange=function(A){var L=A.target;if(L.readyState===2){if(L.responseURL!=null){var I=this._seekHandler.removeURLParameters(L.responseURL);L.responseURL!==this._currentRequestURL&&I!==this._currentRedirectedURL&&(this._currentRedirectedURL=I,this._onURLRedirect&&this._onURLRedirect(I))}if(L.status>=200&&L.status<=299){if(this._waitForTotalLength)return;this._status=a.c.kBuffering}else{if(this._status=a.c.kError,!this._onError)throw new d.d("RangeLoader: Http code invalid, "+L.status+" "+L.statusText);this._onError(a.b.HTTP_STATUS_CODE_INVALID,{code:L.status,msg:L.statusText})}}},b.prototype._onProgress=function(A){if(this._status!==a.c.kError){if(this._contentLength===null){var L=!1;if(this._waitForTotalLength){this._waitForTotalLength=!1,this._totalLengthReceived=!0,L=!0;var I=A.total;this._internalAbort(),I!=null&I!==0&&(this._totalLength=I)}if(this._range.to===-1?this._contentLength=this._totalLength-this._range.from:this._contentLength=this._range.to-this._range.from+1,L)return void this._openSubRange();this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength)}var j=A.loaded-this._lastTimeLoaded;this._lastTimeLoaded=A.loaded,this._speedSampler.addBytes(j)}},b.prototype._normalizeSpeed=function(A){var L=this._chunkSizeKBList,I=L.length-1,j=0,F=0,$=I;if(A<L[0])return L[0];for(;F<=$;){if((j=F+Math.floor(($-F)/2))===I||A>=L[j]&&A<L[j+1])return L[j];L[j]<A?F=j+1:$=j-1}},b.prototype._onLoad=function(A){if(this._status!==a.c.kError)if(this._waitForTotalLength)this._waitForTotalLength=!1;else{this._lastTimeLoaded=0;var L=this._speedSampler.lastSecondKBps;if(L===0&&(this._zeroSpeedChunkCount++,this._zeroSpeedChunkCount>=3&&(L=this._speedSampler.currentKBps)),L!==0){var I=this._normalizeSpeed(L);this._currentSpeedNormalized!==I&&(this._currentSpeedNormalized=I,this._currentChunkSizeKB=I)}var j=A.target.response,F=this._range.from+this._receivedLength;this._receivedLength+=j.byteLength;var $=!1;this._contentLength!=null&&this._receivedLength<this._contentLength?this._openSubRange():$=!0,this._onDataArrival&&this._onDataArrival(j,F,this._receivedLength),$&&(this._status=a.c.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1))}},b.prototype._onXhrError=function(A){this._status=a.c.kError;var L=0,I=null;if(this._contentLength&&this._receivedLength>0&&this._receivedLength<this._contentLength?(L=a.b.EARLY_EOF,I={code:-1,msg:"RangeLoader meet Early-Eof"}):(L=a.b.EXCEPTION,I={code:-1,msg:A.constructor.name+" "+A.type}),!this._onError)throw new d.d(I.msg);this._onError(L,I)},b}(a.a),E=function(){var C=function(b,A){return(C=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(L,I){L.__proto__=I}||function(L,I){for(var j in I)I.hasOwnProperty(j)&&(L[j]=I[j])})(b,A)};return function(b,A){function L(){this.constructor=b}C(b,A),b.prototype=A===null?Object.create(A):(L.prototype=A.prototype,new L)}}(),k=function(C){function b(){var A=C.call(this,"websocket-loader")||this;return A.TAG="WebSocketLoader",A._needStash=!0,A._ws=null,A._requestAbort=!1,A._receivedLength=0,A}return E(b,C),b.isSupported=function(){try{return self.WebSocket!==void 0}catch(A){return!1}},b.prototype.destroy=function(){this._ws&&this.abort(),C.prototype.destroy.call(this)},b.prototype.open=function(A){try{var L=this._ws=new self.WebSocket(A.url);L.binaryType="arraybuffer",L.onopen=this._onWebSocketOpen.bind(this),L.onclose=this._onWebSocketClose.bind(this),L.onmessage=this._onWebSocketMessage.bind(this),L.onerror=this._onWebSocketError.bind(this),this._status=a.c.kConnecting}catch(j){this._status=a.c.kError;var I={code:j.code,msg:j.message};if(!this._onError)throw new d.d(I.msg);this._onError(a.b.EXCEPTION,I)}},b.prototype.abort=function(){var A=this._ws;!A||A.readyState!==0&&A.readyState!==1||(this._requestAbort=!0,A.close()),this._ws=null,this._status=a.c.kComplete},b.prototype._onWebSocketOpen=function(A){this._status=a.c.kBuffering},b.prototype._onWebSocketClose=function(A){this._requestAbort!==!0?(this._status=a.c.kComplete,this._onComplete&&this._onComplete(0,this._receivedLength-1)):this._requestAbort=!1},b.prototype._onWebSocketMessage=function(A){var L=this;if(A.data instanceof ArrayBuffer)this._dispatchArrayBuffer(A.data);else if(A.data instanceof Blob){var I=new FileReader;I.onload=function(){L._dispatchArrayBuffer(I.result)},I.readAsArrayBuffer(A.data)}else{this._status=a.c.kError;var j={code:-1,msg:"Unsupported WebSocket message type: "+A.data.constructor.name};if(!this._onError)throw new d.d(j.msg);this._onError(a.b.EXCEPTION,j)}},b.prototype._dispatchArrayBuffer=function(A){var L=A,I=this._receivedLength;this._receivedLength+=L.byteLength,this._onDataArrival&&this._onDataArrival(L,I,this._receivedLength)},b.prototype._onWebSocketError=function(A){this._status=a.c.kError;var L={code:A.code,msg:A.message};if(!this._onError)throw new d.d(L.msg);this._onError(a.b.EXCEPTION,L)},b}(a.a),O=function(){function C(b){this._zeroStart=b||!1}return C.prototype.getConfig=function(b,A){var L={};if(A.from!==0||A.to!==-1){var I=void 0;I=A.to!==-1?"bytes="+A.from.toString()+"-"+A.to.toString():"bytes="+A.from.toString()+"-",L.Range=I}else this._zeroStart&&(L.Range="bytes=0-");return{url:b,headers:L}},C.prototype.removeURLParameters=function(b){return b},C}(),T=function(){function C(b,A){this._startName=b,this._endName=A}return C.prototype.getConfig=function(b,A){var L=b;if(A.from!==0||A.to!==-1){var I=!0;L.indexOf("?")===-1&&(L+="?",I=!1),I&&(L+="&"),L+=this._startName+"="+A.from.toString(),A.to!==-1&&(L+="&"+this._endName+"="+A.to.toString())}return{url:L,headers:{}}},C.prototype.removeURLParameters=function(b){var A=b.split("?")[0],L=void 0,I=b.indexOf("?");I!==-1&&(L=b.substring(I+1));var j="";if(L!=null&&L.length>0)for(var F=L.split("&"),$=0;$<F.length;$++){var V=F[$].split("="),Q=$>0;V[0]!==this._startName&&V[0]!==this._endName&&(Q&&(j+="&"),j+=F[$])}return j.length===0?A:A+"?"+j},C}(),R=function(){function C(b,A,L){this.TAG="IOController",this._config=A,this._extraData=L,this._stashInitialSize=65536,A.stashInitialSize!=null&&A.stashInitialSize>0&&(this._stashInitialSize=A.stashInitialSize),this._stashUsed=0,this._stashSize=this._stashInitialSize,this._bufferSize=3145728,this._stashBuffer=new ArrayBuffer(this._bufferSize),this._stashByteStart=0,this._enableStash=!0,A.enableStashBuffer===!1&&(this._enableStash=!1),this._loader=null,this._loaderClass=null,this._seekHandler=null,this._dataSource=b,this._isWebSocketURL=/wss?:\/\/(.+?)/.test(b.url),this._refTotalLength=b.filesize?b.filesize:null,this._totalLength=this._refTotalLength,this._fullRequestFlag=!1,this._currentRange=null,this._redirectedURL=null,this._speedNormalized=0,this._speedSampler=new o,this._speedNormalizeList=[32,64,96,128,192,256,384,512,768,1024,1536,2048,3072,4096],this._isEarlyEofReconnecting=!1,this._paused=!1,this._resumeFrom=0,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._selectSeekHandler(),this._selectLoader(),this._createLoader()}return C.prototype.destroy=function(){this._loader.isWorking()&&this._loader.abort(),this._loader.destroy(),this._loader=null,this._loaderClass=null,this._dataSource=null,this._stashBuffer=null,this._stashUsed=this._stashSize=this._bufferSize=this._stashByteStart=0,this._currentRange=null,this._speedSampler=null,this._isEarlyEofReconnecting=!1,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._extraData=null},C.prototype.isWorking=function(){return this._loader&&this._loader.isWorking()&&!this._paused},C.prototype.isPaused=function(){return this._paused},Object.defineProperty(C.prototype,"status",{get:function(){return this._loader.status},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"extraData",{get:function(){return this._extraData},set:function(b){this._extraData=b},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(b){this._onDataArrival=b},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"onSeeked",{get:function(){return this._onSeeked},set:function(b){this._onSeeked=b},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"onError",{get:function(){return this._onError},set:function(b){this._onError=b},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"onComplete",{get:function(){return this._onComplete},set:function(b){this._onComplete=b},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"onRedirect",{get:function(){return this._onRedirect},set:function(b){this._onRedirect=b},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"onRecoveredEarlyEof",{get:function(){return this._onRecoveredEarlyEof},set:function(b){this._onRecoveredEarlyEof=b},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"currentURL",{get:function(){return this._dataSource.url},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"hasRedirect",{get:function(){return this._redirectedURL!=null||this._dataSource.redirectedURL!=null},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"currentRedirectedURL",{get:function(){return this._redirectedURL||this._dataSource.redirectedURL},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"currentSpeed",{get:function(){return this._loaderClass===x?this._loader.currentSpeed:this._speedSampler.lastSecondKBps},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"loaderType",{get:function(){return this._loader.type},enumerable:!1,configurable:!0}),C.prototype._selectSeekHandler=function(){var b=this._config;if(b.seekType==="range")this._seekHandler=new O(this._config.rangeLoadZeroStart);else if(b.seekType==="param"){var A=b.seekParamStart||"bstart",L=b.seekParamEnd||"bend";this._seekHandler=new T(A,L)}else{if(b.seekType!=="custom")throw new d.b("Invalid seekType in config: "+b.seekType);if(typeof b.customSeekHandler!="function")throw new d.b("Custom seekType specified in config but invalid customSeekHandler!");this._seekHandler=new b.customSeekHandler}},C.prototype._selectLoader=function(){if(this._config.customLoader!=null)this._loaderClass=this._config.customLoader;else if(this._isWebSocketURL)this._loaderClass=k;else if(f.isSupported())this._loaderClass=f;else if(p.isSupported())this._loaderClass=p;else{if(!x.isSupported())throw new d.d("Your browser doesn't support xhr with arraybuffer responseType!");this._loaderClass=x}},C.prototype._createLoader=function(){this._loader=new this._loaderClass(this._seekHandler,this._config),this._loader.needStashBuffer===!1&&(this._enableStash=!1),this._loader.onContentLengthKnown=this._onContentLengthKnown.bind(this),this._loader.onURLRedirect=this._onURLRedirect.bind(this),this._loader.onDataArrival=this._onLoaderChunkArrival.bind(this),this._loader.onComplete=this._onLoaderComplete.bind(this),this._loader.onError=this._onLoaderError.bind(this)},C.prototype.open=function(b){this._currentRange={from:0,to:-1},b&&(this._currentRange.from=b),this._speedSampler.reset(),b||(this._fullRequestFlag=!0),this._loader.open(this._dataSource,Object.assign({},this._currentRange))},C.prototype.abort=function(){this._loader.abort(),this._paused&&(this._paused=!1,this._resumeFrom=0)},C.prototype.pause=function(){this.isWorking()&&(this._loader.abort(),this._stashUsed!==0?(this._resumeFrom=this._stashByteStart,this._currentRange.to=this._stashByteStart-1):this._resumeFrom=this._currentRange.to+1,this._stashUsed=0,this._stashByteStart=0,this._paused=!0)},C.prototype.resume=function(){if(this._paused){this._paused=!1;var b=this._resumeFrom;this._resumeFrom=0,this._internalSeek(b,!0)}},C.prototype.seek=function(b){this._paused=!1,this._stashUsed=0,this._stashByteStart=0,this._internalSeek(b,!0)},C.prototype._internalSeek=function(b,A){this._loader.isWorking()&&this._loader.abort(),this._flushStashBuffer(A),this._loader.destroy(),this._loader=null;var L={from:b,to:-1};this._currentRange={from:L.from,to:-1},this._speedSampler.reset(),this._stashSize=this._stashInitialSize,this._createLoader(),this._loader.open(this._dataSource,L),this._onSeeked&&this._onSeeked()},C.prototype.updateUrl=function(b){if(!b||typeof b!="string"||b.length===0)throw new d.b("Url must be a non-empty string!");this._dataSource.url=b},C.prototype._expandBuffer=function(b){for(var A=this._stashSize;A+1048576<b;)A*=2;if((A+=1048576)!==this._bufferSize){var L=new ArrayBuffer(A);if(this._stashUsed>0){var I=new Uint8Array(this._stashBuffer,0,this._stashUsed);new Uint8Array(L,0,A).set(I,0)}this._stashBuffer=L,this._bufferSize=A}},C.prototype._normalizeSpeed=function(b){var A=this._speedNormalizeList,L=A.length-1,I=0,j=0,F=L;if(b<A[0])return A[0];for(;j<=F;){if((I=j+Math.floor((F-j)/2))===L||b>=A[I]&&b<A[I+1])return A[I];A[I]<b?j=I+1:F=I-1}},C.prototype._adjustStashSize=function(b){var A=0;(A=this._config.isLive?b/8:b<512?b:b>=512&&b<=1024?Math.floor(1.5*b):2*b)>8192&&(A=8192);var L=1024*A+1048576;this._bufferSize<L&&this._expandBuffer(L),this._stashSize=1024*A},C.prototype._dispatchChunks=function(b,A){return this._currentRange.to=A+b.byteLength-1,this._onDataArrival(b,A)},C.prototype._onURLRedirect=function(b){this._redirectedURL=b,this._onRedirect&&this._onRedirect(b)},C.prototype._onContentLengthKnown=function(b){b&&this._fullRequestFlag&&(this._totalLength=b,this._fullRequestFlag=!1)},C.prototype._onLoaderChunkArrival=function(b,A,L){if(!this._onDataArrival)throw new d.a("IOController: No existing consumer (onDataArrival) callback!");if(!this._paused){this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,this._onRecoveredEarlyEof&&this._onRecoveredEarlyEof()),this._speedSampler.addBytes(b.byteLength);var I=this._speedSampler.lastSecondKBps;if(I!==0){var j=this._normalizeSpeed(I);this._speedNormalized!==j&&(this._speedNormalized=j,this._adjustStashSize(j))}if(this._enableStash)if(this._stashUsed===0&&this._stashByteStart===0&&(this._stashByteStart=A),this._stashUsed+b.byteLength<=this._stashSize)(V=new Uint8Array(this._stashBuffer,0,this._stashSize)).set(new Uint8Array(b),this._stashUsed),this._stashUsed+=b.byteLength;else if(V=new Uint8Array(this._stashBuffer,0,this._bufferSize),this._stashUsed>0){var F=this._stashBuffer.slice(0,this._stashUsed);(Q=this._dispatchChunks(F,this._stashByteStart))<F.byteLength?Q>0&&(z=new Uint8Array(F,Q),V.set(z,0),this._stashUsed=z.byteLength,this._stashByteStart+=Q):(this._stashUsed=0,this._stashByteStart+=Q),this._stashUsed+b.byteLength>this._bufferSize&&(this._expandBuffer(this._stashUsed+b.byteLength),V=new Uint8Array(this._stashBuffer,0,this._bufferSize)),V.set(new Uint8Array(b),this._stashUsed),this._stashUsed+=b.byteLength}else(Q=this._dispatchChunks(b,A))<b.byteLength&&(($=b.byteLength-Q)>this._bufferSize&&(this._expandBuffer($),V=new Uint8Array(this._stashBuffer,0,this._bufferSize)),V.set(new Uint8Array(b,Q),0),this._stashUsed+=$,this._stashByteStart=A+Q);else if(this._stashUsed===0){var $;(Q=this._dispatchChunks(b,A))<b.byteLength&&(($=b.byteLength-Q)>this._bufferSize&&this._expandBuffer($),(V=new Uint8Array(this._stashBuffer,0,this._bufferSize)).set(new Uint8Array(b,Q),0),this._stashUsed+=$,this._stashByteStart=A+Q)}else{var V,Q;if(this._stashUsed+b.byteLength>this._bufferSize&&this._expandBuffer(this._stashUsed+b.byteLength),(V=new Uint8Array(this._stashBuffer,0,this._bufferSize)).set(new Uint8Array(b),this._stashUsed),this._stashUsed+=b.byteLength,(Q=this._dispatchChunks(this._stashBuffer.slice(0,this._stashUsed),this._stashByteStart))<this._stashUsed&&Q>0){var z=new Uint8Array(this._stashBuffer,Q);V.set(z,0)}this._stashUsed-=Q,this._stashByteStart+=Q}}},C.prototype._flushStashBuffer=function(b){if(this._stashUsed>0){var A=this._stashBuffer.slice(0,this._stashUsed),L=this._dispatchChunks(A,this._stashByteStart),I=A.byteLength-L;if(L<A.byteLength){if(!b){if(L>0){var j=new Uint8Array(this._stashBuffer,0,this._bufferSize),F=new Uint8Array(A,L);j.set(F,0),this._stashUsed=F.byteLength,this._stashByteStart+=L}return 0}n.a.w(this.TAG,I+" bytes unconsumed data remain when flush buffer, dropped")}return this._stashUsed=0,this._stashByteStart=0,I}return 0},C.prototype._onLoaderComplete=function(b,A){this._flushStashBuffer(!0),this._onComplete&&this._onComplete(this._extraData)},C.prototype._onLoaderError=function(b,A){switch(n.a.e(this.TAG,"Loader error, code = "+A.code+", msg = "+A.msg),this._flushStashBuffer(!1),this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,b=a.b.UNRECOVERABLE_EARLY_EOF),b){case a.b.EARLY_EOF:if(!this._config.isLive&&this._totalLength){var L=this._currentRange.to+1;return void(L<this._totalLength&&(n.a.w(this.TAG,"Connection lost, trying reconnect..."),this._isEarlyEofReconnecting=!0,this._internalSeek(L,!1)))}b=a.b.UNRECOVERABLE_EARLY_EOF;break;case a.b.UNRECOVERABLE_EARLY_EOF:case a.b.CONNECTING_TIMEOUT:case a.b.HTTP_STATUS_CODE_INVALID:case a.b.EXCEPTION:}if(!this._onError)throw new d.d("IOException: "+A.msg);this._onError(b,A)},C}();i.a=R},function(e,i,r){var s=function(){function n(){}return n.install=function(){Object.setPrototypeOf=Object.setPrototypeOf||function(o,a){return o.__proto__=a,o},Object.assign=Object.assign||function(o){if(o==null)throw new TypeError("Cannot convert undefined or null to object");for(var a=Object(o),l=1;l<arguments.length;l++){var d=arguments[l];if(d!=null)for(var c in d)d.hasOwnProperty(c)&&(a[c]=d[c])}return a},typeof self.Promise!="function"&&r(15).polyfill()},n}();s.install(),i.a=s},function(e,i,r){function s(l){var d={};function c(h){if(d[h])return d[h].exports;var p=d[h]={i:h,l:!1,exports:{}};return l[h].call(p.exports,p,p.exports,c),p.l=!0,p.exports}c.m=l,c.c=d,c.i=function(h){return h},c.d=function(h,p,g){c.o(h,p)||Object.defineProperty(h,p,{configurable:!1,enumerable:!0,get:g})},c.r=function(h){Object.defineProperty(h,"__esModule",{value:!0})},c.n=function(h){var p=h&&h.__esModule?function(){return h.default}:function(){return h};return c.d(p,"a",p),p},c.o=function(h,p){return Object.prototype.hasOwnProperty.call(h,p)},c.p="/",c.oe=function(h){throw console.error(h),h};var f=c(c.s=ENTRY_MODULE);return f.default||f}function n(l){return(l+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function o(l,d,c){var f={};f[c]=[];var h=d.toString(),p=h.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!p)return f;for(var g,x=p[1],E=new RegExp("(\\\\n|\\W)"+n(x)+"\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)","g");g=E.exec(h);)g[3]!=="dll-reference"&&f[c].push(g[3]);for(E=new RegExp("\\("+n(x)+'\\("(dll-reference\\s([\\.|\\-|\\+|\\w|/|@]+))"\\)\\)\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)',"g");g=E.exec(h);)l[g[2]]||(f[c].push(g[1]),l[g[2]]=r(g[1]).m),f[g[2]]=f[g[2]]||[],f[g[2]].push(g[4]);for(var k,O=Object.keys(f),T=0;T<O.length;T++)for(var R=0;R<f[O[T]].length;R++)k=f[O[T]][R],isNaN(1*k)||(f[O[T]][R]=1*f[O[T]][R]);return f}function a(l){return Object.keys(l).reduce(function(d,c){return d||l[c].length>0},!1)}e.exports=function(l,d){d=d||{};var c={main:r.m},f=d.all?{main:Object.keys(c.main)}:function(E,k){for(var O={main:[k]},T={main:[]},R={main:{}};a(O);)for(var C=Object.keys(O),b=0;b<C.length;b++){var A=C[b],L=O[A].pop();if(R[A]=R[A]||{},!R[A][L]&&E[A][L]){R[A][L]=!0,T[A]=T[A]||[],T[A].push(L);for(var I=o(E,E[A][L],A),j=Object.keys(I),F=0;F<j.length;F++)O[j[F]]=O[j[F]]||[],O[j[F]]=O[j[F]].concat(I[j[F]])}}return T}(c,l),h="";Object.keys(f).filter(function(E){return E!=="main"}).forEach(function(E){for(var k=0;f[E][k];)k++;f[E].push(k),c[E][k]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",h=h+"var "+E+" = ("+s.toString().replace("ENTRY_MODULE",JSON.stringify(k))+")({"+f[E].map(function(O){return JSON.stringify(O)+": "+c[E][O].toString()}).join(",")+`});
`}),h=h+"new (("+s.toString().replace("ENTRY_MODULE",JSON.stringify(l))+")({"+f.main.map(function(E){return JSON.stringify(E)+": "+c.main[E].toString()}).join(",")+"}))(self);";var p=new window.Blob([h],{type:"text/javascript"});if(d.bare)return p;var g=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(p),x=new window.Worker(g);return x.objectURL=g,x}},function(e,i,r){e.exports=r(19).default},function(e,i,r){(function(s,n){/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   v4.2.8+1e68dce6
 */var o;o=function(){function a(it){return typeof it=="function"}var l=Array.isArray?Array.isArray:function(it){return Object.prototype.toString.call(it)==="[object Array]"},d=0,c=void 0,f=void 0,h=function(it,at){T[d]=it,T[d+1]=at,(d+=2)===2&&(f?f(R):I())},p=typeof window!="undefined"?window:void 0,g=p||{},x=g.MutationObserver||g.WebKitMutationObserver,E=typeof self=="undefined"&&s!==void 0&&{}.toString.call(s)==="[object process]",k=typeof Uint8ClampedArray!="undefined"&&typeof importScripts!="undefined"&&typeof MessageChannel!="undefined";function O(){var it=setTimeout;return function(){return it(R,1)}}var T=new Array(1e3);function R(){for(var it=0;it<d;it+=2)(0,T[it])(T[it+1]),T[it]=void 0,T[it+1]=void 0;d=0}var C,b,A,L,I=void 0;function j(it,at){var lt=this,ct=new this.constructor(V);ct[$]===void 0&&vt(ct);var mt=lt._state;if(mt){var It=arguments[mt-1];h(function(){return rt(mt,ct,It,lt._result)})}else G(lt,ct,it,at);return ct}function F(it){if(it&&typeof it=="object"&&it.constructor===this)return it;var at=new this(V);return z(at,it),at}E?I=function(){return s.nextTick(R)}:x?(b=0,A=new x(R),L=document.createTextNode(""),A.observe(L,{characterData:!0}),I=function(){L.data=b=++b%2}):k?((C=new MessageChannel).port1.onmessage=R,I=function(){return C.port2.postMessage(0)}):I=p===void 0?function(){try{var it=Function("return this")().require("vertx");return(c=it.runOnLoop||it.runOnContext)!==void 0?function(){c(R)}:O()}catch(at){return O()}}():O();var $=Math.random().toString(36).substring(2);function V(){}function Q(it,at,lt){at.constructor===it.constructor&&lt===j&&at.constructor.resolve===F?function(ct,mt){mt._state===1?w(ct,mt._result):mt._state===2?P(ct,mt._result):G(mt,void 0,function(It){return z(ct,It)},function(It){return P(ct,It)})}(it,at):lt===void 0?w(it,at):a(lt)?function(ct,mt,It){h(function(Gt){var Xt=!1,se=function(Yt,Et,We,le){try{Yt.call(Et,We,le)}catch(Ae){return Ae}}(It,mt,function(Yt){Xt||(Xt=!0,mt!==Yt?z(Gt,Yt):w(Gt,Yt))},function(Yt){Xt||(Xt=!0,P(Gt,Yt))},Gt._label);!Xt&&se&&(Xt=!0,P(Gt,se))},ct)}(it,at,lt):w(it,at)}function z(it,at){if(it===at)P(it,new TypeError("You cannot resolve a promise with itself"));else if(mt=typeof(ct=at),ct===null||mt!=="object"&&mt!=="function")w(it,at);else{var lt=void 0;try{lt=at.then}catch(It){return void P(it,It)}Q(it,at,lt)}var ct,mt}function B(it){it._onerror&&it._onerror(it._result),et(it)}function w(it,at){it._state===void 0&&(it._result=at,it._state=1,it._subscribers.length!==0&&h(et,it))}function P(it,at){it._state===void 0&&(it._state=2,it._result=at,h(B,it))}function G(it,at,lt,ct){var mt=it._subscribers,It=mt.length;it._onerror=null,mt[It]=at,mt[It+1]=lt,mt[It+2]=ct,It===0&&it._state&&h(et,it)}function et(it){var at=it._subscribers,lt=it._state;if(at.length!==0){for(var ct=void 0,mt=void 0,It=it._result,Gt=0;Gt<at.length;Gt+=3)ct=at[Gt],mt=at[Gt+lt],ct?rt(lt,ct,mt,It):mt(It);it._subscribers.length=0}}function rt(it,at,lt,ct){var mt=a(lt),It=void 0,Gt=void 0,Xt=!0;if(mt){try{It=lt(ct)}catch(se){Xt=!1,Gt=se}if(at===It)return void P(at,new TypeError("A promises callback cannot return that same promise."))}else It=ct;at._state!==void 0||(mt&&Xt?z(at,It):Xt===!1?P(at,Gt):it===1?w(at,It):it===2&&P(at,It))}var dt=0;function vt(it){it[$]=dt++,it._state=void 0,it._result=void 0,it._subscribers=[]}var Lt=function(){function it(at,lt){this._instanceConstructor=at,this.promise=new at(V),this.promise[$]||vt(this.promise),l(lt)?(this.length=lt.length,this._remaining=lt.length,this._result=new Array(this.length),this.length===0?w(this.promise,this._result):(this.length=this.length||0,this._enumerate(lt),this._remaining===0&&w(this.promise,this._result))):P(this.promise,new Error("Array Methods must be provided an Array"))}return it.prototype._enumerate=function(at){for(var lt=0;this._state===void 0&&lt<at.length;lt++)this._eachEntry(at[lt],lt)},it.prototype._eachEntry=function(at,lt){var ct=this._instanceConstructor,mt=ct.resolve;if(mt===F){var It=void 0,Gt=void 0,Xt=!1;try{It=at.then}catch(Yt){Xt=!0,Gt=Yt}if(It===j&&at._state!==void 0)this._settledAt(at._state,lt,at._result);else if(typeof It!="function")this._remaining--,this._result[lt]=at;else if(ct===xt){var se=new ct(V);Xt?P(se,Gt):Q(se,at,It),this._willSettleAt(se,lt)}else this._willSettleAt(new ct(function(Yt){return Yt(at)}),lt)}else this._willSettleAt(mt(at),lt)},it.prototype._settledAt=function(at,lt,ct){var mt=this.promise;mt._state===void 0&&(this._remaining--,at===2?P(mt,ct):this._result[lt]=ct),this._remaining===0&&w(mt,this._result)},it.prototype._willSettleAt=function(at,lt){var ct=this;G(at,void 0,function(mt){return ct._settledAt(1,lt,mt)},function(mt){return ct._settledAt(2,lt,mt)})},it}(),xt=function(){function it(at){this[$]=dt++,this._result=this._state=void 0,this._subscribers=[],V!==at&&(typeof at!="function"&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof it?function(lt,ct){try{ct(function(mt){z(lt,mt)},function(mt){P(lt,mt)})}catch(mt){P(lt,mt)}}(this,at):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return it.prototype.catch=function(at){return this.then(null,at)},it.prototype.finally=function(at){var lt=this.constructor;return a(at)?this.then(function(ct){return lt.resolve(at()).then(function(){return ct})},function(ct){return lt.resolve(at()).then(function(){throw ct})}):this.then(at,at)},it}();return xt.prototype.then=j,xt.all=function(it){return new Lt(this,it).promise},xt.race=function(it){var at=this;return l(it)?new at(function(lt,ct){for(var mt=it.length,It=0;It<mt;It++)at.resolve(it[It]).then(lt,ct)}):new at(function(lt,ct){return ct(new TypeError("You must pass an array to race."))})},xt.resolve=F,xt.reject=function(it){var at=new this(V);return P(at,it),at},xt._setScheduler=function(it){f=it},xt._setAsap=function(it){h=it},xt._asap=h,xt.polyfill=function(){var it=void 0;if(n!==void 0)it=n;else if(typeof self!="undefined")it=self;else try{it=Function("return this")()}catch(ct){throw new Error("polyfill failed because global object is unavailable in this environment")}var at=it.Promise;if(at){var lt=null;try{lt=Object.prototype.toString.call(at.resolve())}catch(ct){}if(lt==="[object Promise]"&&!at.cast)return}it.Promise=xt},xt.Promise=xt,xt},e.exports=o()}).call(this,r(16),r(17))},function(e,i){var r,s,n=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function l(k){if(r===setTimeout)return setTimeout(k,0);if((r===o||!r)&&setTimeout)return r=setTimeout,setTimeout(k,0);try{return r(k,0)}catch(O){try{return r.call(null,k,0)}catch(T){return r.call(this,k,0)}}}(function(){try{r=typeof setTimeout=="function"?setTimeout:o}catch(k){r=o}try{s=typeof clearTimeout=="function"?clearTimeout:a}catch(k){s=a}})();var d,c=[],f=!1,h=-1;function p(){f&&d&&(f=!1,d.length?c=d.concat(c):h=-1,c.length&&g())}function g(){if(!f){var k=l(p);f=!0;for(var O=c.length;O;){for(d=c,c=[];++h<O;)d&&d[h].run();h=-1,O=c.length}d=null,f=!1,function(T){if(s===clearTimeout)return clearTimeout(T);if((s===a||!s)&&clearTimeout)return s=clearTimeout,clearTimeout(T);try{s(T)}catch(R){try{return s.call(null,T)}catch(C){return s.call(this,T)}}}(k)}}function x(k,O){this.fun=k,this.array=O}function E(){}n.nextTick=function(k){var O=new Array(arguments.length-1);if(arguments.length>1)for(var T=1;T<arguments.length;T++)O[T-1]=arguments[T];c.push(new x(k,O)),c.length!==1||f||l(g)},x.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=E,n.addListener=E,n.once=E,n.off=E,n.removeListener=E,n.removeAllListeners=E,n.emit=E,n.prependListener=E,n.prependOnceListener=E,n.listeners=function(k){return[]},n.binding=function(k){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(k){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},function(e,i){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(s){typeof window=="object"&&(r=window)}e.exports=r},function(e,i,r){r.r(i);var s=r(9),n=r(12),o=r(10),a=r(1);i.default=function(l){var d=null,c=function(F,$){l.postMessage({msg:"logcat_callback",data:{type:F,logcat:$}})}.bind(this);function f(F,$){var V={msg:a.a.INIT_SEGMENT,data:{type:F,data:$}};l.postMessage(V,[$.data])}function h(F,$){var V={msg:a.a.MEDIA_SEGMENT,data:{type:F,data:$}};l.postMessage(V,[$.data])}function p(){var F={msg:a.a.LOADING_COMPLETE};l.postMessage(F)}function g(){var F={msg:a.a.RECOVERED_EARLY_EOF};l.postMessage(F)}function x(F){var $={msg:a.a.MEDIA_INFO,data:F};l.postMessage($)}function E(F){var $={msg:a.a.METADATA_ARRIVED,data:F};l.postMessage($)}function k(F){var $={msg:a.a.SCRIPTDATA_ARRIVED,data:F};l.postMessage($)}function O(F){var $={msg:a.a.TIMED_ID3_METADATA_ARRIVED,data:F};l.postMessage($)}function T(F){var $={msg:a.a.SMPTE2038_METADATA_ARRIVED,data:F};l.postMessage($)}function R(F){var $={msg:a.a.SCTE35_METADATA_ARRIVED,data:F};l.postMessage($)}function C(F){var $={msg:a.a.PES_PRIVATE_DATA_DESCRIPTOR,data:F};l.postMessage($)}function b(F){var $={msg:a.a.PES_PRIVATE_DATA_ARRIVED,data:F};l.postMessage($)}function A(F){var $={msg:a.a.STATISTICS_INFO,data:F};l.postMessage($)}function L(F,$){l.postMessage({msg:a.a.IO_ERROR,data:{type:F,info:$}})}function I(F,$){l.postMessage({msg:a.a.DEMUX_ERROR,data:{type:F,info:$}})}function j(F){l.postMessage({msg:a.a.RECOMMEND_SEEKPOINT,data:F})}n.a.install(),l.addEventListener("message",function(F){switch(F.data.cmd){case"init":(d=new o.a(F.data.param[0],F.data.param[1])).on(a.a.IO_ERROR,L.bind(this)),d.on(a.a.DEMUX_ERROR,I.bind(this)),d.on(a.a.INIT_SEGMENT,f.bind(this)),d.on(a.a.MEDIA_SEGMENT,h.bind(this)),d.on(a.a.LOADING_COMPLETE,p.bind(this)),d.on(a.a.RECOVERED_EARLY_EOF,g.bind(this)),d.on(a.a.MEDIA_INFO,x.bind(this)),d.on(a.a.METADATA_ARRIVED,E.bind(this)),d.on(a.a.SCRIPTDATA_ARRIVED,k.bind(this)),d.on(a.a.TIMED_ID3_METADATA_ARRIVED,O.bind(this)),d.on(a.a.SMPTE2038_METADATA_ARRIVED,T.bind(this)),d.on(a.a.SCTE35_METADATA_ARRIVED,R.bind(this)),d.on(a.a.PES_PRIVATE_DATA_DESCRIPTOR,C.bind(this)),d.on(a.a.PES_PRIVATE_DATA_ARRIVED,b.bind(this)),d.on(a.a.STATISTICS_INFO,A.bind(this)),d.on(a.a.RECOMMEND_SEEKPOINT,j.bind(this));break;case"destroy":d&&(d.destroy(),d=null),l.postMessage({msg:"destroyed"});break;case"start":d.start();break;case"stop":d.stop();break;case"seek":d.seek(F.data.param);break;case"pause":d.pause();break;case"resume":d.resume();break;case"logging_config":var $=F.data.param;s.a.applyConfig($),$.enableCallback===!0?s.a.addLogListener(c):s.a.removeLogListener(c)}})}},function(e,i,r){r.r(i);var s=r(12),n=r(11),o={enableWorker:!1,enableStashBuffer:!0,stashInitialSize:void 0,isLive:!1,liveBufferLatencyChasing:!1,liveBufferLatencyMaxLatency:1.5,liveBufferLatencyMinRemain:.5,lazyLoad:!0,lazyLoadMaxDuration:180,lazyLoadRecoverDuration:30,deferLoadAfterSourceOpen:!0,autoCleanupMaxBackwardDuration:180,autoCleanupMinBackwardDuration:120,statisticsInfoReportInterval:600,fixAudioTimestampGap:!0,accurateSeek:!1,seekType:"range",seekParamStart:"bstart",seekParamEnd:"bend",rangeLoadZeroStart:!1,customSeekHandler:void 0,reuseRedirectedURL:!1,headers:void 0,customLoader:void 0};function a(){return Object.assign({},o)}var l=function(){function B(){}return B.supportMSEH264Playback=function(){return window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')},B.supportMSEH265Playback=function(){return window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="hvc1.1.6.L93.B0"')},B.supportNetworkStreamIO=function(){var w=new n.a({},a()),P=w.loaderType;return w.destroy(),P=="fetch-stream-loader"||P=="xhr-moz-chunked-loader"},B.getNetworkLoaderTypeName=function(){var w=new n.a({},a()),P=w.loaderType;return w.destroy(),P},B.supportNativeMediaPlayback=function(w){B.videoElement==null&&(B.videoElement=window.document.createElement("video"));var P=B.videoElement.canPlayType(w);return P==="probably"||P=="maybe"},B.getFeatureList=function(){var w={msePlayback:!1,mseLivePlayback:!1,mseH265Playback:!1,networkStreamIO:!1,networkLoaderName:"",nativeMP4H264Playback:!1,nativeMP4H265Playback:!1,nativeWebmVP8Playback:!1,nativeWebmVP9Playback:!1};return w.msePlayback=B.supportMSEH264Playback(),w.networkStreamIO=B.supportNetworkStreamIO(),w.networkLoaderName=B.getNetworkLoaderTypeName(),w.mseLivePlayback=w.msePlayback&&w.networkStreamIO,w.mseH265Playback=B.supportMSEH265Playback(),w.nativeMP4H264Playback=B.supportNativeMediaPlayback('video/mp4; codecs="avc1.42001E, mp4a.40.2"'),w.nativeMP4H265Playback=B.supportNativeMediaPlayback('video/mp4; codecs="hvc1.1.6.L93.B0"'),w.nativeWebmVP8Playback=B.supportNativeMediaPlayback('video/webm; codecs="vp8.0, vorbis"'),w.nativeWebmVP9Playback=B.supportNativeMediaPlayback('video/webm; codecs="vp9"'),w},B}(),d=r(2),c=r(6),f=r.n(c),h=r(0),p=r(4),g={ERROR:"error",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",METADATA_ARRIVED:"metadata_arrived",SCRIPTDATA_ARRIVED:"scriptdata_arrived",TIMED_ID3_METADATA_ARRIVED:"timed_id3_metadata_arrived",SMPTE2038_METADATA_ARRIVED:"smpte2038_metadata_arrived",SCTE35_METADATA_ARRIVED:"scte35_metadata_arrived",PES_PRIVATE_DATA_DESCRIPTOR:"pes_private_data_descriptor",PES_PRIVATE_DATA_ARRIVED:"pes_private_data_arrived",STATISTICS_INFO:"statistics_info"},x=r(13),E=r.n(x),k=r(9),O=r(10),T=r(1),R=r(8),C=function(){function B(w,P){if(this.TAG="Transmuxer",this._emitter=new f.a,P.enableWorker&&typeof Worker!="undefined")try{this._worker=E()(18),this._workerDestroying=!1,this._worker.addEventListener("message",this._onWorkerMessage.bind(this)),this._worker.postMessage({cmd:"init",param:[w,P]}),this.e={onLoggingConfigChanged:this._onLoggingConfigChanged.bind(this)},k.a.registerListener(this.e.onLoggingConfigChanged),this._worker.postMessage({cmd:"logging_config",param:k.a.getConfig()})}catch(et){h.a.e(this.TAG,"Error while initialize transmuxing worker, fallback to inline transmuxing"),this._worker=null,this._controller=new O.a(w,P)}else this._controller=new O.a(w,P);if(this._controller){var G=this._controller;G.on(T.a.IO_ERROR,this._onIOError.bind(this)),G.on(T.a.DEMUX_ERROR,this._onDemuxError.bind(this)),G.on(T.a.INIT_SEGMENT,this._onInitSegment.bind(this)),G.on(T.a.MEDIA_SEGMENT,this._onMediaSegment.bind(this)),G.on(T.a.LOADING_COMPLETE,this._onLoadingComplete.bind(this)),G.on(T.a.RECOVERED_EARLY_EOF,this._onRecoveredEarlyEof.bind(this)),G.on(T.a.MEDIA_INFO,this._onMediaInfo.bind(this)),G.on(T.a.METADATA_ARRIVED,this._onMetaDataArrived.bind(this)),G.on(T.a.SCRIPTDATA_ARRIVED,this._onScriptDataArrived.bind(this)),G.on(T.a.TIMED_ID3_METADATA_ARRIVED,this._onTimedID3MetadataArrived.bind(this)),G.on(T.a.SMPTE2038_METADATA_ARRIVED,this._onSMPTE2038MetadataArrived.bind(this)),G.on(T.a.SCTE35_METADATA_ARRIVED,this._onSCTE35MetadataArrived.bind(this)),G.on(T.a.PES_PRIVATE_DATA_DESCRIPTOR,this._onPESPrivateDataDescriptor.bind(this)),G.on(T.a.PES_PRIVATE_DATA_ARRIVED,this._onPESPrivateDataArrived.bind(this)),G.on(T.a.STATISTICS_INFO,this._onStatisticsInfo.bind(this)),G.on(T.a.RECOMMEND_SEEKPOINT,this._onRecommendSeekpoint.bind(this))}}return B.prototype.destroy=function(){this._worker?this._workerDestroying||(this._workerDestroying=!0,this._worker.postMessage({cmd:"destroy"}),k.a.removeListener(this.e.onLoggingConfigChanged),this.e=null):(this._controller.destroy(),this._controller=null),this._emitter.removeAllListeners(),this._emitter=null},B.prototype.on=function(w,P){this._emitter.addListener(w,P)},B.prototype.off=function(w,P){this._emitter.removeListener(w,P)},B.prototype.hasWorker=function(){return this._worker!=null},B.prototype.open=function(){this._worker?this._worker.postMessage({cmd:"start"}):this._controller.start()},B.prototype.close=function(){this._worker?this._worker.postMessage({cmd:"stop"}):this._controller.stop()},B.prototype.seek=function(w){this._worker?this._worker.postMessage({cmd:"seek",param:w}):this._controller.seek(w)},B.prototype.pause=function(){this._worker?this._worker.postMessage({cmd:"pause"}):this._controller.pause()},B.prototype.resume=function(){this._worker?this._worker.postMessage({cmd:"resume"}):this._controller.resume()},B.prototype._onInitSegment=function(w,P){var G=this;Promise.resolve().then(function(){G._emitter.emit(T.a.INIT_SEGMENT,w,P)})},B.prototype._onMediaSegment=function(w,P){var G=this;Promise.resolve().then(function(){G._emitter.emit(T.a.MEDIA_SEGMENT,w,P)})},B.prototype._onLoadingComplete=function(){var w=this;Promise.resolve().then(function(){w._emitter.emit(T.a.LOADING_COMPLETE)})},B.prototype._onRecoveredEarlyEof=function(){var w=this;Promise.resolve().then(function(){w._emitter.emit(T.a.RECOVERED_EARLY_EOF)})},B.prototype._onMediaInfo=function(w){var P=this;Promise.resolve().then(function(){P._emitter.emit(T.a.MEDIA_INFO,w)})},B.prototype._onMetaDataArrived=function(w){var P=this;Promise.resolve().then(function(){P._emitter.emit(T.a.METADATA_ARRIVED,w)})},B.prototype._onScriptDataArrived=function(w){var P=this;Promise.resolve().then(function(){P._emitter.emit(T.a.SCRIPTDATA_ARRIVED,w)})},B.prototype._onTimedID3MetadataArrived=function(w){var P=this;Promise.resolve().then(function(){P._emitter.emit(T.a.TIMED_ID3_METADATA_ARRIVED,w)})},B.prototype._onSMPTE2038MetadataArrived=function(w){var P=this;Promise.resolve().then(function(){P._emitter.emit(T.a.SMPTE2038_METADATA_ARRIVED,w)})},B.prototype._onSCTE35MetadataArrived=function(w){var P=this;Promise.resolve().then(function(){P._emitter.emit(T.a.SCTE35_METADATA_ARRIVED,w)})},B.prototype._onPESPrivateDataDescriptor=function(w){var P=this;Promise.resolve().then(function(){P._emitter.emit(T.a.PES_PRIVATE_DATA_DESCRIPTOR,w)})},B.prototype._onPESPrivateDataArrived=function(w){var P=this;Promise.resolve().then(function(){P._emitter.emit(T.a.PES_PRIVATE_DATA_ARRIVED,w)})},B.prototype._onStatisticsInfo=function(w){var P=this;Promise.resolve().then(function(){P._emitter.emit(T.a.STATISTICS_INFO,w)})},B.prototype._onIOError=function(w,P){var G=this;Promise.resolve().then(function(){G._emitter.emit(T.a.IO_ERROR,w,P)})},B.prototype._onDemuxError=function(w,P){var G=this;Promise.resolve().then(function(){G._emitter.emit(T.a.DEMUX_ERROR,w,P)})},B.prototype._onRecommendSeekpoint=function(w){var P=this;Promise.resolve().then(function(){P._emitter.emit(T.a.RECOMMEND_SEEKPOINT,w)})},B.prototype._onLoggingConfigChanged=function(w){this._worker&&this._worker.postMessage({cmd:"logging_config",param:w})},B.prototype._onWorkerMessage=function(w){var P=w.data,G=P.data;if(P.msg==="destroyed"||this._workerDestroying)return this._workerDestroying=!1,this._worker.terminate(),void(this._worker=null);switch(P.msg){case T.a.INIT_SEGMENT:case T.a.MEDIA_SEGMENT:this._emitter.emit(P.msg,G.type,G.data);break;case T.a.LOADING_COMPLETE:case T.a.RECOVERED_EARLY_EOF:this._emitter.emit(P.msg);break;case T.a.MEDIA_INFO:Object.setPrototypeOf(G,R.a.prototype),this._emitter.emit(P.msg,G);break;case T.a.METADATA_ARRIVED:case T.a.SCRIPTDATA_ARRIVED:case T.a.TIMED_ID3_METADATA_ARRIVED:case T.a.SMPTE2038_METADATA_ARRIVED:case T.a.SCTE35_METADATA_ARRIVED:case T.a.PES_PRIVATE_DATA_DESCRIPTOR:case T.a.PES_PRIVATE_DATA_ARRIVED:case T.a.STATISTICS_INFO:this._emitter.emit(P.msg,G);break;case T.a.IO_ERROR:case T.a.DEMUX_ERROR:this._emitter.emit(P.msg,G.type,G.info);break;case T.a.RECOMMEND_SEEKPOINT:this._emitter.emit(P.msg,G);break;case"logcat_callback":h.a.emitter.emit("log",G.type,G.logcat)}},B}(),b={ERROR:"error",SOURCE_OPEN:"source_open",UPDATE_END:"update_end",BUFFER_FULL:"buffer_full"},A=r(7),L=r(3),I=function(){function B(w){this.TAG="MSEController",this._config=w,this._emitter=new f.a,this._config.isLive&&this._config.autoCleanupSourceBuffer==null&&(this._config.autoCleanupSourceBuffer=!0),this.e={onSourceOpen:this._onSourceOpen.bind(this),onSourceEnded:this._onSourceEnded.bind(this),onSourceClose:this._onSourceClose.bind(this),onSourceBufferError:this._onSourceBufferError.bind(this),onSourceBufferUpdateEnd:this._onSourceBufferUpdateEnd.bind(this)},this._mediaSource=null,this._mediaSourceObjectURL=null,this._mediaElement=null,this._isBufferFull=!1,this._hasPendingEos=!1,this._requireSetMediaDuration=!1,this._pendingMediaDuration=0,this._pendingSourceBufferInit=[],this._mimeTypes={video:null,audio:null},this._sourceBuffers={video:null,audio:null},this._lastInitSegments={video:null,audio:null},this._pendingSegments={video:[],audio:[]},this._pendingRemoveRanges={video:[],audio:[]},this._idrList=new A.a}return B.prototype.destroy=function(){(this._mediaElement||this._mediaSource)&&this.detachMediaElement(),this.e=null,this._emitter.removeAllListeners(),this._emitter=null},B.prototype.on=function(w,P){this._emitter.addListener(w,P)},B.prototype.off=function(w,P){this._emitter.removeListener(w,P)},B.prototype.attachMediaElement=function(w){if(this._mediaSource)throw new L.a("MediaSource has been attached to an HTMLMediaElement!");var P=this._mediaSource=new window.MediaSource;P.addEventListener("sourceopen",this.e.onSourceOpen),P.addEventListener("sourceended",this.e.onSourceEnded),P.addEventListener("sourceclose",this.e.onSourceClose),this._mediaElement=w,this._mediaSourceObjectURL=window.URL.createObjectURL(this._mediaSource),w.src=this._mediaSourceObjectURL},B.prototype.detachMediaElement=function(){if(this._mediaSource){var w=this._mediaSource;for(var P in this._sourceBuffers){var G=this._pendingSegments[P];G.splice(0,G.length),this._pendingSegments[P]=null,this._pendingRemoveRanges[P]=null,this._lastInitSegments[P]=null;var et=this._sourceBuffers[P];if(et){if(w.readyState!=="closed"){try{w.removeSourceBuffer(et)}catch(rt){h.a.e(this.TAG,rt.message)}et.removeEventListener("error",this.e.onSourceBufferError),et.removeEventListener("updateend",this.e.onSourceBufferUpdateEnd)}this._mimeTypes[P]=null,this._sourceBuffers[P]=null}}if(w.readyState==="open")try{w.endOfStream()}catch(rt){h.a.e(this.TAG,rt.message)}w.removeEventListener("sourceopen",this.e.onSourceOpen),w.removeEventListener("sourceended",this.e.onSourceEnded),w.removeEventListener("sourceclose",this.e.onSourceClose),this._pendingSourceBufferInit=[],this._isBufferFull=!1,this._idrList.clear(),this._mediaSource=null}this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement=null),this._mediaSourceObjectURL&&(window.URL.revokeObjectURL(this._mediaSourceObjectURL),this._mediaSourceObjectURL=null)},B.prototype.appendInitSegment=function(w,P){if(!this._mediaSource||this._mediaSource.readyState!=="open")return this._pendingSourceBufferInit.push(w),void this._pendingSegments[w.type].push(w);var G=w,et=""+G.container;G.codec&&G.codec.length>0&&(et+=";codecs="+G.codec);var rt=!1;if(h.a.v(this.TAG,"Received Initialization Segment, mimeType: "+et),this._lastInitSegments[G.type]=G,et!==this._mimeTypes[G.type]){if(this._mimeTypes[G.type])h.a.v(this.TAG,"Notice: "+G.type+" mimeType changed, origin: "+this._mimeTypes[G.type]+", target: "+et);else{rt=!0;try{var dt=this._sourceBuffers[G.type]=this._mediaSource.addSourceBuffer(et);dt.addEventListener("error",this.e.onSourceBufferError),dt.addEventListener("updateend",this.e.onSourceBufferUpdateEnd)}catch(vt){return h.a.e(this.TAG,vt.message),void this._emitter.emit(b.ERROR,{code:vt.code,msg:vt.message})}}this._mimeTypes[G.type]=et}P||this._pendingSegments[G.type].push(G),rt||this._sourceBuffers[G.type]&&!this._sourceBuffers[G.type].updating&&this._doAppendSegments(),p.a.safari&&G.container==="audio/mpeg"&&G.mediaDuration>0&&(this._requireSetMediaDuration=!0,this._pendingMediaDuration=G.mediaDuration/1e3,this._updateMediaSourceDuration())},B.prototype.appendMediaSegment=function(w){var P=w;this._pendingSegments[P.type].push(P),this._config.autoCleanupSourceBuffer&&this._needCleanupSourceBuffer()&&this._doCleanupSourceBuffer();var G=this._sourceBuffers[P.type];!G||G.updating||this._hasPendingRemoveRanges()||this._doAppendSegments()},B.prototype.seek=function(w){for(var P in this._sourceBuffers)if(this._sourceBuffers[P]){var G=this._sourceBuffers[P];if(this._mediaSource.readyState==="open")try{G.abort()}catch(xt){h.a.e(this.TAG,xt.message)}this._idrList.clear();var et=this._pendingSegments[P];if(et.splice(0,et.length),this._mediaSource.readyState!=="closed"){for(var rt=0;rt<G.buffered.length;rt++){var dt=G.buffered.start(rt),vt=G.buffered.end(rt);this._pendingRemoveRanges[P].push({start:dt,end:vt})}if(G.updating||this._doRemoveRanges(),p.a.safari){var Lt=this._lastInitSegments[P];Lt&&(this._pendingSegments[P].push(Lt),G.updating||this._doAppendSegments())}}}},B.prototype.endOfStream=function(){var w=this._mediaSource,P=this._sourceBuffers;w&&w.readyState==="open"?P.video&&P.video.updating||P.audio&&P.audio.updating?this._hasPendingEos=!0:(this._hasPendingEos=!1,w.endOfStream()):w&&w.readyState==="closed"&&this._hasPendingSegments()&&(this._hasPendingEos=!0)},B.prototype.getNearestKeyframe=function(w){return this._idrList.getLastSyncPointBeforeDts(w)},B.prototype._needCleanupSourceBuffer=function(){if(!this._config.autoCleanupSourceBuffer)return!1;var w=this._mediaElement.currentTime;for(var P in this._sourceBuffers){var G=this._sourceBuffers[P];if(G){var et=G.buffered;if(et.length>=1&&w-et.start(0)>=this._config.autoCleanupMaxBackwardDuration)return!0}}return!1},B.prototype._doCleanupSourceBuffer=function(){var w=this._mediaElement.currentTime;for(var P in this._sourceBuffers){var G=this._sourceBuffers[P];if(G){for(var et=G.buffered,rt=!1,dt=0;dt<et.length;dt++){var vt=et.start(dt),Lt=et.end(dt);if(vt<=w&&w<Lt+3){if(w-vt>=this._config.autoCleanupMaxBackwardDuration){rt=!0;var xt=w-this._config.autoCleanupMinBackwardDuration;this._pendingRemoveRanges[P].push({start:vt,end:xt})}}else Lt<w&&(rt=!0,this._pendingRemoveRanges[P].push({start:vt,end:Lt}))}rt&&!G.updating&&this._doRemoveRanges()}}},B.prototype._updateMediaSourceDuration=function(){var w=this._sourceBuffers;if(this._mediaElement.readyState!==0&&this._mediaSource.readyState==="open"&&!(w.video&&w.video.updating||w.audio&&w.audio.updating)){var P=this._mediaSource.duration,G=this._pendingMediaDuration;G>0&&(isNaN(P)||G>P)&&(h.a.v(this.TAG,"Update MediaSource duration from "+P+" to "+G),this._mediaSource.duration=G),this._requireSetMediaDuration=!1,this._pendingMediaDuration=0}},B.prototype._doRemoveRanges=function(){for(var w in this._pendingRemoveRanges)if(this._sourceBuffers[w]&&!this._sourceBuffers[w].updating)for(var P=this._sourceBuffers[w],G=this._pendingRemoveRanges[w];G.length&&!P.updating;){var et=G.shift();P.remove(et.start,et.end)}},B.prototype._doAppendSegments=function(){var w=this._pendingSegments;for(var P in w)if(this._sourceBuffers[P]&&!this._sourceBuffers[P].updating&&w[P].length>0){var G=w[P].shift();if(G.timestampOffset){var et=this._sourceBuffers[P].timestampOffset,rt=G.timestampOffset/1e3;Math.abs(et-rt)>.1&&(h.a.v(this.TAG,"Update MPEG audio timestampOffset from "+et+" to "+rt),this._sourceBuffers[P].timestampOffset=rt),delete G.timestampOffset}if(!G.data||G.data.byteLength===0)continue;try{this._sourceBuffers[P].appendBuffer(G.data),this._isBufferFull=!1,P==="video"&&G.hasOwnProperty("info")&&this._idrList.appendArray(G.info.syncPoints)}catch(dt){this._pendingSegments[P].unshift(G),dt.code===22?(this._isBufferFull||this._emitter.emit(b.BUFFER_FULL),this._isBufferFull=!0):(h.a.e(this.TAG,dt.message),this._emitter.emit(b.ERROR,{code:dt.code,msg:dt.message}))}}},B.prototype._onSourceOpen=function(){if(h.a.v(this.TAG,"MediaSource onSourceOpen"),this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._pendingSourceBufferInit.length>0)for(var w=this._pendingSourceBufferInit;w.length;){var P=w.shift();this.appendInitSegment(P,!0)}this._hasPendingSegments()&&this._doAppendSegments(),this._emitter.emit(b.SOURCE_OPEN)},B.prototype._onSourceEnded=function(){h.a.v(this.TAG,"MediaSource onSourceEnded")},B.prototype._onSourceClose=function(){h.a.v(this.TAG,"MediaSource onSourceClose"),this._mediaSource&&this.e!=null&&(this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._mediaSource.removeEventListener("sourceended",this.e.onSourceEnded),this._mediaSource.removeEventListener("sourceclose",this.e.onSourceClose))},B.prototype._hasPendingSegments=function(){var w=this._pendingSegments;return w.video.length>0||w.audio.length>0},B.prototype._hasPendingRemoveRanges=function(){var w=this._pendingRemoveRanges;return w.video.length>0||w.audio.length>0},B.prototype._onSourceBufferUpdateEnd=function(){this._requireSetMediaDuration?this._updateMediaSourceDuration():this._hasPendingRemoveRanges()?this._doRemoveRanges():this._hasPendingSegments()?this._doAppendSegments():this._hasPendingEos&&this.endOfStream(),this._emitter.emit(b.UPDATE_END)},B.prototype._onSourceBufferError=function(w){h.a.e(this.TAG,"SourceBuffer Error: "+w)},B}(),j=r(5),F={NETWORK_ERROR:"NetworkError",MEDIA_ERROR:"MediaError",OTHER_ERROR:"OtherError"},$={NETWORK_EXCEPTION:d.b.EXCEPTION,NETWORK_STATUS_CODE_INVALID:d.b.HTTP_STATUS_CODE_INVALID,NETWORK_TIMEOUT:d.b.CONNECTING_TIMEOUT,NETWORK_UNRECOVERABLE_EARLY_EOF:d.b.UNRECOVERABLE_EARLY_EOF,MEDIA_MSE_ERROR:"MediaMSEError",MEDIA_FORMAT_ERROR:j.a.FORMAT_ERROR,MEDIA_FORMAT_UNSUPPORTED:j.a.FORMAT_UNSUPPORTED,MEDIA_CODEC_UNSUPPORTED:j.a.CODEC_UNSUPPORTED},V=function(){function B(w,P){this.TAG="MSEPlayer",this._type="MSEPlayer",this._emitter=new f.a,this._config=a(),typeof P=="object"&&Object.assign(this._config,P);var G=w.type.toLowerCase();if(G!=="mse"&&G!=="mpegts"&&G!=="m2ts"&&G!=="flv")throw new L.b("MSEPlayer requires an mpegts/m2ts/flv MediaDataSource input!");w.isLive===!0&&(this._config.isLive=!0),this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this),onvSeeking:this._onvSeeking.bind(this),onvCanPlay:this._onvCanPlay.bind(this),onvStalled:this._onvStalled.bind(this),onvProgress:this._onvProgress.bind(this)},self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now,this._pendingSeekTime=null,this._requestSetTime=!1,this._seekpointRecord=null,this._progressChecker=null,this._mediaDataSource=w,this._mediaElement=null,this._msectl=null,this._transmuxer=null,this._mseSourceOpened=!1,this._hasPendingLoad=!1,this._receivedCanPlay=!1,this._mediaInfo=null,this._statisticsInfo=null;var et=p.a.chrome&&(p.a.version.major<50||p.a.version.major===50&&p.a.version.build<2661);this._alwaysSeekKeyframe=!!(et||p.a.msedge||p.a.msie),this._alwaysSeekKeyframe&&(this._config.accurateSeek=!1)}return B.prototype.destroy=function(){this._progressChecker!=null&&(window.clearInterval(this._progressChecker),this._progressChecker=null),this._transmuxer&&this.unload(),this._mediaElement&&this.detachMediaElement(),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null},B.prototype.on=function(w,P){var G=this;w===g.MEDIA_INFO?this._mediaInfo!=null&&Promise.resolve().then(function(){G._emitter.emit(g.MEDIA_INFO,G.mediaInfo)}):w===g.STATISTICS_INFO&&this._statisticsInfo!=null&&Promise.resolve().then(function(){G._emitter.emit(g.STATISTICS_INFO,G.statisticsInfo)}),this._emitter.addListener(w,P)},B.prototype.off=function(w,P){this._emitter.removeListener(w,P)},B.prototype.attachMediaElement=function(w){var P=this;if(this._mediaElement=w,w.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),w.addEventListener("seeking",this.e.onvSeeking),w.addEventListener("canplay",this.e.onvCanPlay),w.addEventListener("stalled",this.e.onvStalled),w.addEventListener("progress",this.e.onvProgress),this._msectl=new I(this._config),this._msectl.on(b.UPDATE_END,this._onmseUpdateEnd.bind(this)),this._msectl.on(b.BUFFER_FULL,this._onmseBufferFull.bind(this)),this._msectl.on(b.SOURCE_OPEN,function(){P._mseSourceOpened=!0,P._hasPendingLoad&&(P._hasPendingLoad=!1,P.load())}),this._msectl.on(b.ERROR,function(G){P._emitter.emit(g.ERROR,F.MEDIA_ERROR,$.MEDIA_MSE_ERROR,G)}),this._msectl.attachMediaElement(w),this._pendingSeekTime!=null)try{w.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch(G){}},B.prototype.detachMediaElement=function(){this._mediaElement&&(this._msectl.detachMediaElement(),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement.removeEventListener("seeking",this.e.onvSeeking),this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay),this._mediaElement.removeEventListener("stalled",this.e.onvStalled),this._mediaElement.removeEventListener("progress",this.e.onvProgress),this._mediaElement=null),this._msectl&&(this._msectl.destroy(),this._msectl=null)},B.prototype.load=function(){var w=this;if(!this._mediaElement)throw new L.a("HTMLMediaElement must be attached before load()!");if(this._transmuxer)throw new L.a("MSEPlayer.load() has been called, please call unload() first!");this._hasPendingLoad||(this._config.deferLoadAfterSourceOpen&&this._mseSourceOpened===!1?this._hasPendingLoad=!0:(this._mediaElement.readyState>0&&(this._requestSetTime=!0,this._mediaElement.currentTime=0),this._transmuxer=new C(this._mediaDataSource,this._config),this._transmuxer.on(T.a.INIT_SEGMENT,function(P,G){w._msectl.appendInitSegment(G)}),this._transmuxer.on(T.a.MEDIA_SEGMENT,function(P,G){if(w._msectl.appendMediaSegment(G),w._config.lazyLoad&&!w._config.isLive){var et=w._mediaElement.currentTime;G.info.endDts>=1e3*(et+w._config.lazyLoadMaxDuration)&&w._progressChecker==null&&(h.a.v(w.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),w._suspendTransmuxer())}}),this._transmuxer.on(T.a.LOADING_COMPLETE,function(){w._msectl.endOfStream(),w._emitter.emit(g.LOADING_COMPLETE)}),this._transmuxer.on(T.a.RECOVERED_EARLY_EOF,function(){w._emitter.emit(g.RECOVERED_EARLY_EOF)}),this._transmuxer.on(T.a.IO_ERROR,function(P,G){w._emitter.emit(g.ERROR,F.NETWORK_ERROR,P,G)}),this._transmuxer.on(T.a.DEMUX_ERROR,function(P,G){w._emitter.emit(g.ERROR,F.MEDIA_ERROR,P,{code:-1,msg:G})}),this._transmuxer.on(T.a.MEDIA_INFO,function(P){w._mediaInfo=P,w._emitter.emit(g.MEDIA_INFO,Object.assign({},P))}),this._transmuxer.on(T.a.METADATA_ARRIVED,function(P){w._emitter.emit(g.METADATA_ARRIVED,P)}),this._transmuxer.on(T.a.SCRIPTDATA_ARRIVED,function(P){w._emitter.emit(g.SCRIPTDATA_ARRIVED,P)}),this._transmuxer.on(T.a.TIMED_ID3_METADATA_ARRIVED,function(P){w._emitter.emit(g.TIMED_ID3_METADATA_ARRIVED,P)}),this._transmuxer.on(T.a.SMPTE2038_METADATA_ARRIVED,function(P){w._emitter.emit(g.SMPTE2038_METADATA_ARRIVED,P)}),this._transmuxer.on(T.a.SCTE35_METADATA_ARRIVED,function(P){w._emitter.emit(g.SCTE35_METADATA_ARRIVED,P)}),this._transmuxer.on(T.a.PES_PRIVATE_DATA_DESCRIPTOR,function(P){w._emitter.emit(g.PES_PRIVATE_DATA_DESCRIPTOR,P)}),this._transmuxer.on(T.a.PES_PRIVATE_DATA_ARRIVED,function(P){w._emitter.emit(g.PES_PRIVATE_DATA_ARRIVED,P)}),this._transmuxer.on(T.a.STATISTICS_INFO,function(P){w._statisticsInfo=w._fillStatisticsInfo(P),w._emitter.emit(g.STATISTICS_INFO,Object.assign({},w._statisticsInfo))}),this._transmuxer.on(T.a.RECOMMEND_SEEKPOINT,function(P){w._mediaElement&&!w._config.accurateSeek&&(w._requestSetTime=!0,w._mediaElement.currentTime=P/1e3)}),this._transmuxer.open()))},B.prototype.unload=function(){this._mediaElement&&this._mediaElement.pause(),this._msectl&&this._msectl.seek(0),this._transmuxer&&(this._transmuxer.close(),this._transmuxer.destroy(),this._transmuxer=null)},B.prototype.play=function(){return this._mediaElement.play()},B.prototype.pause=function(){this._mediaElement.pause()},Object.defineProperty(B.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"buffered",{get:function(){return this._mediaElement.buffered},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"duration",{get:function(){return this._mediaElement.duration},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"volume",{get:function(){return this._mediaElement.volume},set:function(w){this._mediaElement.volume=w},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"muted",{get:function(){return this._mediaElement.muted},set:function(w){this._mediaElement.muted=w},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"currentTime",{get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(w){this._mediaElement?this._internalSeek(w):this._pendingSeekTime=w},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"mediaInfo",{get:function(){return Object.assign({},this._mediaInfo)},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"statisticsInfo",{get:function(){return this._statisticsInfo==null&&(this._statisticsInfo={}),this._statisticsInfo=this._fillStatisticsInfo(this._statisticsInfo),Object.assign({},this._statisticsInfo)},enumerable:!1,configurable:!0}),B.prototype._fillStatisticsInfo=function(w){if(w.playerType=this._type,!(this._mediaElement instanceof HTMLVideoElement))return w;var P=!0,G=0,et=0;if(this._mediaElement.getVideoPlaybackQuality){var rt=this._mediaElement.getVideoPlaybackQuality();G=rt.totalVideoFrames,et=rt.droppedVideoFrames}else this._mediaElement.webkitDecodedFrameCount!=null?(G=this._mediaElement.webkitDecodedFrameCount,et=this._mediaElement.webkitDroppedFrameCount):P=!1;return P&&(w.decodedFrames=G,w.droppedFrames=et),w},B.prototype._onmseUpdateEnd=function(){var w=this._mediaElement.buffered,P=this._mediaElement.currentTime;if(this._config.isLive&&this._config.liveBufferLatencyChasing&&w.length>0&&!this._mediaElement.paused){var G=w.end(w.length-1);if(G>this._config.liveBufferLatencyMaxLatency&&G-P>this._config.liveBufferLatencyMaxLatency){var et=G-this._config.liveBufferLatencyMinRemain;this.currentTime=et}}if(this._config.lazyLoad&&!this._config.isLive){for(var rt=0,dt=0;dt<w.length;dt++){var vt=w.start(dt),Lt=w.end(dt);if(vt<=P&&P<Lt){rt=Lt;break}}rt>=P+this._config.lazyLoadMaxDuration&&this._progressChecker==null&&(h.a.v(this.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),this._suspendTransmuxer())}},B.prototype._onmseBufferFull=function(){h.a.v(this.TAG,"MSE SourceBuffer is full, suspend transmuxing task"),this._progressChecker==null&&this._suspendTransmuxer()},B.prototype._suspendTransmuxer=function(){this._transmuxer&&(this._transmuxer.pause(),this._progressChecker==null&&(this._progressChecker=window.setInterval(this._checkProgressAndResume.bind(this),1e3)))},B.prototype._checkProgressAndResume=function(){for(var w=this._mediaElement.currentTime,P=this._mediaElement.buffered,G=!1,et=0;et<P.length;et++){var rt=P.start(et),dt=P.end(et);if(w>=rt&&w<dt){w>=dt-this._config.lazyLoadRecoverDuration&&(G=!0);break}}G&&(window.clearInterval(this._progressChecker),this._progressChecker=null,G&&(h.a.v(this.TAG,"Continue loading from paused position"),this._transmuxer.resume()))},B.prototype._isTimepointBuffered=function(w){for(var P=this._mediaElement.buffered,G=0;G<P.length;G++){var et=P.start(G),rt=P.end(G);if(w>=et&&w<rt)return!0}return!1},B.prototype._internalSeek=function(w){var P=this._isTimepointBuffered(w),G=!1,et=0;if(w<1&&this._mediaElement.buffered.length>0){var rt=this._mediaElement.buffered.start(0);(rt<1&&w<rt||p.a.safari)&&(G=!0,et=p.a.safari?.1:rt)}if(G)this._requestSetTime=!0,this._mediaElement.currentTime=et;else if(P){if(this._alwaysSeekKeyframe){var dt=this._msectl.getNearestKeyframe(Math.floor(1e3*w));this._requestSetTime=!0,this._mediaElement.currentTime=dt!=null?dt.dts/1e3:w}else this._requestSetTime=!0,this._mediaElement.currentTime=w;this._progressChecker!=null&&this._checkProgressAndResume()}else this._progressChecker!=null&&(window.clearInterval(this._progressChecker),this._progressChecker=null),this._msectl.seek(w),this._transmuxer.seek(Math.floor(1e3*w)),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=w)},B.prototype._checkAndApplyUnbufferedSeekpoint=function(){if(this._seekpointRecord)if(this._seekpointRecord.recordTime<=this._now()-100){var w=this._mediaElement.currentTime;this._seekpointRecord=null,this._isTimepointBuffered(w)||(this._progressChecker!=null&&(window.clearTimeout(this._progressChecker),this._progressChecker=null),this._msectl.seek(w),this._transmuxer.seek(Math.floor(1e3*w)),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=w))}else window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)},B.prototype._checkAndResumeStuckPlayback=function(w){var P=this._mediaElement;if(w||!this._receivedCanPlay||P.readyState<2){var G=P.buffered;G.length>0&&P.currentTime<G.start(0)&&(h.a.w(this.TAG,"Playback seems stuck at "+P.currentTime+", seek to "+G.start(0)),this._requestSetTime=!0,this._mediaElement.currentTime=G.start(0),this._mediaElement.removeEventListener("progress",this.e.onvProgress))}else this._mediaElement.removeEventListener("progress",this.e.onvProgress)},B.prototype._onvLoadedMetadata=function(w){this._pendingSeekTime!=null&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null)},B.prototype._onvSeeking=function(w){var P=this._mediaElement.currentTime,G=this._mediaElement.buffered;if(this._requestSetTime)this._requestSetTime=!1;else{if(P<1&&G.length>0){var et=G.start(0);if(et<1&&P<et||p.a.safari)return this._requestSetTime=!0,void(this._mediaElement.currentTime=p.a.safari?.1:et)}if(this._isTimepointBuffered(P)){if(this._alwaysSeekKeyframe){var rt=this._msectl.getNearestKeyframe(Math.floor(1e3*P));rt!=null&&(this._requestSetTime=!0,this._mediaElement.currentTime=rt.dts/1e3)}this._progressChecker!=null&&this._checkProgressAndResume()}else this._seekpointRecord={seekPoint:P,recordTime:this._now()},window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)}},B.prototype._onvCanPlay=function(w){this._receivedCanPlay=!0,this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay)},B.prototype._onvStalled=function(w){this._checkAndResumeStuckPlayback(!0)},B.prototype._onvProgress=function(w){this._checkAndResumeStuckPlayback()},B}(),Q=function(){function B(w,P){this.TAG="NativePlayer",this._type="NativePlayer",this._emitter=new f.a,this._config=a(),typeof P=="object"&&Object.assign(this._config,P);var G=w.type.toLowerCase();if(G==="mse"||G==="mpegts"||G==="m2ts"||G==="flv")throw new L.b("NativePlayer does't support mse/mpegts/m2ts/flv MediaDataSource input!");if(w.hasOwnProperty("segments"))throw new L.b("NativePlayer("+w.type+") doesn't support multipart playback!");this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this)},this._pendingSeekTime=null,this._statisticsReporter=null,this._mediaDataSource=w,this._mediaElement=null}return B.prototype.destroy=function(){this._mediaElement&&(this.unload(),this.detachMediaElement()),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null},B.prototype.on=function(w,P){var G=this;w===g.MEDIA_INFO?this._mediaElement!=null&&this._mediaElement.readyState!==0&&Promise.resolve().then(function(){G._emitter.emit(g.MEDIA_INFO,G.mediaInfo)}):w===g.STATISTICS_INFO&&this._mediaElement!=null&&this._mediaElement.readyState!==0&&Promise.resolve().then(function(){G._emitter.emit(g.STATISTICS_INFO,G.statisticsInfo)}),this._emitter.addListener(w,P)},B.prototype.off=function(w,P){this._emitter.removeListener(w,P)},B.prototype.attachMediaElement=function(w){if(this._mediaElement=w,w.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._pendingSeekTime!=null)try{w.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch(P){}},B.prototype.detachMediaElement=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement=null),this._statisticsReporter!=null&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},B.prototype.load=function(){if(!this._mediaElement)throw new L.a("HTMLMediaElement must be attached before load()!");this._mediaElement.src=this._mediaDataSource.url,this._mediaElement.readyState>0&&(this._mediaElement.currentTime=0),this._mediaElement.preload="auto",this._mediaElement.load(),this._statisticsReporter=window.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval)},B.prototype.unload=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src")),this._statisticsReporter!=null&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},B.prototype.play=function(){return this._mediaElement.play()},B.prototype.pause=function(){this._mediaElement.pause()},Object.defineProperty(B.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"buffered",{get:function(){return this._mediaElement.buffered},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"duration",{get:function(){return this._mediaElement.duration},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"volume",{get:function(){return this._mediaElement.volume},set:function(w){this._mediaElement.volume=w},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"muted",{get:function(){return this._mediaElement.muted},set:function(w){this._mediaElement.muted=w},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"currentTime",{get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(w){this._mediaElement?this._mediaElement.currentTime=w:this._pendingSeekTime=w},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"mediaInfo",{get:function(){var w={mimeType:(this._mediaElement instanceof HTMLAudioElement?"audio/":"video/")+this._mediaDataSource.type};return this._mediaElement&&(w.duration=Math.floor(1e3*this._mediaElement.duration),this._mediaElement instanceof HTMLVideoElement&&(w.width=this._mediaElement.videoWidth,w.height=this._mediaElement.videoHeight)),w},enumerable:!1,configurable:!0}),Object.defineProperty(B.prototype,"statisticsInfo",{get:function(){var w={playerType:this._type,url:this._mediaDataSource.url};if(!(this._mediaElement instanceof HTMLVideoElement))return w;var P=!0,G=0,et=0;if(this._mediaElement.getVideoPlaybackQuality){var rt=this._mediaElement.getVideoPlaybackQuality();G=rt.totalVideoFrames,et=rt.droppedVideoFrames}else this._mediaElement.webkitDecodedFrameCount!=null?(G=this._mediaElement.webkitDecodedFrameCount,et=this._mediaElement.webkitDroppedFrameCount):P=!1;return P&&(w.decodedFrames=G,w.droppedFrames=et),w},enumerable:!1,configurable:!0}),B.prototype._onvLoadedMetadata=function(w){this._pendingSeekTime!=null&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null),this._emitter.emit(g.MEDIA_INFO,this.mediaInfo)},B.prototype._reportStatisticsInfo=function(){this._emitter.emit(g.STATISTICS_INFO,this.statisticsInfo)},B}();s.a.install();var z={createPlayer:function(B,w){var P=B;if(P==null||typeof P!="object")throw new L.b("MediaDataSource must be an javascript object!");if(!P.hasOwnProperty("type"))throw new L.b("MediaDataSource must has type field to indicate video file type!");switch(P.type){case"mse":case"mpegts":case"m2ts":case"flv":return new V(P,w);default:return new Q(P,w)}},isSupported:function(){return l.supportMSEH264Playback()},getFeatureList:function(){return l.getFeatureList()}};z.BaseLoader=d.a,z.LoaderStatus=d.c,z.LoaderErrors=d.b,z.Events=g,z.ErrorTypes=F,z.ErrorDetails=$,z.MSEPlayer=V,z.NativePlayer=Q,z.LoggingControl=k.a,Object.defineProperty(z,"version",{enumerable:!0,get:function(){return"1.7.2"}}),i.default=z}])})})(on);var cs=Or(on.exports);function Za(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}var ln={exports:{}};(function(u,t){(function(e){var i=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,r=/^(?=([^\/?#]*))\1([^]*)$/,s=/(?:\/|^)\.(?=\/)/g,n=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,o={buildAbsoluteURL:function(a,l,d){if(d=d||{},a=a.trim(),l=l.trim(),!l){if(!d.alwaysNormalize)return a;var c=o.parseURL(a);if(!c)throw new Error("Error trying to parse base URL.");return c.path=o.normalizePath(c.path),o.buildURLFromParts(c)}var f=o.parseURL(l);if(!f)throw new Error("Error trying to parse relative URL.");if(f.scheme)return d.alwaysNormalize?(f.path=o.normalizePath(f.path),o.buildURLFromParts(f)):l;var h=o.parseURL(a);if(!h)throw new Error("Error trying to parse base URL.");if(!h.netLoc&&h.path&&h.path[0]!=="/"){var p=r.exec(h.path);h.netLoc=p[1],h.path=p[2]}h.netLoc&&!h.path&&(h.path="/");var g={scheme:h.scheme,netLoc:f.netLoc,path:null,params:f.params,query:f.query,fragment:f.fragment};if(!f.netLoc&&(g.netLoc=h.netLoc,f.path[0]!=="/"))if(!f.path)g.path=h.path,f.params||(g.params=h.params,f.query||(g.query=h.query));else{var x=h.path,E=x.substring(0,x.lastIndexOf("/")+1)+f.path;g.path=o.normalizePath(E)}return g.path===null&&(g.path=d.alwaysNormalize?o.normalizePath(f.path):f.path),o.buildURLFromParts(g)},parseURL:function(a){var l=i.exec(a);return l?{scheme:l[1]||"",netLoc:l[2]||"",path:l[3]||"",params:l[4]||"",query:l[5]||"",fragment:l[6]||""}:null},normalizePath:function(a){for(a=a.split("").reverse().join("").replace(s,"");a.length!==(a=a.replace(n,"")).length;);return a.split("").reverse().join("")},buildURLFromParts:function(a){return a.scheme+a.netLoc+a.path+a.params+a.query+a.fragment}};u.exports=o})()})(ln);var Nr=ln.exports;function us(u,t){var e=Object.keys(u);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(u);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(u,r).enumerable})),e.push.apply(e,i)}return e}function fe(u){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?us(Object(e),!0).forEach(function(i){Xa(u,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(u,Object.getOwnPropertyDescriptors(e)):us(Object(e)).forEach(function(i){Object.defineProperty(u,i,Object.getOwnPropertyDescriptor(e,i))})}return u}function Xa(u,t,e){return t=Ja(t),t in u?Object.defineProperty(u,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):u[t]=e,u}function Jt(){return Jt=Object.assign?Object.assign.bind():function(u){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(u[i]=e[i])}return u},Jt.apply(this,arguments)}function Qa(u,t){if(typeof u!="object"||u===null)return u;var e=u[Symbol.toPrimitive];if(e!==void 0){var i=e.call(u,t||"default");if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(u)}function Ja(u){var t=Qa(u,"string");return typeof t=="symbol"?t:String(t)}const _t=Number.isFinite||function(u){return typeof u=="number"&&isFinite(u)};let D=function(u){return u.MEDIA_ATTACHING="hlsMediaAttaching",u.MEDIA_ATTACHED="hlsMediaAttached",u.MEDIA_DETACHING="hlsMediaDetaching",u.MEDIA_DETACHED="hlsMediaDetached",u.BUFFER_RESET="hlsBufferReset",u.BUFFER_CODECS="hlsBufferCodecs",u.BUFFER_CREATED="hlsBufferCreated",u.BUFFER_APPENDING="hlsBufferAppending",u.BUFFER_APPENDED="hlsBufferAppended",u.BUFFER_EOS="hlsBufferEos",u.BUFFER_FLUSHING="hlsBufferFlushing",u.BUFFER_FLUSHED="hlsBufferFlushed",u.MANIFEST_LOADING="hlsManifestLoading",u.MANIFEST_LOADED="hlsManifestLoaded",u.MANIFEST_PARSED="hlsManifestParsed",u.LEVEL_SWITCHING="hlsLevelSwitching",u.LEVEL_SWITCHED="hlsLevelSwitched",u.LEVEL_LOADING="hlsLevelLoading",u.LEVEL_LOADED="hlsLevelLoaded",u.LEVEL_UPDATED="hlsLevelUpdated",u.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",u.LEVELS_UPDATED="hlsLevelsUpdated",u.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",u.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",u.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",u.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",u.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",u.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",u.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",u.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",u.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",u.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",u.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",u.CUES_PARSED="hlsCuesParsed",u.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",u.INIT_PTS_FOUND="hlsInitPtsFound",u.FRAG_LOADING="hlsFragLoading",u.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",u.FRAG_LOADED="hlsFragLoaded",u.FRAG_DECRYPTED="hlsFragDecrypted",u.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",u.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",u.FRAG_PARSING_METADATA="hlsFragParsingMetadata",u.FRAG_PARSED="hlsFragParsed",u.FRAG_BUFFERED="hlsFragBuffered",u.FRAG_CHANGED="hlsFragChanged",u.FPS_DROP="hlsFpsDrop",u.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",u.ERROR="hlsError",u.DESTROYING="hlsDestroying",u.KEY_LOADING="hlsKeyLoading",u.KEY_LOADED="hlsKeyLoaded",u.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",u.BACK_BUFFER_REACHED="hlsBackBufferReached",u}({}),bt=function(u){return u.NETWORK_ERROR="networkError",u.MEDIA_ERROR="mediaError",u.KEY_SYSTEM_ERROR="keySystemError",u.MUX_ERROR="muxError",u.OTHER_ERROR="otherError",u}({}),tt=function(u){return u.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",u.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",u.KEY_SYSTEM_NO_SESSION="keySystemNoSession",u.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",u.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",u.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",u.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",u.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",u.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",u.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",u.MANIFEST_LOAD_ERROR="manifestLoadError",u.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",u.MANIFEST_PARSING_ERROR="manifestParsingError",u.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",u.LEVEL_EMPTY_ERROR="levelEmptyError",u.LEVEL_LOAD_ERROR="levelLoadError",u.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",u.LEVEL_PARSING_ERROR="levelParsingError",u.LEVEL_SWITCH_ERROR="levelSwitchError",u.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",u.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",u.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",u.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",u.FRAG_LOAD_ERROR="fragLoadError",u.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",u.FRAG_DECRYPT_ERROR="fragDecryptError",u.FRAG_PARSING_ERROR="fragParsingError",u.FRAG_GAP="fragGap",u.REMUX_ALLOC_ERROR="remuxAllocError",u.KEY_LOAD_ERROR="keyLoadError",u.KEY_LOAD_TIMEOUT="keyLoadTimeOut",u.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",u.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",u.BUFFER_APPEND_ERROR="bufferAppendError",u.BUFFER_APPENDING_ERROR="bufferAppendingError",u.BUFFER_STALLED_ERROR="bufferStalledError",u.BUFFER_FULL_ERROR="bufferFullError",u.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",u.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",u.INTERNAL_EXCEPTION="internalException",u.INTERNAL_ABORTED="aborted",u.UNKNOWN="unknown",u}({});const Xe=function(){},Ar={trace:Xe,debug:Xe,log:Xe,warn:Xe,info:Xe,error:Xe};let pi=Ar;function to(u){const t=self.console[u];return t?t.bind(self.console,`[${u}] >`):Xe}function eo(u,...t){t.forEach(function(e){pi[e]=u[e]?u[e].bind(u):to(e)})}function io(u,t){if(self.console&&u===!0||typeof u=="object"){eo(u,"debug","log","info","warn","error");try{pi.log(`Debug logs enabled for "${t}" in hls.js version 1.4.4`)}catch(e){pi=Ar}}else pi=Ar}const H=pi,ro=/^(\d+)x(\d+)$/,hs=/(.+?)=(".*?"|.*?)(?:,|$)/g;class Ht{constructor(t){typeof t=="string"&&(t=Ht.parseAttrList(t));for(const e in t)t.hasOwnProperty(e)&&(e.substring(0,2)==="X-"&&(this.clientAttrs=this.clientAttrs||[],this.clientAttrs.push(e)),this[e]=t[e])}decimalInteger(t){const e=parseInt(this[t],10);return e>Number.MAX_SAFE_INTEGER?1/0:e}hexadecimalInteger(t){if(this[t]){let e=(this[t]||"0x").slice(2);e=(e.length&1?"0":"")+e;const i=new Uint8Array(e.length/2);for(let r=0;r<e.length/2;r++)i[r]=parseInt(e.slice(r*2,r*2+2),16);return i}else return null}hexadecimalIntegerAsNumber(t){const e=parseInt(this[t],16);return e>Number.MAX_SAFE_INTEGER?1/0:e}decimalFloatingPoint(t){return parseFloat(this[t])}optionalFloat(t,e){const i=this[t];return i?parseFloat(i):e}enumeratedString(t){return this[t]}bool(t){return this[t]==="YES"}decimalResolution(t){const e=ro.exec(this[t]);if(e!==null)return{width:parseInt(e[1],10),height:parseInt(e[2],10)}}static parseAttrList(t){let e;const i={},r='"';for(hs.lastIndex=0;(e=hs.exec(t))!==null;){let s=e[2];s.indexOf(r)===0&&s.lastIndexOf(r)===s.length-1&&(s=s.slice(1,-1));const n=e[1].trim();i[n]=s}return i}}function so(u){return u!=="ID"&&u!=="CLASS"&&u!=="START-DATE"&&u!=="DURATION"&&u!=="END-DATE"&&u!=="END-ON-NEXT"}function no(u){return u==="SCTE35-OUT"||u==="SCTE35-IN"}class dn{constructor(t,e){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,e){const i=e.attr;for(const r in i)if(Object.prototype.hasOwnProperty.call(t,r)&&t[r]!==i[r]){H.warn(`DATERANGE tag attribute: "${r}" does not match for tags with ID: "${t.ID}"`),this._badValueForSameId=r;break}t=Jt(new Ht({}),i,t)}if(this.attr=t,this._startDate=new Date(t["START-DATE"]),"END-DATE"in this.attr){const i=new Date(this.attr["END-DATE"]);_t(i.getTime())&&(this._endDate=i)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get startDate(){return this._startDate}get endDate(){if(this._endDate)return this._endDate;const t=this.duration;return t!==null?new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){const t=this.attr.decimalFloatingPoint("DURATION");if(_t(t))return t}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isValid(){return!!this.id&&!this._badValueForSameId&&_t(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}class Gi{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var Bt={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class cn{constructor(t){this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams={[Bt.AUDIO]:null,[Bt.VIDEO]:null,[Bt.AUDIOVIDEO]:null},this.baseurl=t}setByteRange(t,e){const i=t.split("@",2),r=[];i.length===1?r[0]=e?e.byteRangeEndOffset:0:r[0]=parseInt(i[1]),r[1]=parseInt(i[0])+r[0],this._byteRange=r}get byteRange(){return this._byteRange?this._byteRange:[]}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Nr.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(t){this._url=t}}class er extends cn{constructor(t,e){super(e),this._decryptdata=null,this.rawProgramDateTime=null,this.programDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.stats=new Gi,this.urlId=0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.type=t}get decryptdata(){const{levelkeys:t}=this;if(!t&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){const e=this.levelkeys.identity;if(e)this._decryptdata=e.getDecryptData(this.sn);else{const i=Object.keys(this.levelkeys);if(i.length===1)return this._decryptdata=this.levelkeys[i[0]].getDecryptData(this.sn)}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null||!_t(this.programDateTime))return null;const t=_t(this.duration)?this.duration:0;return this.programDateTime+t*1e3}get encrypted(){var t;if((t=this._decryptdata)!=null&&t.encrypted)return!0;if(this.levelkeys){const e=Object.keys(this.levelkeys),i=e.length;if(i>1||i===1&&this.levelkeys[e[0]].encrypted)return!0}return!1}setKeyFormat(t){if(this.levelkeys){const e=this.levelkeys[t];e&&!this._decryptdata&&(this._decryptdata=e.getDecryptData(this.sn))}}abortRequests(){var t,e;(t=this.loader)==null||t.abort(),(e=this.keyLoader)==null||e.abort()}setElementaryStreamInfo(t,e,i,r,s,n=!1){const{elementaryStreams:o}=this,a=o[t];if(!a){o[t]={startPTS:e,endPTS:i,startDTS:r,endDTS:s,partial:n};return}a.startPTS=Math.min(a.startPTS,e),a.endPTS=Math.max(a.endPTS,i),a.startDTS=Math.min(a.startDTS,r),a.endDTS=Math.max(a.endDTS,s)}clearElementaryStreamInfo(){const{elementaryStreams:t}=this;t[Bt.AUDIO]=null,t[Bt.VIDEO]=null,t[Bt.AUDIOVIDEO]=null}}class ao extends cn{constructor(t,e,i,r,s){super(i),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.stats=new Gi,this.duration=t.decimalFloatingPoint("DURATION"),this.gap=t.bool("GAP"),this.independent=t.bool("INDEPENDENT"),this.relurl=t.enumeratedString("URI"),this.fragment=e,this.index=r;const n=t.enumeratedString("BYTERANGE");n&&this.setByteRange(n,s),s&&(this.fragOffset=s.fragOffset+s.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:t}=this;return!!(t.audio||t.video||t.audiovideo)}}const oo=10;class lo{constructor(t){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=t}reloaded(t){if(!t){this.advanced=!0,this.updated=!0;return}const e=this.lastPartSn-t.lastPartSn,i=this.lastPartIndex-t.lastPartIndex;this.updated=this.endSN!==t.endSN||!!i||!!e,this.advanced=this.endSN>t.endSN||e>0||e===0&&i>0,this.updated||this.advanced?this.misses=Math.floor(t.misses*.6):this.misses=t.misses+1,this.availabilityDelay=t.availabilityDelay}get hasProgramDateTime(){return this.fragments.length?_t(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||oo}get drift(){const t=this.driftEndTime-this.driftStartTime;return t>0?(this.driftEnd-this.driftStart)*1e3/t:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var t;return(t=this.partList)!=null&&t.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){var t;return(t=this.fragments)!=null&&t.length?this.fragments[this.fragments.length-1].end:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var t;return(t=this.partList)!=null&&t.length?this.partList[this.partList.length-1].index:-1}get lastPartSn(){var t;return(t=this.partList)!=null&&t.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}function Fr(u){return Uint8Array.from(atob(u),t=>t.charCodeAt(0))}function co(u){const t=un(u).subarray(0,16),e=new Uint8Array(16);return e.set(t,16-t.length),e}function uo(u){const t=function(i,r,s){const n=i[r];i[r]=i[s],i[s]=n};t(u,0,3),t(u,1,2),t(u,4,5),t(u,6,7)}function ho(u){const t=u.split(":");let e=null;if(t[0]==="data"&&t.length===2){const i=t[1].split(";"),r=i[i.length-1].split(",");if(r.length===2){const s=r[0]==="base64",n=r[1];s?(i.splice(-1,1),e=Fr(n)):e=co(n)}}return e}function un(u){return Uint8Array.from(unescape(encodeURIComponent(u)),t=>t.charCodeAt(0))}var Wt={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},he={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function fs(u){switch(u){case he.FAIRPLAY:return Wt.FAIRPLAY;case he.PLAYREADY:return Wt.PLAYREADY;case he.WIDEVINE:return Wt.WIDEVINE;case he.CLEARKEY:return Wt.CLEARKEY}}var hn={WIDEVINE:"edef8ba979d64acea3c827dcd51d21ed"};function fo(u){if(u===hn.WIDEVINE)return Wt.WIDEVINE}function ps(u){switch(u){case Wt.FAIRPLAY:return he.FAIRPLAY;case Wt.PLAYREADY:return he.PLAYREADY;case Wt.WIDEVINE:return he.WIDEVINE;case Wt.CLEARKEY:return he.CLEARKEY}}function ir(u){const{drmSystems:t,widevineLicenseUrl:e}=u,i=t?[Wt.FAIRPLAY,Wt.WIDEVINE,Wt.PLAYREADY,Wt.CLEARKEY].filter(r=>!!t[r]):[];return!i[Wt.WIDEVINE]&&e&&i.push(Wt.WIDEVINE),i}const fn=function(){return typeof self!="undefined"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function po(u,t,e,i){let r;switch(u){case Wt.FAIRPLAY:r=["cenc","sinf"];break;case Wt.WIDEVINE:case Wt.PLAYREADY:r=["cenc"];break;case Wt.CLEARKEY:r=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${u}`)}return mo(r,t,e,i)}function mo(u,t,e,i){return[{initDataTypes:u,persistentState:i.persistentState||"not-allowed",distinctiveIdentifier:i.distinctiveIdentifier||"not-allowed",sessionTypes:i.sessionTypes||[i.sessionType||"temporary"],audioCapabilities:t.map(s=>({contentType:`audio/mp4; codecs="${s}"`,robustness:i.audioRobustness||"",encryptionScheme:i.audioEncryptionScheme||null})),videoCapabilities:e.map(s=>({contentType:`video/mp4; codecs="${s}"`,robustness:i.videoRobustness||"",encryptionScheme:i.videoEncryptionScheme||null}))}]}function Qe(u,t,e){return Uint8Array.prototype.slice?u.slice(t,e):new Uint8Array(Array.prototype.slice.call(u,t,e))}const Br=(u,t)=>t+10<=u.length&&u[t]===73&&u[t+1]===68&&u[t+2]===51&&u[t+3]<255&&u[t+4]<255&&u[t+6]<128&&u[t+7]<128&&u[t+8]<128&&u[t+9]<128,pn=(u,t)=>t+10<=u.length&&u[t]===51&&u[t+1]===68&&u[t+2]===73&&u[t+3]<255&&u[t+4]<255&&u[t+6]<128&&u[t+7]<128&&u[t+8]<128&&u[t+9]<128,Ni=(u,t)=>{const e=t;let i=0;for(;Br(u,t);)i+=10,i+=Vi(u,t+6),pn(u,t+10)&&(i+=10),t+=i;if(i>0)return u.subarray(e,e+i)},Vi=(u,t)=>{let e=0;return e=(u[t]&127)<<21,e|=(u[t+1]&127)<<14,e|=(u[t+2]&127)<<7,e|=u[t+3]&127,e},go=(u,t)=>Br(u,t)&&Vi(u,t+6)+10<=u.length-t,yo=u=>{const t=gn(u);for(let e=0;e<t.length;e++){const i=t[e];if(mn(i))return To(i)}},mn=u=>u&&u.key==="PRIV"&&u.info==="com.apple.streaming.transportStreamTimestamp",vo=u=>{const t=String.fromCharCode(u[0],u[1],u[2],u[3]),e=Vi(u,4),i=10;return{type:t,size:e,data:u.subarray(i,i+e)}},gn=u=>{let t=0;const e=[];for(;Br(u,t);){const i=Vi(u,t+6);t+=10;const r=t+i;for(;t+8<r;){const s=vo(u.subarray(t)),n=_o(s);n&&e.push(n),t+=s.size+10}pn(u,t)&&(t+=10)}return e},_o=u=>u.type==="PRIV"?xo(u):u.type[0]==="W"?bo(u):Eo(u),xo=u=>{if(u.size<2)return;const t=Re(u.data,!0),e=new Uint8Array(u.data.subarray(t.length+1));return{key:u.type,info:t,data:e.buffer}},Eo=u=>{if(u.size<2)return;if(u.type==="TXXX"){let e=1;const i=Re(u.data.subarray(e),!0);e+=i.length+1;const r=Re(u.data.subarray(e));return{key:u.type,info:i,data:r}}const t=Re(u.data.subarray(1));return{key:u.type,data:t}},bo=u=>{if(u.type==="WXXX"){if(u.size<2)return;let e=1;const i=Re(u.data.subarray(e),!0);e+=i.length+1;const r=Re(u.data.subarray(e));return{key:u.type,info:i,data:r}}const t=Re(u.data);return{key:u.type,data:t}},To=u=>{if(u.data.byteLength===8){const t=new Uint8Array(u.data),e=t[3]&1;let i=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return i/=45,e&&(i+=4772185884e-2),Math.round(i)}},Re=(u,t=!1)=>{const e=So();if(e){const l=e.decode(u);if(t){const d=l.indexOf("\0");return d!==-1?l.substring(0,d):l}return l.replace(/\0/g,"")}const i=u.length;let r,s,n,o="",a=0;for(;a<i;){if(r=u[a++],r===0&&t)return o;if(r===0||r===3)continue;switch(r>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(r);break;case 12:case 13:s=u[a++],o+=String.fromCharCode((r&31)<<6|s&63);break;case 14:s=u[a++],n=u[a++],o+=String.fromCharCode((r&15)<<12|(s&63)<<6|(n&63)<<0);break}}return o};let rr;function So(){return!rr&&typeof self.TextDecoder!="undefined"&&(rr=new self.TextDecoder("utf-8")),rr}const Ie={hexDump:function(u){let t="";for(let e=0;e<u.length;e++){let i=u[e].toString(16);i.length<2&&(i="0"+i),t+=i}return t}},Fi=Math.pow(2,32)-1,Ao=[].push,yn={video:1,audio:2,id3:3,text:4};function ie(u){return String.fromCharCode.apply(null,u)}function vn(u,t){const e=u[t]<<8|u[t+1];return e<0?65536+e:e}function At(u,t){const e=_n(u,t);return e<0?4294967296+e:e}function _n(u,t){return u[t]<<24|u[t+1]<<16|u[t+2]<<8|u[t+3]}function sr(u,t,e){u[t]=e>>24,u[t+1]=e>>16&255,u[t+2]=e>>8&255,u[t+3]=e&255}function Mt(u,t){const e=[];if(!t.length)return e;const i=u.byteLength;for(let r=0;r<i;){const s=At(u,r),n=ie(u.subarray(r+4,r+8)),o=s>1?r+s:i;if(n===t[0])if(t.length===1)e.push(u.subarray(r+8,o));else{const a=Mt(u.subarray(r+8,o),t.slice(1));a.length&&Ao.apply(e,a)}r=o}return e}function Lo(u){const t=[],e=u[0];let i=8;const r=At(u,i);i+=4;const s=0,n=0;e===0?i+=8:i+=16,i+=2;let o=u.length+n;const a=vn(u,i);i+=2;for(let l=0;l<a;l++){let d=i;const c=At(u,d);d+=4;const f=c&2147483647;if((c&2147483648)>>>31===1)return H.warn("SIDX has hierarchical references (not supported)"),null;const p=At(u,d);d+=4,t.push({referenceSize:f,subsegmentDuration:p,info:{duration:p/r,start:o,end:o+f-1}}),o+=f,d+=4,i=d}return{earliestPresentationTime:s,timescale:r,version:e,referencesCount:a,references:t}}function xn(u){const t=[],e=Mt(u,["moov","trak"]);for(let r=0;r<e.length;r++){const s=e[r],n=Mt(s,["tkhd"])[0];if(n){let o=n[0],a=o===0?12:20;const l=At(n,a),d=Mt(s,["mdia","mdhd"])[0];if(d){o=d[0],a=o===0?12:20;const c=At(d,a),f=Mt(s,["mdia","hdlr"])[0];if(f){const h=ie(f.subarray(8,12)),p={soun:Bt.AUDIO,vide:Bt.VIDEO}[h];if(p){const g=Mt(s,["mdia","minf","stbl","stsd"])[0];let x;g&&(x=ie(g.subarray(12,16))),t[l]={timescale:c,type:p},t[p]={timescale:c,id:l,codec:x}}}}}}return Mt(u,["moov","mvex","trex"]).forEach(r=>{const s=At(r,4),n=t[s];n&&(n.default={duration:At(r,12),flags:At(r,20)})}),t}function Io(u,t){if(!u||!t)return u;const e=t.keyId;return e&&t.isCommonEncryption&&Mt(u,["moov","trak"]).forEach(r=>{const n=Mt(r,["mdia","minf","stbl","stsd"])[0].subarray(8);let o=Mt(n,["enca"]);const a=o.length>0;a||(o=Mt(n,["encv"])),o.forEach(l=>{const d=a?l.subarray(28):l.subarray(78);Mt(d,["sinf"]).forEach(f=>{const h=En(f);if(h){const p=h.subarray(8,24);p.some(g=>g!==0)||(H.log(`[eme] Patching keyId in 'enc${a?"a":"v"}>sinf>>tenc' box: ${Ie.hexDump(p)} -> ${Ie.hexDump(e)}`),h.set(e,8))}})})}),u}function En(u){const t=Mt(u,["schm"])[0];if(t){const e=ie(t.subarray(4,8));if(e==="cbcs"||e==="cenc")return Mt(u,["schi","tenc"])[0]}return H.error("[eme] missing 'schm' box"),null}function wo(u,t){return Mt(t,["moof","traf"]).reduce((e,i)=>{const r=Mt(i,["tfdt"])[0],s=r[0],n=Mt(i,["tfhd"]).reduce((o,a)=>{const l=At(a,4),d=u[l];if(d){let c=At(r,4);if(s===1){if(c===Fi)return H.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),o;c*=Fi+1,c+=At(r,8)}const f=d.timescale||9e4,h=c/f;if(isFinite(h)&&(o===null||h<o))return h}return o},null);return n!==null&&isFinite(n)&&(e===null||n<e)?n:e},null)}function Ro(u,t){let e=0,i=0,r=0;const s=Mt(u,["moof","traf"]);for(let n=0;n<s.length;n++){const o=s[n],a=Mt(o,["tfhd"])[0],l=At(a,4),d=t[l];if(!d)continue;const c=d.default,f=At(a,0)|(c==null?void 0:c.flags);let h=c==null?void 0:c.duration;f&8&&(f&2?h=At(a,12):h=At(a,8));const p=d.timescale||9e4,g=Mt(o,["trun"]);for(let x=0;x<g.length;x++){if(e=Do(g[x]),!e&&h){const E=At(g[x],4);e=h*E}d.type===Bt.VIDEO?i+=e/p:d.type===Bt.AUDIO&&(r+=e/p)}}if(i===0&&r===0){let n=0;const o=Mt(u,["sidx"]);for(let a=0;a<o.length;a++){const l=Lo(o[a]);l!=null&&l.references&&(n+=l.references.reduce((d,c)=>d+c.info.duration||0,0))}return n}return i||r}function Do(u){const t=At(u,0);let e=8;t&1&&(e+=4),t&4&&(e+=4);let i=0;const r=At(u,4);for(let s=0;s<r;s++)t&256&&(i+=At(u,e),e+=4),t&512&&(e+=4),t&1024&&(e+=4),t&2048&&(e+=4);return i}function ko(u,t,e){Mt(t,["moof","traf"]).forEach(i=>{Mt(i,["tfhd"]).forEach(r=>{const s=At(r,4),n=u[s];if(!n)return;const o=n.timescale||9e4;Mt(i,["tfdt"]).forEach(a=>{const l=a[0];let d=At(a,4);if(l===0)d-=e*o,d=Math.max(d,0),sr(a,4,d);else{d*=Math.pow(2,32),d+=At(a,8),d-=e*o,d=Math.max(d,0);const c=Math.floor(d/(Fi+1)),f=Math.floor(d%(Fi+1));sr(a,4,c),sr(a,8,f)}})})})}function Co(u){const t={valid:null,remainder:null},e=Mt(u,["moof"]);if(e){if(e.length<2)return t.remainder=u,t}else return t;const i=e[e.length-1];return t.valid=Qe(u,0,i.byteOffset-8),t.remainder=Qe(u,i.byteOffset-8),t}function Je(u,t){const e=new Uint8Array(u.length+t.length);return e.set(u),e.set(t,u.length),e}function ms(u,t){const e=[],i=t.samples,r=t.timescale,s=t.id;let n=!1;return Mt(i,["moof"]).map(a=>{const l=a.byteOffset-8;Mt(a,["traf"]).map(c=>{const f=Mt(c,["tfdt"]).map(h=>{const p=h[0];let g=At(h,4);return p===1&&(g*=Math.pow(2,32),g+=At(h,8)),g/r})[0];return f!==void 0&&(u=f),Mt(c,["tfhd"]).map(h=>{const p=At(h,4),g=At(h,0)&16777215,x=(g&1)!==0,E=(g&2)!==0,k=(g&8)!==0;let O=0;const T=(g&16)!==0;let R=0;const C=(g&32)!==0;let b=8;p===s&&(x&&(b+=8),E&&(b+=4),k&&(O=At(h,b),b+=4),T&&(R=At(h,b),b+=4),C&&(b+=4),t.type==="video"&&(n=Mo(t.codec)),Mt(c,["trun"]).map(A=>{const L=A[0],I=At(A,0)&16777215,j=(I&1)!==0;let F=0;const $=(I&4)!==0,V=(I&256)!==0;let Q=0;const z=(I&512)!==0;let B=0;const w=(I&1024)!==0,P=(I&2048)!==0;let G=0;const et=At(A,4);let rt=8;j&&(F=At(A,rt),rt+=4),$&&(rt+=4);let dt=F+l;for(let vt=0;vt<et;vt++){if(V?(Q=At(A,rt),rt+=4):Q=O,z?(B=At(A,rt),rt+=4):B=R,w&&(rt+=4),P&&(L===0?G=At(A,rt):G=_n(A,rt),rt+=4),t.type===Bt.VIDEO){let Lt=0;for(;Lt<B;){const xt=At(i,dt);if(dt+=4,Po(n,i[dt])){const it=i.subarray(dt,dt+xt);bn(it,n?2:1,u+G/r,e)}dt+=xt,Lt+=xt+4}}u+=Q/r}}))})})}),e}function Mo(u){if(!u)return!1;const t=u.indexOf("."),e=t<0?u:u.substring(0,t);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function Po(u,t){if(u){const e=t>>1&63;return e===39||e===40}else return(t&31)===6}function bn(u,t,e,i){const r=Tn(u);let s=0;s+=t;let n=0,o=0,a=!1,l=0;for(;s<r.length;){n=0;do{if(s>=r.length)break;l=r[s++],n+=l}while(l===255);o=0;do{if(s>=r.length)break;l=r[s++],o+=l}while(l===255);const d=r.length-s;if(!a&&n===4&&s<r.length){if(a=!0,r[s++]===181){const f=vn(r,s);if(s+=2,f===49){const h=At(r,s);if(s+=4,h===1195456820){const p=r[s++];if(p===3){const g=r[s++],x=31&g,E=64&g,k=E?2+x*3:0,O=new Uint8Array(k);if(E){O[0]=g;for(let T=1;T<k;T++)O[T]=r[s++]}i.push({type:p,payloadType:n,pts:e,bytes:O})}}}}}else if(n===5&&o<d){if(a=!0,o>16){const c=[];for(let p=0;p<16;p++){const g=r[s++].toString(16);c.push(g.length==1?"0"+g:g),(p===3||p===5||p===7||p===9)&&c.push("-")}const f=o-16,h=new Uint8Array(f);for(let p=0;p<f;p++)h[p]=r[s++];i.push({payloadType:n,pts:e,uuid:c.join(""),userData:Re(h),userDataBytes:h})}}else if(o<d)s+=o;else if(o>d)break}}function Tn(u){const t=u.byteLength,e=[];let i=1;for(;i<t-2;)u[i]===0&&u[i+1]===0&&u[i+2]===3?(e.push(i+2),i+=2):i++;if(e.length===0)return u;const r=t-e.length,s=new Uint8Array(r);let n=0;for(i=0;i<r;n++,i++)n===e[0]&&(n++,e.shift()),s[i]=u[n];return s}function Oo(u){const t=u[0];let e="",i="",r=0,s=0,n=0,o=0,a=0,l=0;if(t===0){for(;ie(u.subarray(l,l+1))!=="\0";)e+=ie(u.subarray(l,l+1)),l+=1;for(e+=ie(u.subarray(l,l+1)),l+=1;ie(u.subarray(l,l+1))!=="\0";)i+=ie(u.subarray(l,l+1)),l+=1;i+=ie(u.subarray(l,l+1)),l+=1,r=At(u,12),s=At(u,16),o=At(u,20),a=At(u,24),l=28}else if(t===1){l+=4,r=At(u,l),l+=4;const c=At(u,l);l+=4;const f=At(u,l);for(l+=4,n=os(2,32)*c+f,Number.isSafeInteger(n)||(n=Number.MAX_SAFE_INTEGER,H.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),o=At(u,l),l+=4,a=At(u,l),l+=4;ie(u.subarray(l,l+1))!=="\0";)e+=ie(u.subarray(l,l+1)),l+=1;for(e+=ie(u.subarray(l,l+1)),l+=1;ie(u.subarray(l,l+1))!=="\0";)i+=ie(u.subarray(l,l+1)),l+=1;i+=ie(u.subarray(l,l+1)),l+=1}const d=u.subarray(l,u.byteLength);return{schemeIdUri:e,value:i,timeScale:r,presentationTime:n,presentationTimeDelta:s,eventDuration:o,id:a,payload:d}}function No(u,...t){const e=t.length;let i=8,r=e;for(;r--;)i+=t[r].byteLength;const s=new Uint8Array(i);for(s[0]=i>>24&255,s[1]=i>>16&255,s[2]=i>>8&255,s[3]=i&255,s.set(u,4),r=0,i=8;r<e;r++)s.set(t[r],i),i+=t[r].byteLength;return s}function Fo(u,t,e){if(u.byteLength!==16)throw new RangeError("Invalid system id");let i,r;if(t){i=1,r=new Uint8Array(t.length*16);for(let o=0;o<t.length;o++){const a=t[o];if(a.byteLength!==16)throw new RangeError("Invalid key");r.set(a,o*16)}}else i=0,r=new Uint8Array;let s;i>0?(s=new Uint8Array(4),t.length>0&&new DataView(s.buffer).setUint32(0,t.length,!1)):s=new Uint8Array;const n=new Uint8Array(4);return e&&e.byteLength>0&&new DataView(n.buffer).setUint32(0,e.byteLength,!1),No([112,115,115,104],new Uint8Array([i,0,0,0]),u,s,r,n,e||new Uint8Array)}function Bo(u){if(!(u instanceof ArrayBuffer)||u.byteLength<32)return null;const t={version:0,systemId:"",kids:null,data:null},e=new DataView(u),i=e.getUint32(0);if(u.byteLength!==i&&i>44||e.getUint32(4)!==1886614376||(t.version=e.getUint32(8)>>>24,t.version>1))return null;t.systemId=Ie.hexDump(new Uint8Array(u,12,16));const s=e.getUint32(28);if(t.version===0){if(i-32<s)return null;t.data=new Uint8Array(u,32,s)}else if(t.version===1){t.kids=[];for(let n=0;n<s;n++)t.kids.push(new Uint8Array(u,32+n*16,16))}return t}let Ti={};class gi{static clearKeyUriToKeyIdMap(){Ti={}}constructor(t,e,i,r=[1],s=null){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=t,this.uri=e,this.keyFormat=i,this.keyFormatVersions=r,this.iv=s,this.encrypted=t?t!=="NONE":!1,this.isCommonEncryption=this.encrypted&&t!=="AES-128"}isSupported(){if(this.method){if(this.method==="AES-128"||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case he.FAIRPLAY:case he.WIDEVINE:case he.PLAYREADY:case he.CLEARKEY:return["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(t){if(!this.encrypted||!this.uri)return null;if(this.method==="AES-128"&&this.uri&&!this.iv){typeof t!="number"&&(this.method==="AES-128"&&!this.iv&&H.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),t=0);const i=Uo(t);return new gi(this.method,this.uri,"identity",this.keyFormatVersions,i)}const e=ho(this.uri);if(e)switch(this.keyFormat){case he.WIDEVINE:this.pssh=e,e.length>=22&&(this.keyId=e.subarray(e.length-22,e.length-6));break;case he.PLAYREADY:{const i=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=Fo(i,null,e);const r=new Uint16Array(e.buffer,e.byteOffset,e.byteLength/2),s=String.fromCharCode.apply(null,Array.from(r)),n=s.substring(s.indexOf("<"),s.length),l=new DOMParser().parseFromString(n,"text/xml").getElementsByTagName("KID")[0];if(l){const d=l.childNodes[0]?l.childNodes[0].nodeValue:l.getAttribute("VALUE");if(d){const c=Fr(d).subarray(0,16);uo(c),this.keyId=c}}break}default:{let i=e.subarray(0,16);if(i.length!==16){const r=new Uint8Array(16);r.set(i,16-i.length),i=r}this.keyId=i;break}}if(!this.keyId||this.keyId.byteLength!==16){let i=Ti[this.uri];if(!i){const r=Object.keys(Ti).length%Number.MAX_SAFE_INTEGER;i=new Uint8Array(16),new DataView(i.buffer,12,4).setUint32(0,r),Ti[this.uri]=i}this.keyId=i}return this}}function Uo(u){const t=new Uint8Array(16);for(let e=12;e<16;e++)t[e]=u>>8*(15-e)&255;return t}const Sn=/\{\$([a-zA-Z0-9-_]+)\}/g;function gs(u){return Sn.test(u)}function ce(u,t,e){if(u.variableList!==null||u.hasVariableRefs)for(let i=e.length;i--;){const r=e[i],s=t[r];s&&(t[r]=Lr(u,s))}}function Lr(u,t){if(u.variableList!==null||u.hasVariableRefs){const e=u.variableList;return t.replace(Sn,i=>{const r=i.substring(2,i.length-1),s=e==null?void 0:e[r];return s===void 0?(u.playlistParsingError||(u.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${r}"`)),i):s})}return t}function ys(u,t,e){let i=u.variableList;i||(u.variableList=i={});let r,s;if("QUERYPARAM"in t){r=t.QUERYPARAM;try{const n=new self.URL(e).searchParams;if(n.has(r))s=n.get(r);else throw new Error(`"${r}" does not match any query parameter in URI: "${e}"`)}catch(n){u.playlistParsingError||(u.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${n.message}`))}}else r=t.NAME,s=t.VALUE;r in i?u.playlistParsingError||(u.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${r}"`)):i[r]=s||""}function jo(u,t,e){const i=t.IMPORT;if(e&&i in e){let r=u.variableList;r||(u.variableList=r={}),r[i]=e[i]}else u.playlistParsingError||(u.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${i}"`))}function zi(){if(typeof self!="undefined")return self.MediaSource||self.WebKitMediaSource}const $o={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dva1:!0,dvav:!0,dvh1:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}},vs=zi();function Go(u,t){const e=$o[t];return!!e&&e[u.slice(0,4)]===!0}function nr(u,t){var e;return(e=vs==null?void 0:vs.isTypeSupported(`${t||"video"}/mp4;codecs="${u}"`))!=null?e:!1}const _s=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,xs=/#EXT-X-MEDIA:(.*)/g,Vo=/^#EXT(?:INF|-X-TARGETDURATION):/m,Es=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),zo=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class Se{static findGroup(t,e){for(let i=0;i<t.length;i++){const r=t[i];if(r.id===e)return r}}static convertAVC1ToAVCOTI(t){const e=t.split(".");if(e.length>2){let i=e.shift()+".";return i+=parseInt(e.shift()).toString(16),i+=("000"+parseInt(e.shift()).toString(16)).slice(-4),i}return t}static resolve(t,e){return Nr.buildAbsoluteURL(e,t,{alwaysNormalize:!0})}static isMediaPlaylist(t){return Vo.test(t)}static parseMasterPlaylist(t,e){const i=gs(t),r={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:i},s=[];_s.lastIndex=0;let n;for(;(n=_s.exec(t))!=null;)if(n[1]){var o;const l=new Ht(n[1]);ce(r,l,["CODECS","SUPPLEMENTAL-CODECS","ALLOWED-CPC","PATHWAY-ID","STABLE-VARIANT-ID","AUDIO","VIDEO","SUBTITLES","CLOSED-CAPTIONS","NAME"]);const d=Lr(r,n[2]),c={attrs:l,bitrate:l.decimalInteger("AVERAGE-BANDWIDTH")||l.decimalInteger("BANDWIDTH"),name:l.NAME,url:Se.resolve(d,e)},f=l.decimalResolution("RESOLUTION");f&&(c.width=f.width,c.height=f.height),Ho((l.CODECS||"").split(/[ ,]+/).filter(h=>h),c),c.videoCodec&&c.videoCodec.indexOf("avc1")!==-1&&(c.videoCodec=Se.convertAVC1ToAVCOTI(c.videoCodec)),(o=c.unknownCodecs)!=null&&o.length||s.push(c),r.levels.push(c)}else if(n[3]){const l=n[3],d=n[4];switch(l){case"SESSION-DATA":{const c=new Ht(d);ce(r,c,["DATA-ID","LANGUAGE","VALUE","URI"]);const f=c["DATA-ID"];f&&(r.sessionData===null&&(r.sessionData={}),r.sessionData[f]=c);break}case"SESSION-KEY":{const c=bs(d,e,r);c.encrypted&&c.isSupported()?(r.sessionKeys===null&&(r.sessionKeys=[]),r.sessionKeys.push(c)):H.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${d}"`);break}case"DEFINE":{{const c=new Ht(d);ce(r,c,["NAME","VALUE","QUERYPARAM"]),ys(r,c,e)}break}case"CONTENT-STEERING":{const c=new Ht(d);ce(r,c,["SERVER-URI","PATHWAY-ID"]),r.contentSteering={uri:Se.resolve(c["SERVER-URI"],e),pathwayId:c["PATHWAY-ID"]||"."};break}case"START":{r.startTimeOffset=Ts(d);break}}}const a=s.length>0&&s.length<r.levels.length;return r.levels=a?s:r.levels,r.levels.length===0&&(r.playlistParsingError=new Error("no levels found in manifest")),r}static parseMasterPlaylistMedia(t,e,i){let r;const s={},n=i.levels,o={AUDIO:n.map(l=>({id:l.attrs.AUDIO,audioCodec:l.audioCodec})),SUBTITLES:n.map(l=>({id:l.attrs.SUBTITLES,textCodec:l.textCodec})),"CLOSED-CAPTIONS":[]};let a=0;for(xs.lastIndex=0;(r=xs.exec(t))!==null;){const l=new Ht(r[1]),d=l.TYPE;if(d){const c=o[d],f=s[d]||[];s[d]=f,ce(i,l,["URI","GROUP-ID","LANGUAGE","ASSOC-LANGUAGE","STABLE-RENDITION-ID","NAME","INSTREAM-ID","CHARACTERISTICS","CHANNELS"]);const h={attrs:l,bitrate:0,id:a++,groupId:l["GROUP-ID"]||"",instreamId:l["INSTREAM-ID"],name:l.NAME||l.LANGUAGE||"",type:d,default:l.bool("DEFAULT"),autoselect:l.bool("AUTOSELECT"),forced:l.bool("FORCED"),lang:l.LANGUAGE,url:l.URI?Se.resolve(l.URI,e):""};if(c!=null&&c.length){const p=Se.findGroup(c,h.groupId)||c[0];Ss(h,p,"audioCodec"),Ss(h,p,"textCodec")}f.push(h)}}return s}static parseLevelPlaylist(t,e,i,r,s,n){const o=new lo(e),a=o.fragments;let l=null,d=0,c=0,f=0,h=0,p=null,g=new er(r,e),x,E,k,O=-1,T=!1;for(Es.lastIndex=0,o.m3u8=t,o.hasVariableRefs=gs(t);(x=Es.exec(t))!==null;){T&&(T=!1,g=new er(r,e),g.start=f,g.sn=d,g.cc=h,g.level=i,l&&(g.initSegment=l,g.rawProgramDateTime=l.rawProgramDateTime,l.rawProgramDateTime=null));const A=x[1];if(A){g.duration=parseFloat(A);const L=(" "+x[2]).slice(1);g.title=L||null,g.tagList.push(L?["INF",A,L]:["INF",A])}else if(x[3]){if(_t(g.duration)){g.start=f,k&&Is(g,k,o),g.sn=d,g.level=i,g.cc=h,g.urlId=s,a.push(g);const L=(" "+x[3]).slice(1);g.relurl=Lr(o,L),As(g,p),p=g,f+=g.duration,d++,c=0,T=!0}}else if(x[4]){const L=(" "+x[4]).slice(1);p?g.setByteRange(L,p):g.setByteRange(L)}else if(x[5])g.rawProgramDateTime=(" "+x[5]).slice(1),g.tagList.push(["PROGRAM-DATE-TIME",g.rawProgramDateTime]),O===-1&&(O=a.length);else{if(x=x[0].match(zo),!x){H.warn("No matches on slow regex match for level playlist!");continue}for(E=1;E<x.length&&typeof x[E]=="undefined";E++);const L=(" "+x[E]).slice(1),I=(" "+x[E+1]).slice(1),j=x[E+2]?(" "+x[E+2]).slice(1):"";switch(L){case"PLAYLIST-TYPE":o.type=I.toUpperCase();break;case"MEDIA-SEQUENCE":d=o.startSN=parseInt(I);break;case"SKIP":{const F=new Ht(I);ce(o,F,["RECENTLY-REMOVED-DATERANGES"]);const $=F.decimalInteger("SKIPPED-SEGMENTS");if(_t($)){o.skippedSegments=$;for(let Q=$;Q--;)a.unshift(null);d+=$}const V=F.enumeratedString("RECENTLY-REMOVED-DATERANGES");V&&(o.recentlyRemovedDateranges=V.split("	"));break}case"TARGETDURATION":o.targetduration=Math.max(parseInt(I),1);break;case"VERSION":o.version=parseInt(I);break;case"EXTM3U":break;case"ENDLIST":o.live=!1;break;case"#":(I||j)&&g.tagList.push(j?[I,j]:[I]);break;case"DISCONTINUITY":h++,g.tagList.push(["DIS"]);break;case"GAP":g.gap=!0,g.tagList.push([L]);break;case"BITRATE":g.tagList.push([L,I]);break;case"DATERANGE":{const F=new Ht(I);ce(o,F,["ID","CLASS","START-DATE","END-DATE","SCTE35-CMD","SCTE35-OUT","SCTE35-IN"]),ce(o,F,F.clientAttrs);const $=new dn(F,o.dateRanges[F.ID]);$.isValid||o.skippedSegments?o.dateRanges[$.id]=$:H.warn(`Ignoring invalid DATERANGE tag: "${I}"`),g.tagList.push(["EXT-X-DATERANGE",I]);break}case"DEFINE":{{const F=new Ht(I);ce(o,F,["NAME","VALUE","IMPORT","QUERYPARAM"]),"IMPORT"in F?jo(o,F,n):ys(o,F,e)}break}case"DISCONTINUITY-SEQUENCE":h=parseInt(I);break;case"KEY":{const F=bs(I,e,o);if(F.isSupported()){if(F.method==="NONE"){k=void 0;break}k||(k={}),k[F.keyFormat]&&(k=Jt({},k)),k[F.keyFormat]=F}else H.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${I}"`);break}case"START":o.startTimeOffset=Ts(I);break;case"MAP":{const F=new Ht(I);if(ce(o,F,["BYTERANGE","URI"]),g.duration){const $=new er(r,e);Ls($,F,i,k),l=$,g.initSegment=l,l.rawProgramDateTime&&!g.rawProgramDateTime&&(g.rawProgramDateTime=l.rawProgramDateTime)}else Ls(g,F,i,k),l=g,T=!0;break}case"SERVER-CONTROL":{const F=new Ht(I);o.canBlockReload=F.bool("CAN-BLOCK-RELOAD"),o.canSkipUntil=F.optionalFloat("CAN-SKIP-UNTIL",0),o.canSkipDateRanges=o.canSkipUntil>0&&F.bool("CAN-SKIP-DATERANGES"),o.partHoldBack=F.optionalFloat("PART-HOLD-BACK",0),o.holdBack=F.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{const F=new Ht(I);o.partTarget=F.decimalFloatingPoint("PART-TARGET");break}case"PART":{let F=o.partList;F||(F=o.partList=[]);const $=c>0?F[F.length-1]:void 0,V=c++,Q=new Ht(I);ce(o,Q,["BYTERANGE","URI"]);const z=new ao(Q,g,e,V,$);F.push(z),g.duration+=z.duration;break}case"PRELOAD-HINT":{const F=new Ht(I);ce(o,F,["URI"]),o.preloadHint=F;break}case"RENDITION-REPORT":{const F=new Ht(I);ce(o,F,["URI"]),o.renditionReports=o.renditionReports||[],o.renditionReports.push(F);break}default:H.warn(`line parsed but not handled: ${x}`);break}}}p&&!p.relurl?(a.pop(),f-=p.duration,o.partList&&(o.fragmentHint=p)):o.partList&&(As(g,p),g.cc=h,o.fragmentHint=g,k&&Is(g,k,o));const R=a.length,C=a[0],b=a[R-1];if(f+=o.skippedSegments*o.targetduration,f>0&&R&&b){o.averagetargetduration=f/R;const A=b.sn;o.endSN=A!=="initSegment"?A:0,o.live||(b.endList=!0),C&&(o.startCC=C.cc)}else o.endSN=0,o.startCC=0;return o.fragmentHint&&(f+=o.fragmentHint.duration),o.totalduration=f,o.endCC=h,O>0&&Ko(a,O),o}}function bs(u,t,e){var i,r;const s=new Ht(u);ce(e,s,["KEYFORMAT","KEYFORMATVERSIONS","URI","IV","URI"]);const n=(i=s.METHOD)!=null?i:"",o=s.URI,a=s.hexadecimalInteger("IV"),l=s.KEYFORMATVERSIONS,d=(r=s.KEYFORMAT)!=null?r:"identity";o&&s.IV&&!a&&H.error(`Invalid IV: ${s.IV}`);const c=o?Se.resolve(o,t):"",f=(l||"1").split("/").map(Number).filter(Number.isFinite);return new gi(n,c,d,f,a)}function Ts(u){const e=new Ht(u).decimalFloatingPoint("TIME-OFFSET");return _t(e)?e:null}function Ho(u,t){["video","audio","text"].forEach(e=>{const i=u.filter(r=>Go(r,e));if(i.length){const r=i.filter(s=>s.lastIndexOf("avc1",0)===0||s.lastIndexOf("mp4a",0)===0);t[`${e}Codec`]=r.length>0?r[0]:i[0],u=u.filter(s=>i.indexOf(s)===-1)}}),t.unknownCodecs=u}function Ss(u,t,e){const i=t[e];i&&(u[e]=i)}function Ko(u,t){let e=u[t];for(let i=t;i--;){const r=u[i];if(!r)return;r.programDateTime=e.programDateTime-r.duration*1e3,e=r}}function As(u,t){u.rawProgramDateTime?u.programDateTime=Date.parse(u.rawProgramDateTime):t!=null&&t.programDateTime&&(u.programDateTime=t.endProgramDateTime),_t(u.programDateTime)||(u.programDateTime=null,u.rawProgramDateTime=null)}function Ls(u,t,e,i){u.relurl=t.URI,t.BYTERANGE&&u.setByteRange(t.BYTERANGE),u.level=e,u.sn="initSegment",i&&(u.levelkeys=i),u.initSegment=null}function Is(u,t,e){u.levelkeys=t;const{encryptedFragments:i}=e;(!i.length||i[i.length-1].levelkeys!==t)&&Object.keys(t).some(r=>t[r].isCommonEncryption)&&i.push(u)}var Pt={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},Tt={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};function ws(u){const{type:t}=u;switch(t){case Pt.AUDIO_TRACK:return Tt.AUDIO;case Pt.SUBTITLE_TRACK:return Tt.SUBTITLE;default:return Tt.MAIN}}function ar(u,t){let e=u.url;return(e===void 0||e.indexOf("data:")===0)&&(e=t.url),e}class Wo{constructor(t){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.hls=t,this.registerListeners()}startLoad(t){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:t}=this;t.on(D.MANIFEST_LOADING,this.onManifestLoading,this),t.on(D.LEVEL_LOADING,this.onLevelLoading,this),t.on(D.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.on(D.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}unregisterListeners(){const{hls:t}=this;t.off(D.MANIFEST_LOADING,this.onManifestLoading,this),t.off(D.LEVEL_LOADING,this.onLevelLoading,this),t.off(D.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.off(D.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}createInternalLoader(t){const e=this.hls.config,i=e.pLoader,r=e.loader,s=i||r,n=new s(e);return this.loaders[t.type]=n,n}getInternalLoader(t){return this.loaders[t.type]}resetInternalLoader(t){this.loaders[t]&&delete this.loaders[t]}destroyInternalLoaders(){for(const t in this.loaders){const e=this.loaders[t];e&&e.destroy(),this.resetInternalLoader(t)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(t,e){const{url:i}=e;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:Pt.MANIFEST,url:i,deliveryDirectives:null})}onLevelLoading(t,e){const{id:i,level:r,url:s,deliveryDirectives:n}=e;this.load({id:i,level:r,responseType:"text",type:Pt.LEVEL,url:s,deliveryDirectives:n})}onAudioTrackLoading(t,e){const{id:i,groupId:r,url:s,deliveryDirectives:n}=e;this.load({id:i,groupId:r,level:null,responseType:"text",type:Pt.AUDIO_TRACK,url:s,deliveryDirectives:n})}onSubtitleTrackLoading(t,e){const{id:i,groupId:r,url:s,deliveryDirectives:n}=e;this.load({id:i,groupId:r,level:null,responseType:"text",type:Pt.SUBTITLE_TRACK,url:s,deliveryDirectives:n})}load(t){var e;const i=this.hls.config;let r=this.getInternalLoader(t);if(r){const l=r.context;if(l&&l.url===t.url){H.trace("[playlist-loader]: playlist request ongoing");return}H.log(`[playlist-loader]: aborting previous loader for type: ${t.type}`),r.abort()}let s;if(t.type===Pt.MANIFEST?s=i.manifestLoadPolicy.default:s=Jt({},i.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),r=this.createInternalLoader(t),(e=t.deliveryDirectives)!=null&&e.part){let l;if(t.type===Pt.LEVEL&&t.level!==null?l=this.hls.levels[t.level].details:t.type===Pt.AUDIO_TRACK&&t.id!==null?l=this.hls.audioTracks[t.id].details:t.type===Pt.SUBTITLE_TRACK&&t.id!==null&&(l=this.hls.subtitleTracks[t.id].details),l){const d=l.partTarget,c=l.targetduration;if(d&&c){const f=Math.max(d*3,c*.8)*1e3;s=Jt({},s,{maxTimeToFirstByteMs:Math.min(f,s.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(f,s.maxTimeToFirstByteMs)})}}}const n=s.errorRetry||s.timeoutRetry||{},o={loadPolicy:s,timeout:s.maxLoadTimeMs,maxRetry:n.maxNumRetry||0,retryDelay:n.retryDelayMs||0,maxRetryDelay:n.maxRetryDelayMs||0},a={onSuccess:(l,d,c,f)=>{const h=this.getInternalLoader(c);this.resetInternalLoader(c.type);const p=l.data;if(p.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(l,c,new Error("no EXTM3U delimiter"),f||null,d);return}d.parsing.start=performance.now(),Se.isMediaPlaylist(p)?this.handleTrackOrLevelPlaylist(l,d,c,f||null,h):this.handleMasterPlaylist(l,d,c,f)},onError:(l,d,c,f)=>{this.handleNetworkError(d,c,!1,l,f)},onTimeout:(l,d,c)=>{this.handleNetworkError(d,c,!0,void 0,l)}};r.load(t,o,a)}handleMasterPlaylist(t,e,i,r){const s=this.hls,n=t.data,o=ar(t,i),a=Se.parseMasterPlaylist(n,o);if(a.playlistParsingError){this.handleManifestParsingError(t,i,a.playlistParsingError,r,e);return}const{contentSteering:l,levels:d,sessionData:c,sessionKeys:f,startTimeOffset:h,variableList:p}=a;this.variableList=p;const{AUDIO:g=[],SUBTITLES:x,"CLOSED-CAPTIONS":E}=Se.parseMasterPlaylistMedia(n,o,a);g.length&&!g.some(O=>!O.url)&&d[0].audioCodec&&!d[0].attrs.AUDIO&&(H.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),g.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new Ht({}),bitrate:0,url:""})),s.trigger(D.MANIFEST_LOADED,{levels:d,audioTracks:g,subtitles:x,captions:E,contentSteering:l,url:o,stats:e,networkDetails:r,sessionData:c,sessionKeys:f,startTimeOffset:h,variableList:p})}handleTrackOrLevelPlaylist(t,e,i,r,s){const n=this.hls,{id:o,level:a,type:l}=i,d=ar(t,i),c=_t(o)?o:0,f=_t(a)?a:c,h=ws(i),p=Se.parseLevelPlaylist(t.data,d,f,h,c,this.variableList);if(l===Pt.MANIFEST){const g={attrs:new Ht({}),bitrate:0,details:p,name:"",url:d};n.trigger(D.MANIFEST_LOADED,{levels:[g],audioTracks:[],url:d,stats:e,networkDetails:r,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}e.parsing.end=performance.now(),i.levelDetails=p,this.handlePlaylistLoaded(p,t,e,i,r,s)}handleManifestParsingError(t,e,i,r,s){this.hls.trigger(D.ERROR,{type:bt.NETWORK_ERROR,details:tt.MANIFEST_PARSING_ERROR,fatal:e.type===Pt.MANIFEST,url:t.url,err:i,error:i,reason:i.message,response:t,context:e,networkDetails:r,stats:s})}handleNetworkError(t,e,i=!1,r,s){let n=`A network ${i?"timeout":"error"+(r?" (status "+r.code+")":"")} occurred while loading ${t.type}`;t.type===Pt.LEVEL?n+=`: ${t.level} id: ${t.id}`:(t.type===Pt.AUDIO_TRACK||t.type===Pt.SUBTITLE_TRACK)&&(n+=` id: ${t.id} group-id: "${t.groupId}"`);const o=new Error(n);H.warn(`[playlist-loader]: ${n}`);let a=tt.UNKNOWN,l=!1;const d=this.getInternalLoader(t);switch(t.type){case Pt.MANIFEST:a=i?tt.MANIFEST_LOAD_TIMEOUT:tt.MANIFEST_LOAD_ERROR,l=!0;break;case Pt.LEVEL:a=i?tt.LEVEL_LOAD_TIMEOUT:tt.LEVEL_LOAD_ERROR,l=!1;break;case Pt.AUDIO_TRACK:a=i?tt.AUDIO_TRACK_LOAD_TIMEOUT:tt.AUDIO_TRACK_LOAD_ERROR,l=!1;break;case Pt.SUBTITLE_TRACK:a=i?tt.SUBTITLE_TRACK_LOAD_TIMEOUT:tt.SUBTITLE_LOAD_ERROR,l=!1;break}d&&this.resetInternalLoader(t.type);const c={type:bt.NETWORK_ERROR,details:a,fatal:l,url:t.url,loader:d,context:t,error:o,networkDetails:e,stats:s};if(r){const f=(e==null?void 0:e.url)||t.url;c.response=fe({url:f,data:void 0},r)}this.hls.trigger(D.ERROR,c)}handlePlaylistLoaded(t,e,i,r,s,n){const o=this.hls,{type:a,level:l,id:d,groupId:c,deliveryDirectives:f}=r,h=ar(e,r),p=ws(r),g=typeof r.level=="number"&&p===Tt.MAIN?l:void 0;if(!t.fragments.length){const E=new Error("No Segments found in Playlist");o.trigger(D.ERROR,{type:bt.NETWORK_ERROR,details:tt.LEVEL_EMPTY_ERROR,fatal:!1,url:h,error:E,reason:E.message,response:e,context:r,level:g,parent:p,networkDetails:s,stats:i});return}t.targetduration||(t.playlistParsingError=new Error("Missing Target Duration"));const x=t.playlistParsingError;if(x){o.trigger(D.ERROR,{type:bt.NETWORK_ERROR,details:tt.LEVEL_PARSING_ERROR,fatal:!1,url:h,error:x,reason:x.message,response:e,context:r,level:g,parent:p,networkDetails:s,stats:i});return}switch(t.live&&n&&(n.getCacheAge&&(t.ageHeader=n.getCacheAge()||0),(!n.getCacheAge||isNaN(t.ageHeader))&&(t.ageHeader=0)),a){case Pt.MANIFEST:case Pt.LEVEL:o.trigger(D.LEVEL_LOADED,{details:t,level:g||0,id:d||0,stats:i,networkDetails:s,deliveryDirectives:f});break;case Pt.AUDIO_TRACK:o.trigger(D.AUDIO_TRACK_LOADED,{details:t,id:d||0,groupId:c||"",stats:i,networkDetails:s,deliveryDirectives:f});break;case Pt.SUBTITLE_TRACK:o.trigger(D.SUBTITLE_TRACK_LOADED,{details:t,id:d||0,groupId:c||"",stats:i,networkDetails:s,deliveryDirectives:f});break}}}function An(u,t){let e;try{e=new Event("addtrack")}catch(i){e=document.createEvent("Event"),e.initEvent("addtrack",!1,!1)}e.track=u,t.dispatchEvent(e)}function Ln(u,t){const e=u.mode;if(e==="disabled"&&(u.mode="hidden"),u.cues&&!u.cues.getCueById(t.id))try{if(u.addCue(t),!u.cues.getCueById(t.id))throw new Error(`addCue is failed for: ${t}`)}catch(i){H.debug(`[texttrack-utils]: ${i}`);const r=new self.TextTrackCue(t.startTime,t.endTime,t.text);r.id=t.id,u.addCue(r)}e==="disabled"&&(u.mode=e)}function ai(u){const t=u.mode;if(t==="disabled"&&(u.mode="hidden"),u.cues)for(let e=u.cues.length;e--;)u.removeCue(u.cues[e]);t==="disabled"&&(u.mode=t)}function Ir(u,t,e,i){const r=u.mode;if(r==="disabled"&&(u.mode="hidden"),u.cues&&u.cues.length>0){const s=qo(u.cues,t,e);for(let n=0;n<s.length;n++)(!i||i(s[n]))&&u.removeCue(s[n])}r==="disabled"&&(u.mode=r)}function Yo(u,t){if(t<u[0].startTime)return 0;const e=u.length-1;if(t>u[e].endTime)return-1;let i=0,r=e;for(;i<=r;){const s=Math.floor((r+i)/2);if(t<u[s].startTime)r=s-1;else if(t>u[s].startTime&&i<e)i=s+1;else return s}return u[i].startTime-t<t-u[r].startTime?i:r}function qo(u,t,e){const i=[],r=Yo(u,t);if(r>-1)for(let s=r,n=u.length;s<n;s++){const o=u[s];if(o.startTime>=t&&o.endTime<=e)i.push(o);else if(o.startTime>e)return i}return i}var Te={audioId3:"org.id3",dateRange:"com.apple.quicktime.HLS",emsg:"https://aomedia.org/emsg/ID3"};const Zo=.25;function wr(){if(typeof self!="undefined")return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}const Si=(()=>{const u=wr();try{new u(0,Number.POSITIVE_INFINITY,"")}catch(t){return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();function or(u,t){return u.getTime()/1e3-t}function Xo(u){return Uint8Array.from(u.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}class Qo{constructor(t){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=t,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null}_registerListeners(){const{hls:t}=this;t.on(D.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(D.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(D.MANIFEST_LOADING,this.onManifestLoading,this),t.on(D.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),t.on(D.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(D.LEVEL_UPDATED,this.onLevelUpdated,this)}_unregisterListeners(){const{hls:t}=this;t.off(D.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(D.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(D.MANIFEST_LOADING,this.onManifestLoading,this),t.off(D.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),t.off(D.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(D.LEVEL_UPDATED,this.onLevelUpdated,this)}onMediaAttached(t,e){this.media=e.media}onMediaDetaching(){!this.id3Track||(ai(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(t){const e=this.getID3Track(t.textTracks);return e.mode="hidden",e}getID3Track(t){if(!!this.media){for(let e=0;e<t.length;e++){const i=t[e];if(i.kind==="metadata"&&i.label==="id3")return An(i,this.media),i}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(t,e){if(!this.media)return;const{hls:{config:{enableEmsgMetadataCues:i,enableID3MetadataCues:r}}}=this;if(!i&&!r)return;const{samples:s}=e;this.id3Track||(this.id3Track=this.createTrack(this.media));const n=wr();for(let o=0;o<s.length;o++){const a=s[o].type;if(a===Te.emsg&&!i||!r)continue;const l=gn(s[o].data);if(l){const d=s[o].pts;let c=d+s[o].duration;c>Si&&(c=Si),c-d<=0&&(c=d+Zo);for(let h=0;h<l.length;h++){const p=l[h];if(!mn(p)){this.updateId3CueEnds(d);const g=new n(d,c,"");g.value=p,a&&(g.type=a),this.id3Track.addCue(g)}}}}}updateId3CueEnds(t){var e;const i=(e=this.id3Track)==null?void 0:e.cues;if(i)for(let r=i.length;r--;){const s=i[r];s.startTime<t&&s.endTime===Si&&(s.endTime=t)}}onBufferFlushing(t,{startOffset:e,endOffset:i,type:r}){const{id3Track:s,hls:n}=this;if(!n)return;const{config:{enableEmsgMetadataCues:o,enableID3MetadataCues:a}}=n;if(s&&(o||a)){let l;r==="audio"?l=d=>d.type===Te.audioId3&&a:r==="video"?l=d=>d.type===Te.emsg&&o:l=d=>d.type===Te.audioId3&&a||d.type===Te.emsg&&o,Ir(s,e,i,l)}}onLevelUpdated(t,{details:e}){if(!this.media||!e.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)return;const{dateRangeCuesAppended:i,id3Track:r}=this,{dateRanges:s}=e,n=Object.keys(s);if(r){const d=Object.keys(i).filter(c=>!n.includes(c));for(let c=d.length;c--;){const f=d[c];Object.keys(i[f].cues).forEach(h=>{r.removeCue(i[f].cues[h])}),delete i[f]}}const o=e.fragments[e.fragments.length-1];if(n.length===0||!_t(o==null?void 0:o.programDateTime))return;this.id3Track||(this.id3Track=this.createTrack(this.media));const a=o.programDateTime/1e3-o.start,l=wr();for(let d=0;d<n.length;d++){const c=n[d],f=s[c],h=i[c],p=(h==null?void 0:h.cues)||{};let g=(h==null?void 0:h.durationKnown)||!1;const x=or(f.startDate,a);let E=Si;const k=f.endDate;if(k)E=or(k,a),g=!0;else if(f.endOnNext&&!g){const T=n.reduce((R,C)=>{const b=s[C];return b.class===f.class&&b.id!==C&&b.startDate>f.startDate&&R.push(b),R},[]).sort((R,C)=>R.startDate.getTime()-C.startDate.getTime())[0];T&&(E=or(T.startDate,a),g=!0)}const O=Object.keys(f.attr);for(let T=0;T<O.length;T++){const R=O[T];if(!so(R))continue;let C=p[R];if(C)g&&!h.durationKnown&&(C.endTime=E);else{let b=f.attr[R];C=new l(x,E,""),no(R)&&(b=Xo(b)),C.value={key:R,data:b},C.type=Te.dateRange,C.id=c,this.id3Track.addCue(C),p[R]=C}}i[c]={cues:p,dateRange:f,durationKnown:g}}}}class Jo{constructor(t){this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=()=>this.timeupdate(),this.hls=t,this.config=t.config,this.registerListeners()}get latency(){return this._latency||0}get maxLatency(){const{config:t,levelDetails:e}=this;return t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:e?t.liveMaxLatencyDurationCount*e.targetduration:0}get targetLatency(){const{levelDetails:t}=this;if(t===null)return null;const{holdBack:e,partHoldBack:i,targetduration:r}=t,{liveSyncDuration:s,liveSyncDurationCount:n,lowLatencyMode:o}=this.config,a=this.hls.userConfig;let l=o&&i||e;(a.liveSyncDuration||a.liveSyncDurationCount||l===0)&&(l=s!==void 0?s:n*r);const d=r,c=1;return l+Math.min(this.stallCount*c,d)}get liveSyncPosition(){const t=this.estimateLiveEdge(),e=this.targetLatency,i=this.levelDetails;if(t===null||e===null||i===null)return null;const r=i.edge,s=t-e-this.edgeStalled,n=r-i.totalduration,o=r-(this.config.lowLatencyMode&&i.partTarget||i.targetduration);return Math.min(Math.max(n,s),o)}get drift(){const{levelDetails:t}=this;return t===null?1:t.drift}get edgeStalled(){const{levelDetails:t}=this;if(t===null)return 0;const e=(this.config.lowLatencyMode&&t.partTarget||t.targetduration)*3;return Math.max(t.age-e,0)}get forwardBufferLength(){const{media:t,levelDetails:e}=this;if(!t||!e)return 0;const i=t.buffered.length;return(i?t.buffered.end(i-1):e.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null}registerListeners(){this.hls.on(D.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(D.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(D.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(D.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(D.ERROR,this.onError,this)}unregisterListeners(){this.hls.off(D.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(D.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.off(D.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(D.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.off(D.ERROR,this.onError,this)}onMediaAttached(t,e){this.media=e.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)}onManifestLoading(){this.levelDetails=null,this._latency=null,this.stallCount=0}onLevelUpdated(t,{details:e}){this.levelDetails=e,e.advanced&&this.timeupdate(),!e.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)}onError(t,e){var i;e.details===tt.BUFFER_STALLED_ERROR&&(this.stallCount++,(i=this.levelDetails)!=null&&i.live&&H.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))}timeupdate(){const{media:t,levelDetails:e}=this;if(!t||!e)return;this.currentTime=t.currentTime;const i=this.computeLatency();if(i===null)return;this._latency=i;const{lowLatencyMode:r,maxLiveSyncPlaybackRate:s}=this.config;if(!r||s===1)return;const n=this.targetLatency;if(n===null)return;const o=i-n,a=Math.min(this.maxLatency,n+e.targetduration),l=o<a;if(e.live&&l&&o>.05&&this.forwardBufferLength>1){const d=Math.min(2,Math.max(1,s)),c=Math.round(2/(1+Math.exp(-.75*o-this.edgeStalled))*20)/20;t.playbackRate=Math.min(d,Math.max(1,c))}else t.playbackRate!==1&&t.playbackRate!==0&&(t.playbackRate=1)}estimateLiveEdge(){const{levelDetails:t}=this;return t===null?null:t.edge+t.age}computeLatency(){const t=this.estimateLiveEdge();return t===null?null:t-this.currentTime}}const Rr=["NONE","TYPE-0","TYPE-1",null];var mi={No:"",Yes:"YES",v2:"v2"};function tl(u,t){const{canSkipUntil:e,canSkipDateRanges:i,endSN:r}=u,s=t!==void 0?t-r:0;return e&&s<e?i?mi.v2:mi.Yes:mi.No}class Rs{constructor(t,e,i){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=t,this.part=e,this.skip=i}addDirectives(t){const e=new self.URL(t);return this.msn!==void 0&&e.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&e.searchParams.set("_HLS_part",this.part.toString()),this.skip&&e.searchParams.set("_HLS_skip",this.skip),e.href}}class yi{constructor(t){this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[t.url],this._attrs=[t.attrs],this.bitrate=t.bitrate,t.details&&(this.details=t.details),this.id=t.id||0,this.name=t.name,this.width=t.width||0,this.height=t.height||0,this.audioCodec=t.audioCodec,this.videoCodec=t.videoCodec,this.unknownCodecs=t.unknownCodecs,this.codecSet=[t.videoCodec,t.audioCodec].filter(e=>e).join(",").replace(/\.[^.,]+/g,"")}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get attrs(){return this._attrs[this._urlId]}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get uri(){return this.url[this._urlId]||""}get urlId(){return this._urlId}set urlId(t){const e=t%this.url.length;this._urlId!==e&&(this.fragmentError=0,this.loadError=0,this.details=void 0,this._urlId=e)}get audioGroupId(){var t;return(t=this.audioGroupIds)==null?void 0:t[this.urlId]}get textGroupId(){var t;return(t=this.textGroupIds)==null?void 0:t[this.urlId]}addFallback(t){this.url.push(t.url),this._attrs.push(t.attrs)}}function lr(u,t){const e=t.startPTS;if(_t(e)){let i=0,r;t.sn>u.sn?(i=e-u.start,r=u):(i=u.start-e,r=t),r.duration!==i&&(r.duration=i)}else t.sn>u.sn?u.cc===t.cc&&u.minEndPTS?t.start=u.start+(u.minEndPTS-u.start):t.start=u.start+u.duration:t.start=Math.max(u.start-t.duration,0)}function In(u,t,e,i,r,s){i-e<=0&&(H.warn("Fragment should have a positive duration",t),i=e+t.duration,s=r+t.duration);let o=e,a=i;const l=t.startPTS,d=t.endPTS;if(_t(l)){const x=Math.abs(l-e);_t(t.deltaPTS)?t.deltaPTS=Math.max(x,t.deltaPTS):t.deltaPTS=x,o=Math.max(e,l),e=Math.min(e,l),r=Math.min(r,t.startDTS),a=Math.min(i,d),i=Math.max(i,d),s=Math.max(s,t.endDTS)}const c=e-t.start;t.start!==0&&(t.start=e),t.duration=i-t.start,t.startPTS=e,t.maxStartPTS=o,t.startDTS=r,t.endPTS=i,t.minEndPTS=a,t.endDTS=s;const f=t.sn;if(!u||f<u.startSN||f>u.endSN)return 0;let h;const p=f-u.startSN,g=u.fragments;for(g[p]=t,h=p;h>0;h--)lr(g[h],g[h-1]);for(h=p;h<g.length-1;h++)lr(g[h],g[h+1]);return u.fragmentHint&&lr(g[g.length-1],u.fragmentHint),u.PTSKnown=u.alignedSliding=!0,c}function el(u,t){let e=null;const i=u.fragments;for(let a=i.length-1;a>=0;a--){const l=i[a].initSegment;if(l){e=l;break}}u.fragmentHint&&delete u.fragmentHint.endPTS;let r=0,s;if(sl(u,t,(a,l)=>{a.relurl&&(r=a.cc-l.cc),_t(a.startPTS)&&_t(a.endPTS)&&(l.start=l.startPTS=a.startPTS,l.startDTS=a.startDTS,l.maxStartPTS=a.maxStartPTS,l.endPTS=a.endPTS,l.endDTS=a.endDTS,l.minEndPTS=a.minEndPTS,l.duration=a.endPTS-a.startPTS,l.duration&&(s=l),t.PTSKnown=t.alignedSliding=!0),l.elementaryStreams=a.elementaryStreams,l.loader=a.loader,l.stats=a.stats,l.urlId=a.urlId,a.initSegment&&(l.initSegment=a.initSegment,e=a.initSegment)}),e&&(t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments).forEach(l=>{var d;(!l.initSegment||l.initSegment.relurl===((d=e)==null?void 0:d.relurl))&&(l.initSegment=e)}),t.skippedSegments)if(t.deltaUpdateFailed=t.fragments.some(a=>!a),t.deltaUpdateFailed){H.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let a=t.skippedSegments;a--;)t.fragments.shift();t.startSN=t.fragments[0].sn,t.startCC=t.fragments[0].cc}else t.canSkipDateRanges&&(t.dateRanges=il(u.dateRanges,t.dateRanges,t.recentlyRemovedDateranges));const n=t.fragments;if(r){H.warn("discontinuity sliding from playlist, take drift into account");for(let a=0;a<n.length;a++)n[a].cc+=r}t.skippedSegments&&(t.startCC=t.fragments[0].cc),rl(u.partList,t.partList,(a,l)=>{l.elementaryStreams=a.elementaryStreams,l.stats=a.stats}),s?In(t,s,s.startPTS,s.endPTS,s.startDTS,s.endDTS):wn(u,t),n.length&&(t.totalduration=t.edge-n[0].start),t.driftStartTime=u.driftStartTime,t.driftStart=u.driftStart;const o=t.advancedDateTime;if(t.advanced&&o){const a=t.edge;t.driftStart||(t.driftStartTime=o,t.driftStart=a),t.driftEndTime=o,t.driftEnd=a}else t.driftEndTime=u.driftEndTime,t.driftEnd=u.driftEnd,t.advancedDateTime=u.advancedDateTime}function il(u,t,e){const i=Jt({},u);return e&&e.forEach(r=>{delete i[r]}),Object.keys(t).forEach(r=>{const s=new dn(t[r].attr,i[r]);s.isValid?i[r]=s:H.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${JSON.stringify(t[r].attr)}"`)}),i}function rl(u,t,e){if(u&&t){let i=0;for(let r=0,s=u.length;r<=s;r++){const n=u[r],o=t[r+i];n&&o&&n.index===o.index&&n.fragment.sn===o.fragment.sn?e(n,o):i--}}}function sl(u,t,e){const i=t.skippedSegments,r=Math.max(u.startSN,t.startSN)-t.startSN,s=(u.fragmentHint?1:0)+(i?t.endSN:Math.min(u.endSN,t.endSN))-t.startSN,n=t.startSN-u.startSN,o=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,a=u.fragmentHint?u.fragments.concat(u.fragmentHint):u.fragments;for(let l=r;l<=s;l++){const d=a[n+l];let c=o[l];i&&!c&&l<i&&(c=t.fragments[l]=d),d&&c&&e(d,c)}}function wn(u,t){const e=t.startSN+t.skippedSegments-u.startSN,i=u.fragments;e<0||e>=i.length||Dr(t,i[e].start)}function Dr(u,t){if(t){const e=u.fragments;for(let i=u.skippedSegments;i<e.length;i++)e[i].start+=t;u.fragmentHint&&(u.fragmentHint.start+=t)}}function nl(u,t=1/0){let e=1e3*u.targetduration;if(u.updated){const i=u.fragments,r=4;if(i.length&&e*r>t){const s=i[i.length-1].duration*1e3;s<e&&(e=s)}}else e/=2;return Math.round(e)}function al(u,t,e){if(!(u!=null&&u.details))return null;const i=u.details;let r=i.fragments[t-i.startSN];return r||(r=i.fragmentHint,r&&r.sn===t)?r:t<i.startSN&&e&&e.sn===t?e:null}function Ds(u,t,e){var i;return u!=null&&u.details?Rn((i=u.details)==null?void 0:i.partList,t,e):null}function Rn(u,t,e){if(u)for(let i=u.length;i--;){const r=u[i];if(r.index===e&&r.fragment.sn===t)return r}return null}function Bi(u){switch(u.details){case tt.FRAG_LOAD_TIMEOUT:case tt.KEY_LOAD_TIMEOUT:case tt.LEVEL_LOAD_TIMEOUT:case tt.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function ks(u,t){const e=Bi(t);return u.default[`${e?"timeout":"error"}Retry`]}function Ur(u,t){const e=u.backoff==="linear"?1:Math.pow(2,t);return Math.min(e*u.retryDelayMs,u.maxRetryDelayMs)}function Cs(u){return fe(fe({},u),{errorRetry:null,timeoutRetry:null})}function Ui(u,t,e,i){return!!u&&t<u.maxNumRetry&&(ol(i)||!!e)}function ol(u){return u===0&&navigator.onLine===!1||!!u&&(u<400||u>499)}const Dn={search:function(u,t){let e=0,i=u.length-1,r=null,s=null;for(;e<=i;){r=(e+i)/2|0,s=u[r];const n=t(s);if(n>0)e=r+1;else if(n<0)i=r-1;else return s}return null}};function ll(u,t,e){if(t===null||!Array.isArray(u)||!u.length||!_t(t))return null;const i=u[0].programDateTime;if(t<(i||0))return null;const r=u[u.length-1].endProgramDateTime;if(t>=(r||0))return null;e=e||0;for(let s=0;s<u.length;++s){const n=u[s];if(dl(t,e,n))return n}return null}function vi(u,t,e=0,i=0){let r=null;if(u?r=t[u.sn-t[0].sn+1]||null:e===0&&t[0].start===0&&(r=t[0]),r&&kr(e,i,r)===0)return r;const s=Dn.search(t,kr.bind(null,e,i));return s&&(s!==u||!r)?s:r}function kr(u=0,t=0,e){if(e.start<=u&&e.start+e.duration>u)return 0;const i=Math.min(t,e.duration+(e.deltaPTS?e.deltaPTS:0));return e.start+e.duration-i<=u?1:e.start-i>u&&e.start?-1:0}function dl(u,t,e){const i=Math.min(t,e.duration+(e.deltaPTS?e.deltaPTS:0))*1e3;return(e.endProgramDateTime||0)-i>u}function cl(u,t){return Dn.search(u,e=>e.cc<t?1:e.cc>t?-1:0)}const ul=3e5;var ue={DoNothing:0,SendEndCallback:1,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,InsertDiscontinuity:4,RetryRequest:5},Ee={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,SwitchToSDR:4};class hl{constructor(t){this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.log=void 0,this.warn=void 0,this.error=void 0,this.hls=t,this.log=H.log.bind(H,"[info]:"),this.warn=H.warn.bind(H,"[warning]:"),this.error=H.error.bind(H,"[error]:"),this.registerListeners()}registerListeners(){const t=this.hls;t.on(D.ERROR,this.onError,this),t.on(D.MANIFEST_LOADING,this.onManifestLoading,this),t.on(D.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const t=this.hls;!t||(t.off(D.ERROR,this.onError,this),t.off(D.ERROR,this.onErrorOut,this),t.off(D.MANIFEST_LOADING,this.onManifestLoading,this),t.off(D.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}startLoad(t){this.playlistError=0}stopLoad(){}getVariantLevelIndex(t){return(t==null?void 0:t.type)===Tt.MAIN?t.level:this.hls.loadLevel}onManifestLoading(){this.playlistError=0,this.penalizedRenditions={}}onLevelUpdated(){this.playlistError=0}onError(t,e){var i;if(e.fatal)return;const r=this.hls,s=e.context;switch(e.details){case tt.FRAG_LOAD_ERROR:case tt.FRAG_LOAD_TIMEOUT:case tt.KEY_LOAD_ERROR:case tt.KEY_LOAD_TIMEOUT:e.errorAction=this.getFragRetryOrSwitchAction(e);return;case tt.FRAG_GAP:case tt.FRAG_PARSING_ERROR:case tt.FRAG_DECRYPT_ERROR:{e.errorAction=this.getFragRetryOrSwitchAction(e),e.errorAction.action=ue.SendAlternateToPenaltyBox;return}case tt.LEVEL_EMPTY_ERROR:case tt.LEVEL_PARSING_ERROR:{var n,o;const a=e.parent===Tt.MAIN?e.level:r.loadLevel;e.details===tt.LEVEL_EMPTY_ERROR&&!!((n=e.context)!=null&&(o=n.levelDetails)!=null&&o.live)?e.errorAction=this.getPlaylistRetryOrSwitchAction(e,a):(e.levelRetry=!1,e.errorAction=this.getLevelSwitchAction(e,a))}return;case tt.LEVEL_LOAD_ERROR:case tt.LEVEL_LOAD_TIMEOUT:typeof(s==null?void 0:s.level)=="number"&&(e.errorAction=this.getPlaylistRetryOrSwitchAction(e,s.level));return;case tt.AUDIO_TRACK_LOAD_ERROR:case tt.AUDIO_TRACK_LOAD_TIMEOUT:case tt.SUBTITLE_LOAD_ERROR:case tt.SUBTITLE_TRACK_LOAD_TIMEOUT:if(s){const a=r.levels[r.loadLevel];if(a&&(s.type===Pt.AUDIO_TRACK&&s.groupId===a.audioGroupId||s.type===Pt.SUBTITLE_TRACK&&s.groupId===a.textGroupId)){e.errorAction=this.getPlaylistRetryOrSwitchAction(e,r.loadLevel),e.errorAction.action=ue.SendAlternateToPenaltyBox,e.errorAction.flags=Ee.MoveAllAlternatesMatchingHost;return}}return;case tt.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{const a=r.levels[r.loadLevel],l=a==null?void 0:a.attrs["HDCP-LEVEL"];l&&(e.errorAction={action:ue.SendAlternateToPenaltyBox,flags:Ee.MoveAllAlternatesMatchingHDCP,hdcpLevel:l})}return;case tt.BUFFER_ADD_CODEC_ERROR:case tt.REMUX_ALLOC_ERROR:e.errorAction=this.getLevelSwitchAction(e,(i=e.level)!=null?i:r.loadLevel);return;case tt.INTERNAL_EXCEPTION:case tt.BUFFER_APPENDING_ERROR:case tt.BUFFER_APPEND_ERROR:case tt.BUFFER_FULL_ERROR:case tt.LEVEL_SWITCH_ERROR:case tt.BUFFER_STALLED_ERROR:case tt.BUFFER_SEEK_OVER_HOLE:case tt.BUFFER_NUDGE_ON_STALL:e.errorAction={action:ue.DoNothing,flags:Ee.None};return}if(e.type===bt.KEY_SYSTEM_ERROR){const a=this.getVariantLevelIndex(e.frag);e.levelRetry=!1,e.errorAction=this.getLevelSwitchAction(e,a);return}}getPlaylistRetryOrSwitchAction(t,e){var i;const r=this.hls,s=ks(r.config.playlistLoadPolicy,t),n=this.playlistError++,o=(i=t.response)==null?void 0:i.code;if(Ui(s,n,Bi(t),o))return{action:ue.RetryRequest,flags:Ee.None,retryConfig:s,retryCount:n};const l=this.getLevelSwitchAction(t,e);return s&&(l.retryConfig=s,l.retryCount=n),l}getFragRetryOrSwitchAction(t){const e=this.hls,i=this.getVariantLevelIndex(t.frag),r=e.levels[i],{fragLoadPolicy:s,keyLoadPolicy:n}=e.config,o=ks(t.details.startsWith("key")?n:s,t),a=e.levels.reduce((c,f)=>c+f.fragmentError,0);if(r){var l;t.details!==tt.FRAG_GAP&&r.fragmentError++;const c=(l=t.response)==null?void 0:l.code;if(Ui(o,a,Bi(t),c))return{action:ue.RetryRequest,flags:Ee.None,retryConfig:o,retryCount:a}}const d=this.getLevelSwitchAction(t,i);return o&&(d.retryConfig=o,d.retryCount=a),d}getLevelSwitchAction(t,e){const i=this.hls;e==null&&(e=i.loadLevel);const r=this.hls.levels[e];if(r&&(r.loadError++,i.autoLevelEnabled)){var s,n;let o=-1;const a=i.levels,l=(s=t.frag)==null?void 0:s.type,{type:d,groupId:c}=(n=t.context)!=null?n:{};for(let f=a.length;f--;){const h=(f+i.loadLevel)%a.length;if(h!==i.loadLevel&&a[h].loadError===0){const p=a[h];if(t.details===tt.FRAG_GAP&&t.frag){const g=a[h].details;if(g){const x=vi(t.frag,g.fragments,t.frag.start);if(x!=null&&x.gap)continue}}else{if(d===Pt.AUDIO_TRACK&&c===p.audioGroupId||d===Pt.SUBTITLE_TRACK&&c===p.textGroupId)continue;if(l===Tt.AUDIO&&r.audioGroupId===p.audioGroupId||l===Tt.SUBTITLE&&r.textGroupId===p.textGroupId)continue}o=h;break}}if(o>-1&&i.loadLevel!==o)return t.levelRetry=!0,this.playlistError=0,{action:ue.SendAlternateToPenaltyBox,flags:Ee.None,nextAutoLevel:o}}return{action:ue.SendAlternateToPenaltyBox,flags:Ee.MoveAllAlternatesMatchingHost}}onErrorOut(t,e){var i;switch((i=e.errorAction)==null?void 0:i.action){case ue.DoNothing:break;case ue.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(e),!e.errorAction.resolved&&e.details!==tt.FRAG_GAP&&(e.fatal=!0);break}if(e.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(t){const e=this.hls,i=t.errorAction;if(!i)return;const{flags:r,hdcpLevel:s,nextAutoLevel:n}=i;switch(r){case Ee.None:this.switchLevel(t,n);break;case Ee.MoveAllAlternatesMatchingHost:i.resolved||(i.resolved=this.redundantFailover(t));break;case Ee.MoveAllAlternatesMatchingHDCP:s&&(e.maxHdcpLevel=Rr[Rr.indexOf(s)-1],i.resolved=!0),this.warn(`Restricting playback to HDCP-LEVEL of "${e.maxHdcpLevel}" or lower`);break}i.resolved||this.switchLevel(t,n)}switchLevel(t,e){e!==void 0&&t.errorAction&&(this.warn(`switching to level ${e} after ${t.details}`),this.hls.nextAutoLevel=e,t.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel)}redundantFailover(t){const{hls:e,penalizedRenditions:i}=this,r=t.parent===Tt.MAIN?t.level:e.loadLevel,s=e.levels[r],n=s.url.length,o=t.frag?t.frag.urlId:s.urlId;s.urlId===o&&(!t.frag||s.details)&&this.penalizeRendition(s,t);for(let a=1;a<n;a++){const l=(o+a)%n,d=i[l];if(!d||fl(d,t,i[o]))return this.warn(`Switching to Redundant Stream ${l+1}/${n}: "${s.url[l]}" after ${t.details}`),this.playlistError=0,e.levels.forEach(c=>{c.urlId=l}),e.nextLoadLevel=r,!0}return!1}penalizeRendition(t,e){const{penalizedRenditions:i}=this,r=i[t.urlId]||{lastErrorPerfMs:0,errors:[],details:void 0};r.lastErrorPerfMs=performance.now(),r.errors.push(e),r.details=t.details,i[t.urlId]=r}}function fl(u,t,e){if(performance.now()-u.lastErrorPerfMs>ul)return!0;const i=u.details;if(t.details===tt.FRAG_GAP&&i&&t.frag){const r=t.frag.start,s=vi(null,i.fragments,r);if(s&&!s.gap)return!0}if(e&&u.errors.length<e.errors.length){const r=u.errors[u.errors.length-1];if(i&&r.frag&&t.frag&&Math.abs(r.frag.start-t.frag.start)>i.targetduration*3)return!0}return!1}class jr{constructor(t,e){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.log=void 0,this.warn=void 0,this.log=H.log.bind(H,`${e}:`),this.warn=H.warn.bind(H,`${e}:`),this.hls=t}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){clearTimeout(this.timer),this.timer=-1}startLoad(){this.canLoad=!0,this.requestScheduled=-1,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(t,e){const i=e==null?void 0:e.renditionReports;if(i){let r=-1;for(let s=0;s<i.length;s++){const n=i[s];let o;try{o=new self.URL(n.URI,e.url).href}catch(a){H.warn(`Could not construct new URL for Rendition Report: ${a}`),o=n.URI||""}if(o===t){r=s;break}else o===t.substring(0,o.length)&&(r=s)}if(r!==-1){const s=i[r],n=parseInt(s["LAST-MSN"])||(e==null?void 0:e.lastPartSn);let o=parseInt(s["LAST-PART"])||(e==null?void 0:e.lastPartIndex);if(this.hls.config.lowLatencyMode){const a=Math.min(e.age-e.partTarget,e.targetduration);o>=0&&a>e.partTarget&&(o+=1)}return new Rs(n,o>=0?o:void 0,mi.No)}}}loadPlaylist(t){this.requestScheduled===-1&&(this.requestScheduled=self.performance.now())}shouldLoadPlaylist(t){return this.canLoad&&!!t&&!!t.url&&(!t.details||t.details.live)}shouldReloadPlaylist(t){return this.timer===-1&&this.requestScheduled===-1&&this.shouldLoadPlaylist(t)}playlistLoaded(t,e,i){const{details:r,stats:s}=e,n=self.performance.now(),o=s.loading.first?Math.max(0,n-s.loading.first):0;if(r.advancedDateTime=Date.now()-o,r.live||i!=null&&i.live){if(r.reloaded(i),i&&this.log(`live playlist ${t} ${r.advanced?"REFRESHED "+r.lastPartSn+"-"+r.lastPartIndex:"MISSED"}`),i&&r.fragments.length>0&&el(i,r),!this.canLoad||!r.live)return;let a,l,d;if(r.canBlockReload&&r.endSN&&r.advanced){const x=this.hls.config.lowLatencyMode,E=r.lastPartSn,k=r.endSN,O=r.lastPartIndex,T=O!==-1,R=E===k,C=x?0:O;T?(l=R?k+1:E,d=R?C:O+1):l=k+1;const b=r.age,A=b+r.ageHeader;let L=Math.min(A-r.partTarget,r.targetduration*1.5);if(L>0){if(i&&L>i.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${i.tuneInGoal} to: ${L} with playlist age: ${r.age}`),L=0;else{const I=Math.floor(L/r.targetduration);l+=I,d!==void 0&&(d+=Math.round(L%r.targetduration/r.partTarget)),this.log(`CDN Tune-in age: ${r.ageHeader}s last advanced ${b.toFixed(2)}s goal: ${L} skip sn ${I} to part ${d}`)}r.tuneInGoal=L}if(a=this.getDeliveryDirectives(r,e.deliveryDirectives,l,d),x||!R){this.loadPlaylist(a);return}}else r.canBlockReload&&(a=this.getDeliveryDirectives(r,e.deliveryDirectives,l,d));const c=this.hls.mainForwardBufferInfo,f=c?c.end-c.len:0,h=(r.edge-f)*1e3,p=nl(r,h);r.updated&&n>this.requestScheduled+p&&(this.requestScheduled=s.loading.start),l!==void 0&&r.canBlockReload?this.requestScheduled=s.loading.first+p-(r.partTarget*1e3||1e3):this.requestScheduled===-1||this.requestScheduled+p<n?this.requestScheduled=n:this.requestScheduled-n<=0&&(this.requestScheduled+=p);let g=this.requestScheduled-n;g=Math.max(0,g),this.log(`reload live playlist ${t} in ${Math.round(g)} ms`),this.timer=self.setTimeout(()=>this.loadPlaylist(a),g)}else this.clearTimer()}getDeliveryDirectives(t,e,i,r){let s=tl(t,i);return e!=null&&e.skip&&t.deltaUpdateFailed&&(i=e.msn,r=e.part,s=mi.No),new Rs(i,r,s)}checkRetry(t){const e=t.details,i=Bi(t),r=t.errorAction,{action:s,retryCount:n=0,retryConfig:o}=r||{},a=!!r&&!!o&&(s===ue.RetryRequest||!r.resolved&&s===ue.SendAlternateToPenaltyBox);if(a){var l;if(this.requestScheduled=-1,n>=o.maxNumRetry)return!1;if(i&&(l=t.context)!=null&&l.deliveryDirectives)this.warn(`Retrying playlist loading ${n+1}/${o.maxNumRetry} after "${e}" without delivery-directives`),this.loadPlaylist();else{const d=Ur(o,n);this.timer=self.setTimeout(()=>this.loadPlaylist(),d),this.warn(`Retrying playlist loading ${n+1}/${o.maxNumRetry} after "${e}" in ${d}ms`)}t.levelRetry=!0,r.resolved=!0}return a}}let dr;class pl extends jr{constructor(t,e){super(t,"[level-controller]"),this._levels=[],this._firstLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=e,this._registerListeners()}_registerListeners(){const{hls:t}=this;t.on(D.MANIFEST_LOADING,this.onManifestLoading,this),t.on(D.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(D.LEVEL_LOADED,this.onLevelLoaded,this),t.on(D.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(D.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.on(D.FRAG_LOADED,this.onFragLoaded,this),t.on(D.ERROR,this.onError,this)}_unregisterListeners(){const{hls:t}=this;t.off(D.MANIFEST_LOADING,this.onManifestLoading,this),t.off(D.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(D.LEVEL_LOADED,this.onLevelLoaded,this),t.off(D.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(D.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.off(D.FRAG_LOADED,this.onFragLoaded,this),t.off(D.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}startLoad(){this._levels.forEach(e=>{e.loadError=0,e.fragmentError=0}),super.startLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[]}onManifestLoading(t,e){this.resetLevels()}onManifestLoaded(t,e){const i=[],r={};let s;e.levels.forEach(n=>{var o;const a=n.attrs;((o=n.audioCodec)==null?void 0:o.indexOf("mp4a.40.34"))!==-1&&(dr||(dr=/chrome|firefox/i.test(navigator.userAgent)),dr&&(n.audioCodec=void 0));const{AUDIO:l,CODECS:d,"FRAME-RATE":c,"PATHWAY-ID":f,RESOLUTION:h,SUBTITLES:p}=a,x=`${`${f||"."}-`}${n.bitrate}-${h}-${c}-${d}`;s=r[x],s?s.addFallback(n):(s=new yi(n),r[x]=s,i.push(s)),ji(s,"audio",l),ji(s,"text",p)}),this.filterAndSortMediaOptions(i,e)}filterAndSortMediaOptions(t,e){let i=[],r=[],s=!1,n=!1,o=!1,a=t.filter(({audioCodec:h,videoCodec:p,width:g,height:x,unknownCodecs:E})=>(s||(s=!!(g&&x)),n||(n=!!p),o||(o=!!h),!(E!=null&&E.length)&&(!h||nr(h,"audio"))&&(!p||nr(p,"video"))));if((s||n)&&o&&(a=a.filter(({videoCodec:h,width:p,height:g})=>!!h||!!(p&&g))),a.length===0){Promise.resolve().then(()=>{if(this.hls){const h=new Error("no level with compatible codecs found in manifest");this.hls.trigger(D.ERROR,{type:bt.MEDIA_ERROR,details:tt.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:e.url,error:h,reason:h.message})}});return}e.audioTracks&&(i=e.audioTracks.filter(h=>!h.audioCodec||nr(h.audioCodec,"audio")),Ms(i)),e.subtitles&&(r=e.subtitles,Ms(r));const l=a.slice(0);a.sort((h,p)=>h.attrs["HDCP-LEVEL"]!==p.attrs["HDCP-LEVEL"]?(h.attrs["HDCP-LEVEL"]||"")>(p.attrs["HDCP-LEVEL"]||"")?1:-1:h.bitrate!==p.bitrate?h.bitrate-p.bitrate:h.attrs["FRAME-RATE"]!==p.attrs["FRAME-RATE"]?h.attrs.decimalFloatingPoint("FRAME-RATE")-p.attrs.decimalFloatingPoint("FRAME-RATE"):h.attrs.SCORE!==p.attrs.SCORE?h.attrs.decimalFloatingPoint("SCORE")-p.attrs.decimalFloatingPoint("SCORE"):s&&h.height!==p.height?h.height-p.height:0);let d=l[0];if(this.steering&&(a=this.steering.filterParsedLevels(a),a.length!==l.length)){for(let h=0;h<l.length;h++)if(l[h].pathwayId===a[0].pathwayId){d=l[h];break}}this._levels=a;for(let h=0;h<a.length;h++)if(a[h]===d){this._firstLevel=h,this.log(`manifest loaded, ${a.length} level(s) found, first bitrate: ${d.bitrate}`);break}const c=o&&!n,f={levels:a,audioTracks:i,subtitleTracks:r,sessionData:e.sessionData,sessionKeys:e.sessionKeys,firstLevel:this._firstLevel,stats:e.stats,audio:o,video:n,altAudio:!c&&i.some(h=>!!h.url)};this.hls.trigger(D.MANIFEST_PARSED,f),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}get levels(){return this._levels.length===0?null:this._levels}get level(){return this.currentLevelIndex}set level(t){const e=this._levels;if(e.length===0)return;if(t<0||t>=e.length){const d=new Error("invalid level idx"),c=t<0;if(this.hls.trigger(D.ERROR,{type:bt.OTHER_ERROR,details:tt.LEVEL_SWITCH_ERROR,level:t,fatal:c,error:d,reason:d.message}),c)return;t=Math.min(t,e.length-1)}const i=this.currentLevelIndex,r=this.currentLevel,s=r?r.attrs["PATHWAY-ID"]:void 0,n=e[t],o=n.attrs["PATHWAY-ID"];if(this.currentLevelIndex=t,this.currentLevel=n,i===t&&n.details&&r&&s===o)return;this.log(`Switching to level ${t}${o?" with Pathway "+o:""} from level ${i}${s?" with Pathway "+s:""}`);const a=Jt({},n,{level:t,maxBitrate:n.maxBitrate,attrs:n.attrs,uri:n.uri,urlId:n.urlId});delete a._attrs,delete a._urlId,this.hls.trigger(D.LEVEL_SWITCHING,a);const l=n.details;if(!l||l.live){const d=this.switchParams(n.uri,r==null?void 0:r.details);this.loadPlaylist(d)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(t){this.manualLevelIndex=t,this._startLevel===void 0&&(this._startLevel=t),t!==-1&&(this.level=t)}get firstLevel(){return this._firstLevel}set firstLevel(t){this._firstLevel=t}get startLevel(){if(this._startLevel===void 0){const t=this.hls.config.startLevel;return t!==void 0?t:this._firstLevel}else return this._startLevel}set startLevel(t){this._startLevel=t}onError(t,e){e.fatal||!e.context||e.context.type===Pt.LEVEL&&e.context.level===this.level&&this.checkRetry(e)}onFragLoaded(t,{frag:e}){if(e!==void 0&&e.type===Tt.MAIN){const i=this._levels[e.level];i!==void 0&&(i.loadError=0)}}onLevelLoaded(t,e){var i;const{level:r,details:s}=e,n=this._levels[r];if(!n){var o;this.warn(`Invalid level index ${r}`),(o=e.deliveryDirectives)!=null&&o.skip&&(s.deltaUpdateFailed=!0);return}r===this.currentLevelIndex?(n.fragmentError===0&&(n.loadError=0),this.playlistLoaded(r,e,n.details)):(i=e.deliveryDirectives)!=null&&i.skip&&(s.deltaUpdateFailed=!0)}onAudioTrackSwitched(t,e){const i=this.currentLevel;if(!i)return;const r=this.hls.audioTracks[e.id].groupId;if(i.audioGroupIds&&i.audioGroupId!==r){let s=-1;for(let n=0;n<i.audioGroupIds.length;n++)if(i.audioGroupIds[n]===r){s=n;break}s!==-1&&s!==i.urlId&&(i.urlId=s,this.canLoad&&this.startLoad())}}loadPlaylist(t){super.loadPlaylist();const e=this.currentLevelIndex,i=this.currentLevel;if(i&&this.shouldLoadPlaylist(i)){const r=i.urlId;let s=i.uri;if(t)try{s=t.addDirectives(s)}catch(o){this.warn(`Could not construct new URL with HLS Delivery Directives: ${o}`)}const n=i.attrs["PATHWAY-ID"];this.log(`Loading level index ${e}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""} with${n?" Pathway "+n:""} URI ${r+1}/${i.url.length} ${s}`),this.clearTimer(),this.hls.trigger(D.LEVEL_LOADING,{url:s,level:e,id:r,deliveryDirectives:t||null})}}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(t){this.level=t,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=t)}removeLevel(t,e){const i=(s,n)=>n!==e,r=this._levels.filter((s,n)=>n!==t?!0:s.url.length>1&&e!==void 0?(s.url=s.url.filter(i),s.audioGroupIds&&(s.audioGroupIds=s.audioGroupIds.filter(i)),s.textGroupIds&&(s.textGroupIds=s.textGroupIds.filter(i)),s.urlId=0,!0):(this.steering&&this.steering.removeLevel(s),!1));this.hls.trigger(D.LEVELS_UPDATED,{levels:r})}onLevelsUpdated(t,{levels:e}){e.forEach((i,r)=>{const{details:s}=i;s!=null&&s.fragments&&s.fragments.forEach(n=>{n.level=r})}),this._levels=e}}function ji(u,t,e){!e||(t==="audio"?(u.audioGroupIds||(u.audioGroupIds=[]),u.audioGroupIds[u.url.length-1]=e):t==="text"&&(u.textGroupIds||(u.textGroupIds=[]),u.textGroupIds[u.url.length-1]=e))}function Ms(u){const t={};u.forEach(e=>{const i=e.groupId||"";e.id=t[i]=t[i]||0,t[i]++})}var re={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class ml{constructor(t){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=t,this._registerListeners()}_registerListeners(){const{hls:t}=this;t.on(D.BUFFER_APPENDED,this.onBufferAppended,this),t.on(D.FRAG_BUFFERED,this.onFragBuffered,this),t.on(D.FRAG_LOADED,this.onFragLoaded,this)}_unregisterListeners(){const{hls:t}=this;t.off(D.BUFFER_APPENDED,this.onBufferAppended,this),t.off(D.FRAG_BUFFERED,this.onFragBuffered,this),t.off(D.FRAG_LOADED,this.onFragLoaded,this)}destroy(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(t,e){const i=this.activePartLists[e];if(i)for(let r=i.length;r--;){const s=i[r];if(!s)break;const n=s.end;if(s.start<=t&&n!==null&&t<=n)return s}return this.getBufferedFrag(t,e)}getBufferedFrag(t,e){const{fragments:i}=this,r=Object.keys(i);for(let s=r.length;s--;){const n=i[r[s]];if((n==null?void 0:n.body.type)===e&&n.buffered){const o=n.body;if(o.start<=t&&t<=o.end)return o}}return null}detectEvictedFragments(t,e,i,r){this.timeRanges&&(this.timeRanges[t]=e);const s=(r==null?void 0:r.fragment.sn)||-1;Object.keys(this.fragments).forEach(n=>{const o=this.fragments[n];if(!o||s>=o.body.sn)return;if(!o.buffered&&!o.loaded){o.body.type===i&&this.removeFragment(o.body);return}const a=o.range[t];!a||a.time.some(l=>{const d=!this.isTimeBuffered(l.startPTS,l.endPTS,e);return d&&this.removeFragment(o.body),d})})}detectPartialFragments(t){const e=this.timeRanges,{frag:i,part:r}=t;if(!e||i.sn==="initSegment")return;const s=ii(i),n=this.fragments[s];if(!n)return;const o=!i.relurl;Object.keys(e).forEach(a=>{const l=i.elementaryStreams[a];if(!l)return;const d=e[a],c=o||l.partial===!0;n.range[a]=this.getBufferedTimes(i,r,c,d)}),n.loaded=null,Object.keys(n.range).length?(n.buffered=!0,n.body.endList&&(this.endListFragments[n.body.type]=n),Ai(n)||this.removeParts(i.sn-1,i.type)):this.removeFragment(n.body)}removeParts(t,e){const i=this.activePartLists[e];!i||(this.activePartLists[e]=i.filter(r=>r.fragment.sn>=t))}fragBuffered(t,e){const i=ii(t);let r=this.fragments[i];!r&&e&&(r=this.fragments[i]={body:t,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},t.gap&&(this.hasGaps=!0)),r&&(r.loaded=null,r.buffered=!0)}getBufferedTimes(t,e,i,r){const s={time:[],partial:i},n=t.start,o=t.end,a=t.minEndPTS||o,l=t.maxStartPTS||n;for(let d=0;d<r.length;d++){const c=r.start(d)-this.bufferPadding,f=r.end(d)+this.bufferPadding;if(l>=c&&a<=f){s.time.push({startPTS:Math.max(n,r.start(d)),endPTS:Math.min(o,r.end(d))});break}else if(n<f&&o>c)s.partial=!0,s.time.push({startPTS:Math.max(n,r.start(d)),endPTS:Math.min(o,r.end(d))});else if(o<=c)break}return s}getPartialFragment(t){let e=null,i,r,s,n=0;const{bufferPadding:o,fragments:a}=this;return Object.keys(a).forEach(l=>{const d=a[l];!d||Ai(d)&&(r=d.body.start-o,s=d.body.end+o,t>=r&&t<=s&&(i=Math.min(t-r,s-t),n<=i&&(e=d.body,n=i)))}),e}isEndListAppended(t){const e=this.endListFragments[t];return e!==void 0&&(e.buffered||Ai(e))}getState(t){const e=ii(t),i=this.fragments[e];return i?i.buffered?Ai(i)?re.PARTIAL:re.OK:re.APPENDING:re.NOT_LOADED}isTimeBuffered(t,e,i){let r,s;for(let n=0;n<i.length;n++){if(r=i.start(n)-this.bufferPadding,s=i.end(n)+this.bufferPadding,t>=r&&e<=s)return!0;if(e<=r)return!1}return!1}onFragLoaded(t,e){const{frag:i,part:r}=e;if(i.sn==="initSegment"||i.bitrateTest)return;const s=r?null:e,n=ii(i);this.fragments[n]={body:i,appendedPTS:null,loaded:s,buffered:!1,range:Object.create(null)}}onBufferAppended(t,e){const{frag:i,part:r,timeRanges:s}=e;if(i.sn==="initSegment")return;const n=i.type;if(r){let o=this.activePartLists[n];o||(this.activePartLists[n]=o=[]),o.push(r)}this.timeRanges=s,Object.keys(s).forEach(o=>{const a=s[o];this.detectEvictedFragments(o,a,n,r)})}onFragBuffered(t,e){this.detectPartialFragments(e)}hasFragment(t){const e=ii(t);return!!this.fragments[e]}hasParts(t){var e;return!!((e=this.activePartLists[t])!=null&&e.length)}removeFragmentsInRange(t,e,i,r,s){r&&!this.hasGaps||Object.keys(this.fragments).forEach(n=>{const o=this.fragments[n];if(!o)return;const a=o.body;a.type!==i||r&&!a.gap||a.start<e&&a.end>t&&(o.buffered||s)&&this.removeFragment(a)})}removeFragment(t){const e=ii(t);t.stats.loaded=0,t.clearElementaryStreamInfo();const i=this.activePartLists[t.type];if(i){const r=t.sn;this.activePartLists[t.type]=i.filter(s=>s.fragment.sn!==r)}delete this.fragments[e],t.endList&&delete this.endListFragments[t.type]}removeAllFragments(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1}}function Ai(u){var t,e,i;return u.buffered&&(u.body.gap||((t=u.range.video)==null?void 0:t.partial)||((e=u.range.audio)==null?void 0:e.partial)||((i=u.range.audiovideo)==null?void 0:i.partial))}function ii(u){return`${u.type}_${u.level}_${u.urlId}_${u.sn}`}const Ps=Math.pow(2,17);class gl{constructor(t){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=t}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(t,e){const i=t.url;if(!i)return Promise.reject(new Ne({type:bt.NETWORK_ERROR,details:tt.FRAG_LOAD_ERROR,fatal:!1,frag:t,error:new Error(`Fragment does not have a ${i?"part list":"url"}`),networkDetails:null}));this.abort();const r=this.config,s=r.fLoader,n=r.loader;return new Promise((o,a)=>{if(this.loader&&this.loader.destroy(),t.gap){a(Ns(t));return}const l=this.loader=t.loader=s?new s(r):new n(r),d=Os(t),c=Cs(r.fragLoadPolicy.default),f={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:t.sn==="initSegment"?1/0:Ps};t.stats=l.stats,l.load(d,f,{onSuccess:(h,p,g,x)=>{this.resetLoader(t,l);let E=h.data;g.resetIV&&t.decryptdata&&(t.decryptdata.iv=new Uint8Array(E.slice(0,16)),E=E.slice(16)),o({frag:t,part:null,payload:E,networkDetails:x})},onError:(h,p,g,x)=>{this.resetLoader(t,l),a(new Ne({type:bt.NETWORK_ERROR,details:tt.FRAG_LOAD_ERROR,fatal:!1,frag:t,response:fe({url:i,data:void 0},h),error:new Error(`HTTP Error ${h.code} ${h.text}`),networkDetails:g,stats:x}))},onAbort:(h,p,g)=>{this.resetLoader(t,l),a(new Ne({type:bt.NETWORK_ERROR,details:tt.INTERNAL_ABORTED,fatal:!1,frag:t,error:new Error("Aborted"),networkDetails:g,stats:h}))},onTimeout:(h,p,g)=>{this.resetLoader(t,l),a(new Ne({type:bt.NETWORK_ERROR,details:tt.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t,error:new Error(`Timeout after ${f.timeout}ms`),networkDetails:g,stats:h}))},onProgress:(h,p,g,x)=>{e&&e({frag:t,part:null,payload:g,networkDetails:x})}})})}loadPart(t,e,i){this.abort();const r=this.config,s=r.fLoader,n=r.loader;return new Promise((o,a)=>{if(this.loader&&this.loader.destroy(),t.gap||e.gap){a(Ns(t,e));return}const l=this.loader=t.loader=s?new s(r):new n(r),d=Os(t,e),c=Cs(r.fragLoadPolicy.default),f={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:Ps};e.stats=l.stats,l.load(d,f,{onSuccess:(h,p,g,x)=>{this.resetLoader(t,l),this.updateStatsFromPart(t,e);const E={frag:t,part:e,payload:h.data,networkDetails:x};i(E),o(E)},onError:(h,p,g,x)=>{this.resetLoader(t,l),a(new Ne({type:bt.NETWORK_ERROR,details:tt.FRAG_LOAD_ERROR,fatal:!1,frag:t,part:e,response:fe({url:d.url,data:void 0},h),error:new Error(`HTTP Error ${h.code} ${h.text}`),networkDetails:g,stats:x}))},onAbort:(h,p,g)=>{t.stats.aborted=e.stats.aborted,this.resetLoader(t,l),a(new Ne({type:bt.NETWORK_ERROR,details:tt.INTERNAL_ABORTED,fatal:!1,frag:t,part:e,error:new Error("Aborted"),networkDetails:g,stats:h}))},onTimeout:(h,p,g)=>{this.resetLoader(t,l),a(new Ne({type:bt.NETWORK_ERROR,details:tt.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t,part:e,error:new Error(`Timeout after ${f.timeout}ms`),networkDetails:g,stats:h}))}})})}updateStatsFromPart(t,e){const i=t.stats,r=e.stats,s=r.total;if(i.loaded+=r.loaded,s){const a=Math.round(t.duration/e.duration),l=Math.min(Math.round(i.loaded/s),a),c=(a-l)*Math.round(i.loaded/l);i.total=i.loaded+c}else i.total=Math.max(i.loaded,i.total);const n=i.loading,o=r.loading;n.start?n.first+=o.first-o.start:(n.start=o.start,n.first=o.first),n.end=o.end}resetLoader(t,e){t.loader=null,this.loader===e&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),e.destroy()}}function Os(u,t=null){const e=t||u,i={frag:u,part:t,responseType:"arraybuffer",url:e.url,headers:{},rangeStart:0,rangeEnd:0},r=e.byteRangeStartOffset,s=e.byteRangeEndOffset;if(_t(r)&&_t(s)){var n;let o=r,a=s;if(u.sn==="initSegment"&&((n=u.decryptdata)==null?void 0:n.method)==="AES-128"){const l=s-r;l%16&&(a=s+(16-l%16)),r!==0&&(i.resetIV=!0,o=r-16)}i.rangeStart=o,i.rangeEnd=a}return i}function Ns(u,t){const e=new Error(`GAP ${u.gap?"tag":"attribute"} found`),i={type:bt.MEDIA_ERROR,details:tt.FRAG_GAP,fatal:!1,frag:u,error:e,networkDetails:null};return t&&(i.part=t),(t||u).stats.aborted=!0,new Ne(i)}class Ne extends Error{constructor(t){super(t.error.message),this.data=void 0,this.data=t}}class yl{constructor(t){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=t}abort(t){for(const e in this.keyUriToKeyInfo){const i=this.keyUriToKeyInfo[e].loader;if(i){if(t&&t!==i.context.frag.type)return;i.abort()}}}detach(){for(const t in this.keyUriToKeyInfo){const e=this.keyUriToKeyInfo[t];(e.mediaKeySessionContext||e.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[t]}}destroy(){this.detach();for(const t in this.keyUriToKeyInfo){const e=this.keyUriToKeyInfo[t].loader;e&&e.destroy()}this.keyUriToKeyInfo={}}createKeyLoadError(t,e=tt.KEY_LOAD_ERROR,i,r,s){return new Ne({type:bt.NETWORK_ERROR,details:e,fatal:!1,frag:t,response:s,error:i,networkDetails:r})}loadClear(t,e){if(this.emeController&&this.config.emeEnabled){const{sn:i,cc:r}=t;for(let s=0;s<e.length;s++){const n=e[s];if(r<=n.cc&&(i==="initSegment"||n.sn==="initSegment"||i<n.sn)){this.emeController.selectKeySystemFormat(n).then(o=>{n.setKeyFormat(o)});break}}}}load(t){return!t.decryptdata&&t.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(t).then(e=>this.loadInternal(t,e)):this.loadInternal(t)}loadInternal(t,e){var i,r;e&&t.setKeyFormat(e);const s=t.decryptdata;if(!s){const l=new Error(e?`Expected frag.decryptdata to be defined after setting format ${e}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(t,tt.KEY_LOAD_ERROR,l))}const n=s.uri;if(!n)return Promise.reject(this.createKeyLoadError(t,tt.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${n}"`)));let o=this.keyUriToKeyInfo[n];if((i=o)!=null&&i.decryptdata.key)return s.key=o.decryptdata.key,Promise.resolve({frag:t,keyInfo:o});if((r=o)!=null&&r.keyLoadPromise){var a;switch((a=o.mediaKeySessionContext)==null?void 0:a.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return o.keyLoadPromise.then(l=>(s.key=l.keyInfo.decryptdata.key,{frag:t,keyInfo:o}))}}switch(o=this.keyUriToKeyInfo[n]={decryptdata:s,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},s.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return s.keyFormat==="identity"?this.loadKeyHTTP(o,t):this.loadKeyEME(o,t);case"AES-128":return this.loadKeyHTTP(o,t);default:return Promise.reject(this.createKeyLoadError(t,tt.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${s.method}"`)))}}loadKeyEME(t,e){const i={frag:e,keyInfo:t};if(this.emeController&&this.config.emeEnabled){const r=this.emeController.loadKey(i);if(r)return(t.keyLoadPromise=r.then(s=>(t.mediaKeySessionContext=s,i))).catch(s=>{throw t.keyLoadPromise=null,s})}return Promise.resolve(i)}loadKeyHTTP(t,e){const i=this.config,r=i.loader,s=new r(i);return e.keyLoader=t.loader=s,t.keyLoadPromise=new Promise((n,o)=>{const a={keyInfo:t,frag:e,responseType:"arraybuffer",url:t.decryptdata.uri},l=i.keyLoadPolicy.default,d={loadPolicy:l,timeout:l.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},c={onSuccess:(f,h,p,g)=>{const{frag:x,keyInfo:E,url:k}=p;if(!x.decryptdata||E!==this.keyUriToKeyInfo[k])return o(this.createKeyLoadError(x,tt.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),g));E.decryptdata.key=x.decryptdata.key=new Uint8Array(f.data),x.keyLoader=null,E.loader=null,n({frag:x,keyInfo:E})},onError:(f,h,p,g)=>{this.resetLoader(h),o(this.createKeyLoadError(e,tt.KEY_LOAD_ERROR,new Error(`HTTP Error ${f.code} loading key ${f.text}`),p,fe({url:a.url,data:void 0},f)))},onTimeout:(f,h,p)=>{this.resetLoader(h),o(this.createKeyLoadError(e,tt.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),p))},onAbort:(f,h,p)=>{this.resetLoader(h),o(this.createKeyLoadError(e,tt.INTERNAL_ABORTED,new Error("key loading aborted"),p))}};s.load(a,d,c)})}resetLoader(t){const{frag:e,keyInfo:i,url:r}=t,s=i.loader;e.keyLoader===s&&(e.keyLoader=null,i.loader=null),delete this.keyUriToKeyInfo[r],s&&s.destroy()}}class vl{constructor(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(t){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,t),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}const _l={length:0,start:()=>0,end:()=>0};class $t{static isBuffered(t,e){try{if(t){const i=$t.getBuffered(t);for(let r=0;r<i.length;r++)if(e>=i.start(r)&&e<=i.end(r))return!0}}catch(i){}return!1}static bufferInfo(t,e,i){try{if(t){const r=$t.getBuffered(t),s=[];let n;for(n=0;n<r.length;n++)s.push({start:r.start(n),end:r.end(n)});return this.bufferedInfo(s,e,i)}}catch(r){}return{len:0,start:e,end:e,nextStart:void 0}}static bufferedInfo(t,e,i){e=Math.max(0,e),t.sort(function(l,d){const c=l.start-d.start;return c||d.end-l.end});let r=[];if(i)for(let l=0;l<t.length;l++){const d=r.length;if(d){const c=r[d-1].end;t[l].start-c<i?t[l].end>c&&(r[d-1].end=t[l].end):r.push(t[l])}else r.push(t[l])}else r=t;let s=0,n,o=e,a=e;for(let l=0;l<r.length;l++){const d=r[l].start,c=r[l].end;if(e+i>=d&&e<c)o=d,a=c,s=a-e;else if(e+i<d){n=d;break}}return{len:s,start:o||0,end:a||0,nextStart:n}}static getBuffered(t){try{return t.buffered}catch(e){return H.log("failed to get media.buffered",e),_l}}}class $r{constructor(t,e,i,r=0,s=-1,n=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=Li(),this.buffering={audio:Li(),video:Li(),audiovideo:Li()},this.level=t,this.sn=e,this.id=i,this.size=r,this.part=s,this.partial=n}}function Li(){return{start:0,executeStart:0,executeEnd:0,end:0}}function kn(u,t){let e=null;for(let i=0,r=u.length;i<r;i++){const s=u[i];if(s&&s.cc===t){e=s;break}}return e}function xl(u,t,e){return!!(t.details&&(e.endCC>e.startCC||u&&u.cc<e.startCC))}function El(u,t,e=0){const i=u.fragments,r=t.fragments;if(!r.length||!i.length){H.log("No fragments to align");return}const s=kn(i,r[0].cc);if(!s||s&&!s.startPTS){H.log("No frag in previous level to align on");return}return s}function Fs(u,t){if(u){const e=u.start+t;u.start=u.startPTS=e,u.endPTS=e+u.duration}}function Gr(u,t){const e=t.fragments;for(let i=0,r=e.length;i<r;i++)Fs(e[i],u);t.fragmentHint&&Fs(t.fragmentHint,u),t.alignedSliding=!0}function bl(u,t,e){!t||(Tl(u,e,t),!e.alignedSliding&&t.details&&Sl(e,t.details),!e.alignedSliding&&t.details&&!e.skippedSegments&&wn(t.details,e))}function Tl(u,t,e){if(xl(u,e,t)){const i=El(e.details,t);i&&_t(i.start)&&(H.log(`Adjusting PTS using last level due to CC increase within current level ${t.url}`),Gr(i.start,t))}}function Sl(u,t){if(!t.fragments.length||!u.hasProgramDateTime||!t.hasProgramDateTime)return;const e=t.fragments[0].programDateTime,i=u.fragments[0].programDateTime,r=(i-e)/1e3+t.fragments[0].start;r&&_t(r)&&(H.log(`Adjusting PTS using programDateTime delta ${i-e}ms, sliding:${r.toFixed(3)} ${u.url} `),Gr(r,u))}function Cn(u,t){if(!u.hasProgramDateTime||!t.hasProgramDateTime)return;const e=u.fragments,i=t.fragments;if(!e.length||!i.length)return;const r=Math.round(i.length/2)-1,s=i[r],n=kn(e,s.cc)||e[Math.round(e.length/2)-1],o=s.programDateTime,a=n.programDateTime;if(o===null||a===null)return;const l=(a-o)/1e3-(n.start-s.start);Gr(l,u)}class Al{constructor(t,e){this.subtle=void 0,this.aesIV=void 0,this.subtle=t,this.aesIV=e}decrypt(t,e){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},e,t)}}class Ll{constructor(t,e){this.subtle=void 0,this.key=void 0,this.subtle=t,this.key=e}expandKey(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])}}function Il(u){const t=u.byteLength,e=t&&new DataView(u.buffer).getUint8(t-1);return e?Qe(u,0,t-e):u}class wl{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(t){const e=new DataView(t),i=new Uint32Array(4);for(let r=0;r<4;r++)i[r]=e.getUint32(r*4);return i}initTable(){const t=this.sBox,e=this.invSBox,i=this.subMix,r=i[0],s=i[1],n=i[2],o=i[3],a=this.invSubMix,l=a[0],d=a[1],c=a[2],f=a[3],h=new Uint32Array(256);let p=0,g=0,x=0;for(x=0;x<256;x++)x<128?h[x]=x<<1:h[x]=x<<1^283;for(x=0;x<256;x++){let E=g^g<<1^g<<2^g<<3^g<<4;E=E>>>8^E&255^99,t[p]=E,e[E]=p;const k=h[p],O=h[k],T=h[O];let R=h[E]*257^E*16843008;r[p]=R<<24|R>>>8,s[p]=R<<16|R>>>16,n[p]=R<<8|R>>>24,o[p]=R,R=T*16843009^O*65537^k*257^p*16843008,l[E]=R<<24|R>>>8,d[E]=R<<16|R>>>16,c[E]=R<<8|R>>>24,f[E]=R,p?(p=k^h[h[h[T^k]]],g^=h[h[g]]):p=g=1}}expandKey(t){const e=this.uint8ArrayToUint32Array_(t);let i=!0,r=0;for(;r<e.length&&i;)i=e[r]===this.key[r],r++;if(i)return;this.key=e;const s=this.keySize=e.length;if(s!==4&&s!==6&&s!==8)throw new Error("Invalid aes key size="+s);const n=this.ksRows=(s+6+1)*4;let o,a;const l=this.keySchedule=new Uint32Array(n),d=this.invKeySchedule=new Uint32Array(n),c=this.sBox,f=this.rcon,h=this.invSubMix,p=h[0],g=h[1],x=h[2],E=h[3];let k,O;for(o=0;o<n;o++){if(o<s){k=l[o]=e[o];continue}O=k,o%s===0?(O=O<<8|O>>>24,O=c[O>>>24]<<24|c[O>>>16&255]<<16|c[O>>>8&255]<<8|c[O&255],O^=f[o/s|0]<<24):s>6&&o%s===4&&(O=c[O>>>24]<<24|c[O>>>16&255]<<16|c[O>>>8&255]<<8|c[O&255]),l[o]=k=(l[o-s]^O)>>>0}for(a=0;a<n;a++)o=n-a,a&3?O=l[o]:O=l[o-4],a<4||o<=4?d[a]=O:d[a]=p[c[O>>>24]]^g[c[O>>>16&255]]^x[c[O>>>8&255]]^E[c[O&255]],d[a]=d[a]>>>0}networkToHostOrderSwap(t){return t<<24|(t&65280)<<8|(t&16711680)>>8|t>>>24}decrypt(t,e,i){const r=this.keySize+6,s=this.invKeySchedule,n=this.invSBox,o=this.invSubMix,a=o[0],l=o[1],d=o[2],c=o[3],f=this.uint8ArrayToUint32Array_(i);let h=f[0],p=f[1],g=f[2],x=f[3];const E=new Int32Array(t),k=new Int32Array(E.length);let O,T,R,C,b,A,L,I,j,F,$,V,Q,z;const B=this.networkToHostOrderSwap;for(;e<E.length;){for(j=B(E[e]),F=B(E[e+1]),$=B(E[e+2]),V=B(E[e+3]),b=j^s[0],A=V^s[1],L=$^s[2],I=F^s[3],Q=4,z=1;z<r;z++)O=a[b>>>24]^l[A>>16&255]^d[L>>8&255]^c[I&255]^s[Q],T=a[A>>>24]^l[L>>16&255]^d[I>>8&255]^c[b&255]^s[Q+1],R=a[L>>>24]^l[I>>16&255]^d[b>>8&255]^c[A&255]^s[Q+2],C=a[I>>>24]^l[b>>16&255]^d[A>>8&255]^c[L&255]^s[Q+3],b=O,A=T,L=R,I=C,Q=Q+4;O=n[b>>>24]<<24^n[A>>16&255]<<16^n[L>>8&255]<<8^n[I&255]^s[Q],T=n[A>>>24]<<24^n[L>>16&255]<<16^n[I>>8&255]<<8^n[b&255]^s[Q+1],R=n[L>>>24]<<24^n[I>>16&255]<<16^n[b>>8&255]<<8^n[A&255]^s[Q+2],C=n[I>>>24]<<24^n[b>>16&255]<<16^n[A>>8&255]<<8^n[L&255]^s[Q+3],k[e]=B(O^h),k[e+1]=B(C^p),k[e+2]=B(R^g),k[e+3]=B(T^x),h=j,p=F,g=$,x=V,e=e+4}return k.buffer}}const Rl=16;class Vr{constructor(t,{removePKCS7Padding:e=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=t.enableSoftwareAES,this.removePKCS7Padding=e,e)try{const i=self.crypto;i&&(this.subtle=i.subtle||i.webkitSubtle)}catch(i){}this.subtle===null&&(this.useSoftware=!0)}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:t,remainderData:e}=this;if(!t||e)return this.reset(),null;const i=new Uint8Array(t);return this.reset(),this.removePKCS7Padding?Il(i):i}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(t,e,i){return this.useSoftware?new Promise((r,s)=>{this.softwareDecrypt(new Uint8Array(t),e,i);const n=this.flush();n?r(n.buffer):s(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(t),e,i)}softwareDecrypt(t,e,i){const{currentIV:r,currentResult:s,remainderData:n}=this;this.logOnce("JS AES decrypt"),n&&(t=Je(n,t),this.remainderData=null);const o=this.getValidChunk(t);if(!o.length)return null;r&&(i=r);let a=this.softwareDecrypter;a||(a=this.softwareDecrypter=new wl),a.expandKey(e);const l=s;return this.currentResult=a.decrypt(o.buffer,0,i),this.currentIV=Qe(o,-16).buffer,l||null}webCryptoDecrypt(t,e,i){const r=this.subtle;return(this.key!==e||!this.fastAesKey)&&(this.key=e,this.fastAesKey=new Ll(r,e)),this.fastAesKey.expandKey().then(s=>r?(this.logOnce("WebCrypto AES decrypt"),new Al(r,new Uint8Array(i)).decrypt(t.buffer,s)):Promise.reject(new Error("web crypto not initialized"))).catch(s=>(H.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${s.name}: ${s.message}`),this.onWebCryptoError(t,e,i)))}onWebCryptoError(t,e,i){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(t,e,i);const r=this.flush();if(r)return r.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")}getValidChunk(t){let e=t;const i=t.length-t.length%Rl;return i!==t.length&&(e=Qe(t,0,i),this.remainderData=Qe(t,i)),e}logOnce(t){!this.logEnabled||(H.log(`[decrypter]: ${t}`),this.logEnabled=!1)}}const Dl={toString:function(u){let t="";const e=u.length;for(let i=0;i<e;i++)t+=`[${u.start(i).toFixed(3)}-${u.end(i).toFixed(3)}]`;return t}},nt={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class zr extends vl{constructor(t,e,i,r,s){super(),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=nt.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.loadedmetadata=!1,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.onvseeking=null,this.onvended=null,this.logPrefix="",this.log=void 0,this.warn=void 0,this.playlistType=s,this.logPrefix=r,this.log=H.log.bind(H,`${r}:`),this.warn=H.warn.bind(H,`${r}:`),this.hls=t,this.fragmentLoader=new gl(t.config),this.keyLoader=i,this.fragmentTracker=e,this.config=t.config,this.decrypter=new Vr(t.config),t.on(D.MANIFEST_LOADED,this.onManifestLoaded,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(t){}stopLoad(){this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const t=this.fragCurrent;t!=null&&t.loader&&(t.abortRequests(),this.fragmentTracker.removeFragment(t)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=nt.STOPPED}_streamEnded(t,e){if(e.live||t.nextStart||!t.end||!this.media)return!1;const i=e.partList;if(i!=null&&i.length){const s=i[i.length-1];return $t.isBuffered(this.media,s.start+s.duration/2)}const r=e.fragments[e.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(r)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null){var t;return(t=this.levels[this.levelLastLoaded])==null?void 0:t.details}}onMediaAttached(t,e){const i=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),i.addEventListener("seeking",this.onvseeking),i.addEventListener("ended",this.onvended);const r=this.config;this.levels&&r.autoStartLoad&&this.state===nt.STOPPED&&this.startLoad(r.startPosition)}onMediaDetaching(){const t=this.media;t!=null&&t.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),t&&this.onvseeking&&this.onvended&&(t.removeEventListener("seeking",this.onvseeking),t.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}onMediaSeeking(){const{config:t,fragCurrent:e,media:i,mediaBuffer:r,state:s}=this,n=i?i.currentTime:0,o=$t.bufferInfo(r||i,n,t.maxBufferHole);if(this.log(`media seeking to ${_t(n)?n.toFixed(3):n}, state: ${s}`),this.state===nt.ENDED)this.resetLoadingState();else if(e){const a=t.maxFragLookUpTolerance,l=e.start-a,d=e.start+e.duration+a;if(!o.len||d<o.start||l>o.end){const c=n>d;(n<l||c)&&(c&&e.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),e.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}i&&(this.fragmentTracker.removeFragmentsInRange(n,1/0,this.playlistType,!0),this.lastCurrentTime=n),!this.loadedmetadata&&!o.len&&(this.nextLoadPosition=this.startPosition=n),this.tickImmediate()}onMediaEnded(){this.startPosition=this.lastCurrentTime=0}onManifestLoaded(t,e){this.startTimeOffset=e.startTimeOffset,this.initPTS=[]}onHandlerDestroying(){this.stopLoad(),super.onHandlerDestroying()}onHandlerDestroyed(){this.state=nt.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(t,e,i){this._loadFragForPlayback(t,e,i)}_loadFragForPlayback(t,e,i){const r=s=>{if(this.fragContextChanged(t)){this.warn(`Fragment ${t.sn}${s.part?" p: "+s.part.index:""} of level ${t.level} was dropped during download.`),this.fragmentTracker.removeFragment(t);return}t.stats.chunkCount++,this._handleFragmentLoadProgress(s)};this._doFragLoad(t,e,i,r).then(s=>{if(!s)return;const n=this.state;if(this.fragContextChanged(t)){(n===nt.FRAG_LOADING||!this.fragCurrent&&n===nt.PARSING)&&(this.fragmentTracker.removeFragment(t),this.state=nt.IDLE);return}"payload"in s&&(this.log(`Loaded fragment ${t.sn} of level ${t.level}`),this.hls.trigger(D.FRAG_LOADED,s)),this._handleFragmentLoadComplete(s)}).catch(s=>{this.state===nt.STOPPED||this.state===nt.ERROR||(this.warn(s),this.resetFragmentLoading(t))})}clearTrackerIfNeeded(t){var e;const{fragmentTracker:i}=this;if(i.getState(t)===re.APPENDING){const s=t.type,n=this.getFwdBufferInfo(this.mediaBuffer,s),o=Math.max(t.duration,n?n.len:this.config.maxBufferLength);this.reduceMaxBufferLength(o)&&i.removeFragment(t)}else((e=this.mediaBuffer)==null?void 0:e.buffered.length)===0?i.removeAllFragments():i.hasParts(t.type)&&(i.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type}),i.getState(t)===re.PARTIAL&&i.removeFragment(t))}flushMainBuffer(t,e,i=null){if(!(t-e))return;const r={startOffset:t,endOffset:e,type:i};this.hls.trigger(D.BUFFER_FLUSHING,r)}_loadInitSegment(t,e){this._doFragLoad(t,e).then(i=>{if(!i||this.fragContextChanged(t)||!this.levels)throw new Error("init load aborted");return i}).then(i=>{const{hls:r}=this,{payload:s}=i,n=t.decryptdata;if(s&&s.byteLength>0&&n&&n.key&&n.iv&&n.method==="AES-128"){const o=self.performance.now();return this.decrypter.decrypt(new Uint8Array(s),n.key.buffer,n.iv.buffer).catch(a=>{throw r.trigger(D.ERROR,{type:bt.MEDIA_ERROR,details:tt.FRAG_DECRYPT_ERROR,fatal:!1,error:a,reason:a.message,frag:t}),a}).then(a=>{const l=self.performance.now();return r.trigger(D.FRAG_DECRYPTED,{frag:t,payload:a,stats:{tstart:o,tdecrypt:l}}),i.payload=a,i})}return i}).then(i=>{const{fragCurrent:r,hls:s,levels:n}=this;if(!n)throw new Error("init load aborted, missing levels");const o=t.stats;this.state=nt.IDLE,e.fragmentError=0,t.data=new Uint8Array(i.payload),o.parsing.start=o.buffering.start=self.performance.now(),o.parsing.end=o.buffering.end=self.performance.now(),i.frag===r&&s.trigger(D.FRAG_BUFFERED,{stats:o,frag:r,part:null,id:t.type}),this.tick()}).catch(i=>{this.state===nt.STOPPED||this.state===nt.ERROR||(this.warn(i),this.resetFragmentLoading(t))})}fragContextChanged(t){const{fragCurrent:e}=this;return!t||!e||t.level!==e.level||t.sn!==e.sn||t.urlId!==e.urlId}fragBufferedComplete(t,e){var i,r,s,n;const o=this.mediaBuffer?this.mediaBuffer:this.media;this.log(`Buffered ${t.type} sn: ${t.sn}${e?" part: "+e.index:""} of ${this.playlistType===Tt.MAIN?"level":"track"} ${t.level} (frag:[${((i=t.startPTS)!=null?i:NaN).toFixed(3)}-${((r=t.endPTS)!=null?r:NaN).toFixed(3)}] > buffer:${o?Dl.toString($t.getBuffered(o)):"(detached)"})`),this.state=nt.IDLE,o&&(!this.loadedmetadata&&t.type==Tt.MAIN&&o.buffered.length&&((s=this.fragCurrent)==null?void 0:s.sn)===((n=this.fragPrevious)==null?void 0:n.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())}seekToStartPos(){}_handleFragmentLoadComplete(t){const{transmuxer:e}=this;if(!e)return;const{frag:i,part:r,partsLoaded:s}=t,n=!s||s.length===0||s.some(a=>!a),o=new $r(i.level,i.sn,i.stats.chunkCount+1,0,r?r.index:-1,!n);e.flush(o)}_handleFragmentLoadProgress(t){}_doFragLoad(t,e,i=null,r){var s;const n=e==null?void 0:e.details;if(!this.levels||!n)throw new Error(`frag load aborted, missing level${n?"":" detail"}s`);let o=null;if(t.encrypted&&!((s=t.decryptdata)!=null&&s.key)?(this.log(`Loading key for ${t.sn} of [${n.startSN}-${n.endSN}], ${this.logPrefix==="[stream-controller]"?"level":"track"} ${t.level}`),this.state=nt.KEY_LOADING,this.fragCurrent=t,o=this.keyLoader.load(t).then(d=>{if(!this.fragContextChanged(d.frag))return this.hls.trigger(D.KEY_LOADED,d),this.state===nt.KEY_LOADING&&(this.state=nt.IDLE),d}),this.hls.trigger(D.KEY_LOADING,{frag:t}),this.fragCurrent===null&&(o=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))):!t.encrypted&&n.encryptedFragments.length&&this.keyLoader.loadClear(t,n.encryptedFragments),i=Math.max(t.start,i||0),this.config.lowLatencyMode&&t.sn!=="initSegment"){const d=n.partList;if(d&&r){i>t.end&&n.fragmentHint&&(t=n.fragmentHint);const c=this.getNextPart(d,t,i);if(c>-1){const f=d[c];this.log(`Loading part sn: ${t.sn} p: ${f.index} cc: ${t.cc} of playlist [${n.startSN}-${n.endSN}] parts [0-${c}-${d.length-1}] ${this.logPrefix==="[stream-controller]"?"level":"track"}: ${t.level}, target: ${parseFloat(i.toFixed(3))}`),this.nextLoadPosition=f.start+f.duration,this.state=nt.FRAG_LOADING;let h;return o?h=o.then(p=>!p||this.fragContextChanged(p.frag)?null:this.doFragPartsLoad(t,f,e,r)).catch(p=>this.handleFragLoadError(p)):h=this.doFragPartsLoad(t,f,e,r).catch(p=>this.handleFragLoadError(p)),this.hls.trigger(D.FRAG_LOADING,{frag:t,part:f,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):h}else if(!t.url||this.loadedEndOfParts(d,i))return Promise.resolve(null)}}this.log(`Loading fragment ${t.sn} cc: ${t.cc} ${n?"of ["+n.startSN+"-"+n.endSN+"] ":""}${this.logPrefix==="[stream-controller]"?"level":"track"}: ${t.level}, target: ${parseFloat(i.toFixed(3))}`),_t(t.sn)&&!this.bitrateTest&&(this.nextLoadPosition=t.start+t.duration),this.state=nt.FRAG_LOADING;const a=this.config.progressive;let l;return a&&o?l=o.then(d=>!d||this.fragContextChanged(d==null?void 0:d.frag)?null:this.fragmentLoader.load(t,r)).catch(d=>this.handleFragLoadError(d)):l=Promise.all([this.fragmentLoader.load(t,a?r:void 0),o]).then(([d])=>(!a&&d&&r&&r(d),d)).catch(d=>this.handleFragLoadError(d)),this.hls.trigger(D.FRAG_LOADING,{frag:t,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):l}doFragPartsLoad(t,e,i,r){return new Promise((s,n)=>{var o;const a=[],l=(o=i.details)==null?void 0:o.partList,d=c=>{this.fragmentLoader.loadPart(t,c,r).then(f=>{a[c.index]=f;const h=f.part;this.hls.trigger(D.FRAG_LOADED,f);const p=Ds(i,t.sn,c.index+1)||Rn(l,t.sn,c.index+1);if(p)d(p);else return s({frag:t,part:h,partsLoaded:a})}).catch(n)};d(e)})}handleFragLoadError(t){if("data"in t){const e=t.data;t.data&&e.details===tt.INTERNAL_ABORTED?this.handleFragLoadAborted(e.frag,e.part):this.hls.trigger(D.ERROR,e)}else this.hls.trigger(D.ERROR,{type:bt.OTHER_ERROR,details:tt.INTERNAL_EXCEPTION,err:t,error:t,fatal:!0});return null}_handleTransmuxerFlush(t){const e=this.getCurrentContext(t);if(!e||this.state!==nt.PARSING){!this.fragCurrent&&this.state!==nt.STOPPED&&this.state!==nt.ERROR&&(this.state=nt.IDLE);return}const{frag:i,part:r,level:s}=e,n=self.performance.now();i.stats.parsing.end=n,r&&(r.stats.parsing.end=n),this.updateLevelTiming(i,r,s,t.partial)}getCurrentContext(t){const{levels:e,fragCurrent:i}=this,{level:r,sn:s,part:n}=t;if(!(e!=null&&e[r]))return this.warn(`Levels object was unset while buffering fragment ${s} of level ${r}. The current chunk will not be buffered.`),null;const o=e[r],a=n>-1?Ds(o,s,n):null,l=a?a.fragment:al(o,s,i);return l?(i&&i!==l&&(l.stats=i.stats),{frag:l,part:a,level:o}):null}bufferFragmentData(t,e,i,r){var s;if(!t||this.state!==nt.PARSING)return;const{data1:n,data2:o}=t;let a=n;if(n&&o&&(a=Je(n,o)),!((s=a)!=null&&s.length))return;const l={type:t.type,frag:e,part:i,chunkMeta:r,parent:e.type,data:a};this.hls.trigger(D.BUFFER_APPENDING,l),t.dropped&&t.independent&&!i&&this.flushBufferGap(e)}flushBufferGap(t){const e=this.media;if(!e)return;if(!$t.isBuffered(e,e.currentTime)){this.flushMainBuffer(0,t.start);return}const i=e.currentTime,r=$t.bufferInfo(e,i,0),s=t.duration,n=Math.min(this.config.maxFragLookUpTolerance*2,s*.25),o=Math.max(Math.min(t.start-n,r.end-n),i+n);t.start-o>n&&this.flushMainBuffer(o,t.start)}getFwdBufferInfo(t,e){const i=this.getLoadPosition();return _t(i)?this.getFwdBufferInfoAtPos(t,i,e):null}getFwdBufferInfoAtPos(t,e,i){const{config:{maxBufferHole:r}}=this,s=$t.bufferInfo(t,e,r);if(s.len===0&&s.nextStart!==void 0){const n=this.fragmentTracker.getBufferedFrag(e,i);if(n&&s.nextStart<n.end)return $t.bufferInfo(t,e,Math.max(s.nextStart,r))}return s}getMaxBufferLength(t){const{config:e}=this;let i;return t?i=Math.max(8*e.maxBufferSize/t,e.maxBufferLength):i=e.maxBufferLength,Math.min(i,e.maxMaxBufferLength)}reduceMaxBufferLength(t){const e=this.config,i=t||e.maxBufferLength;return e.maxMaxBufferLength>=i?(e.maxMaxBufferLength/=2,this.warn(`Reduce max buffer length to ${e.maxMaxBufferLength}s`),!0):!1}getAppendedFrag(t,e=Tt.MAIN){const i=this.fragmentTracker.getAppendedFrag(t,Tt.MAIN);return i&&"fragment"in i?i.fragment:i}getNextFragment(t,e){const i=e.fragments,r=i.length;if(!r)return null;const{config:s}=this,n=i[0].start;let o;if(e.live){const a=s.initialLiveManifestSize;if(r<a)return this.warn(`Not enough fragments to start playback (have: ${r}, need: ${a})`),null;!e.PTSKnown&&!this.startFragRequested&&this.startPosition===-1&&(o=this.getInitialLiveFragment(e,i),this.startPosition=o?this.hls.liveSyncPosition||o.start:t)}else t<=n&&(o=i[0]);if(!o){const a=s.lowLatencyMode?e.partEnd:e.fragmentEnd;o=this.getFragmentAtPosition(t,a,e)}return this.mapToInitFragWhenRequired(o)}isLoopLoading(t,e){const i=this.fragmentTracker.getState(t);return(i===re.OK||i===re.PARTIAL&&!!t.gap)&&this.nextLoadPosition>e}getNextFragmentLoopLoading(t,e,i,r,s){const n=t.gap,o=this.getNextFragment(this.nextLoadPosition,e);if(o===null)return o;if(t=o,n&&t&&!t.gap&&i.nextStart){const a=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,i.nextStart,r);if(a!==null&&i.len+a.len>=s)return this.log(`buffer full after gaps in "${r}" playlist starting at sn: ${t.sn}`),null}return t}mapToInitFragWhenRequired(t){return t!=null&&t.initSegment&&!(t!=null&&t.initSegment.data)&&!this.bitrateTest?t.initSegment:t}getNextPart(t,e,i){let r=-1,s=!1,n=!0;for(let o=0,a=t.length;o<a;o++){const l=t[o];if(n=n&&!l.independent,r>-1&&i<l.start)break;const d=l.loaded;d?r=-1:(s||l.independent||n)&&l.fragment===e&&(r=o),s=d}return r}loadedEndOfParts(t,e){const i=t[t.length-1];return i&&e>i.start&&i.loaded}getInitialLiveFragment(t,e){const i=this.fragPrevious;let r=null;if(i){if(t.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${i.programDateTime}`),r=ll(e,i.endProgramDateTime,this.config.maxFragLookUpTolerance)),!r){const s=i.sn+1;if(s>=t.startSN&&s<=t.endSN){const n=e[s-t.startSN];i.cc===n.cc&&(r=n,this.log(`Live playlist, switching playlist, load frag with next SN: ${r.sn}`))}r||(r=cl(e,i.cc),r&&this.log(`Live playlist, switching playlist, load frag with same CC: ${r.sn}`))}}else{const s=this.hls.liveSyncPosition;s!==null&&(r=this.getFragmentAtPosition(s,this.bitrateTest?t.fragmentEnd:t.edge,t))}return r}getFragmentAtPosition(t,e,i){const{config:r}=this;let{fragPrevious:s}=this,{fragments:n,endSN:o}=i;const{fragmentHint:a}=i,l=r.maxFragLookUpTolerance,d=i.partList,c=!!(r.lowLatencyMode&&d!=null&&d.length&&a);c&&a&&!this.bitrateTest&&(n=n.concat(a),o=a.sn);let f;if(t<e){const h=t>e-l?0:l;f=vi(s,n,t,h)}else f=n[n.length-1];if(f){const h=f.sn-i.startSN,p=this.fragmentTracker.getState(f);if((p===re.OK||p===re.PARTIAL&&f.gap)&&(s=f),s&&f.sn===s.sn&&(!c||d[0].fragment.sn>f.sn)&&s&&f.level===s.level){const x=n[h+1];f.sn<o&&this.fragmentTracker.getState(x)!==re.OK?f=x:f=null}}return f}synchronizeToLiveEdge(t){const{config:e,media:i}=this;if(!i)return;const r=this.hls.liveSyncPosition,s=i.currentTime,n=t.fragments[0].start,o=t.edge,a=s>=n-e.maxFragLookUpTolerance&&s<=o;if(r!==null&&i.duration>r&&(s<r||!a)){const l=e.liveMaxLatencyDuration!==void 0?e.liveMaxLatencyDuration:e.liveMaxLatencyDurationCount*t.targetduration;(!a&&i.readyState<4||s<o-l)&&(this.loadedmetadata||(this.nextLoadPosition=r),i.readyState&&(this.warn(`Playback: ${s.toFixed(3)} is located too far from the end of live sliding playlist: ${o}, reset currentTime to : ${r.toFixed(3)}`),i.currentTime=r))}}alignPlaylists(t,e){const{levels:i,levelLastLoaded:r,fragPrevious:s}=this,n=r!==null?i[r]:null,o=t.fragments.length;if(!o)return this.warn("No fragments in live playlist"),0;const a=t.fragments[0].start,l=!e,d=t.alignedSliding&&_t(a);if(l||!d&&!a){bl(s,n,t);const c=t.fragments[0].start;return this.log(`Live playlist sliding: ${c.toFixed(2)} start-sn: ${e?e.startSN:"na"}->${t.startSN} prev-sn: ${s?s.sn:"na"} fragments: ${o}`),c}return a}waitForCdnTuneIn(t){return t.live&&t.canBlockReload&&t.partTarget&&t.tuneInGoal>Math.max(t.partHoldBack,t.partTarget*3)}setStartPosition(t,e){let i=this.startPosition;if(i<e&&(i=-1),i===-1||this.lastCurrentTime===-1){const r=this.startTimeOffset!==null,s=r?this.startTimeOffset:t.startTimeOffset;s!==null&&_t(s)?(i=e+s,s<0&&(i+=t.totalduration),i=Math.min(Math.max(e,i),e+t.totalduration),this.log(`Start time offset ${s} found in ${r?"multivariant":"media"} playlist, adjust startPosition to ${i}`),this.startPosition=i):t.live?i=this.hls.liveSyncPosition||e:this.startPosition=i=0,this.lastCurrentTime=i}this.nextLoadPosition=i}getLoadPosition(){const{media:t}=this;let e=0;return this.loadedmetadata&&t?e=t.currentTime:this.nextLoadPosition&&(e=this.nextLoadPosition),e}handleFragLoadAborted(t,e){this.transmuxer&&t.sn!=="initSegment"&&t.stats.aborted&&(this.warn(`Fragment ${t.sn}${e?" part "+e.index:""} of level ${t.level} was aborted`),this.resetFragmentLoading(t))}resetFragmentLoading(t){(!this.fragCurrent||!this.fragContextChanged(t)&&this.state!==nt.FRAG_LOADING_WAITING_RETRY)&&(this.state=nt.IDLE)}onFragmentOrKeyLoadError(t,e){if(e.chunkMeta&&!e.frag){const d=this.getCurrentContext(e.chunkMeta);d&&(e.frag=d.frag)}const i=e.frag;if(!i||i.type!==t||!this.levels)return;if(this.fragContextChanged(i)){var r;this.warn(`Frag load error must match current frag to retry ${i.url} > ${(r=this.fragCurrent)==null?void 0:r.url}`);return}const s=e.details===tt.FRAG_GAP;s&&this.fragmentTracker.fragBuffered(i,!0);const n=e.errorAction,{action:o,retryCount:a=0,retryConfig:l}=n||{};if(n&&o===ue.RetryRequest&&l){this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition);const d=Ur(l,a);this.warn(`Fragment ${i.sn} of ${t} ${i.level} errored with ${e.details}, retrying loading ${a+1}/${l.maxNumRetry} in ${d}ms`),n.resolved=!0,this.retryDate=self.performance.now()+d,this.state=nt.FRAG_LOADING_WAITING_RETRY}else l&&n?(this.resetFragmentErrors(t),a<l.maxNumRetry?s||(n.resolved=!0):H.warn(`${e.details} reached or exceeded max retry (${a})`)):this.state=nt.ERROR;this.tickImmediate()}reduceLengthAndFlushBuffer(t){if(this.state===nt.PARSING||this.state===nt.PARSED){const e=t.parent,i=this.getFwdBufferInfo(this.mediaBuffer,e),r=i&&i.len>.5;r&&this.reduceMaxBufferLength(i.len);const s=!r;return s&&this.warn(`Buffer full error while media.currentTime is not buffered, flush ${e} buffer`),t.frag&&(this.fragmentTracker.removeFragment(t.frag),this.nextLoadPosition=t.frag.start),this.resetLoadingState(),s}return!1}resetFragmentErrors(t){t===Tt.AUDIO&&(this.fragCurrent=null),this.loadedmetadata||(this.startFragRequested=!1),this.state!==nt.STOPPED&&(this.state=nt.IDLE)}afterBufferFlushed(t,e,i){if(!t)return;const r=$t.getBuffered(t);this.fragmentTracker.detectEvictedFragments(e,r,i),this.state===nt.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=nt.IDLE}resetStartWhenNotLoaded(t){if(!this.loadedmetadata){this.startFragRequested=!1;const e=this.levels?this.levels[t].details:null;e!=null&&e.live?(this.startPosition=-1,this.setStartPosition(e,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(t){this.warn(`The loading context changed while buffering fragment ${t.sn} of level ${t.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(t.level),this.resetLoadingState()}removeUnbufferedFrags(t=0){this.fragmentTracker.removeFragmentsInRange(t,1/0,this.playlistType,!1,!0)}updateLevelTiming(t,e,i,r){var s;const n=i.details;if(!n){this.warn("level.details undefined");return}if(Object.keys(t.elementaryStreams).reduce((a,l)=>{const d=t.elementaryStreams[l];if(d){const c=d.endPTS-d.startPTS;if(c<=0)return this.warn(`Could not parse fragment ${t.sn} ${l} duration reliably (${c})`),a||!1;const f=r?0:In(n,t,d.startPTS,d.endPTS,d.startDTS,d.endDTS);return this.hls.trigger(D.LEVEL_PTS_UPDATED,{details:n,level:i,drift:f,type:l,frag:t,start:d.startPTS,end:d.endPTS}),!0}return a},!1))i.fragmentError=0;else if(((s=this.transmuxer)==null?void 0:s.error)===null){const a=new Error(`Found no media in fragment ${t.sn} of level ${i.id} resetting transmuxer to fallback to playlist timing`);if(this.warn(a.message),this.hls.trigger(D.ERROR,{type:bt.MEDIA_ERROR,details:tt.FRAG_PARSING_ERROR,fatal:!1,error:a,frag:t,reason:`Found no media in msn ${t.sn} of level "${i.url}"`}),!this.hls)return;this.resetTransmuxer()}this.state=nt.PARSED,this.hls.trigger(D.FRAG_PARSED,{frag:t,part:e})}resetTransmuxer(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)}recoverWorkerError(t){t.event==="demuxerWorker"&&(this.resetTransmuxer(),this.resetLoadingState())}set state(t){const e=this._state;e!==t&&(this._state=t,this.log(`${e}->${t}`))}get state(){return this._state}}function Mn(){return self.SourceBuffer||self.WebKitSourceBuffer}function kl(){const u=zi();if(!u)return!1;const t=Mn(),e=u&&typeof u.isTypeSupported=="function"&&u.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),i=!t||t.prototype&&typeof t.prototype.appendBuffer=="function"&&typeof t.prototype.remove=="function";return!!e&&!!i}function Cl(){var u;const t=Mn();return typeof(t==null||(u=t.prototype)==null?void 0:u.changeType)=="function"}function Ml(){return typeof __HLS_WORKER_BUNDLE__=="function"}function Pl(){const u=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(u);return{worker:new self.Worker(t),objectURL:t}}function Ol(u){const t=new self.URL(u,self.location.href).href;return{worker:new self.Worker(t),scriptURL:t}}function we(u="",t=9e4){return{type:u,id:-1,pid:-1,inputTimeScale:t,sequenceNumber:-1,samples:[],dropped:0}}class Pn{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(t,e,i,r){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(t){this.initPTS=t,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(t,e){return!1}appendFrame(t,e,i){}demux(t,e){this.cachedData&&(t=Je(this.cachedData,t),this.cachedData=null);let i=Ni(t,0),r=i?i.length:0,s;const n=this._audioTrack,o=this._id3Track,a=i?yo(i):void 0,l=t.length;for((this.basePTS===null||this.frameIndex===0&&_t(a))&&(this.basePTS=Nl(a,e,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),i&&i.length>0&&o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:Te.audioId3,duration:Number.POSITIVE_INFINITY});r<l;){if(this.canParse(t,r)){const d=this.appendFrame(n,t,r);d?(this.frameIndex++,this.lastPTS=d.sample.pts,r+=d.length,s=r):r=l}else go(t,r)?(i=Ni(t,r),o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:Te.audioId3,duration:Number.POSITIVE_INFINITY}),r+=i.length,s=r):r++;if(r===l&&s!==l){const d=Qe(t,s);this.cachedData?this.cachedData=Je(this.cachedData,d):this.cachedData=d}}return{audioTrack:n,videoTrack:we(),id3Track:o,textTrack:we()}}demuxSampleAes(t,e,i){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(t){const e=this.cachedData;return e&&(this.cachedData=null,this.demux(e,0)),{audioTrack:this._audioTrack,videoTrack:we(),id3Track:this._id3Track,textTrack:we()}}destroy(){}}const Nl=(u,t,e)=>{if(_t(u))return u*90;const i=e?e.baseTime*9e4/e.timescale:0;return t*9e4+i};function Fl(u,t,e,i){let r,s,n,o;const a=navigator.userAgent.toLowerCase(),l=i,d=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];r=((t[e+2]&192)>>>6)+1;const c=(t[e+2]&60)>>>2;if(c>d.length-1){u.trigger(D.ERROR,{type:bt.MEDIA_ERROR,details:tt.FRAG_PARSING_ERROR,fatal:!0,reason:`invalid ADTS sampling index:${c}`});return}return n=(t[e+2]&1)<<2,n|=(t[e+3]&192)>>>6,H.log(`manifest codec:${i}, ADTS type:${r}, samplingIndex:${c}`),/firefox/i.test(a)?c>=6?(r=5,o=new Array(4),s=c-3):(r=2,o=new Array(2),s=c):a.indexOf("android")!==-1?(r=2,o=new Array(2),s=c):(r=5,o=new Array(4),i&&(i.indexOf("mp4a.40.29")!==-1||i.indexOf("mp4a.40.5")!==-1)||!i&&c>=6?s=c-3:((i&&i.indexOf("mp4a.40.2")!==-1&&(c>=6&&n===1||/vivaldi/i.test(a))||!i&&n===1)&&(r=2,o=new Array(2)),s=c)),o[0]=r<<3,o[0]|=(c&14)>>1,o[1]|=(c&1)<<7,o[1]|=n<<3,r===5&&(o[1]|=(s&14)>>1,o[2]=(s&1)<<7,o[2]|=2<<2,o[3]=0),{config:o,samplerate:d[c],channelCount:n,codec:"mp4a.40."+r,manifestCodec:l}}function On(u,t){return u[t]===255&&(u[t+1]&246)===240}function Nn(u,t){return u[t+1]&1?7:9}function Hr(u,t){return(u[t+3]&3)<<11|u[t+4]<<3|(u[t+5]&224)>>>5}function Bl(u,t){return t+5<u.length}function $i(u,t){return t+1<u.length&&On(u,t)}function Ul(u,t){return Bl(u,t)&&On(u,t)&&Hr(u,t)<=u.length-t}function jl(u,t){if($i(u,t)){const e=Nn(u,t);if(t+e>=u.length)return!1;const i=Hr(u,t);if(i<=e)return!1;const r=t+i;return r===u.length||$i(u,r)}return!1}function Fn(u,t,e,i,r){if(!u.samplerate){const s=Fl(t,e,i,r);if(!s)return;u.config=s.config,u.samplerate=s.samplerate,u.channelCount=s.channelCount,u.codec=s.codec,u.manifestCodec=s.manifestCodec,H.log(`parsed codec:${u.codec}, rate:${s.samplerate}, channels:${s.channelCount}`)}}function Bn(u){return 1024*9e4/u}function $l(u,t){const e=Nn(u,t);if(t+e<=u.length){const i=Hr(u,t)-e;if(i>0)return{headerLength:e,frameLength:i}}}function Un(u,t,e,i,r){const s=Bn(u.samplerate),n=i+r*s,o=$l(t,e);let a;if(o){const{frameLength:c,headerLength:f}=o,h=f+c,p=Math.max(0,e+h-t.length);p?(a=new Uint8Array(h-f),a.set(t.subarray(e+f,t.length),0)):a=t.subarray(e+f,e+h);const g={unit:a,pts:n};return p||u.samples.push(g),{sample:g,length:h,missing:p}}const l=t.length-e;return a=new Uint8Array(l),a.set(t.subarray(e,t.length),0),{sample:{unit:a,pts:n},length:l,missing:-1}}class Gl extends Pn{constructor(t,e){super(),this.observer=void 0,this.config=void 0,this.observer=t,this.config=e}resetInitSegment(t,e,i,r){super.resetInitSegment(t,e,i,r),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:e,duration:r,inputTimeScale:9e4,dropped:0}}static probe(t){if(!t)return!1;let i=(Ni(t,0)||[]).length;for(let r=t.length;i<r;i++)if(jl(t,i))return H.log("ADTS sync word found !"),!0;return!1}canParse(t,e){return Ul(t,e)}appendFrame(t,e,i){Fn(t,this.observer,e,i,t.manifestCodec);const r=Un(t,e,i,this.basePTS,this.frameIndex);if(r&&r.missing===0)return r}}const Vl=/\/emsg[-/]ID3/i;class zl{constructor(t,e){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=e}resetTimeStamp(){}resetInitSegment(t,e,i,r){const s=this.videoTrack=we("video",1),n=this.audioTrack=we("audio",1),o=this.txtTrack=we("text",1);if(this.id3Track=we("id3",1),this.timeOffset=0,!(t!=null&&t.byteLength))return;const a=xn(t);if(a.video){const{id:l,timescale:d,codec:c}=a.video;s.id=l,s.timescale=o.timescale=d,s.codec=c}if(a.audio){const{id:l,timescale:d,codec:c}=a.audio;n.id=l,n.timescale=d,n.codec=c}o.id=yn.text,s.sampleDuration=0,s.duration=n.duration=r}resetContiguity(){this.remainderData=null}static probe(t){return t=t.length>16384?t.subarray(0,16384):t,Mt(t,["moof"]).length>0}demux(t,e){this.timeOffset=e;let i=t;const r=this.videoTrack,s=this.txtTrack;if(this.config.progressive){this.remainderData&&(i=Je(this.remainderData,t));const o=Co(i);this.remainderData=o.remainder,r.samples=o.valid||new Uint8Array}else r.samples=i;const n=this.extractID3Track(r,e);return s.samples=ms(e,r),{videoTrack:r,audioTrack:this.audioTrack,id3Track:n,textTrack:this.txtTrack}}flush(){const t=this.timeOffset,e=this.videoTrack,i=this.txtTrack;e.samples=this.remainderData||new Uint8Array,this.remainderData=null;const r=this.extractID3Track(e,this.timeOffset);return i.samples=ms(t,e),{videoTrack:e,audioTrack:we(),id3Track:r,textTrack:we()}}extractID3Track(t,e){const i=this.id3Track;if(t.samples.length){const r=Mt(t.samples,["emsg"]);r&&r.forEach(s=>{const n=Oo(s);if(Vl.test(n.schemeIdUri)){const o=_t(n.presentationTime)?n.presentationTime/n.timeScale:e+n.presentationTimeDelta/n.timeScale;let a=n.eventDuration===4294967295?Number.POSITIVE_INFINITY:n.eventDuration/n.timeScale;a<=.001&&(a=Number.POSITIVE_INFINITY);const l=n.payload;i.samples.push({data:l,len:l.byteLength,dts:o,pts:o,type:Te.emsg,duration:a})}})}return i}demuxSampleAes(t,e,i){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){}}let Ii=null;const Hl=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],Kl=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],Wl=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],Yl=[0,1,1,4];function jn(u,t,e,i,r){if(e+24>t.length)return;const s=$n(t,e);if(s&&e+s.frameLength<=t.length){const n=s.samplesPerFrame*9e4/s.sampleRate,o=i+r*n,a={unit:t.subarray(e,e+s.frameLength),pts:o,dts:o};return u.config=[],u.channelCount=s.channelCount,u.samplerate=s.sampleRate,u.samples.push(a),{sample:a,length:s.frameLength,missing:0}}}function $n(u,t){const e=u[t+1]>>3&3,i=u[t+1]>>1&3,r=u[t+2]>>4&15,s=u[t+2]>>2&3;if(e!==1&&r!==0&&r!==15&&s!==3){const n=u[t+2]>>1&1,o=u[t+3]>>6,a=e===3?3-i:i===3?3:4,l=Hl[a*14+r-1]*1e3,c=Kl[(e===3?0:e===2?1:2)*3+s],f=o===3?1:2,h=Wl[e][i],p=Yl[i],g=h*8*p,x=Math.floor(h*l/c+n)*p;if(Ii===null){const O=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Ii=O?parseInt(O[1]):0}return!!Ii&&Ii<=87&&i===2&&l>=224e3&&o===0&&(u[t+3]=u[t+3]|128),{sampleRate:c,channelCount:f,frameLength:x,samplesPerFrame:g}}}function Kr(u,t){return u[t]===255&&(u[t+1]&224)===224&&(u[t+1]&6)!==0}function Gn(u,t){return t+1<u.length&&Kr(u,t)}function ql(u,t){return Kr(u,t)&&4<=u.length-t}function Zl(u,t){if(t+1<u.length&&Kr(u,t)){const i=$n(u,t);let r=4;i!=null&&i.frameLength&&(r=i.frameLength);const s=t+r;return s===u.length||Gn(u,s)}return!1}class Bs{constructor(t){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=t,this.bytesAvailable=t.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const t=this.data,e=this.bytesAvailable,i=t.byteLength-e,r=new Uint8Array(4),s=Math.min(4,e);if(s===0)throw new Error("no bytes available");r.set(t.subarray(i,i+s)),this.word=new DataView(r.buffer).getUint32(0),this.bitsAvailable=s*8,this.bytesAvailable-=s}skipBits(t){let e;t=Math.min(t,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>t?(this.word<<=t,this.bitsAvailable-=t):(t-=this.bitsAvailable,e=t>>3,t-=e<<3,this.bytesAvailable-=e,this.loadWord(),this.word<<=t,this.bitsAvailable-=t)}readBits(t){let e=Math.min(this.bitsAvailable,t);const i=this.word>>>32-e;if(t>32&&H.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=e,this.bitsAvailable>0)this.word<<=e;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return e=t-e,e>0&&this.bitsAvailable?i<<e|this.readBits(e):i}skipLZ(){let t;for(t=0;t<this.bitsAvailable;++t)if((this.word&2147483648>>>t)!==0)return this.word<<=t,this.bitsAvailable-=t,t;return this.loadWord(),t+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const t=this.skipLZ();return this.readBits(t+1)-1}readEG(){const t=this.readUEG();return 1&t?1+t>>>1:-1*(t>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}skipScalingList(t){let e=8,i=8,r;for(let s=0;s<t;s++)i!==0&&(r=this.readEG(),i=(e+r+256)%256),e=i===0?e:i}readSPS(){let t=0,e=0,i=0,r=0,s,n,o;const a=this.readUByte.bind(this),l=this.readBits.bind(this),d=this.readUEG.bind(this),c=this.readBoolean.bind(this),f=this.skipBits.bind(this),h=this.skipEG.bind(this),p=this.skipUEG.bind(this),g=this.skipScalingList.bind(this);a();const x=a();if(l(5),f(3),a(),p(),x===100||x===110||x===122||x===244||x===44||x===83||x===86||x===118||x===128){const C=d();if(C===3&&f(1),p(),p(),f(1),c())for(n=C!==3?8:12,o=0;o<n;o++)c()&&(o<6?g(16):g(64))}p();const E=d();if(E===0)d();else if(E===1)for(f(1),h(),h(),s=d(),o=0;o<s;o++)h();p(),f(1);const k=d(),O=d(),T=l(1);T===0&&f(1),f(1),c()&&(t=d(),e=d(),i=d(),r=d());let R=[1,1];if(c()&&c())switch(a()){case 1:R=[1,1];break;case 2:R=[12,11];break;case 3:R=[10,11];break;case 4:R=[16,11];break;case 5:R=[40,33];break;case 6:R=[24,11];break;case 7:R=[20,11];break;case 8:R=[32,11];break;case 9:R=[80,33];break;case 10:R=[18,11];break;case 11:R=[15,11];break;case 12:R=[64,33];break;case 13:R=[160,99];break;case 14:R=[4,3];break;case 15:R=[3,2];break;case 16:R=[2,1];break;case 255:{R=[a()<<8|a(),a()<<8|a()];break}}return{width:Math.ceil((k+1)*16-t*2-e*2),height:(2-T)*(O+1)*16-(T?2:4)*(i+r),pixelRatio:R}}readSliceType(){return this.readUByte(),this.readUEG(),this.readUEG()}}class Xl{constructor(t,e,i){this.keyData=void 0,this.decrypter=void 0,this.keyData=i,this.decrypter=new Vr(e,{removePKCS7Padding:!1})}decryptBuffer(t){return this.decrypter.decrypt(t,this.keyData.key.buffer,this.keyData.iv.buffer)}decryptAacSample(t,e,i){const r=t[e].unit;if(r.length<=16)return;const s=r.subarray(16,r.length-r.length%16),n=s.buffer.slice(s.byteOffset,s.byteOffset+s.length);this.decryptBuffer(n).then(o=>{const a=new Uint8Array(o);r.set(a,16),this.decrypter.isSync()||this.decryptAacSamples(t,e+1,i)})}decryptAacSamples(t,e,i){for(;;e++){if(e>=t.length){i();return}if(!(t[e].unit.length<32)&&(this.decryptAacSample(t,e,i),!this.decrypter.isSync()))return}}getAvcEncryptedData(t){const e=Math.floor((t.length-48)/160)*16+16,i=new Int8Array(e);let r=0;for(let s=32;s<t.length-16;s+=160,r+=16)i.set(t.subarray(s,s+16),r);return i}getAvcDecryptedUnit(t,e){const i=new Uint8Array(e);let r=0;for(let s=32;s<t.length-16;s+=160,r+=16)t.set(i.subarray(r,r+16),s);return t}decryptAvcSample(t,e,i,r,s){const n=Tn(s.data),o=this.getAvcEncryptedData(n);this.decryptBuffer(o.buffer).then(a=>{s.data=this.getAvcDecryptedUnit(n,a),this.decrypter.isSync()||this.decryptAvcSamples(t,e,i+1,r)})}decryptAvcSamples(t,e,i,r){if(t instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;e++,i=0){if(e>=t.length){r();return}const s=t[e].units;for(;!(i>=s.length);i++){const n=s[i];if(!(n.data.length<=48||n.type!==1&&n.type!==5)&&(this.decryptAvcSample(t,e,i,r,n),!this.decrypter.isSync()))return}}}}const ae=188;class ze{constructor(t,e,i){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=t,this.config=e,this.typeSupported=i}static probe(t){const e=ze.syncOffset(t);return e>0&&H.warn(`MPEG2-TS detected but first sync word found @ offset ${e}`),e!==-1}static syncOffset(t){const e=t.length;let i=Math.min(ae*5,t.length-ae)+1,r=0;for(;r<i;){let s=!1,n=-1,o=0;for(let a=r;a<e;a+=ae)if(t[a]===71){if(o++,n===-1&&(n=a,n!==0&&(i=Math.min(n+ae*99,t.length-ae)+1)),s||(s=Cr(t,a)===0),s&&o>1&&(n===0&&o>2||a+ae>i))return n}else{if(o)return-1;break}r++}return-1}static createTrack(t,e){return{container:t==="video"||t==="audio"?"video/mp2t":void 0,type:t,id:yn[t],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:t==="audio"?e:void 0}}resetInitSegment(t,e,i,r){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=ze.createTrack("video"),this._audioTrack=ze.createTrack("audio",r),this._id3Track=ze.createTrack("id3"),this._txtTrack=ze.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=e,this.videoCodec=i,this._duration=r}resetTimeStamp(){}resetContiguity(){const{_audioTrack:t,_avcTrack:e,_id3Track:i}=this;t&&(t.pesData=null),e&&(e.pesData=null),i&&(i.pesData=null),this.aacOverFlow=null,this.avcSample=null,this.remainderData=null}demux(t,e,i=!1,r=!1){i||(this.sampleAes=null);let s;const n=this._avcTrack,o=this._audioTrack,a=this._id3Track,l=this._txtTrack;let d=n.pid,c=n.pesData,f=o.pid,h=a.pid,p=o.pesData,g=a.pesData,x=null,E=this.pmtParsed,k=this._pmtId,O=t.length;if(this.remainderData&&(t=Je(this.remainderData,t),O=t.length,this.remainderData=null),O<ae&&!r)return this.remainderData=t,{audioTrack:o,videoTrack:n,id3Track:a,textTrack:l};const T=Math.max(0,ze.syncOffset(t));O-=(O-T)%ae,O<t.byteLength&&!r&&(this.remainderData=new Uint8Array(t.buffer,O,t.buffer.byteLength-O));let R=0;for(let b=T;b<O;b+=ae)if(t[b]===71){const A=!!(t[b+1]&64),L=Cr(t,b),I=(t[b+3]&48)>>4;let j;if(I>1){if(j=b+5+t[b+4],j===b+ae)continue}else j=b+4;switch(L){case d:A&&(c&&(s=ri(c))&&this.parseAVCPES(n,l,s,!1),c={data:[],size:0}),c&&(c.data.push(t.subarray(j,b+ae)),c.size+=b+ae-j);break;case f:if(A){if(p&&(s=ri(p)))switch(o.segmentCodec){case"aac":this.parseAACPES(o,s);break;case"mp3":this.parseMPEGPES(o,s);break}p={data:[],size:0}}p&&(p.data.push(t.subarray(j,b+ae)),p.size+=b+ae-j);break;case h:A&&(g&&(s=ri(g))&&this.parseID3PES(a,s),g={data:[],size:0}),g&&(g.data.push(t.subarray(j,b+ae)),g.size+=b+ae-j);break;case 0:A&&(j+=t[j]+1),k=this._pmtId=Ql(t,j);break;case k:{A&&(j+=t[j]+1);const F=Jl(t,j,this.typeSupported,i);d=F.avc,d>0&&(n.pid=d),f=F.audio,f>0&&(o.pid=f,o.segmentCodec=F.segmentCodec),h=F.id3,h>0&&(a.pid=h),x!==null&&!E&&(H.warn(`MPEG-TS PMT found at ${b} after unknown PID '${x}'. Backtracking to sync byte @${T} to parse all TS packets.`),x=null,b=T-188),E=this.pmtParsed=!0;break}case 17:case 8191:break;default:x=L;break}}else R++;if(R>0){const b=new Error(`Found ${R} TS packet/s that do not start with 0x47`);this.observer.emit(D.ERROR,D.ERROR,{type:bt.MEDIA_ERROR,details:tt.FRAG_PARSING_ERROR,fatal:!1,error:b,reason:b.message})}n.pesData=c,o.pesData=p,a.pesData=g;const C={audioTrack:o,videoTrack:n,id3Track:a,textTrack:l};return r&&this.extractRemainingSamples(C),C}flush(){const{remainderData:t}=this;this.remainderData=null;let e;return t?e=this.demux(t,-1,!1,!0):e={videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(e),this.sampleAes?this.decrypt(e,this.sampleAes):e}extractRemainingSamples(t){const{audioTrack:e,videoTrack:i,id3Track:r,textTrack:s}=t,n=i.pesData,o=e.pesData,a=r.pesData;let l;if(n&&(l=ri(n))?(this.parseAVCPES(i,s,l,!0),i.pesData=null):i.pesData=n,o&&(l=ri(o))){switch(e.segmentCodec){case"aac":this.parseAACPES(e,l);break;case"mp3":this.parseMPEGPES(e,l);break}e.pesData=null}else o!=null&&o.size&&H.log("last AAC PES packet truncated,might overlap between fragments"),e.pesData=o;a&&(l=ri(a))?(this.parseID3PES(r,l),r.pesData=null):r.pesData=a}demuxSampleAes(t,e,i){const r=this.demux(t,i,!0,!this.config.progressive),s=this.sampleAes=new Xl(this.observer,this.config,e);return this.decrypt(r,s)}decrypt(t,e){return new Promise(i=>{const{audioTrack:r,videoTrack:s}=t;r.samples&&r.segmentCodec==="aac"?e.decryptAacSamples(r.samples,0,()=>{s.samples?e.decryptAvcSamples(s.samples,0,0,()=>{i(t)}):i(t)}):s.samples&&e.decryptAvcSamples(s.samples,0,0,()=>{i(t)})})}destroy(){this._duration=0}parseAVCPES(t,e,i,r){const s=this.parseAVCNALu(t,i.data);let n=this.avcSample,o,a=!1;i.data=null,n&&s.length&&!t.audFound&&(cr(n,t),n=this.avcSample=wi(!1,i.pts,i.dts,"")),s.forEach(l=>{switch(l.type){case 1:{o=!0,n||(n=this.avcSample=wi(!0,i.pts,i.dts,"")),n.frame=!0;const d=l.data;if(a&&d.length>4){const c=new Bs(d).readSliceType();(c===2||c===4||c===7||c===9)&&(n.key=!0)}break}case 5:o=!0,n||(n=this.avcSample=wi(!0,i.pts,i.dts,"")),n.key=!0,n.frame=!0;break;case 6:{o=!0,bn(l.data,1,i.pts,e.samples);break}case 7:if(o=!0,a=!0,!t.sps){const d=l.data,f=new Bs(d).readSPS();t.width=f.width,t.height=f.height,t.pixelRatio=f.pixelRatio,t.sps=[d],t.duration=this._duration;const h=d.subarray(1,4);let p="avc1.";for(let g=0;g<3;g++){let x=h[g].toString(16);x.length<2&&(x="0"+x),p+=x}t.codec=p}break;case 8:o=!0,t.pps||(t.pps=[l.data]);break;case 9:o=!1,t.audFound=!0,n&&cr(n,t),n=this.avcSample=wi(!1,i.pts,i.dts,"");break;case 12:o=!0;break;default:o=!1,n&&(n.debug+="unknown NAL "+l.type+" ");break}n&&o&&n.units.push(l)}),r&&n&&(cr(n,t),this.avcSample=null)}getLastNalUnit(t){var e;let i=this.avcSample,r;if((!i||i.units.length===0)&&(i=t[t.length-1]),(e=i)!=null&&e.units){const s=i.units;r=s[s.length-1]}return r}parseAVCNALu(t,e){const i=e.byteLength;let r=t.naluState||0;const s=r,n=[];let o=0,a,l,d,c=-1,f=0;for(r===-1&&(c=0,f=e[0]&31,r=0,o=1);o<i;){if(a=e[o++],!r){r=a?0:1;continue}if(r===1){r=a?0:2;continue}if(!a)r=3;else if(a===1){if(c>=0){const h={data:e.subarray(c,o-r-1),type:f};n.push(h)}else{const h=this.getLastNalUnit(t.samples);if(h&&(s&&o<=4-s&&h.state&&(h.data=h.data.subarray(0,h.data.byteLength-s)),l=o-r-1,l>0)){const p=new Uint8Array(h.data.byteLength+l);p.set(h.data,0),p.set(e.subarray(0,l),h.data.byteLength),h.data=p,h.state=0}}o<i?(d=e[o]&31,c=o,f=d,r=0):r=-1}else r=0}if(c>=0&&r>=0){const h={data:e.subarray(c,i),type:f,state:r};n.push(h)}if(n.length===0){const h=this.getLastNalUnit(t.samples);if(h){const p=new Uint8Array(h.data.byteLength+e.byteLength);p.set(h.data,0),p.set(e,h.data.byteLength),h.data=p}}return t.naluState=r,n}parseAACPES(t,e){let i=0;const r=this.aacOverFlow;let s=e.data;if(r){this.aacOverFlow=null;const c=r.missing,f=r.sample.unit.byteLength;if(c===-1){const h=new Uint8Array(f+s.byteLength);h.set(r.sample.unit,0),h.set(s,f),s=h}else{const h=f-c;r.sample.unit.set(s.subarray(0,c),h),t.samples.push(r.sample),i=r.missing}}let n,o;for(n=i,o=s.length;n<o-1&&!$i(s,n);n++);if(n!==i){let c;const f=n<o-1;f?c=`AAC PES did not start with ADTS header,offset:${n}`:c="No ADTS header found in AAC PES";const h=new Error(c);if(H.warn(`parsing error: ${c}`),this.observer.emit(D.ERROR,D.ERROR,{type:bt.MEDIA_ERROR,details:tt.FRAG_PARSING_ERROR,fatal:!1,levelRetry:f,error:h,reason:c}),!f)return}Fn(t,this.observer,s,n,this.audioCodec);let a;if(e.pts!==void 0)a=e.pts;else if(r){const c=Bn(t.samplerate);a=r.sample.pts+c}else{H.warn("[tsdemuxer]: AAC PES unknown PTS");return}let l=0,d;for(;n<o;)if(d=Un(t,s,n,a,l),n+=d.length,d.missing){this.aacOverFlow=d;break}else for(l++;n<o-1&&!$i(s,n);n++);}parseMPEGPES(t,e){const i=e.data,r=i.length;let s=0,n=0;const o=e.pts;if(o===void 0){H.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;n<r;)if(Gn(i,n)){const a=jn(t,i,n,o,s);if(a)n+=a.length,s++;else break}else n++}parseID3PES(t,e){if(e.pts===void 0){H.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const i=Jt({},e,{type:this._avcTrack?Te.emsg:Te.audioId3,duration:Number.POSITIVE_INFINITY});t.samples.push(i)}}function wi(u,t,e,i){return{key:u,frame:!1,pts:t,dts:e,units:[],debug:i,length:0}}function Cr(u,t){return((u[t+1]&31)<<8)+u[t+2]}function Ql(u,t){return(u[t+10]&31)<<8|u[t+11]}function Jl(u,t,e,i){const r={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},s=(u[t+1]&15)<<8|u[t+2],n=t+3+s-4,o=(u[t+10]&15)<<8|u[t+11];for(t+=12+o;t<n;){const a=Cr(u,t);switch(u[t]){case 207:if(!i){H.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:r.audio===-1&&(r.audio=a);break;case 21:r.id3===-1&&(r.id3=a);break;case 219:if(!i){H.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:r.avc===-1&&(r.avc=a);break;case 3:case 4:e.mpeg!==!0&&e.mp3!==!0?H.log("MPEG audio found, not supported in this browser"):r.audio===-1&&(r.audio=a,r.segmentCodec="mp3");break;case 36:H.warn("Unsupported HEVC stream type found");break}t+=((u[t+3]&15)<<8|u[t+4])+5}return r}function ri(u){let t=0,e,i,r,s,n;const o=u.data;if(!u||u.size===0)return null;for(;o[0].length<19&&o.length>1;){const l=new Uint8Array(o[0].length+o[1].length);l.set(o[0]),l.set(o[1],o[0].length),o[0]=l,o.splice(1,1)}if(e=o[0],(e[0]<<16)+(e[1]<<8)+e[2]===1){if(i=(e[4]<<8)+e[5],i&&i>u.size-6)return null;const l=e[7];l&192&&(s=(e[9]&14)*536870912+(e[10]&255)*4194304+(e[11]&254)*16384+(e[12]&255)*128+(e[13]&254)/2,l&64?(n=(e[14]&14)*536870912+(e[15]&255)*4194304+(e[16]&254)*16384+(e[17]&255)*128+(e[18]&254)/2,s-n>60*9e4&&(H.warn(`${Math.round((s-n)/9e4)}s delta between PTS and DTS, align them`),s=n)):n=s),r=e[8];let d=r+9;if(u.size<=d)return null;u.size-=d;const c=new Uint8Array(u.size);for(let f=0,h=o.length;f<h;f++){e=o[f];let p=e.byteLength;if(d)if(d>p){d-=p;continue}else e=e.subarray(d),p-=d,d=0;c.set(e,t),t+=p}return i&&(i-=r+3),{data:c,pts:s,dts:n,len:i}}return null}function cr(u,t){if(u.units.length&&u.frame){if(u.pts===void 0){const e=t.samples,i=e.length;if(i){const r=e[i-1];u.pts=r.pts,u.dts=r.dts}else{t.dropped++;return}}t.samples.push(u)}u.debug.length&&H.log(u.pts+"/"+u.dts+":"+u.debug)}class td extends Pn{resetInitSegment(t,e,i,r){super.resetInitSegment(t,e,i,r),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:e,duration:r,inputTimeScale:9e4,dropped:0}}static probe(t){if(!t)return!1;let i=(Ni(t,0)||[]).length;for(let r=t.length;i<r;i++)if(Zl(t,i))return H.log("MPEG Audio sync word found !"),!0;return!1}canParse(t,e){return ql(t,e)}appendFrame(t,e,i){if(this.basePTS!==null)return jn(t,e,i,this.basePTS,this.frameIndex)}}class Us{static getSilentFrame(t,e){switch(t){case"mp4a.40.2":if(e===1)return new Uint8Array([0,200,0,128,35,128]);if(e===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(e===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(e===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(e===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(e===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(e===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(e===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(e===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const Ve=Math.pow(2,32)-1;class Z{static init(){Z.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let t;for(t in Z.types)Z.types.hasOwnProperty(t)&&(Z.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);const e=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);Z.HDLR_TYPES={video:e,audio:i};const r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),s=new Uint8Array([0,0,0,0,0,0,0,0]);Z.STTS=Z.STSC=Z.STCO=s,Z.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),Z.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),Z.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),Z.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const n=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),a=new Uint8Array([0,0,0,1]);Z.FTYP=Z.box(Z.types.ftyp,n,a,n,o),Z.DINF=Z.box(Z.types.dinf,Z.box(Z.types.dref,r))}static box(t,...e){let i=8,r=e.length;const s=r;for(;r--;)i+=e[r].byteLength;const n=new Uint8Array(i);for(n[0]=i>>24&255,n[1]=i>>16&255,n[2]=i>>8&255,n[3]=i&255,n.set(t,4),r=0,i=8;r<s;r++)n.set(e[r],i),i+=e[r].byteLength;return n}static hdlr(t){return Z.box(Z.types.hdlr,Z.HDLR_TYPES[t])}static mdat(t){return Z.box(Z.types.mdat,t)}static mdhd(t,e){e*=t;const i=Math.floor(e/(Ve+1)),r=Math.floor(e%(Ve+1));return Z.box(Z.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,i>>24,i>>16&255,i>>8&255,i&255,r>>24,r>>16&255,r>>8&255,r&255,85,196,0,0]))}static mdia(t){return Z.box(Z.types.mdia,Z.mdhd(t.timescale,t.duration),Z.hdlr(t.type),Z.minf(t))}static mfhd(t){return Z.box(Z.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255]))}static minf(t){return t.type==="audio"?Z.box(Z.types.minf,Z.box(Z.types.smhd,Z.SMHD),Z.DINF,Z.stbl(t)):Z.box(Z.types.minf,Z.box(Z.types.vmhd,Z.VMHD),Z.DINF,Z.stbl(t))}static moof(t,e,i){return Z.box(Z.types.moof,Z.mfhd(t),Z.traf(i,e))}static moov(t){let e=t.length;const i=[];for(;e--;)i[e]=Z.trak(t[e]);return Z.box.apply(null,[Z.types.moov,Z.mvhd(t[0].timescale,t[0].duration)].concat(i).concat(Z.mvex(t)))}static mvex(t){let e=t.length;const i=[];for(;e--;)i[e]=Z.trex(t[e]);return Z.box.apply(null,[Z.types.mvex,...i])}static mvhd(t,e){e*=t;const i=Math.floor(e/(Ve+1)),r=Math.floor(e%(Ve+1)),s=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,i>>24,i>>16&255,i>>8&255,i&255,r>>24,r>>16&255,r>>8&255,r&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return Z.box(Z.types.mvhd,s)}static sdtp(t){const e=t.samples||[],i=new Uint8Array(4+e.length);let r,s;for(r=0;r<e.length;r++)s=e[r].flags,i[r+4]=s.dependsOn<<4|s.isDependedOn<<2|s.hasRedundancy;return Z.box(Z.types.sdtp,i)}static stbl(t){return Z.box(Z.types.stbl,Z.stsd(t),Z.box(Z.types.stts,Z.STTS),Z.box(Z.types.stsc,Z.STSC),Z.box(Z.types.stsz,Z.STSZ),Z.box(Z.types.stco,Z.STCO))}static avc1(t){let e=[],i=[],r,s,n;for(r=0;r<t.sps.length;r++)s=t.sps[r],n=s.byteLength,e.push(n>>>8&255),e.push(n&255),e=e.concat(Array.prototype.slice.call(s));for(r=0;r<t.pps.length;r++)s=t.pps[r],n=s.byteLength,i.push(n>>>8&255),i.push(n&255),i=i.concat(Array.prototype.slice.call(s));const o=Z.box(Z.types.avcC,new Uint8Array([1,e[3],e[4],e[5],255,224|t.sps.length].concat(e).concat([t.pps.length]).concat(i))),a=t.width,l=t.height,d=t.pixelRatio[0],c=t.pixelRatio[1];return Z.box(Z.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,a>>8&255,a&255,l>>8&255,l&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,Z.box(Z.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),Z.box(Z.types.pasp,new Uint8Array([d>>24,d>>16&255,d>>8&255,d&255,c>>24,c>>16&255,c>>8&255,c&255])))}static esds(t){const e=t.config.length;return new Uint8Array([0,0,0,0,3,23+e,0,1,0,4,15+e,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([e]).concat(t.config).concat([6,1,2]))}static mp4a(t){const e=t.samplerate;return Z.box(Z.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,e>>8&255,e&255,0,0]),Z.box(Z.types.esds,Z.esds(t)))}static mp3(t){const e=t.samplerate;return Z.box(Z.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,e>>8&255,e&255,0,0]))}static stsd(t){return t.type==="audio"?t.segmentCodec==="mp3"&&t.codec==="mp3"?Z.box(Z.types.stsd,Z.STSD,Z.mp3(t)):Z.box(Z.types.stsd,Z.STSD,Z.mp4a(t)):Z.box(Z.types.stsd,Z.STSD,Z.avc1(t))}static tkhd(t){const e=t.id,i=t.duration*t.timescale,r=t.width,s=t.height,n=Math.floor(i/(Ve+1)),o=Math.floor(i%(Ve+1));return Z.box(Z.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,0,0,0,0,n>>24,n>>16&255,n>>8&255,n&255,o>>24,o>>16&255,o>>8&255,o&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>8&255,r&255,0,0,s>>8&255,s&255,0,0]))}static traf(t,e){const i=Z.sdtp(t),r=t.id,s=Math.floor(e/(Ve+1)),n=Math.floor(e%(Ve+1));return Z.box(Z.types.traf,Z.box(Z.types.tfhd,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,r&255])),Z.box(Z.types.tfdt,new Uint8Array([1,0,0,0,s>>24,s>>16&255,s>>8&255,s&255,n>>24,n>>16&255,n>>8&255,n&255])),Z.trun(t,i.length+16+20+8+16+8+8),i)}static trak(t){return t.duration=t.duration||4294967295,Z.box(Z.types.trak,Z.tkhd(t),Z.mdia(t))}static trex(t){const e=t.id;return Z.box(Z.types.trex,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(t,e){const i=t.samples||[],r=i.length,s=12+16*r,n=new Uint8Array(s);let o,a,l,d,c,f;for(e+=8+s,n.set([t.type==="video"?1:0,0,15,1,r>>>24&255,r>>>16&255,r>>>8&255,r&255,e>>>24&255,e>>>16&255,e>>>8&255,e&255],0),o=0;o<r;o++)a=i[o],l=a.duration,d=a.size,c=a.flags,f=a.cts,n.set([l>>>24&255,l>>>16&255,l>>>8&255,l&255,d>>>24&255,d>>>16&255,d>>>8&255,d&255,c.isLeading<<2|c.dependsOn,c.isDependedOn<<6|c.hasRedundancy<<4|c.paddingValue<<1|c.isNonSync,c.degradPrio&240<<8,c.degradPrio&15,f>>>24&255,f>>>16&255,f>>>8&255,f&255],12+16*o);return Z.box(Z.types.trun,n)}static initSegment(t){Z.types||Z.init();const e=Z.moov(t),i=new Uint8Array(Z.FTYP.byteLength+e.byteLength);return i.set(Z.FTYP),i.set(e,Z.FTYP.byteLength),i}}Z.types=void 0;Z.HDLR_TYPES=void 0;Z.STTS=void 0;Z.STSC=void 0;Z.STCO=void 0;Z.STSZ=void 0;Z.VMHD=void 0;Z.SMHD=void 0;Z.STSD=void 0;Z.FTYP=void 0;Z.DINF=void 0;const Vn=9e4;function Wr(u,t,e=1,i=!1){const r=u*t*e;return i?Math.round(r):r}function ed(u,t,e=1,i=!1){return Wr(u,t,1/e,i)}function ui(u,t=!1){return Wr(u,1e3,1/Vn,t)}function id(u,t=1){return Wr(u,Vn,1/t)}const rd=10*1e3,js=1024,sd=1152;let Ri=null,ur=null;class hr{constructor(t,e,i,r=""){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=t,this.config=e,this.typeSupported=i,this.ISGenerated=!1,Ri===null){const n=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Ri=n?parseInt(n[1]):0}if(ur===null){const s=navigator.userAgent.match(/Safari\/(\d+)/i);ur=s?parseInt(s[1]):0}}destroy(){}resetTimeStamp(t){H.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=t}resetNextTimestamp(){H.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){H.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1}getVideoStartPts(t){let e=!1;const i=t.reduce((r,s)=>{const n=s.pts-r;return n<-4294967296?(e=!0,me(r,s.pts)):n>0?r:s.pts},t[0].pts);return e&&H.debug("PTS rollover detected"),i}remux(t,e,i,r,s,n,o,a){let l,d,c,f,h,p,g=s,x=s;const E=t.pid>-1,k=e.pid>-1,O=e.samples.length,T=t.samples.length>0,R=o&&O>0||O>1;if((!E||T)&&(!k||R)||this.ISGenerated||o){this.ISGenerated||(c=this.generateIS(t,e,s,n));const b=this.isVideoContiguous;let A=-1,L;if(R&&(A=nd(e.samples),!b&&this.config.forceKeyFrameOnDiscontinuity))if(p=!0,A>0){H.warn(`[mp4-remuxer]: Dropped ${A} out of ${O} video samples due to a missing keyframe`);const I=this.getVideoStartPts(e.samples);e.samples=e.samples.slice(A),e.dropped+=A,x+=(e.samples[0].pts-I)/e.inputTimeScale,L=x}else A===-1&&(H.warn(`[mp4-remuxer]: No keyframe found out of ${O} video samples`),p=!1);if(this.ISGenerated){if(T&&R){const I=this.getVideoStartPts(e.samples),F=(me(t.samples[0].pts,I)-I)/e.inputTimeScale;g+=Math.max(0,F),x+=Math.max(0,-F)}if(T){if(t.samplerate||(H.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),c=this.generateIS(t,e,s,n)),d=this.remuxAudio(t,g,this.isAudioContiguous,n,k||R||a===Tt.AUDIO?x:void 0),R){const I=d?d.endPTS-d.startPTS:0;e.inputTimeScale||(H.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),c=this.generateIS(t,e,s,n)),l=this.remuxVideo(e,x,b,I)}}else R&&(l=this.remuxVideo(e,x,b,0));l&&(l.firstKeyFrame=A,l.independent=A!==-1,l.firstKeyFramePTS=L)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(i.samples.length&&(h=zn(i,s,this._initPTS,this._initDTS)),r.samples.length&&(f=Hn(r,s,this._initPTS))),{audio:d,video:l,initSegment:c,independent:p,text:f,id3:h}}generateIS(t,e,i,r){const s=t.samples,n=e.samples,o=this.typeSupported,a={},l=this._initPTS;let d=!l||r,c="audio/mp4",f,h,p;if(d&&(f=h=1/0),t.config&&s.length){switch(t.timescale=t.samplerate,t.segmentCodec){case"mp3":o.mpeg?(c="audio/mpeg",t.codec=""):o.mp3&&(t.codec="mp3");break}a.audio={id:"audio",container:c,codec:t.codec,initSegment:t.segmentCodec==="mp3"&&o.mpeg?new Uint8Array(0):Z.initSegment([t]),metadata:{channelCount:t.channelCount}},d&&(p=t.inputTimeScale,!l||p!==l.timescale?f=h=s[0].pts-Math.round(p*i):d=!1)}if(e.sps&&e.pps&&n.length&&(e.timescale=e.inputTimeScale,a.video={id:"main",container:"video/mp4",codec:e.codec,initSegment:Z.initSegment([e]),metadata:{width:e.width,height:e.height}},d))if(p=e.inputTimeScale,!l||p!==l.timescale){const g=this.getVideoStartPts(n),x=Math.round(p*i);h=Math.min(h,me(n[0].dts,g)-x),f=Math.min(f,g-x)}else d=!1;if(Object.keys(a).length)return this.ISGenerated=!0,d?(this._initPTS={baseTime:f,timescale:p},this._initDTS={baseTime:h,timescale:p}):f=p=void 0,{tracks:a,initPTS:f,timescale:p}}remuxVideo(t,e,i,r){const s=t.inputTimeScale,n=t.samples,o=[],a=n.length,l=this._initPTS;let d=this.nextAvcDts,c=8,f=this.videoSampleDuration,h,p,g=Number.POSITIVE_INFINITY,x=Number.NEGATIVE_INFINITY,E=!1;if(!i||d===null){const w=e*s,P=n[0].pts-me(n[0].dts,n[0].pts);d=w-P}const k=l.baseTime*s/l.timescale;for(let w=0;w<a;w++){const P=n[w];P.pts=me(P.pts-k,d),P.dts=me(P.dts-k,d),P.dts<n[w>0?w-1:w].dts&&(E=!0)}E&&n.sort(function(w,P){const G=w.dts-P.dts,et=w.pts-P.pts;return G||et}),h=n[0].dts,p=n[n.length-1].dts;const O=p-h,T=O?Math.round(O/(a-1)):f||t.inputTimeScale/30;if(i){const w=h-d,P=w>T,G=w<-1;if((P||G)&&(P?H.warn(`AVC: ${ui(w,!0)} ms (${w}dts) hole between fragments detected, filling it`):H.warn(`AVC: ${ui(-w,!0)} ms (${w}dts) overlapping between fragments detected`),!G||d>=n[0].pts)){h=d;const et=n[0].pts-w;n[0].dts=h,n[0].pts=et,H.log(`Video: First PTS/DTS adjusted: ${ui(et,!0)}/${ui(h,!0)}, delta: ${ui(w,!0)} ms`)}}h=Math.max(0,h);let R=0,C=0;for(let w=0;w<a;w++){const P=n[w],G=P.units,et=G.length;let rt=0;for(let dt=0;dt<et;dt++)rt+=G[dt].data.length;C+=rt,R+=et,P.length=rt,P.dts=Math.max(P.dts,h),g=Math.min(P.pts,g),x=Math.max(P.pts,x)}p=n[a-1].dts;const b=C+4*R+8;let A;try{A=new Uint8Array(b)}catch(w){this.observer.emit(D.ERROR,D.ERROR,{type:bt.MUX_ERROR,details:tt.REMUX_ALLOC_ERROR,fatal:!1,error:w,bytes:b,reason:`fail allocating video mdat ${b}`});return}const L=new DataView(A.buffer);L.setUint32(0,b),A.set(Z.types.mdat,4);let I=!1,j=Number.POSITIVE_INFINITY,F=Number.POSITIVE_INFINITY,$=Number.NEGATIVE_INFINITY,V=Number.NEGATIVE_INFINITY;for(let w=0;w<a;w++){const P=n[w],G=P.units;let et=0;for(let vt=0,Lt=G.length;vt<Lt;vt++){const xt=G[vt],it=xt.data,at=xt.data.byteLength;L.setUint32(c,at),c+=4,A.set(it,c),c+=at,et+=4+at}let rt;if(w<a-1)f=n[w+1].dts-P.dts,rt=n[w+1].pts-P.pts;else{const vt=this.config,Lt=w>0?P.dts-n[w-1].dts:T;if(rt=w>0?P.pts-n[w-1].pts:T,vt.stretchShortVideoTrack&&this.nextAudioPts!==null){const xt=Math.floor(vt.maxBufferHole*s),it=(r?g+r*s:this.nextAudioPts)-P.pts;it>xt?(f=it-Lt,f<0?f=Lt:I=!0,H.log(`[mp4-remuxer]: It is approximately ${it/90} ms to the next segment; using duration ${f/90} ms for the last video frame.`)):f=Lt}else f=Lt}const dt=Math.round(P.pts-P.dts);j=Math.min(j,f),$=Math.max($,f),F=Math.min(F,rt),V=Math.max(V,rt),o.push(new $s(P.key,f,et,dt))}if(o.length){if(Ri){if(Ri<70){const w=o[0].flags;w.dependsOn=2,w.isNonSync=0}}else if(ur&&V-F<$-j&&T/$<.025&&o[0].cts===0){H.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let w=h;for(let P=0,G=o.length;P<G;P++){const et=w+o[P].duration,rt=w+o[P].cts;if(P<G-1){const dt=et+o[P+1].cts;o[P].duration=dt-rt}else o[P].duration=P?o[P-1].duration:T;o[P].cts=0,w=et}}}f=I||!f?T:f,this.nextAvcDts=d=p+f,this.videoSampleDuration=f,this.isVideoContiguous=!0;const Q=Z.moof(t.sequenceNumber++,h,Jt({},t,{samples:o})),z="video",B={data1:Q,data2:A,startPTS:g/s,endPTS:(x+f)/s,startDTS:h/s,endDTS:d/s,type:z,hasAudio:!1,hasVideo:!0,nb:o.length,dropped:t.dropped};return t.samples=[],t.dropped=0,B}remuxAudio(t,e,i,r,s){const n=t.inputTimeScale,o=t.samplerate?t.samplerate:n,a=n/o,l=t.segmentCodec==="aac"?js:sd,d=l*a,c=this._initPTS,f=t.segmentCodec==="mp3"&&this.typeSupported.mpeg,h=[],p=s!==void 0;let g=t.samples,x=f?0:8,E=this.nextAudioPts||-1;const k=e*n,O=c.baseTime*n/c.timescale;if(this.isAudioContiguous=i=i||g.length&&E>0&&(r&&Math.abs(k-E)<9e3||Math.abs(me(g[0].pts-O,k)-E)<20*d),g.forEach(function(z){z.pts=me(z.pts-O,k)}),!i||E<0){if(g=g.filter(z=>z.pts>=0),!g.length)return;s===0?E=0:r&&!p?E=Math.max(0,k):E=g[0].pts}if(t.segmentCodec==="aac"){const z=this.config.maxAudioFramesDrift;for(let B=0,w=E;B<g.length;B++){const P=g[B],G=P.pts,et=G-w,rt=Math.abs(1e3*et/n);if(et<=-z*d&&p)B===0&&(H.warn(`Audio frame @ ${(G/n).toFixed(3)}s overlaps nextAudioPts by ${Math.round(1e3*et/n)} ms.`),this.nextAudioPts=E=w=G);else if(et>=z*d&&rt<rd&&p){let dt=Math.round(et/d);w=G-dt*d,w<0&&(dt--,w+=d),B===0&&(this.nextAudioPts=E=w),H.warn(`[mp4-remuxer]: Injecting ${dt} audio frame @ ${(w/n).toFixed(3)}s due to ${Math.round(1e3*et/n)} ms gap.`);for(let vt=0;vt<dt;vt++){const Lt=Math.max(w,0);let xt=Us.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);xt||(H.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),xt=P.unit.subarray()),g.splice(B,0,{unit:xt,pts:Lt}),w+=d,B++}}P.pts=w,w+=d}}let T=null,R=null,C,b=0,A=g.length;for(;A--;)b+=g[A].unit.byteLength;for(let z=0,B=g.length;z<B;z++){const w=g[z],P=w.unit;let G=w.pts;if(R!==null){const rt=h[z-1];rt.duration=Math.round((G-R)/a)}else if(i&&t.segmentCodec==="aac"&&(G=E),T=G,b>0){b+=x;try{C=new Uint8Array(b)}catch(rt){this.observer.emit(D.ERROR,D.ERROR,{type:bt.MUX_ERROR,details:tt.REMUX_ALLOC_ERROR,fatal:!1,error:rt,bytes:b,reason:`fail allocating audio mdat ${b}`});return}f||(new DataView(C.buffer).setUint32(0,b),C.set(Z.types.mdat,4))}else return;C.set(P,x);const et=P.byteLength;x+=et,h.push(new $s(!0,l,et,0)),R=G}const L=h.length;if(!L)return;const I=h[h.length-1];this.nextAudioPts=E=R+a*I.duration;const j=f?new Uint8Array(0):Z.moof(t.sequenceNumber++,T/a,Jt({},t,{samples:h}));t.samples=[];const F=T/n,$=E/n,Q={data1:j,data2:C,startPTS:F,endPTS:$,startDTS:F,endDTS:$,type:"audio",hasAudio:!0,hasVideo:!1,nb:L};return this.isAudioContiguous=!0,Q}remuxEmptyAudio(t,e,i,r){const s=t.inputTimeScale,n=t.samplerate?t.samplerate:s,o=s/n,a=this.nextAudioPts,l=this._initDTS,d=l.baseTime*9e4/l.timescale,c=(a!==null?a:r.startDTS*s)+d,f=r.endDTS*s+d,h=o*js,p=Math.ceil((f-c)/h),g=Us.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);if(H.warn("[mp4-remuxer]: remux empty Audio"),!g){H.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}const x=[];for(let E=0;E<p;E++){const k=c+E*h;x.push({unit:g,pts:k,dts:k})}return t.samples=x,this.remuxAudio(t,e,i,!1)}}function me(u,t){let e;if(t===null)return u;for(t<u?e=-8589934592:e=8589934592;Math.abs(u-t)>4294967296;)u+=e;return u}function nd(u){for(let t=0;t<u.length;t++)if(u[t].key)return t;return-1}function zn(u,t,e,i){const r=u.samples.length;if(!r)return;const s=u.inputTimeScale;for(let o=0;o<r;o++){const a=u.samples[o];a.pts=me(a.pts-e.baseTime*s/e.timescale,t*s)/s,a.dts=me(a.dts-i.baseTime*s/i.timescale,t*s)/s}const n=u.samples;return u.samples=[],{samples:n}}function Hn(u,t,e){const i=u.samples.length;if(!i)return;const r=u.inputTimeScale;for(let n=0;n<i;n++){const o=u.samples[n];o.pts=me(o.pts-e.baseTime*9e4/e.timescale,t*r)/r}u.samples.sort((n,o)=>n.pts-o.pts);const s=u.samples;return u.samples=[],{samples:s}}class $s{constructor(t,e,i,r){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=e,this.size=i,this.cts=r,this.flags=new ad(t)}}class ad{constructor(t){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=t?2:1,this.isNonSync=t?0:1}}class od{constructor(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null}destroy(){}resetTimeStamp(t){this.initPTS=t,this.lastEndTime=null}resetNextTimestamp(){this.lastEndTime=null}resetInitSegment(t,e,i,r){this.audioCodec=e,this.videoCodec=i,this.generateInitSegment(Io(t,r)),this.emitInitSegment=!0}generateInitSegment(t){let{audioCodec:e,videoCodec:i}=this;if(!(t!=null&&t.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const r=this.initData=xn(t);e||(e=Gs(r.audio,Bt.AUDIO)),i||(i=Gs(r.video,Bt.VIDEO));const s={};r.audio&&r.video?s.audiovideo={container:"video/mp4",codec:e+","+i,initSegment:t,id:"main"}:r.audio?s.audio={container:"audio/mp4",codec:e,initSegment:t,id:"audio"}:r.video?s.video={container:"video/mp4",codec:i,initSegment:t,id:"main"}:H.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=s}remux(t,e,i,r,s,n){var o,a;let{initPTS:l,lastEndTime:d}=this;const c={audio:void 0,video:void 0,text:r,id3:i,initSegment:void 0};_t(d)||(d=this.lastEndTime=s||0);const f=e.samples;if(!(f!=null&&f.length))return c;const h={initPTS:void 0,timescale:1};let p=this.initData;if((o=p)!=null&&o.length||(this.generateInitSegment(f),p=this.initData),!((a=p)!=null&&a.length))return H.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),c;this.emitInitSegment&&(h.tracks=this.initTracks,this.emitInitSegment=!1);const g=Ro(f,p),x=wo(p,f),E=x===null?s:x;(ld(l,E,s,g)||h.timescale!==l.timescale&&n)&&(h.initPTS=E-s,l&&l.timescale===1&&H.warn(`Adjusting initPTS by ${h.initPTS-l.baseTime}`),this.initPTS=l={baseTime:h.initPTS,timescale:1});const k=t?E-l.baseTime/l.timescale:d,O=k+g;ko(p,f,l.baseTime/l.timescale),g>0?this.lastEndTime=O:(H.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const T=!!p.audio,R=!!p.video;let C="";T&&(C+="audio"),R&&(C+="video");const b={data1:f,startPTS:k,startDTS:k,endPTS:O,endDTS:O,type:C,hasAudio:T,hasVideo:R,nb:1,dropped:0};return c.audio=b.type==="audio"?b:void 0,c.video=b.type!=="audio"?b:void 0,c.initSegment=h,c.id3=zn(i,s,l,l),r.samples.length&&(c.text=Hn(r,s,l)),c}}function ld(u,t,e,i){if(u===null)return!0;const r=Math.max(i,1),s=t-u.baseTime/u.timescale;return Math.abs(s-e)>r}function Gs(u,t){const e=u==null?void 0:u.codec;return e&&e.length>4?e:e==="hvc1"||e==="hev1"?"hvc1.1.6.L120.90":e==="av01"?"av01.0.04M.08":e==="avc1"||t===Bt.VIDEO?"avc1.42e01e":"mp4a.40.5"}let Fe;try{Fe=self.performance.now.bind(self.performance)}catch(u){H.debug("Unable to use Performance API on this environment"),Fe=typeof self!="undefined"&&self.Date.now}const fr=[{demux:zl,remux:od},{demux:ze,remux:hr},{demux:Gl,remux:hr},{demux:td,remux:hr}];class Vs{constructor(t,e,i,r,s){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=t,this.typeSupported=e,this.config=i,this.vendor=r,this.id=s}configure(t){this.transmuxConfig=t,this.decrypter&&this.decrypter.reset()}push(t,e,i,r){const s=i.transmuxing;s.executeStart=Fe();let n=new Uint8Array(t);const{currentTransmuxState:o,transmuxConfig:a}=this;r&&(this.currentTransmuxState=r);const{contiguous:l,discontinuity:d,trackSwitch:c,accurateTimeOffset:f,timeOffset:h,initSegmentChange:p}=r||o,{audioCodec:g,videoCodec:x,defaultInitPts:E,duration:k,initSegmentData:O}=a,T=dd(n,e);if(T&&T.method==="AES-128"){const A=this.getDecrypter();if(A.isSync()){let L=A.softwareDecrypt(n,T.key.buffer,T.iv.buffer);if(i.part>-1&&(L=A.flush()),!L)return s.executeEnd=Fe(),pr(i);n=new Uint8Array(L)}else return this.decryptionPromise=A.webCryptoDecrypt(n,T.key.buffer,T.iv.buffer).then(L=>{const I=this.push(L,null,i);return this.decryptionPromise=null,I}),this.decryptionPromise}const R=this.needsProbing(d,c);if(R){const A=this.configureTransmuxer(n);if(A)return H.warn(`[transmuxer] ${A.message}`),this.observer.emit(D.ERROR,D.ERROR,{type:bt.MEDIA_ERROR,details:tt.FRAG_PARSING_ERROR,fatal:!1,error:A,reason:A.message}),s.executeEnd=Fe(),pr(i)}(d||c||p||R)&&this.resetInitSegment(O,g,x,k,e),(d||p||R)&&this.resetInitialTimestamp(E),l||this.resetContiguity();const C=this.transmux(n,T,h,f,i),b=this.currentTransmuxState;return b.contiguous=!0,b.discontinuity=!1,b.trackSwitch=!1,s.executeEnd=Fe(),C}flush(t){const e=t.transmuxing;e.executeStart=Fe();const{decrypter:i,currentTransmuxState:r,decryptionPromise:s}=this;if(s)return s.then(()=>this.flush(t));const n=[],{timeOffset:o}=r;if(i){const c=i.flush();c&&n.push(this.push(c,null,t))}const{demuxer:a,remuxer:l}=this;if(!a||!l)return e.executeEnd=Fe(),[pr(t)];const d=a.flush(o);return Mi(d)?d.then(c=>(this.flushRemux(n,c,t),n)):(this.flushRemux(n,d,t),n)}flushRemux(t,e,i){const{audioTrack:r,videoTrack:s,id3Track:n,textTrack:o}=e,{accurateTimeOffset:a,timeOffset:l}=this.currentTransmuxState;H.log(`[transmuxer.ts]: Flushed fragment ${i.sn}${i.part>-1?" p: "+i.part:""} of level ${i.level}`);const d=this.remuxer.remux(r,s,n,o,l,a,!0,this.id);t.push({remuxResult:d,chunkMeta:i}),i.transmuxing.executeEnd=Fe()}resetInitialTimestamp(t){const{demuxer:e,remuxer:i}=this;!e||!i||(e.resetTimeStamp(t),i.resetTimeStamp(t))}resetContiguity(){const{demuxer:t,remuxer:e}=this;!t||!e||(t.resetContiguity(),e.resetNextTimestamp())}resetInitSegment(t,e,i,r,s){const{demuxer:n,remuxer:o}=this;!n||!o||(n.resetInitSegment(t,e,i,r),o.resetInitSegment(t,e,i,s))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(t,e,i,r,s){let n;return e&&e.method==="SAMPLE-AES"?n=this.transmuxSampleAes(t,e,i,r,s):n=this.transmuxUnencrypted(t,i,r,s),n}transmuxUnencrypted(t,e,i,r){const{audioTrack:s,videoTrack:n,id3Track:o,textTrack:a}=this.demuxer.demux(t,e,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(s,n,o,a,e,i,!1,this.id),chunkMeta:r}}transmuxSampleAes(t,e,i,r,s){return this.demuxer.demuxSampleAes(t,e,i).then(n=>({remuxResult:this.remuxer.remux(n.audioTrack,n.videoTrack,n.id3Track,n.textTrack,i,r,!1,this.id),chunkMeta:s}))}configureTransmuxer(t){const{config:e,observer:i,typeSupported:r,vendor:s}=this;let n;for(let c=0,f=fr.length;c<f;c++)if(fr[c].demux.probe(t)){n=fr[c];break}if(!n)return new Error("Failed to find demuxer by probing fragment data");const o=this.demuxer,a=this.remuxer,l=n.remux,d=n.demux;(!a||!(a instanceof l))&&(this.remuxer=new l(i,e,r,s)),(!o||!(o instanceof d))&&(this.demuxer=new d(i,e,r),this.probe=d.probe)}needsProbing(t,e){return!this.demuxer||!this.remuxer||t||e}getDecrypter(){let t=this.decrypter;return t||(t=this.decrypter=new Vr(this.config)),t}}function dd(u,t){let e=null;return u.byteLength>0&&t!=null&&t.key!=null&&t.iv!==null&&t.method!=null&&(e=t),e}const pr=u=>({remuxResult:{},chunkMeta:u});function Mi(u){return"then"in u&&u.then instanceof Function}class cd{constructor(t,e,i,r,s){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=t,this.videoCodec=e,this.initSegmentData=i,this.duration=r,this.defaultInitPts=s||null}}class ud{constructor(t,e,i,r,s,n){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=t,this.contiguous=e,this.accurateTimeOffset=i,this.trackSwitch=r,this.timeOffset=s,this.initSegmentChange=n}}var Kn={exports:{}};(function(u){var t=Object.prototype.hasOwnProperty,e="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(e=!1));function r(a,l,d){this.fn=a,this.context=l,this.once=d||!1}function s(a,l,d,c,f){if(typeof d!="function")throw new TypeError("The listener must be a function");var h=new r(d,c||a,f),p=e?e+l:l;return a._events[p]?a._events[p].fn?a._events[p]=[a._events[p],h]:a._events[p].push(h):(a._events[p]=h,a._eventsCount++),a}function n(a,l){--a._eventsCount===0?a._events=new i:delete a._events[l]}function o(){this._events=new i,this._eventsCount=0}o.prototype.eventNames=function(){var l=[],d,c;if(this._eventsCount===0)return l;for(c in d=this._events)t.call(d,c)&&l.push(e?c.slice(1):c);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(d)):l},o.prototype.listeners=function(l){var d=e?e+l:l,c=this._events[d];if(!c)return[];if(c.fn)return[c.fn];for(var f=0,h=c.length,p=new Array(h);f<h;f++)p[f]=c[f].fn;return p},o.prototype.listenerCount=function(l){var d=e?e+l:l,c=this._events[d];return c?c.fn?1:c.length:0},o.prototype.emit=function(l,d,c,f,h,p){var g=e?e+l:l;if(!this._events[g])return!1;var x=this._events[g],E=arguments.length,k,O;if(x.fn){switch(x.once&&this.removeListener(l,x.fn,void 0,!0),E){case 1:return x.fn.call(x.context),!0;case 2:return x.fn.call(x.context,d),!0;case 3:return x.fn.call(x.context,d,c),!0;case 4:return x.fn.call(x.context,d,c,f),!0;case 5:return x.fn.call(x.context,d,c,f,h),!0;case 6:return x.fn.call(x.context,d,c,f,h,p),!0}for(O=1,k=new Array(E-1);O<E;O++)k[O-1]=arguments[O];x.fn.apply(x.context,k)}else{var T=x.length,R;for(O=0;O<T;O++)switch(x[O].once&&this.removeListener(l,x[O].fn,void 0,!0),E){case 1:x[O].fn.call(x[O].context);break;case 2:x[O].fn.call(x[O].context,d);break;case 3:x[O].fn.call(x[O].context,d,c);break;case 4:x[O].fn.call(x[O].context,d,c,f);break;default:if(!k)for(R=1,k=new Array(E-1);R<E;R++)k[R-1]=arguments[R];x[O].fn.apply(x[O].context,k)}}return!0},o.prototype.on=function(l,d,c){return s(this,l,d,c,!1)},o.prototype.once=function(l,d,c){return s(this,l,d,c,!0)},o.prototype.removeListener=function(l,d,c,f){var h=e?e+l:l;if(!this._events[h])return this;if(!d)return n(this,h),this;var p=this._events[h];if(p.fn)p.fn===d&&(!f||p.once)&&(!c||p.context===c)&&n(this,h);else{for(var g=0,x=[],E=p.length;g<E;g++)(p[g].fn!==d||f&&!p[g].once||c&&p[g].context!==c)&&x.push(p[g]);x.length?this._events[h]=x.length===1?x[0]:x:n(this,h)}return this},o.prototype.removeAllListeners=function(l){var d;return l?(d=e?e+l:l,this._events[d]&&n(this,d)):(this._events=new i,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=e,o.EventEmitter=o,u.exports=o})(Kn);var hd=Kn.exports,Yr=Za(hd);const mr=zi()||{isTypeSupported:()=>!1};class Wn{constructor(t,e,i,r){this.error=null,this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;const s=t.config;this.hls=t,this.id=e,this.useWorker=!!s.enableWorker,this.onTransmuxComplete=i,this.onFlush=r;const n=(l,d)=>{d=d||{},d.frag=this.frag,d.id=this.id,l===D.ERROR&&(this.error=d.error),this.hls.trigger(l,d)};this.observer=new Yr,this.observer.on(D.FRAG_DECRYPTED,n),this.observer.on(D.ERROR,n);const o={mp4:mr.isTypeSupported("video/mp4"),mpeg:mr.isTypeSupported("audio/mpeg"),mp3:mr.isTypeSupported('audio/mp4; codecs="mp3"')},a=navigator.vendor;if(this.useWorker&&typeof Worker!="undefined"&&(s.workerPath||Ml())){try{s.workerPath?(H.log(`loading Web Worker ${s.workerPath} for "${e}"`),this.workerContext=Ol(s.workerPath)):(H.log(`injecting Web Worker for "${e}"`),this.workerContext=Pl()),this.onwmsg=c=>this.onWorkerMessage(c);const{worker:d}=this.workerContext;d.addEventListener("message",this.onwmsg),d.onerror=c=>{const f=new Error(`${c.message}  (${c.filename}:${c.lineno})`);s.enableWorker=!1,H.warn(`Error in "${e}" Web Worker, fallback to inline`),this.hls.trigger(D.ERROR,{type:bt.OTHER_ERROR,details:tt.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:f})},d.postMessage({cmd:"init",typeSupported:o,vendor:a,id:e,config:JSON.stringify(s)})}catch(d){H.warn(`Error setting up "${e}" Web Worker, fallback to inline`,d),this.resetWorker(),this.error=null,this.transmuxer=new Vs(this.observer,o,s,a,e)}return}this.transmuxer=new Vs(this.observer,o,s,a,e)}resetWorker(){if(this.workerContext){const{worker:t,objectURL:e}=this.workerContext;e&&self.URL.revokeObjectURL(e),t.removeEventListener("message",this.onwmsg),t.onerror=null,t.terminate(),this.workerContext=null}}destroy(){if(this.workerContext)this.resetWorker(),this.onwmsg=void 0;else{const e=this.transmuxer;e&&(e.destroy(),this.transmuxer=null)}const t=this.observer;t&&t.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null}push(t,e,i,r,s,n,o,a,l,d){var c,f;l.transmuxing.start=self.performance.now();const{transmuxer:h}=this,p=n?n.start:s.start,g=s.decryptdata,x=this.frag,E=!(x&&s.cc===x.cc),k=!(x&&l.level===x.level),O=x?l.sn-x.sn:-1,T=this.part?l.part-this.part.index:-1,R=O===0&&l.id>1&&l.id===(x==null?void 0:x.stats.chunkCount),C=!k&&(O===1||O===0&&(T===1||R&&T<=0)),b=self.performance.now();(k||O||s.stats.parsing.start===0)&&(s.stats.parsing.start=b),n&&(T||!C)&&(n.stats.parsing.start=b);const A=!(x&&((c=s.initSegment)==null?void 0:c.url)===((f=x.initSegment)==null?void 0:f.url)),L=new ud(E,C,a,k,p,A);if(!C||E||A){H.log(`[transmuxer-interface, ${s.type}]: Starting new transmux session for sn: ${l.sn} p: ${l.part} level: ${l.level} id: ${l.id}
        discontinuity: ${E}
        trackSwitch: ${k}
        contiguous: ${C}
        accurateTimeOffset: ${a}
        timeOffset: ${p}
        initSegmentChange: ${A}`);const I=new cd(i,r,e,o,d);this.configureTransmuxer(I)}if(this.frag=s,this.part=n,this.workerContext)this.workerContext.worker.postMessage({cmd:"demux",data:t,decryptdata:g,chunkMeta:l,state:L},t instanceof ArrayBuffer?[t]:[]);else if(h){const I=h.push(t,g,l,L);Mi(I)?(h.async=!0,I.then(j=>{this.handleTransmuxComplete(j)}).catch(j=>{this.transmuxerError(j,l,"transmuxer-interface push error")})):(h.async=!1,this.handleTransmuxComplete(I))}}flush(t){t.transmuxing.start=self.performance.now();const{transmuxer:e}=this;if(this.workerContext)this.workerContext.worker.postMessage({cmd:"flush",chunkMeta:t});else if(e){let i=e.flush(t);Mi(i)||e.async?(Mi(i)||(i=Promise.resolve(i)),i.then(s=>{this.handleFlushResult(s,t)}).catch(s=>{this.transmuxerError(s,t,"transmuxer-interface flush error")})):this.handleFlushResult(i,t)}}transmuxerError(t,e,i){!this.hls||(this.error=t,this.hls.trigger(D.ERROR,{type:bt.MEDIA_ERROR,details:tt.FRAG_PARSING_ERROR,chunkMeta:e,fatal:!1,error:t,err:t,reason:i}))}handleFlushResult(t,e){t.forEach(i=>{this.handleTransmuxComplete(i)}),this.onFlush(e)}onWorkerMessage(t){const e=t.data,i=this.hls;switch(e.event){case"init":{var r;const s=(r=this.workerContext)==null?void 0:r.objectURL;s&&self.URL.revokeObjectURL(s);break}case"transmuxComplete":{this.handleTransmuxComplete(e.data);break}case"flush":{this.onFlush(e.data);break}case"workerLog":H[e.data.logType]&&H[e.data.logType](e.data.message);break;default:{e.data=e.data||{},e.data.frag=this.frag,e.data.id=this.id,i.trigger(e.event,e.data);break}}}configureTransmuxer(t){const{transmuxer:e}=this;this.workerContext?this.workerContext.worker.postMessage({cmd:"configure",config:t}):e&&e.configure(t)}handleTransmuxComplete(t){t.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(t)}}const fd=250,gr=2,pd=.1,md=.05;class gd{constructor(t,e,i,r){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=t,this.media=e,this.fragmentTracker=i,this.hls=r}destroy(){this.media=null,this.hls=this.fragmentTracker=null}poll(t,e){const{config:i,media:r,stalled:s}=this;if(r===null)return;const{currentTime:n,seeking:o}=r,a=this.seeking&&!o,l=!this.seeking&&o;if(this.seeking=o,n!==t){if(this.moved=!0,s!==null){if(this.stallReported){const E=self.performance.now()-s;H.warn(`playback not stuck anymore @${n}, after ${Math.round(E)}ms`),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}return}if(l||a){this.stalled=null;return}if(r.paused&&!o||r.ended||r.playbackRate===0||!$t.getBuffered(r).length)return;const d=$t.bufferInfo(r,n,0),c=d.len>0,f=d.nextStart||0;if(!c&&!f)return;if(o){const E=d.len>gr,k=!f||e&&e.start<=n||f-n>gr&&!this.fragmentTracker.getPartialFragment(n);if(E||k)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var h;const E=Math.max(f,d.start||0)-n,k=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,T=(k==null||(h=k.details)==null?void 0:h.live)?k.details.targetduration*2:gr,R=this.fragmentTracker.getPartialFragment(n);if(E>0&&(E<=T||R)){this._trySkipBufferHole(R);return}}const p=self.performance.now();if(s===null){this.stalled=p;return}const g=p-s;if(!o&&g>=fd&&(this._reportStall(d),!this.media))return;const x=$t.bufferInfo(r,n,i.maxBufferHole);this._tryFixBufferStall(x,g)}_tryFixBufferStall(t,e){const{config:i,fragmentTracker:r,media:s}=this;if(s===null)return;const n=s.currentTime,o=r.getPartialFragment(n);o&&(this._trySkipBufferHole(o)||!this.media)||(t.len>i.maxBufferHole||t.nextStart&&t.nextStart-n<i.maxBufferHole)&&e>i.highBufferWatchdogPeriod*1e3&&(H.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}_reportStall(t){const{hls:e,media:i,stallReported:r}=this;if(!r&&i){this.stallReported=!0;const s=new Error(`Playback stalling at @${i.currentTime} due to low buffer (${JSON.stringify(t)})`);H.warn(s.message),e.trigger(D.ERROR,{type:bt.MEDIA_ERROR,details:tt.BUFFER_STALLED_ERROR,fatal:!1,error:s,buffer:t.len})}}_trySkipBufferHole(t){const{config:e,hls:i,media:r}=this;if(r===null)return 0;const s=r.currentTime,n=$t.bufferInfo(r,s,0),o=s<n.start?n.start:n.nextStart;if(o){const a=n.len<=e.maxBufferHole,l=n.len>0&&n.len<1&&r.readyState<3,d=o-s;if(d>0&&(a||l)){if(d>e.maxBufferHole){const{fragmentTracker:f}=this;let h=!1;if(s===0){const p=f.getAppendedFrag(0,Tt.MAIN);p&&o<p.end&&(h=!0)}if(!h){const p=t||f.getAppendedFrag(s,Tt.MAIN);if(p){let g=!1,x=p.end;for(;x<o;){const E=f.getPartialFragment(x);if(E)x+=E.duration;else{g=!0;break}}if(g)return 0}}}const c=Math.max(o+md,s+pd);if(H.warn(`skipping hole, adjusting currentTime from ${s} to ${c}`),this.moved=!0,this.stalled=null,r.currentTime=c,t&&!t.gap){const f=new Error(`fragment loaded with buffer holes, seeking from ${s} to ${c}`);i.trigger(D.ERROR,{type:bt.MEDIA_ERROR,details:tt.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:f,reason:f.message,frag:t})}return c}}return 0}_tryNudgeBuffer(){const{config:t,hls:e,media:i,nudgeRetry:r}=this;if(i===null)return;const s=i.currentTime;if(this.nudgeRetry++,r<t.nudgeMaxRetry){const n=s+(r+1)*t.nudgeOffset,o=new Error(`Nudging 'currentTime' from ${s} to ${n}`);H.warn(o.message),i.currentTime=n,e.trigger(D.ERROR,{type:bt.MEDIA_ERROR,details:tt.BUFFER_NUDGE_ON_STALL,error:o,fatal:!1})}else{const n=new Error(`Playhead still not moving while enough data buffered @${s} after ${t.nudgeMaxRetry} nudges`);H.error(n.message),e.trigger(D.ERROR,{type:bt.MEDIA_ERROR,details:tt.BUFFER_STALLED_ERROR,error:n,fatal:!0})}}}const yd=100;class vd extends zr{constructor(t,e,i){super(t,e,i,"[stream-controller]",Tt.MAIN),this.audioCodecSwap=!1,this.gapController=null,this.level=-1,this._forceStartLoad=!1,this.altAudio=!1,this.audioOnly=!1,this.fragPlaying=null,this.onvplaying=null,this.onvseeked=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this._registerListeners()}_registerListeners(){const{hls:t}=this;t.on(D.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(D.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(D.MANIFEST_LOADING,this.onManifestLoading,this),t.on(D.MANIFEST_PARSED,this.onManifestParsed,this),t.on(D.LEVEL_LOADING,this.onLevelLoading,this),t.on(D.LEVEL_LOADED,this.onLevelLoaded,this),t.on(D.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.on(D.ERROR,this.onError,this),t.on(D.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(D.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.on(D.BUFFER_CREATED,this.onBufferCreated,this),t.on(D.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(D.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(D.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:t}=this;t.off(D.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(D.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(D.MANIFEST_LOADING,this.onManifestLoading,this),t.off(D.MANIFEST_PARSED,this.onManifestParsed,this),t.off(D.LEVEL_LOADED,this.onLevelLoaded,this),t.off(D.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.off(D.ERROR,this.onError,this),t.off(D.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(D.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.off(D.BUFFER_CREATED,this.onBufferCreated,this),t.off(D.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(D.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(D.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this._unregisterListeners(),this.onMediaDetaching()}startLoad(t){if(this.levels){const{lastCurrentTime:e,hls:i}=this;if(this.stopLoad(),this.setInterval(yd),this.level=-1,!this.startFragRequested){let r=i.startLevel;r===-1&&(i.config.testBandwidth&&this.levels.length>1?(r=0,this.bitrateTest=!0):r=i.nextAutoLevel),this.level=i.nextLoadLevel=r,this.loadedmetadata=!1}e>0&&t===-1&&(this.log(`Override startPosition with lastCurrentTime @${e.toFixed(3)}`),t=e),this.state=nt.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()}else this._forceStartLoad=!0,this.state=nt.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case nt.WAITING_LEVEL:{var t;const{levels:i,level:r}=this,s=i==null||(t=i[r])==null?void 0:t.details;if(s&&(!s.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(s))break;this.state=nt.IDLE;break}break}case nt.FRAG_LOADING_WAITING_RETRY:{var e;const i=self.performance.now(),r=this.retryDate;(!r||i>=r||(e=this.media)!=null&&e.seeking)&&(this.resetStartWhenNotLoaded(this.level),this.state=nt.IDLE)}break}this.state===nt.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){super.onTickEnd(),this.checkBuffer(),this.checkFragmentChanged()}doTickIdle(){const{hls:t,levelLastLoaded:e,levels:i,media:r}=this,{config:s,nextLoadLevel:n}=t;if(e===null||!r&&(this.startFragRequested||!s.startFragPrefetch)||this.altAudio&&this.audioOnly||!(i!=null&&i[n]))return;const o=i[n],a=this.getMainFwdBufferInfo();if(a===null)return;const l=this.getLevelDetails();if(l&&this._streamEnded(a,l)){const x={};this.altAudio&&(x.type="video"),this.hls.trigger(D.BUFFER_EOS,x),this.state=nt.ENDED;return}t.loadLevel!==n&&t.manualLevel===-1&&this.log(`Adapting to level ${n} from level ${this.level}`),this.level=t.nextLoadLevel=n;const d=o.details;if(!d||this.state===nt.WAITING_LEVEL||d.live&&this.levelLastLoaded!==n){this.level=n,this.state=nt.WAITING_LEVEL;return}const c=a.len,f=this.getMaxBufferLength(o.maxBitrate);if(c>=f)return;this.backtrackFragment&&this.backtrackFragment.start>a.end&&(this.backtrackFragment=null);const h=this.backtrackFragment?this.backtrackFragment.start:a.end;let p=this.getNextFragment(h,d);if(this.couldBacktrack&&!this.fragPrevious&&p&&p.sn!=="initSegment"&&this.fragmentTracker.getState(p)!==re.OK){var g;const E=((g=this.backtrackFragment)!=null?g:p).sn-d.startSN,k=d.fragments[E-1];k&&p.cc===k.cc&&(p=k,this.fragmentTracker.removeFragment(k))}else this.backtrackFragment&&a.len&&(this.backtrackFragment=null);if(p&&this.isLoopLoading(p,h)){if(!p.gap){const E=this.audioOnly&&!this.altAudio?Bt.AUDIO:Bt.VIDEO,k=(E===Bt.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;k&&this.afterBufferFlushed(k,E,Tt.MAIN)}p=this.getNextFragmentLoopLoading(p,d,a,Tt.MAIN,f)}!p||(p.initSegment&&!p.initSegment.data&&!this.bitrateTest&&(p=p.initSegment),this.loadFragment(p,o,h))}loadFragment(t,e,i){const r=this.fragmentTracker.getState(t);this.fragCurrent=t,r===re.NOT_LOADED||r===re.PARTIAL?t.sn==="initSegment"?this._loadInitSegment(t,e):this.bitrateTest?(this.log(`Fragment ${t.sn} of level ${t.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(t,e)):(this.startFragRequested=!0,super.loadFragment(t,e,i)):this.clearTrackerIfNeeded(t)}getBufferedFrag(t){return this.fragmentTracker.getBufferedFrag(t,Tt.MAIN)}followingBufferedFrag(t){return t?this.getBufferedFrag(t.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:t,media:e}=this;if(e!=null&&e.readyState){let i;const r=this.getAppendedFrag(e.currentTime);r&&r.start>1&&this.flushMainBuffer(0,r.start-1);const s=this.getLevelDetails();if(s!=null&&s.live){const o=this.getMainFwdBufferInfo();if(!o||o.len<s.targetduration*2)return}if(!e.paused&&t){const o=this.hls.nextLoadLevel,a=t[o],l=this.fragLastKbps;l&&this.fragCurrent?i=this.fragCurrent.duration*a.maxBitrate/(1e3*l)+1:i=0}else i=0;const n=this.getBufferedFrag(e.currentTime+i);if(n){const o=this.followingBufferedFrag(n);if(o){this.abortCurrentFrag();const a=o.maxStartPTS?o.maxStartPTS:o.start,l=o.duration,d=Math.max(n.end,a+Math.min(Math.max(l-this.config.maxFragLookUpTolerance,l*.5),l*.75));this.flushMainBuffer(d,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const t=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,t&&(t.abortRequests(),this.fragmentTracker.removeFragment(t)),this.state){case nt.KEY_LOADING:case nt.FRAG_LOADING:case nt.FRAG_LOADING_WAITING_RETRY:case nt.PARSING:case nt.PARSED:this.state=nt.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(t,e){super.flushMainBuffer(t,e,this.altAudio?"video":null)}onMediaAttached(t,e){super.onMediaAttached(t,e);const i=e.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),i.addEventListener("playing",this.onvplaying),i.addEventListener("seeked",this.onvseeked),this.gapController=new gd(this.config,i,this.fragmentTracker,this.hls)}onMediaDetaching(){const{media:t}=this;t&&this.onvplaying&&this.onvseeked&&(t.removeEventListener("playing",this.onvplaying),t.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),super.onMediaDetaching()}onMediaPlaying(){this.tick()}onMediaSeeked(){const t=this.media,e=t?t.currentTime:null;_t(e)&&this.log(`Media seeked to ${e.toFixed(3)}`);const i=this.getMainFwdBufferInfo();if(i===null||i.len===0){this.warn(`Main forward buffer length on "seeked" event ${i?i.len:"empty"})`);return}this.tick()}onManifestLoading(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(D.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.levels=this.fragPlaying=this.backtrackFragment=null,this.altAudio=this.audioOnly=!1}onManifestParsed(t,e){let i=!1,r=!1,s;e.levels.forEach(n=>{s=n.audioCodec,s&&(s.indexOf("mp4a.40.2")!==-1&&(i=!0),s.indexOf("mp4a.40.5")!==-1&&(r=!0))}),this.audioCodecSwitch=i&&r&&!Cl(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=e.levels,this.startFragRequested=!1}onLevelLoading(t,e){const{levels:i}=this;if(!i||this.state!==nt.IDLE)return;const r=i[e.level];(!r.details||r.details.live&&this.levelLastLoaded!==e.level||this.waitForCdnTuneIn(r.details))&&(this.state=nt.WAITING_LEVEL)}onLevelLoaded(t,e){var i;const{levels:r}=this,s=e.level,n=e.details,o=n.totalduration;if(!r){this.warn(`Levels were reset while loading level ${s}`);return}this.log(`Level ${s} loaded [${n.startSN},${n.endSN}]${n.lastPartSn?`[part-${n.lastPartSn}-${n.lastPartIndex}]`:""}, cc [${n.startCC}, ${n.endCC}] duration:${o}`);const a=r[s],l=this.fragCurrent;l&&(this.state===nt.FRAG_LOADING||this.state===nt.FRAG_LOADING_WAITING_RETRY)&&(l.level!==e.level||l.urlId!==a.urlId)&&l.loader&&this.abortCurrentFrag();let d=0;if(n.live||(i=a.details)!=null&&i.live){if(n.fragments[0]||(n.deltaUpdateFailed=!0),n.deltaUpdateFailed)return;d=this.alignPlaylists(n,a.details)}if(a.details=n,this.levelLastLoaded=s,this.hls.trigger(D.LEVEL_UPDATED,{details:n,level:s}),this.state===nt.WAITING_LEVEL){if(this.waitForCdnTuneIn(n))return;this.state=nt.IDLE}this.startFragRequested?n.live&&this.synchronizeToLiveEdge(n):this.setStartPosition(n,d),this.tick()}_handleFragmentLoadProgress(t){var e;const{frag:i,part:r,payload:s}=t,{levels:n}=this;if(!n){this.warn(`Levels were reset while fragment load was in progress. Fragment ${i.sn} of level ${i.level} will not be buffered`);return}const o=n[i.level],a=o.details;if(!a){this.warn(`Dropping fragment ${i.sn} of level ${i.level} after level details were reset`),this.fragmentTracker.removeFragment(i);return}const l=o.videoCodec,d=a.PTSKnown||!a.live,c=(e=i.initSegment)==null?void 0:e.data,f=this._getAudioCodec(o),h=this.transmuxer=this.transmuxer||new Wn(this.hls,Tt.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),p=r?r.index:-1,g=p!==-1,x=new $r(i.level,i.sn,i.stats.chunkCount,s.byteLength,p,g),E=this.initPTS[i.cc];h.push(s,c,f,l,i,r,a.totalduration,d,x,E)}onAudioTrackSwitching(t,e){const i=this.altAudio;if(!!!e.url){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const n=this.fragCurrent;n&&(this.log("Switching to main audio track, cancel main fragment load"),n.abortRequests(),this.fragmentTracker.removeFragment(n)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();const s=this.hls;i&&(s.trigger(D.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null}),this.fragmentTracker.removeAllFragments()),s.trigger(D.AUDIO_TRACK_SWITCHED,e)}}onAudioTrackSwitched(t,e){const i=e.id,r=!!this.hls.audioTracks[i].url;if(r){const s=this.videoBuffer;s&&this.mediaBuffer!==s&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=s)}this.altAudio=r,this.tick()}onBufferCreated(t,e){const i=e.tracks;let r,s,n=!1;for(const o in i){const a=i[o];if(a.id==="main"){if(s=o,r=a,o==="video"){const l=i[o];l&&(this.videoBuffer=l.buffer)}}else n=!0}n&&r?(this.log(`Alternate track found, use ${s}.buffered to schedule main fragment loading`),this.mediaBuffer=r.buffer):this.mediaBuffer=this.media}onFragBuffered(t,e){const{frag:i,part:r}=e;if(i&&i.type!==Tt.MAIN)return;if(this.fragContextChanged(i)){this.warn(`Fragment ${i.sn}${r?" p: "+r.index:""} of level ${i.level} finished buffering, but was aborted. state: ${this.state}`),this.state===nt.PARSED&&(this.state=nt.IDLE);return}const s=r?r.stats:i.stats;this.fragLastKbps=Math.round(8*s.total/(s.buffering.end-s.loading.first)),i.sn!=="initSegment"&&(this.fragPrevious=i),this.fragBufferedComplete(i,r)}onError(t,e){var i;if(e.fatal){this.state=nt.ERROR;return}switch(e.details){case tt.FRAG_GAP:case tt.FRAG_PARSING_ERROR:case tt.FRAG_DECRYPT_ERROR:case tt.FRAG_LOAD_ERROR:case tt.FRAG_LOAD_TIMEOUT:case tt.KEY_LOAD_ERROR:case tt.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Tt.MAIN,e);break;case tt.LEVEL_LOAD_ERROR:case tt.LEVEL_LOAD_TIMEOUT:case tt.LEVEL_PARSING_ERROR:!e.levelRetry&&this.state===nt.WAITING_LEVEL&&((i=e.context)==null?void 0:i.type)===Pt.LEVEL&&(this.state=nt.IDLE);break;case tt.BUFFER_FULL_ERROR:if(!e.parent||e.parent!=="main")return;this.reduceLengthAndFlushBuffer(e)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case tt.INTERNAL_EXCEPTION:this.recoverWorkerError(e);break}}checkBuffer(){const{media:t,gapController:e}=this;if(!(!t||!e||!t.readyState)){if(this.loadedmetadata||!$t.getBuffered(t).length){const i=this.state!==nt.IDLE?this.fragCurrent:null;e.poll(this.lastCurrentTime,i)}this.lastCurrentTime=t.currentTime}}onFragLoadEmergencyAborted(){this.state=nt.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()}onBufferFlushed(t,{type:e}){if(e!==Bt.AUDIO||this.audioOnly&&!this.altAudio){const i=(e===Bt.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(i,e,Tt.MAIN)}}onLevelsUpdated(t,e){this.levels=e.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:t}=this;if(!t)return;const e=t.currentTime;let i=this.startPosition;if(i>=0&&e<i){if(t.seeking){this.log(`could not seek to ${i}, already seeking at ${e}`);return}const r=$t.getBuffered(t),n=(r.length?r.start(0):0)-i;n>0&&(n<this.config.maxBufferHole||n<this.config.maxFragLookUpTolerance)&&(this.log(`adjusting start position by ${n} to match buffer start`),i+=n,this.startPosition=i),this.log(`seek to target start position ${i} from current time ${e}`),t.currentTime=i}}_getAudioCodec(t){let e=this.config.defaultAudioCodec||t.audioCodec;return this.audioCodecSwap&&e&&(this.log("Swapping audio codec"),e.indexOf("mp4a.40.5")!==-1?e="mp4a.40.2":e="mp4a.40.5"),e}_loadBitrateTestFrag(t,e){t.bitrateTest=!0,this._doFragLoad(t,e).then(i=>{const{hls:r}=this;if(!i||this.fragContextChanged(t))return;e.fragmentError=0,this.state=nt.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const s=t.stats;s.parsing.start=s.parsing.end=s.buffering.start=s.buffering.end=self.performance.now(),r.trigger(D.FRAG_LOADED,i),t.bitrateTest=!1})}_handleTransmuxComplete(t){var e;const i="main",{hls:r}=this,{remuxResult:s,chunkMeta:n}=t,o=this.getCurrentContext(n);if(!o){this.resetWhenMissingContext(n);return}const{frag:a,part:l,level:d}=o,{video:c,text:f,id3:h,initSegment:p}=s,{details:g}=d,x=this.altAudio?void 0:s.audio;if(this.fragContextChanged(a)){this.fragmentTracker.removeFragment(a);return}if(this.state=nt.PARSING,p){if(p!=null&&p.tracks){const O=a.initSegment||a;this._bufferInitSegment(d,p.tracks,O,n),r.trigger(D.FRAG_PARSING_INIT_SEGMENT,{frag:O,id:i,tracks:p.tracks})}const E=p.initPTS,k=p.timescale;_t(E)&&(this.initPTS[a.cc]={baseTime:E,timescale:k},r.trigger(D.INIT_PTS_FOUND,{frag:a,id:i,initPTS:E,timescale:k}))}if(c&&s.independent!==!1){if(g){const{startPTS:E,endPTS:k,startDTS:O,endDTS:T}=c;if(l)l.elementaryStreams[c.type]={startPTS:E,endPTS:k,startDTS:O,endDTS:T};else if(c.firstKeyFrame&&c.independent&&n.id===1&&(this.couldBacktrack=!0),c.dropped&&c.independent){const R=this.getMainFwdBufferInfo(),C=(R?R.end:this.getLoadPosition())+this.config.maxBufferHole,b=c.firstKeyFramePTS?c.firstKeyFramePTS:E;if(C<b-this.config.maxBufferHole){this.backtrack(a);return}a.setElementaryStreamInfo(c.type,a.start,k,a.start,T,!0)}a.setElementaryStreamInfo(c.type,E,k,O,T),this.backtrackFragment&&(this.backtrackFragment=a),this.bufferFragmentData(c,a,l,n)}}else if(s.independent===!1){this.backtrack(a);return}if(x){const{startPTS:E,endPTS:k,startDTS:O,endDTS:T}=x;l&&(l.elementaryStreams[Bt.AUDIO]={startPTS:E,endPTS:k,startDTS:O,endDTS:T}),a.setElementaryStreamInfo(Bt.AUDIO,E,k,O,T),this.bufferFragmentData(x,a,l,n)}if(g&&h!=null&&(e=h.samples)!=null&&e.length){const E={id:i,frag:a,details:g,samples:h.samples};r.trigger(D.FRAG_PARSING_METADATA,E)}if(g&&f){const E={id:i,frag:a,details:g,samples:f.samples};r.trigger(D.FRAG_PARSING_USERDATA,E)}}_bufferInitSegment(t,e,i,r){if(this.state!==nt.PARSING)return;this.audioOnly=!!e.audio&&!e.video,this.altAudio&&!this.audioOnly&&delete e.audio;const{audio:s,video:n,audiovideo:o}=e;if(s){let a=t.audioCodec;const l=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(a&&(a.indexOf("mp4a.40.5")!==-1?a="mp4a.40.2":a="mp4a.40.5"),s.metadata.channelCount!==1&&l.indexOf("firefox")===-1&&(a="mp4a.40.5")),l.indexOf("android")!==-1&&s.container!=="audio/mpeg"&&(a="mp4a.40.2",this.log(`Android: force audio codec to ${a}`)),t.audioCodec&&t.audioCodec!==a&&this.log(`Swapping manifest audio codec "${t.audioCodec}" for "${a}"`),s.levelCodec=a,s.id="main",this.log(`Init audio buffer, container:${s.container}, codecs[selected/level/parsed]=[${a||""}/${t.audioCodec||""}/${s.codec}]`)}n&&(n.levelCodec=t.videoCodec,n.id="main",this.log(`Init video buffer, container:${n.container}, codecs[level/parsed]=[${t.videoCodec||""}/${n.codec}]`)),o&&this.log(`Init audiovideo buffer, container:${o.container}, codecs[level/parsed]=[${t.attrs.CODECS||""}/${o.codec}]`),this.hls.trigger(D.BUFFER_CODECS,e),Object.keys(e).forEach(a=>{const d=e[a].initSegment;d!=null&&d.byteLength&&this.hls.trigger(D.BUFFER_APPENDING,{type:a,data:d,frag:i,part:null,chunkMeta:r,parent:i.type})}),this.tick()}getMainFwdBufferInfo(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,Tt.MAIN)}backtrack(t){this.couldBacktrack=!0,this.backtrackFragment=t,this.resetTransmuxer(),this.flushBufferGap(t),this.fragmentTracker.removeFragment(t),this.fragPrevious=null,this.nextLoadPosition=t.start,this.state=nt.IDLE}checkFragmentChanged(){const t=this.media;let e=null;if(t&&t.readyState>1&&t.seeking===!1){const i=t.currentTime;if($t.isBuffered(t,i)?e=this.getAppendedFrag(i):$t.isBuffered(t,i+.1)&&(e=this.getAppendedFrag(i+.1)),e){this.backtrackFragment=null;const r=this.fragPlaying,s=e.level;(!r||e.sn!==r.sn||r.level!==s||e.urlId!==r.urlId)&&(this.fragPlaying=e,this.hls.trigger(D.FRAG_CHANGED,{frag:e}),(!r||r.level!==s)&&this.hls.trigger(D.LEVEL_SWITCHED,{level:s}))}}}get nextLevel(){const t=this.nextBufferedFrag;return t?t.level:-1}get currentFrag(){const t=this.media;return t?this.fragPlaying||this.getAppendedFrag(t.currentTime):null}get currentProgramDateTime(){const t=this.media;if(t){const e=t.currentTime,i=this.currentFrag;if(i&&_t(e)&&_t(i.programDateTime)){const r=i.programDateTime+(e-i.start)*1e3;return new Date(r)}}return null}get currentLevel(){const t=this.currentFrag;return t?t.level:-1}get nextBufferedFrag(){const t=this.currentFrag;return t?this.followingBufferedFrag(t):null}get forceStartLoad(){return this._forceStartLoad}}class si{constructor(t,e=0,i=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=t,this.alpha_=t?Math.exp(Math.log(.5)/t):0,this.estimate_=e,this.totalWeight_=i}sample(t,e){const i=Math.pow(this.alpha_,t);this.estimate_=e*(1-i)+i*this.estimate_,this.totalWeight_+=t}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const t=1-Math.pow(this.alpha_,this.totalWeight_);if(t)return this.estimate_/t}return this.estimate_}}class _d{constructor(t,e,i,r=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=i,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new si(t),this.fast_=new si(e),this.defaultTTFB_=r,this.ttfb_=new si(t)}update(t,e){const{slow_:i,fast_:r,ttfb_:s}=this;i.halfLife!==t&&(this.slow_=new si(t,i.getEstimate(),i.getTotalWeight())),r.halfLife!==e&&(this.fast_=new si(e,r.getEstimate(),r.getTotalWeight())),s.halfLife!==t&&(this.ttfb_=new si(t,s.getEstimate(),s.getTotalWeight()))}sample(t,e){t=Math.max(t,this.minDelayMs_);const i=8*e,r=t/1e3,s=i/r;this.fast_.sample(r,s),this.slow_.sample(r,s)}sampleTTFB(t){const e=t/1e3,i=Math.sqrt(2)*Math.exp(-Math.pow(e,2)/2);this.ttfb_.sample(i,Math.max(t,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}destroy(){}}class xd{constructor(t){this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=-1,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=t;const e=t.config;this.bwEstimator=new _d(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate),this.registerListeners()}registerListeners(){const{hls:t}=this;t.on(D.FRAG_LOADING,this.onFragLoading,this),t.on(D.FRAG_LOADED,this.onFragLoaded,this),t.on(D.FRAG_BUFFERED,this.onFragBuffered,this),t.on(D.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(D.LEVEL_LOADED,this.onLevelLoaded,this)}unregisterListeners(){const{hls:t}=this;t.off(D.FRAG_LOADING,this.onFragLoading,this),t.off(D.FRAG_LOADED,this.onFragLoaded,this),t.off(D.FRAG_BUFFERED,this.onFragBuffered,this),t.off(D.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(D.LEVEL_LOADED,this.onLevelLoaded,this)}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null}onFragLoading(t,e){var i;const r=e.frag;this.ignoreFragment(r)||(this.fragCurrent=r,this.partCurrent=(i=e.part)!=null?i:null,this.clearTimer(),this.timer=self.setInterval(this.onCheck,100))}onLevelSwitching(t,e){this.clearTimer()}getTimeToLoadFrag(t,e,i,r){const s=t+i/e,n=r?this.lastLevelLoadSec:0;return s+n}onLevelLoaded(t,e){const i=this.hls.config,{total:r,bwEstimate:s}=e.stats;_t(r)&&_t(s)&&(this.lastLevelLoadSec=8*r/s),e.details.live?this.bwEstimator.update(i.abrEwmaSlowLive,i.abrEwmaFastLive):this.bwEstimator.update(i.abrEwmaSlowVoD,i.abrEwmaFastVoD)}_abandonRulesCheck(){const{fragCurrent:t,partCurrent:e,hls:i}=this,{autoLevelEnabled:r,media:s}=i;if(!t||!s)return;const n=performance.now(),o=e?e.stats:t.stats,a=e?e.duration:t.duration,l=n-o.loading.start;if(o.aborted||o.loaded&&o.loaded===o.total||t.level===0){this.clearTimer(),this._nextAutoLevel=-1;return}if(!r||s.paused||!s.playbackRate||!s.readyState)return;const d=i.mainForwardBufferInfo;if(d===null)return;const c=this.bwEstimator.getEstimateTTFB(),f=Math.abs(s.playbackRate);if(l<=Math.max(c,1e3*(a/(f*2))))return;const h=d.len/f;if(h>=2*a/f)return;const p=o.loading.first?o.loading.first-o.loading.start:-1,g=o.loaded&&p>-1,x=this.bwEstimator.getEstimate(),{levels:E,minAutoLevel:k}=i,O=E[t.level],T=o.total||Math.max(o.loaded,Math.round(a*O.maxBitrate/8));let R=l-p;R<1&&g&&(R=Math.min(l,o.loaded*8/x));const C=g?o.loaded*1e3/R:0,b=C?(T-o.loaded)/C:T*8/x+c/1e3;if(b<=h)return;const A=C?C*8:x;let L=Number.POSITIVE_INFINITY,I;for(I=t.level-1;I>k;I--){const j=E[I].maxBitrate;if(L=this.getTimeToLoadFrag(c/1e3,A,a*j,!E[I].details),L<h)break}L>=b||L>a*10||(i.nextLoadLevel=I,g?this.bwEstimator.sample(l-Math.min(c,p),o.loaded):this.bwEstimator.sampleTTFB(l),this.clearTimer(),H.warn(`[abr] Fragment ${t.sn}${e?" part "+e.index:""} of level ${t.level} is loading too slowly;
      Time to underbuffer: ${h.toFixed(3)} s
      Estimated load time for current fragment: ${b.toFixed(3)} s
      Estimated load time for down switch fragment: ${L.toFixed(3)} s
      TTFB estimate: ${p}
      Current BW estimate: ${_t(x)?(x/1024).toFixed(3):"Unknown"} Kb/s
      New BW estimate: ${(this.bwEstimator.getEstimate()/1024).toFixed(3)} Kb/s
      Aborting and switching to level ${I}`),t.loader&&(this.fragCurrent=this.partCurrent=null,t.abortRequests()),i.trigger(D.FRAG_LOAD_EMERGENCY_ABORTED,{frag:t,part:e,stats:o}))}onFragLoaded(t,{frag:e,part:i}){const r=i?i.stats:e.stats;if(e.type===Tt.MAIN&&this.bwEstimator.sampleTTFB(r.loading.first-r.loading.start),!this.ignoreFragment(e)){if(this.clearTimer(),this.lastLoadedFragLevel=e.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){const s=i?i.duration:e.duration,n=this.hls.levels[e.level],o=(n.loaded?n.loaded.bytes:0)+r.loaded,a=(n.loaded?n.loaded.duration:0)+s;n.loaded={bytes:o,duration:a},n.realBitrate=Math.round(8*o/a)}if(e.bitrateTest){const s={stats:r,frag:e,part:i,id:e.type};this.onFragBuffered(D.FRAG_BUFFERED,s),e.bitrateTest=!1}}}onFragBuffered(t,e){const{frag:i,part:r}=e,s=r!=null&&r.stats.loaded?r.stats:i.stats;if(s.aborted||this.ignoreFragment(i))return;const n=s.parsing.end-s.loading.start-Math.min(s.loading.first-s.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(n,s.loaded),s.bwEstimate=this.bwEstimator.getEstimate(),i.bitrateTest?this.bitrateTestDelay=n/1e3:this.bitrateTestDelay=0}ignoreFragment(t){return t.type!==Tt.MAIN||t.sn==="initSegment"}clearTimer(){self.clearInterval(this.timer)}get nextAutoLevel(){const t=this._nextAutoLevel,e=this.bwEstimator;if(t!==-1&&!e.canEstimate())return t;let i=this.getNextABRAutoLevel();if(t!==-1){const r=this.hls.levels;if(r.length>Math.max(t,i)&&r[t].loadError<=r[i].loadError)return t}return t!==-1&&(i=Math.min(t,i)),i}getNextABRAutoLevel(){const{fragCurrent:t,partCurrent:e,hls:i}=this,{maxAutoLevel:r,config:s,minAutoLevel:n,media:o}=i,a=e?e.duration:t?t.duration:0,l=o&&o.playbackRate!==0?Math.abs(o.playbackRate):1,d=this.bwEstimator?this.bwEstimator.getEstimate():s.abrEwmaDefaultEstimate,c=i.mainForwardBufferInfo,f=(c?c.len:0)/l;let h=this.findBestLevel(d,n,r,f,s.abrBandWidthFactor,s.abrBandWidthUpFactor);if(h>=0)return h;H.trace(`[abr] ${f?"rebuffering expected":"buffer is empty"}, finding optimal quality level`);let p=a?Math.min(a,s.maxStarvationDelay):s.maxStarvationDelay,g=s.abrBandWidthFactor,x=s.abrBandWidthUpFactor;if(!f){const E=this.bitrateTestDelay;E&&(p=(a?Math.min(a,s.maxLoadingDelay):s.maxLoadingDelay)-E,H.trace(`[abr] bitrate test took ${Math.round(1e3*E)}ms, set first fragment max fetchDuration to ${Math.round(1e3*p)} ms`),g=x=1)}return h=this.findBestLevel(d,n,r,f+p,g,x),Math.max(h,0)}findBestLevel(t,e,i,r,s,n){var o;const{fragCurrent:a,partCurrent:l,lastLoadedFragLevel:d}=this,{levels:c}=this.hls,f=c[d],h=!!(f!=null&&(o=f.details)!=null&&o.live),p=f==null?void 0:f.codecSet,g=l?l.duration:a?a.duration:0,x=this.bwEstimator.getEstimateTTFB()/1e3;let E=e,k=-1;for(let O=i;O>=e;O--){const T=c[O];if(!T||p&&T.codecSet!==p){T&&(E=Math.min(O,E),k=Math.max(O,k));continue}k!==-1&&H.trace(`[abr] Skipped level(s) ${E}-${k} with CODECS:"${c[k].attrs.CODECS}"; not compatible with "${f.attrs.CODECS}"`);const R=T.details,C=(l?R==null?void 0:R.partTarget:R==null?void 0:R.averagetargetduration)||g;let b;O<=d?b=s*t:b=n*t;const A=c[O].maxBitrate,L=this.getTimeToLoadFrag(x,b,A*C,R===void 0);if(H.trace(`[abr] level:${O} adjustedbw-bitrate:${Math.round(b-A)} avgDuration:${C.toFixed(1)} maxFetchDuration:${r.toFixed(1)} fetchDuration:${L.toFixed(1)}`),b>A&&(L===0||!_t(L)||h&&!this.bitrateTestDelay||L<r))return O}return-1}set nextAutoLevel(t){this._nextAutoLevel=t}}class Yn{constructor(){this.chunks=[],this.dataLength=0}push(t){this.chunks.push(t),this.dataLength+=t.length}flush(){const{chunks:t,dataLength:e}=this;let i;if(t.length)t.length===1?i=t[0]:i=Ed(t,e);else return new Uint8Array(0);return this.reset(),i}reset(){this.chunks.length=0,this.dataLength=0}}function Ed(u,t){const e=new Uint8Array(t);let i=0;for(let r=0;r<u.length;r++){const s=u[r];e.set(s,i),i+=s.length}return e}const zs=100;class bd extends zr{constructor(t,e,i){super(t,e,i,"[audio-stream-controller]",Tt.AUDIO),this.videoBuffer=null,this.videoTrackCC=-1,this.waitingVideoCC=-1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),this.mainDetails=null,this.bufferedTrack=null,this.switchingTrack=null}_registerListeners(){const{hls:t}=this;t.on(D.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(D.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(D.MANIFEST_LOADING,this.onManifestLoading,this),t.on(D.LEVEL_LOADED,this.onLevelLoaded,this),t.on(D.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.on(D.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(D.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(D.ERROR,this.onError,this),t.on(D.BUFFER_RESET,this.onBufferReset,this),t.on(D.BUFFER_CREATED,this.onBufferCreated,this),t.on(D.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(D.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(D.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:t}=this;t.off(D.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(D.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(D.MANIFEST_LOADING,this.onManifestLoading,this),t.off(D.LEVEL_LOADED,this.onLevelLoaded,this),t.off(D.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.off(D.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(D.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.off(D.ERROR,this.onError,this),t.off(D.BUFFER_RESET,this.onBufferReset,this),t.off(D.BUFFER_CREATED,this.onBufferCreated,this),t.off(D.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(D.INIT_PTS_FOUND,this.onInitPtsFound,this),t.off(D.FRAG_BUFFERED,this.onFragBuffered,this)}onInitPtsFound(t,{frag:e,id:i,initPTS:r,timescale:s}){if(i==="main"){const n=e.cc;this.initPTS[e.cc]={baseTime:r,timescale:s},this.log(`InitPTS for cc: ${n} found from main: ${r}`),this.videoTrackCC=n,this.state===nt.WAITING_INIT_PTS&&this.tick()}}startLoad(t){if(!this.levels){this.startPosition=t,this.state=nt.STOPPED;return}const e=this.lastCurrentTime;this.stopLoad(),this.setInterval(zs),e>0&&t===-1?(this.log(`Override startPosition with lastCurrentTime @${e.toFixed(3)}`),t=e,this.state=nt.IDLE):(this.loadedmetadata=!1,this.state=nt.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()}doTick(){switch(this.state){case nt.IDLE:this.doTickIdle();break;case nt.WAITING_TRACK:{var t;const{levels:i,trackId:r}=this,s=i==null||(t=i[r])==null?void 0:t.details;if(s){if(this.waitForCdnTuneIn(s))break;this.state=nt.WAITING_INIT_PTS}break}case nt.FRAG_LOADING_WAITING_RETRY:{var e;const i=performance.now(),r=this.retryDate;(!r||i>=r||(e=this.media)!=null&&e.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.trackId),this.state=nt.IDLE);break}case nt.WAITING_INIT_PTS:{const i=this.waitingData;if(i){const{frag:r,part:s,cache:n,complete:o}=i;if(this.initPTS[r.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=nt.FRAG_LOADING;const a=n.flush(),l={frag:r,part:s,payload:a,networkDetails:null};this._handleFragmentLoadProgress(l),o&&super._handleFragmentLoadComplete(l)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log(`Waiting fragment cc (${r.cc}) cancelled because video is at cc ${this.videoTrackCC}`),this.clearWaitingFragment();else{const a=this.getLoadPosition(),l=$t.bufferInfo(this.mediaBuffer,a,this.config.maxBufferHole);kr(l.end,this.config.maxFragLookUpTolerance,r)<0&&(this.log(`Waiting fragment cc (${r.cc}) @ ${r.start} cancelled because another fragment at ${l.end} is needed`),this.clearWaitingFragment())}}else this.state=nt.IDLE}}this.onTickEnd()}clearWaitingFragment(){const t=this.waitingData;t&&(this.fragmentTracker.removeFragment(t.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=nt.IDLE)}resetLoadingState(){this.clearWaitingFragment(),super.resetLoadingState()}onTickEnd(){const{media:t}=this;!(t!=null&&t.readyState)||(this.lastCurrentTime=t.currentTime)}doTickIdle(){const{hls:t,levels:e,media:i,trackId:r}=this,s=t.config;if(!(e!=null&&e[r])||!i&&(this.startFragRequested||!s.startFragPrefetch))return;const n=e[r],o=n.details;if(!o||o.live&&this.levelLastLoaded!==r||this.waitForCdnTuneIn(o)){this.state=nt.WAITING_TRACK;return}const a=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&a&&(this.bufferFlushed=!1,this.afterBufferFlushed(a,Bt.AUDIO,Tt.AUDIO));const l=this.getFwdBufferInfo(a,Tt.AUDIO);if(l===null)return;const{bufferedTrack:d,switchingTrack:c}=this;if(!c&&this._streamEnded(l,o)){t.trigger(D.BUFFER_EOS,{type:"audio"}),this.state=nt.ENDED;return}const f=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,Tt.MAIN),h=l.len,p=this.getMaxBufferLength(f==null?void 0:f.len);if(h>=p&&!c)return;const x=o.fragments[0].start;let E=l.end;if(c&&i){const R=this.getLoadPosition();d&&c.attrs!==d.attrs&&(E=R),o.PTSKnown&&R<x&&(l.end>x||l.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),i.currentTime=x+.05)}let k=this.getNextFragment(E,o),O=!1;if(k&&this.isLoopLoading(k,E)&&(O=!!k.gap,k=this.getNextFragmentLoopLoading(k,o,l,Tt.MAIN,p)),!k){this.bufferFlushed=!0;return}const T=f&&k.start>f.end+o.targetduration;if(T||!(f!=null&&f.len)&&l.len){const R=this.getAppendedFrag(k.start,Tt.MAIN);if(R===null||(O||(O=!!R.gap||!!T&&f.len===0),T&&!O||O&&l.nextStart&&l.nextStart<R.end))return}this.loadFragment(k,n,E)}getMaxBufferLength(t){const e=super.getMaxBufferLength();return t?Math.min(Math.max(e,t),this.config.maxMaxBufferLength):e}onMediaDetaching(){this.videoBuffer=null,super.onMediaDetaching()}onAudioTracksUpdated(t,{audioTracks:e}){this.resetTransmuxer(),this.levels=e.map(i=>new yi(i))}onAudioTrackSwitching(t,e){const i=!!e.url;this.trackId=e.id;const{fragCurrent:r}=this;r&&(r.abortRequests(),this.removeUnbufferedFrags(r.start)),this.resetLoadingState(),i?this.setInterval(zs):this.resetTransmuxer(),i?(this.switchingTrack=e,this.state=nt.IDLE):(this.switchingTrack=null,this.bufferedTrack=e,this.state=nt.STOPPED),this.tick()}onManifestLoading(){this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1,this.levels=this.mainDetails=this.waitingData=this.bufferedTrack=this.cachedTrackLoadedData=this.switchingTrack=null,this.startFragRequested=!1,this.trackId=this.videoTrackCC=this.waitingVideoCC=-1}onLevelLoaded(t,e){this.mainDetails=e.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(D.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)}onAudioTrackLoaded(t,e){var i;if(this.mainDetails==null){this.cachedTrackLoadedData=e;return}const{levels:r}=this,{details:s,id:n}=e;if(!r){this.warn(`Audio tracks were reset while loading level ${n}`);return}this.log(`Track ${n} loaded [${s.startSN},${s.endSN}]${s.lastPartSn?`[part-${s.lastPartSn}-${s.lastPartIndex}]`:""},duration:${s.totalduration}`);const o=r[n];let a=0;if(s.live||(i=o.details)!=null&&i.live){const l=this.mainDetails;if(s.fragments[0]||(s.deltaUpdateFailed=!0),s.deltaUpdateFailed||!l)return;!o.details&&s.hasProgramDateTime&&l.hasProgramDateTime?(Cn(s,l),a=s.fragments[0].start):a=this.alignPlaylists(s,o.details)}o.details=s,this.levelLastLoaded=n,!this.startFragRequested&&(this.mainDetails||!s.live)&&this.setStartPosition(o.details,a),this.state===nt.WAITING_TRACK&&!this.waitForCdnTuneIn(s)&&(this.state=nt.IDLE),this.tick()}_handleFragmentLoadProgress(t){var e;const{frag:i,part:r,payload:s}=t,{config:n,trackId:o,levels:a}=this;if(!a){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${i.sn} of level ${i.level} will not be buffered`);return}const l=a[o];if(!l){this.warn("Audio track is undefined on fragment load progress");return}const d=l.details;if(!d){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(i.start);return}const c=n.defaultAudioCodec||l.audioCodec||"mp4a.40.2";let f=this.transmuxer;f||(f=this.transmuxer=new Wn(this.hls,Tt.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const h=this.initPTS[i.cc],p=(e=i.initSegment)==null?void 0:e.data;if(h!==void 0){const x=r?r.index:-1,E=x!==-1,k=new $r(i.level,i.sn,i.stats.chunkCount,s.byteLength,x,E);f.push(s,p,c,"",i,r,d.totalduration,!1,k,h)}else{this.log(`Unknown video PTS for cc ${i.cc}, waiting for video PTS before demuxing audio frag ${i.sn} of [${d.startSN} ,${d.endSN}],track ${o}`);const{cache:g}=this.waitingData=this.waitingData||{frag:i,part:r,cache:new Yn,complete:!1};g.push(new Uint8Array(s)),this.waitingVideoCC=this.videoTrackCC,this.state=nt.WAITING_INIT_PTS}}_handleFragmentLoadComplete(t){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(t)}onBufferReset(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1}onBufferCreated(t,e){const i=e.tracks.audio;i&&(this.mediaBuffer=i.buffer||null),e.tracks.video&&(this.videoBuffer=e.tracks.video.buffer||null)}onFragBuffered(t,e){const{frag:i,part:r}=e;if(i.type!==Tt.AUDIO){if(!this.loadedmetadata&&i.type===Tt.MAIN){const s=this.videoBuffer||this.media;s&&$t.getBuffered(s).length&&(this.loadedmetadata=!0)}return}if(this.fragContextChanged(i)){this.warn(`Fragment ${i.sn}${r?" p: "+r.index:""} of level ${i.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(i.sn!=="initSegment"){this.fragPrevious=i;const s=this.switchingTrack;s&&(this.bufferedTrack=s,this.switchingTrack=null,this.hls.trigger(D.AUDIO_TRACK_SWITCHED,fe({},s)))}this.fragBufferedComplete(i,r)}onError(t,e){var i;if(e.fatal){this.state=nt.ERROR;return}switch(e.details){case tt.FRAG_GAP:case tt.FRAG_PARSING_ERROR:case tt.FRAG_DECRYPT_ERROR:case tt.FRAG_LOAD_ERROR:case tt.FRAG_LOAD_TIMEOUT:case tt.KEY_LOAD_ERROR:case tt.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Tt.AUDIO,e);break;case tt.AUDIO_TRACK_LOAD_ERROR:case tt.AUDIO_TRACK_LOAD_TIMEOUT:case tt.LEVEL_PARSING_ERROR:!e.levelRetry&&this.state===nt.WAITING_TRACK&&((i=e.context)==null?void 0:i.type)===Pt.AUDIO_TRACK&&(this.state=nt.IDLE);break;case tt.BUFFER_FULL_ERROR:if(!e.parent||e.parent!=="audio")return;this.reduceLengthAndFlushBuffer(e)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case tt.INTERNAL_EXCEPTION:this.recoverWorkerError(e);break}}onBufferFlushed(t,{type:e}){e===Bt.AUDIO&&(this.bufferFlushed=!0,this.state===nt.ENDED&&(this.state=nt.IDLE))}_handleTransmuxComplete(t){var e;const i="audio",{hls:r}=this,{remuxResult:s,chunkMeta:n}=t,o=this.getCurrentContext(n);if(!o){this.resetWhenMissingContext(n);return}const{frag:a,part:l,level:d}=o,{details:c}=d,{audio:f,text:h,id3:p,initSegment:g}=s;if(this.fragContextChanged(a)||!c){this.fragmentTracker.removeFragment(a);return}if(this.state=nt.PARSING,this.switchingTrack&&f&&this.completeAudioSwitch(this.switchingTrack),g!=null&&g.tracks){const x=a.initSegment||a;this._bufferInitSegment(g.tracks,x,n),r.trigger(D.FRAG_PARSING_INIT_SEGMENT,{frag:x,id:i,tracks:g.tracks})}if(f){const{startPTS:x,endPTS:E,startDTS:k,endDTS:O}=f;l&&(l.elementaryStreams[Bt.AUDIO]={startPTS:x,endPTS:E,startDTS:k,endDTS:O}),a.setElementaryStreamInfo(Bt.AUDIO,x,E,k,O),this.bufferFragmentData(f,a,l,n)}if(p!=null&&(e=p.samples)!=null&&e.length){const x=Jt({id:i,frag:a,details:c},p);r.trigger(D.FRAG_PARSING_METADATA,x)}if(h){const x=Jt({id:i,frag:a,details:c},h);r.trigger(D.FRAG_PARSING_USERDATA,x)}}_bufferInitSegment(t,e,i){if(this.state!==nt.PARSING)return;t.video&&delete t.video;const r=t.audio;if(!r)return;r.levelCodec=r.codec,r.id="audio",this.log(`Init audio buffer, container:${r.container}, codecs[parsed]=[${r.codec}]`),this.hls.trigger(D.BUFFER_CODECS,t);const s=r.initSegment;if(s!=null&&s.byteLength){const n={type:"audio",frag:e,part:null,chunkMeta:i,parent:e.type,data:s};this.hls.trigger(D.BUFFER_APPENDING,n)}this.tick()}loadFragment(t,e,i){const r=this.fragmentTracker.getState(t);if(this.fragCurrent=t,this.switchingTrack||r===re.NOT_LOADED||r===re.PARTIAL){var s;t.sn==="initSegment"?this._loadInitSegment(t,e):(s=e.details)!=null&&s.live&&!this.initPTS[t.cc]?(this.log(`Waiting for video PTS in continuity counter ${t.cc} of live stream before loading audio fragment ${t.sn} of level ${this.trackId}`),this.state=nt.WAITING_INIT_PTS):(this.startFragRequested=!0,super.loadFragment(t,e,i))}else this.clearTrackerIfNeeded(t)}completeAudioSwitch(t){const{hls:e,media:i,bufferedTrack:r}=this,s=r==null?void 0:r.attrs,n=t.attrs;i&&s&&(s.CHANNELS!==n.CHANNELS||s.NAME!==n.NAME||s.LANGUAGE!==n.LANGUAGE)&&(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio")),this.bufferedTrack=t,this.switchingTrack=null,e.trigger(D.AUDIO_TRACK_SWITCHED,fe({},t))}}class Td extends jr{constructor(t){super(t,"[audio-track-controller]"),this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:t}=this;t.on(D.MANIFEST_LOADING,this.onManifestLoading,this),t.on(D.MANIFEST_PARSED,this.onManifestParsed,this),t.on(D.LEVEL_LOADING,this.onLevelLoading,this),t.on(D.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(D.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(D.ERROR,this.onError,this)}unregisterListeners(){const{hls:t}=this;t.off(D.MANIFEST_LOADING,this.onManifestLoading,this),t.off(D.MANIFEST_PARSED,this.onManifestParsed,this),t.off(D.LEVEL_LOADING,this.onLevelLoading,this),t.off(D.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(D.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.off(D.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(t,e){this.tracks=e.audioTracks||[]}onAudioTrackLoaded(t,e){const{id:i,groupId:r,details:s}=e,n=this.tracksInGroup[i];if(!n||n.groupId!==r){this.warn(`Track with id:${i} and group:${r} not found in active group ${n.groupId}`);return}const o=n.details;n.details=e.details,this.log(`audio-track ${i} "${n.name}" lang:${n.lang} group:${r} loaded [${s.startSN}-${s.endSN}]`),i===this.trackId&&this.playlistLoaded(i,e,o)}onLevelLoading(t,e){this.switchLevel(e.level)}onLevelSwitching(t,e){this.switchLevel(e.level)}switchLevel(t){const e=this.hls.levels[t];if(!(e!=null&&e.audioGroupIds))return;const i=e.audioGroupIds[e.urlId];if(this.groupId!==i){this.groupId=i||null;const r=this.tracks.filter(n=>!i||n.groupId===i);this.selectDefaultTrack&&!r.some(n=>n.default)&&(this.selectDefaultTrack=!1),this.tracksInGroup=r;const s={audioTracks:r};this.log(`Updating audio tracks, ${r.length} track(s) found in group:${i}`),this.hls.trigger(D.AUDIO_TRACKS_UPDATED,s),this.selectInitialTrack()}else this.shouldReloadPlaylist(this.currentTrack)&&this.setAudioTrack(this.trackId)}onError(t,e){e.fatal||!e.context||e.context.type===Pt.AUDIO_TRACK&&e.context.id===this.trackId&&e.context.groupId===this.groupId&&(this.requestScheduled=-1,this.checkRetry(e))}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(t){this.selectDefaultTrack=!1,this.setAudioTrack(t)}setAudioTrack(t){const e=this.tracksInGroup;if(t<0||t>=e.length){this.warn("Invalid id passed to audio-track controller");return}this.clearTimer();const i=this.currentTrack;e[this.trackId];const r=e[t],{groupId:s,name:n}=r;if(this.log(`Switching to audio-track ${t} "${n}" lang:${r.lang} group:${s}`),this.trackId=t,this.currentTrack=r,this.selectDefaultTrack=!1,this.hls.trigger(D.AUDIO_TRACK_SWITCHING,fe({},r)),r.details&&!r.details.live)return;const o=this.switchParams(r.url,i==null?void 0:i.details);this.loadPlaylist(o)}selectInitialTrack(){const t=this.tracksInGroup,e=this.findTrackId(this.currentTrack)|this.findTrackId(null);if(e!==-1)this.setAudioTrack(e);else{const i=new Error(`No track found for running audio group-ID: ${this.groupId} track count: ${t.length}`);this.warn(i.message),this.hls.trigger(D.ERROR,{type:bt.MEDIA_ERROR,details:tt.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:i})}}findTrackId(t){const e=this.tracksInGroup;for(let i=0;i<e.length;i++){const r=e[i];if((!this.selectDefaultTrack||r.default)&&(!t||t.attrs["STABLE-RENDITION-ID"]!==void 0&&t.attrs["STABLE-RENDITION-ID"]===r.attrs["STABLE-RENDITION-ID"]||t.name===r.name&&t.lang===r.lang))return r.id}return-1}loadPlaylist(t){super.loadPlaylist();const e=this.tracksInGroup[this.trackId];if(this.shouldLoadPlaylist(e)){const i=e.id,r=e.groupId;let s=e.url;if(t)try{s=t.addDirectives(s)}catch(n){this.warn(`Could not construct new URL with HLS Delivery Directives: ${n}`)}this.log(`loading audio-track playlist ${i} "${e.name}" lang:${e.lang} group:${r}`),this.clearTimer(),this.hls.trigger(D.AUDIO_TRACK_LOADING,{url:s,id:i,groupId:r,deliveryDirectives:t||null})}}}function qn(u,t){if(u.length!==t.length)return!1;for(let e=0;e<u.length;e++)if(!Sd(u[e].attrs,t[e].attrs))return!1;return!0}function Sd(u,t){const e=u["STABLE-RENDITION-ID"];return e?e===t["STABLE-RENDITION-ID"]:!["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED"].some(i=>u[i]!==t[i])}const Hs=500;class Ad extends zr{constructor(t,e,i){super(t,e,i,"[subtitle-stream-controller]",Tt.SUBTITLE),this.levels=[],this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),this.mainDetails=null}_registerListeners(){const{hls:t}=this;t.on(D.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(D.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(D.MANIFEST_LOADING,this.onManifestLoading,this),t.on(D.LEVEL_LOADED,this.onLevelLoaded,this),t.on(D.ERROR,this.onError,this),t.on(D.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.on(D.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.on(D.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(D.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),t.on(D.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(D.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:t}=this;t.off(D.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(D.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(D.MANIFEST_LOADING,this.onManifestLoading,this),t.off(D.LEVEL_LOADED,this.onLevelLoaded,this),t.off(D.ERROR,this.onError,this),t.off(D.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.off(D.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.off(D.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(D.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),t.off(D.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(D.FRAG_BUFFERED,this.onFragBuffered,this)}startLoad(t){this.stopLoad(),this.state=nt.IDLE,this.setInterval(Hs),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()}onManifestLoading(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()}onMediaDetaching(){this.tracksBuffered=[],super.onMediaDetaching()}onLevelLoaded(t,e){this.mainDetails=e.details}onSubtitleFragProcessed(t,e){const{frag:i,success:r}=e;if(this.fragPrevious=i,this.state=nt.IDLE,!r)return;const s=this.tracksBuffered[this.currentTrackId];if(!s)return;let n;const o=i.start;for(let l=0;l<s.length;l++)if(o>=s[l].start&&o<=s[l].end){n=s[l];break}const a=i.start+i.duration;n?n.end=a:(n={start:o,end:a},s.push(n)),this.fragmentTracker.fragBuffered(i)}onBufferFlushing(t,e){const{startOffset:i,endOffset:r}=e;if(i===0&&r!==Number.POSITIVE_INFINITY){const{currentTrackId:s,levels:n}=this;if(!n.length||!n[s]||!n[s].details)return;const a=n[s].details.targetduration,l=r-a;if(l<=0)return;e.endOffsetSubtitles=Math.max(0,l),this.tracksBuffered.forEach(d=>{for(let c=0;c<d.length;){if(d[c].end<=l){d.shift();continue}else if(d[c].start<l)d[c].start=l;else break;c++}}),this.fragmentTracker.removeFragmentsInRange(i,l,Tt.SUBTITLE)}}onFragBuffered(t,e){if(!this.loadedmetadata&&e.frag.type===Tt.MAIN){var i;(i=this.media)!=null&&i.buffered.length&&(this.loadedmetadata=!0)}}onError(t,e){const i=e.frag;(i==null?void 0:i.type)===Tt.SUBTITLE&&(this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==nt.STOPPED&&(this.state=nt.IDLE))}onSubtitleTracksUpdated(t,{subtitleTracks:e}){if(qn(this.levels,e)){this.levels=e.map(i=>new yi(i));return}this.tracksBuffered=[],this.levels=e.map(i=>{const r=new yi(i);return this.tracksBuffered[r.id]=[],r}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,Tt.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(t,e){if(this.currentTrackId=e.id,!this.levels.length||this.currentTrackId===-1){this.clearInterval();return}const i=this.levels[this.currentTrackId];i!=null&&i.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,i&&this.setInterval(Hs)}onSubtitleTrackLoaded(t,e){var i;const{details:r,id:s}=e,{currentTrackId:n,levels:o}=this;if(!o.length)return;const a=o[n];if(s>=o.length||s!==n||!a)return;this.mediaBuffer=this.mediaBufferTimeRanges;let l=0;if(r.live||(i=a.details)!=null&&i.live){const d=this.mainDetails;if(r.deltaUpdateFailed||!d)return;const c=d.fragments[0];a.details?(l=this.alignPlaylists(r,a.details),l===0&&c&&(l=c.start,Dr(r,l))):r.hasProgramDateTime&&d.hasProgramDateTime?(Cn(r,d),l=r.fragments[0].start):c&&(l=c.start,Dr(r,l))}a.details=r,this.levelLastLoaded=s,!this.startFragRequested&&(this.mainDetails||!r.live)&&this.setStartPosition(a.details,l),this.tick(),r.live&&!this.fragCurrent&&this.media&&this.state===nt.IDLE&&(vi(null,r.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),a.details=void 0))}_handleFragmentLoadComplete(t){const{frag:e,payload:i}=t,r=e.decryptdata,s=this.hls;if(!this.fragContextChanged(e)&&i&&i.byteLength>0&&r&&r.key&&r.iv&&r.method==="AES-128"){const n=performance.now();this.decrypter.decrypt(new Uint8Array(i),r.key.buffer,r.iv.buffer).catch(o=>{throw s.trigger(D.ERROR,{type:bt.MEDIA_ERROR,details:tt.FRAG_DECRYPT_ERROR,fatal:!1,error:o,reason:o.message,frag:e}),o}).then(o=>{const a=performance.now();s.trigger(D.FRAG_DECRYPTED,{frag:e,payload:o,stats:{tstart:n,tdecrypt:a}})}).catch(o=>{this.warn(`${o.name}: ${o.message}`),this.state=nt.IDLE})}}doTick(){if(!this.media){this.state=nt.IDLE;return}if(this.state===nt.IDLE){const{currentTrackId:t,levels:e}=this,i=e[t];if(!e.length||!i||!i.details)return;const r=i.details,s=r.targetduration,{config:n}=this,o=this.getLoadPosition(),a=$t.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],o-s,n.maxBufferHole),{end:l,len:d}=a,c=this.getFwdBufferInfo(this.media,Tt.MAIN),f=this.getMaxBufferLength(c==null?void 0:c.len)+s;if(d>f)return;const h=r.fragments,p=h.length,g=r.edge;let x=null;const E=this.fragPrevious;if(l<g){const{maxFragLookUpTolerance:k}=n;x=vi(E,h,Math.max(h[0].start,l),k),!x&&E&&E.start<h[0].start&&(x=h[0])}else x=h[p-1];if(!x)return;x=this.mapToInitFragWhenRequired(x),this.fragmentTracker.getState(x)===re.NOT_LOADED&&this.loadFragment(x,i,l)}}getMaxBufferLength(t){const e=super.getMaxBufferLength();return t?Math.max(e,t):e}loadFragment(t,e,i){this.fragCurrent=t,t.sn==="initSegment"?this._loadInitSegment(t,e):(this.startFragRequested=!0,super.loadFragment(t,e,i))}get mediaBufferTimeRanges(){return new Ld(this.tracksBuffered[this.currentTrackId]||[])}}class Ld{constructor(t){this.buffered=void 0;const e=(i,r,s)=>{if(r=r>>>0,r>s-1)throw new DOMException(`Failed to execute '${i}' on 'TimeRanges': The index provided (${r}) is greater than the maximum bound (${s})`);return t[r][i]};this.buffered={get length(){return t.length},end(i){return e("end",i,t.length)},start(i){return e("start",i,t.length)}}}}class Id extends jr{constructor(t){super(t,"[subtitle-track-controller]"),this.media=null,this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.trackChangeListener=()=>this.onTextTracksChanged(),this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(t){this._subtitleDisplay=t,this.trackId>-1&&this.toggleTrackModes(this.trackId)}registerListeners(){const{hls:t}=this;t.on(D.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(D.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(D.MANIFEST_LOADING,this.onManifestLoading,this),t.on(D.MANIFEST_PARSED,this.onManifestParsed,this),t.on(D.LEVEL_LOADING,this.onLevelLoading,this),t.on(D.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(D.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(D.ERROR,this.onError,this)}unregisterListeners(){const{hls:t}=this;t.off(D.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(D.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(D.MANIFEST_LOADING,this.onManifestLoading,this),t.off(D.MANIFEST_PARSED,this.onManifestParsed,this),t.off(D.LEVEL_LOADING,this.onLevelLoading,this),t.off(D.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(D.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(D.ERROR,this.onError,this)}onMediaAttached(t,e){this.media=e.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(t){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,t)}onMediaDetaching(){if(!this.media)return;self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),yr(this.media.textTracks).forEach(e=>{ai(e)}),this.subtitleTrack=-1,this.media=null}onManifestLoading(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(t,e){this.tracks=e.subtitleTracks}onSubtitleTrackLoaded(t,e){const{id:i,details:r}=e,{trackId:s}=this,n=this.tracksInGroup[s];if(!n){this.warn(`Invalid subtitle track id ${i}`);return}const o=n.details;n.details=e.details,this.log(`subtitle track ${i} loaded [${r.startSN}-${r.endSN}]`),i===this.trackId&&this.playlistLoaded(i,e,o)}onLevelLoading(t,e){this.switchLevel(e.level)}onLevelSwitching(t,e){this.switchLevel(e.level)}switchLevel(t){const e=this.hls.levels[t];if(!(e!=null&&e.textGroupIds))return;const i=e.textGroupIds[e.urlId],r=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;if(this.groupId!==i){const s=this.tracks.filter(a=>!i||a.groupId===i);this.tracksInGroup=s;const n=this.findTrackId(r==null?void 0:r.name)||this.findTrackId();this.groupId=i||null;const o={subtitleTracks:s};this.log(`Updating subtitle tracks, ${s.length} track(s) found in "${i}" group-id`),this.hls.trigger(D.SUBTITLE_TRACKS_UPDATED,o),n!==-1&&this.setSubtitleTrack(n,r)}else this.shouldReloadPlaylist(r)&&this.setSubtitleTrack(this.trackId,r)}findTrackId(t){const e=this.tracksInGroup;for(let i=0;i<e.length;i++){const r=e[i];if((!this.selectDefaultTrack||r.default)&&(!t||t===r.name))return r.id}return-1}onError(t,e){e.fatal||!e.context||e.context.type===Pt.SUBTITLE_TRACK&&e.context.id===this.trackId&&e.context.groupId===this.groupId&&this.checkRetry(e)}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(t){this.selectDefaultTrack=!1;const e=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(t,e)}loadPlaylist(t){super.loadPlaylist();const e=this.tracksInGroup[this.trackId];if(this.shouldLoadPlaylist(e)){const i=e.id,r=e.groupId;let s=e.url;if(t)try{s=t.addDirectives(s)}catch(n){this.warn(`Could not construct new URL with HLS Delivery Directives: ${n}`)}this.log(`Loading subtitle playlist for id ${i}`),this.hls.trigger(D.SUBTITLE_TRACK_LOADING,{url:s,id:i,groupId:r,deliveryDirectives:t||null})}}toggleTrackModes(t){const{media:e,trackId:i}=this;if(!e)return;const r=yr(e.textTracks),s=r.filter(o=>o.groupId===this.groupId);if(t===-1)[].slice.call(r).forEach(o=>{o.mode="disabled"});else{const o=s[i];o&&(o.mode="disabled")}const n=s[t];n&&(n.mode=this.subtitleDisplay?"showing":"hidden")}setSubtitleTrack(t,e){var i;const r=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=t;return}if(this.trackId!==t&&this.toggleTrackModes(t),this.trackId===t&&(t===-1||(i=r[t])!=null&&i.details)||t<-1||t>=r.length)return;this.clearTimer();const s=r[t];if(this.log(`Switching to subtitle-track ${t}`+(s?` "${s.name}" lang:${s.lang} group:${s.groupId}`:"")),this.trackId=t,s){const{id:n,groupId:o="",name:a,type:l,url:d}=s;this.hls.trigger(D.SUBTITLE_TRACK_SWITCH,{id:n,groupId:o,name:a,type:l,url:d});const c=this.switchParams(s.url,e==null?void 0:e.details);this.loadPlaylist(c)}else this.hls.trigger(D.SUBTITLE_TRACK_SWITCH,{id:t})}onTextTracksChanged(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=-1;const e=yr(this.media.textTracks);for(let i=0;i<e.length;i++)if(e[i].mode==="hidden")t=i;else if(e[i].mode==="showing"){t=i;break}this.subtitleTrack!==t&&(this.subtitleTrack=t)}}function yr(u){const t=[];for(let e=0;e<u.length;e++){const i=u[e];(i.kind==="subtitles"||i.kind==="captions")&&i.label&&t.push(u[e])}return t}class wd{constructor(t){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=t}append(t,e){const i=this.queues[e];i.push(t),i.length===1&&this.buffers[e]&&this.executeNext(e)}insertAbort(t,e){this.queues[e].unshift(t),this.executeNext(e)}appendBlocker(t){let e;const i=new Promise(s=>{e=s}),r={execute:e,onStart:()=>{},onComplete:()=>{},onError:()=>{}};return this.append(r,t),i}executeNext(t){const{buffers:e,queues:i}=this,r=e[t],s=i[t];if(s.length){const n=s[0];try{n.execute()}catch(o){H.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),n.onError(o),r!=null&&r.updating||(s.shift(),this.executeNext(t))}}}shiftAndExecuteNext(t){this.queues[t].shift(),this.executeNext(t)}current(t){return this.queues[t][0]}}const Ks=zi(),Ws=/([ha]vc.)(?:\.[^.,]+)+/;class Rd{constructor(t){this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=()=>{const{media:e,mediaSource:i}=this;H.log("[buffer-controller]: Media source opened"),e&&(e.removeEventListener("emptied",this._onMediaEmptied),this.updateMediaElementDuration(),this.hls.trigger(D.MEDIA_ATTACHED,{media:e})),i&&i.removeEventListener("sourceopen",this._onMediaSourceOpen),this.checkPendingTracks()},this._onMediaSourceClose=()=>{H.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=()=>{H.log("[buffer-controller]: Media source ended")},this._onMediaEmptied=()=>{const{media:e,_objectUrl:i}=this;e&&e.src!==i&&H.error(`Media element src was set while attaching MediaSource (${i} > ${e.src})`)},this.hls=t,this._initSourceBuffer(),this.registerListeners()}hasSourceTypes(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null}registerListeners(){const{hls:t}=this;t.on(D.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(D.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(D.MANIFEST_LOADING,this.onManifestLoading,this),t.on(D.MANIFEST_PARSED,this.onManifestParsed,this),t.on(D.BUFFER_RESET,this.onBufferReset,this),t.on(D.BUFFER_APPENDING,this.onBufferAppending,this),t.on(D.BUFFER_CODECS,this.onBufferCodecs,this),t.on(D.BUFFER_EOS,this.onBufferEos,this),t.on(D.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(D.LEVEL_UPDATED,this.onLevelUpdated,this),t.on(D.FRAG_PARSED,this.onFragParsed,this),t.on(D.FRAG_CHANGED,this.onFragChanged,this)}unregisterListeners(){const{hls:t}=this;t.off(D.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(D.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(D.MANIFEST_LOADING,this.onManifestLoading,this),t.off(D.MANIFEST_PARSED,this.onManifestParsed,this),t.off(D.BUFFER_RESET,this.onBufferReset,this),t.off(D.BUFFER_APPENDING,this.onBufferAppending,this),t.off(D.BUFFER_CODECS,this.onBufferCodecs,this),t.off(D.BUFFER_EOS,this.onBufferEos,this),t.off(D.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(D.LEVEL_UPDATED,this.onLevelUpdated,this),t.off(D.FRAG_PARSED,this.onFragParsed,this),t.off(D.FRAG_CHANGED,this.onFragChanged,this)}_initSourceBuffer(){this.sourceBuffer={},this.operationQueue=new wd(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.lastMpegAudioChunk=null}onManifestLoading(){this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=0,this.details=null}onManifestParsed(t,e){let i=2;(e.audio&&!e.video||!e.altAudio)&&(i=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=i,H.log(`${this.bufferCodecEventsExpected} bufferCodec event(s) expected`)}onMediaAttaching(t,e){const i=this.media=e.media;if(i&&Ks){const r=this.mediaSource=new Ks;r.addEventListener("sourceopen",this._onMediaSourceOpen),r.addEventListener("sourceended",this._onMediaSourceEnded),r.addEventListener("sourceclose",this._onMediaSourceClose),i.src=self.URL.createObjectURL(r),this._objectUrl=i.src,i.addEventListener("emptied",this._onMediaEmptied)}}onMediaDetaching(){const{media:t,mediaSource:e,_objectUrl:i}=this;if(e){if(H.log("[buffer-controller]: media source detaching"),e.readyState==="open")try{e.endOfStream()}catch(r){H.warn(`[buffer-controller]: onMediaDetaching: ${r.message} while calling endOfStream`)}this.onBufferReset(),e.removeEventListener("sourceopen",this._onMediaSourceOpen),e.removeEventListener("sourceended",this._onMediaSourceEnded),e.removeEventListener("sourceclose",this._onMediaSourceClose),t&&(t.removeEventListener("emptied",this._onMediaEmptied),i&&self.URL.revokeObjectURL(i),t.src===i?(t.removeAttribute("src"),t.load()):H.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(D.MEDIA_DETACHED,void 0)}onBufferReset(){this.getSourceBufferTypes().forEach(t=>{const e=this.sourceBuffer[t];try{e&&(this.removeBufferListeners(t),this.mediaSource&&this.mediaSource.removeSourceBuffer(e),this.sourceBuffer[t]=void 0)}catch(i){H.warn(`[buffer-controller]: Failed to reset the ${t} buffer`,i)}}),this._initSourceBuffer()}onBufferCodecs(t,e){const i=this.getSourceBufferTypes().length;Object.keys(e).forEach(r=>{if(i){const s=this.tracks[r];if(s&&typeof s.buffer.changeType=="function"){const{id:n,codec:o,levelCodec:a,container:l,metadata:d}=e[r],c=(s.levelCodec||s.codec).replace(Ws,"$1"),f=(a||o).replace(Ws,"$1");if(c!==f){const h=`${l};codecs=${a||o}`;this.appendChangeType(r,h),H.log(`[buffer-controller]: switching codec ${c} to ${f}`),this.tracks[r]={buffer:s.buffer,codec:o,container:l,levelCodec:a,metadata:d,id:n}}}}else this.pendingTracks[r]=e[r]}),!i&&(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())}appendChangeType(t,e){const{operationQueue:i}=this,r={execute:()=>{const s=this.sourceBuffer[t];s&&(H.log(`[buffer-controller]: changing ${t} sourceBuffer type to ${e}`),s.changeType(e)),i.shiftAndExecuteNext(t)},onStart:()=>{},onComplete:()=>{},onError:s=>{H.warn(`[buffer-controller]: Failed to change ${t} SourceBuffer type`,s)}};i.append(r,t)}onBufferAppending(t,e){const{hls:i,operationQueue:r,tracks:s}=this,{data:n,type:o,frag:a,part:l,chunkMeta:d}=e,c=d.buffering[o],f=self.performance.now();c.start=f;const h=a.stats.buffering,p=l?l.stats.buffering:null;h.start===0&&(h.start=f),p&&p.start===0&&(p.start=f);const g=s.audio;let x=!1;o==="audio"&&(g==null?void 0:g.container)==="audio/mpeg"&&(x=!this.lastMpegAudioChunk||d.id===1||this.lastMpegAudioChunk.sn!==d.sn,this.lastMpegAudioChunk=d);const E=a.start,k={execute:()=>{if(c.executeStart=self.performance.now(),x){const O=this.sourceBuffer[o];if(O){const T=E-O.timestampOffset;Math.abs(T)>=.1&&(H.log(`[buffer-controller]: Updating audio SourceBuffer timestampOffset to ${E} (delta: ${T}) sn: ${a.sn})`),O.timestampOffset=E)}}this.appendExecutor(n,o)},onStart:()=>{},onComplete:()=>{const O=self.performance.now();c.executeEnd=c.end=O,h.first===0&&(h.first=O),p&&p.first===0&&(p.first=O);const{sourceBuffer:T}=this,R={};for(const C in T)R[C]=$t.getBuffered(T[C]);this.appendError=0,this.hls.trigger(D.BUFFER_APPENDED,{type:o,frag:a,part:l,chunkMeta:d,parent:a.type,timeRanges:R})},onError:O=>{H.error(`[buffer-controller]: Error encountered while trying to append to the ${o} SourceBuffer`,O);const T={type:bt.MEDIA_ERROR,parent:a.type,details:tt.BUFFER_APPEND_ERROR,frag:a,part:l,chunkMeta:d,error:O,err:O,fatal:!1};O.code===DOMException.QUOTA_EXCEEDED_ERR?T.details=tt.BUFFER_FULL_ERROR:(this.appendError++,T.details=tt.BUFFER_APPEND_ERROR,this.appendError>i.config.appendErrorMaxRetry&&(H.error(`[buffer-controller]: Failed ${i.config.appendErrorMaxRetry} times to append segment in sourceBuffer`),T.fatal=!0)),i.trigger(D.ERROR,T)}};r.append(k,o)}onBufferFlushing(t,e){const{operationQueue:i}=this,r=s=>({execute:this.removeExecutor.bind(this,s,e.startOffset,e.endOffset),onStart:()=>{},onComplete:()=>{this.hls.trigger(D.BUFFER_FLUSHED,{type:s})},onError:n=>{H.warn(`[buffer-controller]: Failed to remove from ${s} SourceBuffer`,n)}});e.type?i.append(r(e.type),e.type):this.getSourceBufferTypes().forEach(s=>{i.append(r(s),s)})}onFragParsed(t,e){const{frag:i,part:r}=e,s=[],n=r?r.elementaryStreams:i.elementaryStreams;n[Bt.AUDIOVIDEO]?s.push("audiovideo"):(n[Bt.AUDIO]&&s.push("audio"),n[Bt.VIDEO]&&s.push("video"));const o=()=>{const a=self.performance.now();i.stats.buffering.end=a,r&&(r.stats.buffering.end=a);const l=r?r.stats:i.stats;this.hls.trigger(D.FRAG_BUFFERED,{frag:i,part:r,stats:l,id:i.type})};s.length===0&&H.warn(`Fragments must have at least one ElementaryStreamType set. type: ${i.type} level: ${i.level} sn: ${i.sn}`),this.blockBuffers(o,s)}onFragChanged(t,e){this.flushBackBuffer()}onBufferEos(t,e){this.getSourceBufferTypes().reduce((r,s)=>{const n=this.sourceBuffer[s];return n&&(!e.type||e.type===s)&&(n.ending=!0,n.ended||(n.ended=!0,H.log(`[buffer-controller]: ${s} sourceBuffer now EOS`))),r&&!!(!n||n.ended)},!0)&&(H.log("[buffer-controller]: Queueing mediaSource.endOfStream()"),this.blockBuffers(()=>{this.getSourceBufferTypes().forEach(s=>{const n=this.sourceBuffer[s];n&&(n.ending=!1)});const{mediaSource:r}=this;if(!r||r.readyState!=="open"){r&&H.info(`[buffer-controller]: Could not call mediaSource.endOfStream(). mediaSource.readyState: ${r.readyState}`);return}H.log("[buffer-controller]: Calling mediaSource.endOfStream()"),r.endOfStream()}))}onLevelUpdated(t,{details:e}){!e.fragments.length||(this.details=e,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())}flushBackBuffer(){const{hls:t,details:e,media:i,sourceBuffer:r}=this;if(!i||e===null)return;const s=this.getSourceBufferTypes();if(!s.length)return;const n=e.live&&t.config.liveBackBufferLength!==null?t.config.liveBackBufferLength:t.config.backBufferLength;if(!_t(n)||n<0)return;const o=i.currentTime,a=e.levelTargetDuration,l=Math.max(n,a),d=Math.floor(o/a)*a-l;s.forEach(c=>{const f=r[c];if(f){const h=$t.getBuffered(f);if(h.length>0&&d>h.start(0)){if(t.trigger(D.BACK_BUFFER_REACHED,{bufferEnd:d}),e.live)t.trigger(D.LIVE_BACK_BUFFER_REACHED,{bufferEnd:d});else if(f.ended&&h.end(h.length-1)-o<a*2){H.info(`[buffer-controller]: Cannot flush ${c} back buffer while SourceBuffer is in ended state`);return}t.trigger(D.BUFFER_FLUSHING,{startOffset:0,endOffset:d,type:c})}}})}updateMediaElementDuration(){if(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")return;const{details:t,hls:e,media:i,mediaSource:r}=this,s=t.fragments[0].start+t.totalduration,n=i.duration,o=_t(r.duration)?r.duration:0;t.live&&e.config.liveDurationInfinity?(H.log("[buffer-controller]: Media Source duration is set to Infinity"),r.duration=1/0,this.updateSeekableRange(t)):(s>o&&s>n||!_t(n))&&(H.log(`[buffer-controller]: Updating Media Source duration to ${s.toFixed(3)}`),r.duration=s)}updateSeekableRange(t){const e=this.mediaSource,i=t.fragments;if(i.length&&t.live&&e!=null&&e.setLiveSeekableRange){const s=Math.max(0,i[0].start),n=Math.max(s,s+t.totalduration);e.setLiveSeekableRange(s,n)}}checkPendingTracks(){const{bufferCodecEventsExpected:t,operationQueue:e,pendingTracks:i}=this,r=Object.keys(i).length;if(r&&!t||r===2){this.createSourceBuffers(i),this.pendingTracks={};const s=this.getSourceBufferTypes();if(s.length)this.hls.trigger(D.BUFFER_CREATED,{tracks:this.tracks}),s.forEach(n=>{e.executeNext(n)});else{const n=new Error("could not create source buffer for media codec(s)");this.hls.trigger(D.ERROR,{type:bt.MEDIA_ERROR,details:tt.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:n,reason:n.message})}}}createSourceBuffers(t){const{sourceBuffer:e,mediaSource:i}=this;if(!i)throw Error("createSourceBuffers called when mediaSource was null");for(const r in t)if(!e[r]){const s=t[r];if(!s)throw Error(`source buffer exists for track ${r}, however track does not`);const n=s.levelCodec||s.codec,o=`${s.container};codecs=${n}`;H.log(`[buffer-controller]: creating sourceBuffer(${o})`);try{const a=e[r]=i.addSourceBuffer(o),l=r;this.addBufferListener(l,"updatestart",this._onSBUpdateStart),this.addBufferListener(l,"updateend",this._onSBUpdateEnd),this.addBufferListener(l,"error",this._onSBUpdateError),this.tracks[r]={buffer:a,codec:n,container:s.container,levelCodec:s.levelCodec,metadata:s.metadata,id:s.id}}catch(a){H.error(`[buffer-controller]: error while trying to add sourceBuffer: ${a.message}`),this.hls.trigger(D.ERROR,{type:bt.MEDIA_ERROR,details:tt.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:a,mimeType:o})}}}_onSBUpdateStart(t){const{operationQueue:e}=this;e.current(t).onStart()}_onSBUpdateEnd(t){const{operationQueue:e}=this;e.current(t).onComplete(),e.shiftAndExecuteNext(t)}_onSBUpdateError(t,e){const i=new Error(`${t} SourceBuffer error`);H.error(`[buffer-controller]: ${i}`,e),this.hls.trigger(D.ERROR,{type:bt.MEDIA_ERROR,details:tt.BUFFER_APPENDING_ERROR,error:i,fatal:!1});const r=this.operationQueue.current(t);r&&r.onError(e)}removeExecutor(t,e,i){const{media:r,mediaSource:s,operationQueue:n,sourceBuffer:o}=this,a=o[t];if(!r||!s||!a){H.warn(`[buffer-controller]: Attempting to remove from the ${t} SourceBuffer, but it does not exist`),n.shiftAndExecuteNext(t);return}const l=_t(r.duration)?r.duration:1/0,d=_t(s.duration)?s.duration:1/0,c=Math.max(0,e),f=Math.min(i,l,d);f>c&&!a.ending?(a.ended=!1,H.log(`[buffer-controller]: Removing [${c},${f}] from the ${t} SourceBuffer`),a.remove(c,f)):n.shiftAndExecuteNext(t)}appendExecutor(t,e){const{operationQueue:i,sourceBuffer:r}=this,s=r[e];if(!s){H.warn(`[buffer-controller]: Attempting to append to the ${e} SourceBuffer, but it does not exist`),i.shiftAndExecuteNext(e);return}s.ended=!1,s.appendBuffer(t)}blockBuffers(t,e=this.getSourceBufferTypes()){if(!e.length){H.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(t);return}const{operationQueue:i}=this,r=e.map(s=>i.appendBlocker(s));Promise.all(r).then(()=>{t(),e.forEach(s=>{const n=this.sourceBuffer[s];n!=null&&n.updating||i.shiftAndExecuteNext(s)})})}getSourceBufferTypes(){return Object.keys(this.sourceBuffer)}addBufferListener(t,e,i){const r=this.sourceBuffer[t];if(!r)return;const s=i.bind(this,t);this.listeners[t].push({event:e,listener:s}),r.addEventListener(e,s)}removeBufferListeners(t){const e=this.sourceBuffer[t];!e||this.listeners[t].forEach(i=>{e.removeEventListener(i.event,i.listener)})}}const Ys={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},Zn=function(t){let e=t;return Ys.hasOwnProperty(t)&&(e=Ys[t]),String.fromCharCode(e)},be=15,Oe=100,Dd={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},kd={17:2,18:4,21:6,22:8,23:10,19:13,20:15},Cd={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},Md={25:2,26:4,29:6,30:8,31:10,27:13,28:15},Pd=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class Od{constructor(){this.time=null,this.verboseLevel=0}log(t,e){if(this.verboseLevel>=t){const i=typeof e=="function"?e():e;H.log(`${this.time} [${t}] ${i}`)}}}const Ze=function(t){const e=[];for(let i=0;i<t.length;i++)e.push(t[i].toString(16));return e};class Xn{constructor(t,e,i,r,s){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=t||"white",this.underline=e||!1,this.italics=i||!1,this.background=r||"black",this.flash=s||!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(t){const e=["foreground","underline","italics","background","flash"];for(let i=0;i<e.length;i++){const r=e[i];t.hasOwnProperty(r)&&(this[r]=t[r])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(t){return this.foreground===t.foreground&&this.underline===t.underline&&this.italics===t.italics&&this.background===t.background&&this.flash===t.flash}copy(t){this.foreground=t.foreground,this.underline=t.underline,this.italics=t.italics,this.background=t.background,this.flash=t.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class Nd{constructor(t,e,i,r,s,n){this.uchar=void 0,this.penState=void 0,this.uchar=t||" ",this.penState=new Xn(e,i,r,s,n)}reset(){this.uchar=" ",this.penState.reset()}setChar(t,e){this.uchar=t,this.penState.copy(e)}setPenState(t){this.penState.copy(t)}equals(t){return this.uchar===t.uchar&&this.penState.equals(t.penState)}copy(t){this.uchar=t.uchar,this.penState.copy(t.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class Fd{constructor(t){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(let e=0;e<Oe;e++)this.chars.push(new Nd);this.logger=t,this.pos=0,this.currPenState=new Xn}equals(t){let e=!0;for(let i=0;i<Oe;i++)if(!this.chars[i].equals(t.chars[i])){e=!1;break}return e}copy(t){for(let e=0;e<Oe;e++)this.chars[e].copy(t.chars[e])}isEmpty(){let t=!0;for(let e=0;e<Oe;e++)if(!this.chars[e].isEmpty()){t=!1;break}return t}setCursor(t){this.pos!==t&&(this.pos=t),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>Oe&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=Oe)}moveCursor(t){const e=this.pos+t;if(t>1)for(let i=this.pos+1;i<e+1;i++)this.chars[i].setPenState(this.currPenState);this.setCursor(e)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(t){t>=144&&this.backSpace();const e=Zn(t);if(this.pos>=Oe){this.logger.log(0,()=>"Cannot insert "+t.toString(16)+" ("+e+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(e,this.currPenState),this.moveCursor(1)}clearFromPos(t){let e;for(e=t;e<Oe;e++)this.chars[e].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const t=[];let e=!0;for(let i=0;i<Oe;i++){const r=this.chars[i].uchar;r!==" "&&(e=!1),t.push(r)}return e?"":t.join("")}setPenStyles(t){this.currPenState.setStyles(t),this.chars[this.pos].setPenState(this.currPenState)}}class vr{constructor(t){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(let e=0;e<be;e++)this.rows.push(new Fd(t));this.logger=t,this.currRow=be-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}reset(){for(let t=0;t<be;t++)this.rows[t].clear();this.currRow=be-1}equals(t){let e=!0;for(let i=0;i<be;i++)if(!this.rows[i].equals(t.rows[i])){e=!1;break}return e}copy(t){for(let e=0;e<be;e++)this.rows[e].copy(t.rows[e])}isEmpty(){let t=!0;for(let e=0;e<be;e++)if(!this.rows[e].isEmpty()){t=!1;break}return t}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(t){this.rows[this.currRow].insertChar(t)}setPen(t){this.rows[this.currRow].setPenStyles(t)}moveCursor(t){this.rows[this.currRow].moveCursor(t)}setCursor(t){this.logger.log(2,"setCursor: "+t),this.rows[this.currRow].setCursor(t)}setPAC(t){this.logger.log(2,()=>"pacData = "+JSON.stringify(t));let e=t.row-1;if(this.nrRollUpRows&&e<this.nrRollUpRows-1&&(e=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==e){for(let o=0;o<be;o++)this.rows[o].clear();const s=this.currRow+1-this.nrRollUpRows,n=this.lastOutputScreen;if(n){const o=n.rows[s].cueStartTime,a=this.logger.time;if(o&&a!==null&&o<a)for(let l=0;l<this.nrRollUpRows;l++)this.rows[e-this.nrRollUpRows+l+1].copy(n.rows[s+l])}}this.currRow=e;const i=this.rows[this.currRow];if(t.indent!==null){const s=t.indent,n=Math.max(s-1,0);i.setCursor(t.indent),t.color=i.chars[n].penState.foreground}const r={foreground:t.color,underline:t.underline,italics:t.italics,background:"black",flash:!1};this.setPen(r)}setBkgData(t){this.logger.log(2,()=>"bkgData = "+JSON.stringify(t)),this.backSpace(),this.setPen(t),this.insertChar(32)}setRollUpRows(t){this.nrRollUpRows=t}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const t=this.currRow+1-this.nrRollUpRows,e=this.rows.splice(t,1)[0];e.clear(),this.rows.splice(this.currRow,0,e),this.logger.log(2,"Rolling up")}getDisplayText(t){t=t||!1;const e=[];let i="",r=-1;for(let s=0;s<be;s++){const n=this.rows[s].getTextString();n&&(r=s+1,t?e.push("Row "+r+": '"+n+"'"):e.push(n.trim()))}return e.length>0&&(t?i="["+e.join(" | ")+"]":i=e.join(`
`)),i}getTextAndFormat(){return this.rows}}class qs{constructor(t,e,i){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=t,this.outputFilter=e,this.mode=null,this.verbose=0,this.displayedMemory=new vr(i),this.nonDisplayedMemory=new vr(i),this.lastOutputScreen=new vr(i),this.currRollUpRow=this.displayedMemory.rows[be-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=i}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[be-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(t){this.outputFilter=t}setPAC(t){this.writeScreen.setPAC(t)}setBkgData(t){this.writeScreen.setBkgData(t)}setMode(t){t!==this.mode&&(this.mode=t,this.logger.log(2,()=>"MODE="+t),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=t)}insertChars(t){for(let i=0;i<t.length;i++)this.writeScreen.insertChar(t[i]);const e=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>e+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(t){this.logger.log(2,"RU("+t+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(t)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const t=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=t,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(t){this.logger.log(2,"TO("+t+") - Tab Offset"),this.writeScreen.moveCursor(t)}ccMIDROW(t){const e={flash:!1};if(e.underline=t%2===1,e.italics=t>=46,e.italics)e.foreground="white";else{const i=Math.floor(t/2)-16,r=["white","green","blue","cyan","red","yellow","magenta"];e.foreground=r[i]}this.logger.log(2,"MIDROW: "+JSON.stringify(e)),this.writeScreen.setPen(e)}outputDataUpdate(t=!1){const e=this.logger.time;e!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=e:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,e,this.lastOutputScreen),t&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:e),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(t){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,t,this.displayedMemory),this.cueStartTime=t))}}class Zs{constructor(t,e,i){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;const r=new Od;this.channels=[null,new qs(t,e,r),new qs(t+1,i,r)],this.cmdHistory=Qs(),this.logger=r}getHandler(t){return this.channels[t].getHandler()}setHandler(t,e){this.channels[t].setHandler(e)}addData(t,e){let i,r,s,n=!1;this.logger.time=t;for(let o=0;o<e.length;o+=2)if(r=e[o]&127,s=e[o+1]&127,!(r===0&&s===0)){if(this.logger.log(3,"["+Ze([e[o],e[o+1]])+"] -> ("+Ze([r,s])+")"),i=this.parseCmd(r,s),i||(i=this.parseMidrow(r,s)),i||(i=this.parsePAC(r,s)),i||(i=this.parseBackgroundAttributes(r,s)),!i&&(n=this.parseChars(r,s),n)){const a=this.currentChannel;a&&a>0?this.channels[a].insertChars(n):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!i&&!n&&this.logger.log(2,"Couldn't parse cleaned data "+Ze([r,s])+" orig: "+Ze([e[o],e[o+1]]))}}parseCmd(t,e){const{cmdHistory:i}=this,r=(t===20||t===28||t===21||t===29)&&e>=32&&e<=47,s=(t===23||t===31)&&e>=33&&e<=35;if(!(r||s))return!1;if(Xs(t,e,i))return ni(null,null,i),this.logger.log(3,"Repeated command ("+Ze([t,e])+") is dropped"),!0;const n=t===20||t===21||t===23?1:2,o=this.channels[n];return t===20||t===21||t===28||t===29?e===32?o.ccRCL():e===33?o.ccBS():e===34?o.ccAOF():e===35?o.ccAON():e===36?o.ccDER():e===37?o.ccRU(2):e===38?o.ccRU(3):e===39?o.ccRU(4):e===40?o.ccFON():e===41?o.ccRDC():e===42?o.ccTR():e===43?o.ccRTD():e===44?o.ccEDM():e===45?o.ccCR():e===46?o.ccENM():e===47&&o.ccEOC():o.ccTO(e-32),ni(t,e,i),this.currentChannel=n,!0}parseMidrow(t,e){let i=0;if((t===17||t===25)&&e>=32&&e<=47){if(t===17?i=1:i=2,i!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const r=this.channels[i];return r?(r.ccMIDROW(e),this.logger.log(3,"MIDROW ("+Ze([t,e])+")"),!0):!1}return!1}parsePAC(t,e){let i;const r=this.cmdHistory,s=(t>=17&&t<=23||t>=25&&t<=31)&&e>=64&&e<=127,n=(t===16||t===24)&&e>=64&&e<=95;if(!(s||n))return!1;if(Xs(t,e,r))return ni(null,null,r),!0;const o=t<=23?1:2;e>=64&&e<=95?i=o===1?Dd[t]:Cd[t]:i=o===1?kd[t]:Md[t];const a=this.channels[o];return a?(a.setPAC(this.interpretPAC(i,e)),ni(t,e,r),this.currentChannel=o,!0):!1}interpretPAC(t,e){let i;const r={color:null,italics:!1,indent:null,underline:!1,row:t};return e>95?i=e-96:i=e-64,r.underline=(i&1)===1,i<=13?r.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(i/2)]:i<=15?(r.italics=!0,r.color="white"):r.indent=Math.floor((i-16)/2)*4,r}parseChars(t,e){let i,r=null,s=null;if(t>=25?(i=2,s=t-8):(i=1,s=t),s>=17&&s<=19){let n;s===17?n=e+80:s===18?n=e+112:n=e+144,this.logger.log(2,"Special char '"+Zn(n)+"' in channel "+i),r=[n]}else t>=32&&t<=127&&(r=e===0?[t]:[t,e]);if(r){const n=Ze(r);this.logger.log(3,"Char codes =  "+n.join(",")),ni(t,e,this.cmdHistory)}return r}parseBackgroundAttributes(t,e){const i=(t===16||t===24)&&e>=32&&e<=47,r=(t===23||t===31)&&e>=45&&e<=47;if(!(i||r))return!1;let s;const n={};t===16||t===24?(s=Math.floor((e-32)/2),n.background=Pd[s],e%2===1&&(n.background=n.background+"_semi")):e===45?n.background="transparent":(n.foreground="black",e===47&&(n.underline=!0));const o=t<=23?1:2;return this.channels[o].setBkgData(n),ni(t,e,this.cmdHistory),!0}reset(){for(let t=0;t<Object.keys(this.channels).length;t++){const e=this.channels[t];e&&e.reset()}this.cmdHistory=Qs()}cueSplitAtTime(t){for(let e=0;e<this.channels.length;e++){const i=this.channels[e];i&&i.cueSplitAtTime(t)}}}function ni(u,t,e){e.a=u,e.b=t}function Xs(u,t,e){return e.a===u&&e.b===t}function Qs(){return{a:null,b:null}}class Di{constructor(t,e){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=t,this.trackName=e}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(t,e,i){(this.startTime===null||this.startTime>t)&&(this.startTime=t),this.endTime=e,this.screen=i,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}var qr=function(){if(typeof self!="undefined"&&self.VTTCue)return self.VTTCue;const u=["","lr","rl"],t=["start","middle","end","left","right"];function e(o,a){if(typeof a!="string"||!Array.isArray(o))return!1;const l=a.toLowerCase();return~o.indexOf(l)?l:!1}function i(o){return e(u,o)}function r(o){return e(t,o)}function s(o,...a){let l=1;for(;l<arguments.length;l++){const d=arguments[l];for(const c in d)o[c]=d[c]}return o}function n(o,a,l){const d=this,c={enumerable:!0};d.hasBeenReset=!1;let f="",h=!1,p=o,g=a,x=l,E=null,k="",O=!0,T="auto",R="start",C=50,b="middle",A=50,L="middle";Object.defineProperty(d,"id",s({},c,{get:function(){return f},set:function(I){f=""+I}})),Object.defineProperty(d,"pauseOnExit",s({},c,{get:function(){return h},set:function(I){h=!!I}})),Object.defineProperty(d,"startTime",s({},c,{get:function(){return p},set:function(I){if(typeof I!="number")throw new TypeError("Start time must be set to a number.");p=I,this.hasBeenReset=!0}})),Object.defineProperty(d,"endTime",s({},c,{get:function(){return g},set:function(I){if(typeof I!="number")throw new TypeError("End time must be set to a number.");g=I,this.hasBeenReset=!0}})),Object.defineProperty(d,"text",s({},c,{get:function(){return x},set:function(I){x=""+I,this.hasBeenReset=!0}})),Object.defineProperty(d,"region",s({},c,{get:function(){return E},set:function(I){E=I,this.hasBeenReset=!0}})),Object.defineProperty(d,"vertical",s({},c,{get:function(){return k},set:function(I){const j=i(I);if(j===!1)throw new SyntaxError("An invalid or illegal string was specified.");k=j,this.hasBeenReset=!0}})),Object.defineProperty(d,"snapToLines",s({},c,{get:function(){return O},set:function(I){O=!!I,this.hasBeenReset=!0}})),Object.defineProperty(d,"line",s({},c,{get:function(){return T},set:function(I){if(typeof I!="number"&&I!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");T=I,this.hasBeenReset=!0}})),Object.defineProperty(d,"lineAlign",s({},c,{get:function(){return R},set:function(I){const j=r(I);if(!j)throw new SyntaxError("An invalid or illegal string was specified.");R=j,this.hasBeenReset=!0}})),Object.defineProperty(d,"position",s({},c,{get:function(){return C},set:function(I){if(I<0||I>100)throw new Error("Position must be between 0 and 100.");C=I,this.hasBeenReset=!0}})),Object.defineProperty(d,"positionAlign",s({},c,{get:function(){return b},set:function(I){const j=r(I);if(!j)throw new SyntaxError("An invalid or illegal string was specified.");b=j,this.hasBeenReset=!0}})),Object.defineProperty(d,"size",s({},c,{get:function(){return A},set:function(I){if(I<0||I>100)throw new Error("Size must be between 0 and 100.");A=I,this.hasBeenReset=!0}})),Object.defineProperty(d,"align",s({},c,{get:function(){return L},set:function(I){const j=r(I);if(!j)throw new SyntaxError("An invalid or illegal string was specified.");L=j,this.hasBeenReset=!0}})),d.displayState=void 0}return n.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},n}();class Bd{decode(t,e){if(!t)return"";if(typeof t!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(t))}}function Qn(u){function t(i,r,s,n){return(i|0)*3600+(r|0)*60+(s|0)+parseFloat(n||0)}const e=u.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return e?parseFloat(e[2])>59?t(e[2],e[3],0,e[4]):t(e[1],e[2],e[3],e[4]):null}class Ud{constructor(){this.values=Object.create(null)}set(t,e){!this.get(t)&&e!==""&&(this.values[t]=e)}get(t,e,i){return i?this.has(t)?this.values[t]:e[i]:this.has(t)?this.values[t]:e}has(t){return t in this.values}alt(t,e,i){for(let r=0;r<i.length;++r)if(e===i[r]){this.set(t,e);break}}integer(t,e){/^-?\d+$/.test(e)&&this.set(t,parseInt(e,10))}percent(t,e){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(e)){const i=parseFloat(e);if(i>=0&&i<=100)return this.set(t,i),!0}return!1}}function Jn(u,t,e,i){const r=i?u.split(i):[u];for(const s in r){if(typeof r[s]!="string")continue;const n=r[s].split(e);if(n.length!==2)continue;const o=n[0],a=n[1];t(o,a)}}const Mr=new qr(0,0,""),ki=Mr.align==="middle"?"middle":"center";function jd(u,t,e){const i=u;function r(){const o=Qn(u);if(o===null)throw new Error("Malformed timestamp: "+i);return u=u.replace(/^[^\sa-zA-Z-]+/,""),o}function s(o,a){const l=new Ud;Jn(o,function(f,h){let p;switch(f){case"region":for(let g=e.length-1;g>=0;g--)if(e[g].id===h){l.set(f,e[g].region);break}break;case"vertical":l.alt(f,h,["rl","lr"]);break;case"line":p=h.split(","),l.integer(f,p[0]),l.percent(f,p[0])&&l.set("snapToLines",!1),l.alt(f,p[0],["auto"]),p.length===2&&l.alt("lineAlign",p[1],["start",ki,"end"]);break;case"position":p=h.split(","),l.percent(f,p[0]),p.length===2&&l.alt("positionAlign",p[1],["start",ki,"end","line-left","line-right","auto"]);break;case"size":l.percent(f,h);break;case"align":l.alt(f,h,["start",ki,"end","left","right"]);break}},/:/,/\s/),a.region=l.get("region",null),a.vertical=l.get("vertical","");let d=l.get("line","auto");d==="auto"&&Mr.line===-1&&(d=-1),a.line=d,a.lineAlign=l.get("lineAlign","start"),a.snapToLines=l.get("snapToLines",!0),a.size=l.get("size",100),a.align=l.get("align",ki);let c=l.get("position","auto");c==="auto"&&Mr.position===50&&(c=a.align==="start"||a.align==="left"?0:a.align==="end"||a.align==="right"?100:50),a.position=c}function n(){u=u.replace(/^\s+/,"")}if(n(),t.startTime=r(),n(),u.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+i);u=u.slice(3),n(),t.endTime=r(),n(),s(u,t)}function ta(u){return u.replace(/<br(?: \/)?>/gi,`
`)}class $d{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new Bd,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(t){const e=this;t&&(e.buffer+=e.decoder.decode(t,{stream:!0}));function i(){let s=e.buffer,n=0;for(s=ta(s);n<s.length&&s[n]!=="\r"&&s[n]!==`
`;)++n;const o=s.slice(0,n);return s[n]==="\r"&&++n,s[n]===`
`&&++n,e.buffer=s.slice(n),o}function r(s){Jn(s,function(n,o){},/:/)}try{let s="";if(e.state==="INITIAL"){if(!/\r\n|\n/.test(e.buffer))return this;s=i();const o=s.match(/^()?WEBVTT([ \t].*)?$/);if(!(o!=null&&o[0]))throw new Error("Malformed WebVTT signature.");e.state="HEADER"}let n=!1;for(;e.buffer;){if(!/\r\n|\n/.test(e.buffer))return this;switch(n?n=!1:s=i(),e.state){case"HEADER":/:/.test(s)?r(s):s||(e.state="ID");continue;case"NOTE":s||(e.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(s)){e.state="NOTE";break}if(!s)continue;if(e.cue=new qr(0,0,""),e.state="CUE",s.indexOf("-->")===-1){e.cue.id=s;continue}case"CUE":if(!e.cue){e.state="BADCUE";continue}try{jd(s,e.cue,e.regionList)}catch(o){e.cue=null,e.state="BADCUE";continue}e.state="CUETEXT";continue;case"CUETEXT":{const o=s.indexOf("-->")!==-1;if(!s||o&&(n=!0)){e.oncue&&e.cue&&e.oncue(e.cue),e.cue=null,e.state="ID";continue}if(e.cue===null)continue;e.cue.text&&(e.cue.text+=`
`),e.cue.text+=s}continue;case"BADCUE":s||(e.state="ID")}}}catch(s){e.state==="CUETEXT"&&e.cue&&e.oncue&&e.oncue(e.cue),e.cue=null,e.state=e.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const t=this;try{if((t.cue||t.state==="HEADER")&&(t.buffer+=`

`,t.parse()),t.state==="INITIAL"||t.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(e){t.onparsingerror&&t.onparsingerror(e)}return t.onflush&&t.onflush(),this}}const Gd=/\r\n|\n\r|\n|\r/g,_r=function(t,e,i=0){return t.slice(i,i+e.length)===e},Vd=function(t){let e=parseInt(t.slice(-3));const i=parseInt(t.slice(-6,-4)),r=parseInt(t.slice(-9,-7)),s=t.length>9?parseInt(t.substring(0,t.indexOf(":"))):0;if(!_t(e)||!_t(i)||!_t(r)||!_t(s))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${t}`);return e+=1e3*i,e+=60*1e3*r,e+=60*60*1e3*s,e},xr=function(t){let e=5381,i=t.length;for(;i;)e=e*33^t.charCodeAt(--i);return(e>>>0).toString()};function Zr(u,t,e){return xr(u.toString())+xr(t.toString())+xr(e)}const zd=function(t,e,i){let r=t[e],s=t[r.prevCC];if(!s||!s.new&&r.new){t.ccOffset=t.presentationOffset=r.start,r.new=!1;return}for(;(n=s)!=null&&n.new;){var n;t.ccOffset+=r.start-s.start,r.new=!1,r=s,s=t[r.prevCC]}t.presentationOffset=i};function Hd(u,t,e,i,r,s,n){const o=new $d,a=Re(new Uint8Array(u)).trim().replace(Gd,`
`).split(`
`),l=[],d=id(t.baseTime,t.timescale);let c="00:00.000",f=0,h=0,p,g=!0;o.oncue=function(x){const E=e[i];let k=e.ccOffset;const O=(f-d)/9e4;E!=null&&E.new&&(h!==void 0?k=e.ccOffset=E.start:zd(e,i,O)),O&&(k=O-e.presentationOffset);const T=x.endTime-x.startTime,R=me((x.startTime+k-h)*9e4,r*9e4)/9e4;x.startTime=Math.max(R,0),x.endTime=Math.max(R+T,0);const C=x.text.trim();x.text=decodeURIComponent(encodeURIComponent(C)),x.id||(x.id=Zr(x.startTime,x.endTime,C)),x.endTime>0&&l.push(x)},o.onparsingerror=function(x){p=x},o.onflush=function(){if(p){n(p);return}s(l)},a.forEach(x=>{if(g)if(_r(x,"X-TIMESTAMP-MAP=")){g=!1,x.slice(16).split(",").forEach(E=>{_r(E,"LOCAL:")?c=E.slice(6):_r(E,"MPEGTS:")&&(f=parseInt(E.slice(7)))});try{h=Vd(c)/1e3}catch(E){p=E}return}else x===""&&(g=!1);o.parse(x+`
`)}),o.flush()}const Er="stpp.ttml.im1t",ea=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,ia=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,Kd={left:"start",center:"center",right:"end",start:"start",end:"end"};function Js(u,t,e,i){const r=Mt(new Uint8Array(u),["mdat"]);if(r.length===0){i(new Error("Could not parse IMSC1 mdat"));return}const s=r.map(o=>Re(o)),n=ed(t.baseTime,1,t.timescale);try{s.forEach(o=>e(Wd(o,n)))}catch(o){i(o)}}function Wd(u,t){const r=new DOMParser().parseFromString(u,"text/xml").getElementsByTagName("tt")[0];if(!r)throw new Error("Invalid ttml");const s={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},n=Object.keys(s).reduce((c,f)=>(c[f]=r.getAttribute(`ttp:${f}`)||s[f],c),{}),o=r.getAttribute("xml:space")!=="preserve",a=tn(br(r,"styling","style")),l=tn(br(r,"layout","region")),d=br(r,"body","[begin]");return[].map.call(d,c=>{const f=ra(c,o);if(!f||!c.hasAttribute("begin"))return null;const h=Sr(c.getAttribute("begin"),n),p=Sr(c.getAttribute("dur"),n);let g=Sr(c.getAttribute("end"),n);if(h===null)throw en(c);if(g===null){if(p===null)throw en(c);g=h+p}const x=new qr(h-t,g-t,f);x.id=Zr(x.startTime,x.endTime,x.text);const E=l[c.getAttribute("region")],k=a[c.getAttribute("style")],O=Yd(E,k,a),{textAlign:T}=O;if(T){const R=Kd[T];R&&(x.lineAlign=R),x.align=T}return Jt(x,O),x}).filter(c=>c!==null)}function br(u,t,e){const i=u.getElementsByTagName(t)[0];return i?[].slice.call(i.querySelectorAll(e)):[]}function tn(u){return u.reduce((t,e)=>{const i=e.getAttribute("xml:id");return i&&(t[i]=e),t},{})}function ra(u,t){return[].slice.call(u.childNodes).reduce((e,i,r)=>{var s;return i.nodeName==="br"&&r?e+`
`:(s=i.childNodes)!=null&&s.length?ra(i,t):t?e+i.textContent.trim().replace(/\s+/g," "):e+i.textContent},"")}function Yd(u,t,e){const i="http://www.w3.org/ns/ttml#styling";let r=null;const s=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],n=u!=null&&u.hasAttribute("style")?u.getAttribute("style"):null;return n&&e.hasOwnProperty(n)&&(r=e[n]),s.reduce((o,a)=>{const l=Tr(t,i,a)||Tr(u,i,a)||Tr(r,i,a);return l&&(o[a]=l),o},{})}function Tr(u,t,e){return u&&u.hasAttributeNS(t,e)?u.getAttributeNS(t,e):null}function en(u){return new Error(`Could not parse ttml timestamp ${u}`)}function Sr(u,t){if(!u)return null;let e=Qn(u);return e===null&&(ea.test(u)?e=qd(u,t):ia.test(u)&&(e=Zd(u,t))),e}function qd(u,t){const e=ea.exec(u),i=(e[4]|0)+(e[5]|0)/t.subFrameRate;return(e[1]|0)*3600+(e[2]|0)*60+(e[3]|0)+i/t.frameRate}function Zd(u,t){const e=ia.exec(u),i=Number(e[1]);switch(e[2]){case"h":return i*3600;case"m":return i*60;case"ms":return i*1e3;case"f":return i/t.frameRate;case"t":return i/t.tickRate}return i}class Xd{constructor(t){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=rn(),this.captionsProperties=void 0,this.hls=t,this.config=t.config,this.Cues=t.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){const e=new Di(this,"textTrack1"),i=new Di(this,"textTrack2"),r=new Di(this,"textTrack3"),s=new Di(this,"textTrack4");this.cea608Parser1=new Zs(1,e,i),this.cea608Parser2=new Zs(3,r,s)}t.on(D.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(D.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(D.MANIFEST_LOADING,this.onManifestLoading,this),t.on(D.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(D.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.on(D.FRAG_LOADING,this.onFragLoading,this),t.on(D.FRAG_LOADED,this.onFragLoaded,this),t.on(D.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.on(D.FRAG_DECRYPTED,this.onFragDecrypted,this),t.on(D.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(D.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.on(D.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:t}=this;t.off(D.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(D.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(D.MANIFEST_LOADING,this.onManifestLoading,this),t.off(D.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(D.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.off(D.FRAG_LOADING,this.onFragLoading,this),t.off(D.FRAG_LOADED,this.onFragLoaded,this),t.off(D.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.off(D.FRAG_DECRYPTED,this.onFragDecrypted,this),t.off(D.INIT_PTS_FOUND,this.onInitPtsFound,this),t.off(D.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.off(D.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null}addCues(t,e,i,r,s){let n=!1;for(let o=s.length;o--;){const a=s[o],l=Jd(a[0],a[1],e,i);if(l>=0&&(a[0]=Math.min(a[0],e),a[1]=Math.max(a[1],i),n=!0,l/(i-e)>.5))return}if(n||s.push([e,i]),this.config.renderTextTracksNatively){const o=this.captionsTracks[t];this.Cues.newCue(o,e,i,r)}else{const o=this.Cues.newCue(null,e,i,r);this.hls.trigger(D.CUES_PARSED,{type:"captions",cues:o,track:t})}}onInitPtsFound(t,{frag:e,id:i,initPTS:r,timescale:s}){const{unparsedVttFrags:n}=this;i==="main"&&(this.initPTS[e.cc]={baseTime:r,timescale:s}),n.length&&(this.unparsedVttFrags=[],n.forEach(o=>{this.onFragLoaded(D.FRAG_LOADED,o)}))}getExistingTrack(t){const{media:e}=this;if(e)for(let i=0;i<e.textTracks.length;i++){const r=e.textTracks[i];if(r[t])return r}return null}createCaptionsTrack(t){this.config.renderTextTracksNatively?this.createNativeTrack(t):this.createNonNativeTrack(t)}createNativeTrack(t){if(this.captionsTracks[t])return;const{captionsProperties:e,captionsTracks:i,media:r}=this,{label:s,languageCode:n}=e[t],o=this.getExistingTrack(t);if(o)i[t]=o,ai(i[t]),An(i[t],r);else{const a=this.createTextTrack("captions",s,n);a&&(a[t]=!0,i[t]=a)}}createNonNativeTrack(t){if(this.nonNativeCaptionsTracks[t])return;const e=this.captionsProperties[t];if(!e)return;const i=e.label,r={_id:t,label:i,kind:"captions",default:e.media?!!e.media.default:!1,closedCaptions:e.media};this.nonNativeCaptionsTracks[t]=r,this.hls.trigger(D.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[r]})}createTextTrack(t,e,i){const r=this.media;if(!!r)return r.addTextTrack(t,e,i)}onMediaAttaching(t,e){this.media=e.media,this._cleanTracks()}onMediaDetaching(){const{captionsTracks:t}=this;Object.keys(t).forEach(e=>{ai(t[e]),delete t[e]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=rn(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:t}=this;if(!t)return;const e=t.textTracks;if(e)for(let i=0;i<e.length;i++)ai(e[i])}onSubtitleTracksUpdated(t,e){const i=e.subtitleTracks||[],r=i.some(s=>s.textCodec===Er);if(this.config.enableWebVTT||r&&this.config.enableIMSC1){if(qn(this.tracks,i)){this.tracks=i;return}if(this.textTracks=[],this.tracks=i,this.config.renderTextTracksNatively){const n=this.media?this.media.textTracks:null;this.tracks.forEach((o,a)=>{let l;if(n&&a<n.length){let d=null;for(let c=0;c<n.length;c++)if(Qd(n[c],o)){d=n[c];break}d&&(l=d)}if(l)ai(l);else{const d=this._captionsOrSubtitlesFromCharacteristics(o);l=this.createTextTrack(d,o.name,o.lang),l&&(l.mode="disabled")}l&&(l.groupId=o.groupId,this.textTracks.push(l))})}else if(this.tracks.length){const n=this.tracks.map(o=>({label:o.name,kind:o.type.toLowerCase(),default:o.default,subtitleTrack:o}));this.hls.trigger(D.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:n})}}}_captionsOrSubtitlesFromCharacteristics(t){if(t.attrs.CHARACTERISTICS){const e=/transcribes-spoken-dialog/gi.test(t.attrs.CHARACTERISTICS),i=/describes-music-and-sound/gi.test(t.attrs.CHARACTERISTICS);if(e&&i)return"captions"}return"subtitles"}onManifestLoaded(t,e){this.config.enableCEA708Captions&&e.captions&&e.captions.forEach(i=>{const r=/(?:CC|SERVICE)([1-4])/.exec(i.instreamId);if(!r)return;const s=`textTrack${r[1]}`,n=this.captionsProperties[s];!n||(n.label=i.name,i.lang&&(n.languageCode=i.lang),n.media=i)})}closedCaptionsForLevel(t){const e=this.hls.levels[t.level];return e==null?void 0:e.attrs["CLOSED-CAPTIONS"]}onFragLoading(t,e){const{cea608Parser1:i,cea608Parser2:r,lastSn:s,lastPartIndex:n}=this;if(!(!this.enabled||!(i&&r))&&e.frag.type===Tt.MAIN){var o,a;const l=e.frag.sn,d=(o=e==null||(a=e.part)==null?void 0:a.index)!=null?o:-1;l===s+1||l===s&&d===n+1||(i.reset(),r.reset()),this.lastSn=l,this.lastPartIndex=d}}onFragLoaded(t,e){const{frag:i,payload:r}=e,{initPTS:s,unparsedVttFrags:n}=this;if(i.type===Tt.SUBTITLE)if(r.byteLength){if(!s[i.cc]){n.push(e),s.length&&this.hls.trigger(D.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:new Error("Missing initial subtitle PTS")});return}const o=i.decryptdata,a="stats"in e;if(o==null||!o.encrypted||a){const l=this.tracks[i.level],d=this.vttCCs;d[i.cc]||(d[i.cc]={start:i.start,prevCC:this.prevCC,new:!0},this.prevCC=i.cc),l&&l.textCodec===Er?this._parseIMSC1(i,r):this._parseVTTs(i,r,d)}}else this.hls.trigger(D.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:new Error("Empty subtitle payload")})}_parseIMSC1(t,e){const i=this.hls;Js(e,this.initPTS[t.cc],r=>{this._appendCues(r,t.level),i.trigger(D.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:t})},r=>{H.log(`Failed to parse IMSC1: ${r}`),i.trigger(D.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:r})})}_parseVTTs(t,e,i){var r;const s=this.hls,n=(r=t.initSegment)!=null&&r.data?Je(t.initSegment.data,new Uint8Array(e)):e;Hd(n,this.initPTS[t.cc],i,t.cc,t.start,o=>{this._appendCues(o,t.level),s.trigger(D.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:t})},o=>{this._fallbackToIMSC1(t,e),H.log(`Failed to parse VTT cue: ${o}`),s.trigger(D.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:o})})}_fallbackToIMSC1(t,e){const i=this.tracks[t.level];i.textCodec||Js(e,this.initPTS[t.cc],()=>{i.textCodec=Er,this._parseIMSC1(t,e)},()=>{i.textCodec="wvtt"})}_appendCues(t,e){const i=this.hls;if(this.config.renderTextTracksNatively){const r=this.textTracks[e];if(!r||r.mode==="disabled")return;t.forEach(s=>Ln(r,s))}else{const r=this.tracks[e];if(!r)return;const s=r.default?"default":"subtitles"+e;i.trigger(D.CUES_PARSED,{type:"subtitles",cues:t,track:s})}}onFragDecrypted(t,e){const{frag:i}=e;if(i.type===Tt.SUBTITLE){if(!this.initPTS[i.cc]){this.unparsedVttFrags.push(e);return}this.onFragLoaded(D.FRAG_LOADED,e)}}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(t,e){const{cea608Parser1:i,cea608Parser2:r}=this;if(!this.enabled||!(i&&r))return;const{frag:s,samples:n}=e;if(!(s.type===Tt.MAIN&&this.closedCaptionsForLevel(s)==="NONE"))for(let o=0;o<n.length;o++){const a=n[o].bytes;if(a){const l=this.extractCea608Data(a);i.addData(n[o].pts,l[0]),r.addData(n[o].pts,l[1])}}}onBufferFlushing(t,{startOffset:e,endOffset:i,endOffsetSubtitles:r,type:s}){const{media:n}=this;if(!(!n||n.currentTime<i)){if(!s||s==="video"){const{captionsTracks:o}=this;Object.keys(o).forEach(a=>Ir(o[a],e,i))}if(this.config.renderTextTracksNatively&&e===0&&r!==void 0){const{textTracks:o}=this;Object.keys(o).forEach(a=>Ir(o[a],e,r))}}}extractCea608Data(t){const e=[[],[]],i=t[0]&31;let r=2;for(let s=0;s<i;s++){const n=t[r++],o=127&t[r++],a=127&t[r++];if(o===0&&a===0)continue;if((4&n)!==0){const d=3&n;(d===0||d===1)&&(e[d].push(o),e[d].push(a))}}return e}}function Qd(u,t){return!!u&&u.label===t.name&&!(u.textTrack1||u.textTrack2)}function Jd(u,t,e,i){return Math.min(t,i)-Math.max(u,e)}function rn(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}class Xr{constructor(t){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=t,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(t){this.streamController=t}destroy(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:t}=this;t.on(D.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),t.on(D.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(D.MANIFEST_PARSED,this.onManifestParsed,this),t.on(D.BUFFER_CODECS,this.onBufferCodecs,this),t.on(D.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:t}=this;t.off(D.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),t.off(D.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(D.MANIFEST_PARSED,this.onManifestParsed,this),t.off(D.BUFFER_CODECS,this.onBufferCodecs,this),t.off(D.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(t,e){const i=this.hls.levels[e.droppedLevel];this.isLevelAllowed(i)&&this.restrictedLevels.push({bitrate:i.bitrate,height:i.height,width:i.width})}onMediaAttaching(t,e){this.media=e.media instanceof HTMLVideoElement?e.media:null,this.clientRect=null}onManifestParsed(t,e){const i=this.hls;this.restrictedLevels=[],this.firstLevel=e.firstLevel,i.config.capLevelToPlayerSize&&e.video&&this.startCapping()}onBufferCodecs(t,e){this.hls.config.capLevelToPlayerSize&&e.video&&this.startCapping()}onMediaDetaching(){this.stopCapping()}detectPlayerSize(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){const t=this.hls.levels;if(t.length){const e=this.hls;e.autoLevelCapping=this.getMaxLevel(t.length-1),e.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=e.autoLevelCapping}}}getMaxLevel(t){const e=this.hls.levels;if(!e.length)return-1;const i=e.filter((r,s)=>this.isLevelAllowed(r)&&s<=t);return this.clientRect=null,Xr.getMaxLevelByMediaSize(i,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const t=this.media,e={width:0,height:0};if(t){const i=t.getBoundingClientRect();e.width=i.width,e.height=i.height,!e.width&&!e.height&&(e.width=i.right-i.left||t.width||0,e.height=i.bottom-i.top||t.height||0)}return this.clientRect=e,e}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let t=1;if(!this.hls.config.ignoreDevicePixelRatio)try{t=self.devicePixelRatio}catch(e){}return t}isLevelAllowed(t){return!this.restrictedLevels.some(i=>t.bitrate===i.bitrate&&t.width===i.width&&t.height===i.height)}static getMaxLevelByMediaSize(t,e,i){if(!(t!=null&&t.length))return-1;const r=(n,o)=>o?n.width!==o.width||n.height!==o.height:!0;let s=t.length-1;for(let n=0;n<t.length;n+=1){const o=t[n];if((o.width>=e||o.height>=i)&&r(o,t[n+1])){s=n;break}}return s}}class tc{constructor(t){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=t,this.registerListeners()}setStreamController(t){this.streamController=t}registerListeners(){this.hls.on(D.MEDIA_ATTACHING,this.onMediaAttaching,this)}unregisterListeners(){this.hls.off(D.MEDIA_ATTACHING,this.onMediaAttaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(t,e){const i=this.hls.config;if(i.capLevelOnFPSDrop){const r=e.media instanceof self.HTMLVideoElement?e.media:null;this.media=r,r&&typeof r.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),i.fpsDroppedMonitoringPeriod)}}checkFPS(t,e,i){const r=performance.now();if(e){if(this.lastTime){const s=r-this.lastTime,n=i-this.lastDroppedFrames,o=e-this.lastDecodedFrames,a=1e3*n/s,l=this.hls;if(l.trigger(D.FPS_DROP,{currentDropped:n,currentDecoded:o,totalDroppedFrames:i}),a>0&&n>l.config.fpsDroppedMonitoringThreshold*o){let d=l.currentLevel;H.warn("drop FPS ratio greater than max allowed value for currentLevel: "+d),d>0&&(l.autoLevelCapping===-1||l.autoLevelCapping>=d)&&(d=d-1,l.trigger(D.FPS_DROP_LEVEL_CAPPING,{level:d,droppedLevel:l.currentLevel}),l.autoLevelCapping=d,this.streamController.nextLevelSwitch())}}this.lastTime=r,this.lastDroppedFrames=i,this.lastDecodedFrames=e}}checkFPSInterval(){const t=this.media;if(t)if(this.isVideoPlaybackQualityAvailable){const e=t.getVideoPlaybackQuality();this.checkFPS(t,e.totalVideoFrames,e.droppedVideoFrames)}else this.checkFPS(t,t.webkitDecodedFrameCount,t.webkitDroppedFrameCount)}}const Ci="[eme]";class oi{constructor(t){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=oi.CDMCleanupPromise?[oi.CDMCleanupPromise]:[],this.onMediaEncrypted=this._onMediaEncrypted.bind(this),this.onWaitingForKey=this._onWaitingForKey.bind(this),this.debug=H.debug.bind(H,Ci),this.log=H.log.bind(H,Ci),this.warn=H.warn.bind(H,Ci),this.error=H.error.bind(H,Ci),this.hls=t,this.config=t.config,this.registerListeners()}destroy(){this.unregisterListeners(),this.onMediaDetached();const t=this.config;t.requestMediaKeySystemAccessFunc=null,t.licenseXhrSetup=t.licenseResponseCallback=void 0,t.drmSystems=t.drmSystemOptions={},this.hls=this.onMediaEncrypted=this.onWaitingForKey=this.keyIdToKeySessionPromise=null,this.config=null}registerListeners(){this.hls.on(D.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(D.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(D.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(D.MANIFEST_LOADED,this.onManifestLoaded,this)}unregisterListeners(){this.hls.off(D.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(D.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(D.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(D.MANIFEST_LOADED,this.onManifestLoaded,this)}getLicenseServerUrl(t){const{drmSystems:e,widevineLicenseUrl:i}=this.config,r=e[t];if(r)return r.licenseUrl;if(t===Wt.WIDEVINE&&i)return i;throw new Error(`no license server URL configured for key-system "${t}"`)}getServerCertificateUrl(t){const{drmSystems:e}=this.config,i=e[t];if(i)return i.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${t}"]`)}attemptKeySystemAccess(t){const e=this.hls.levels,i=(n,o,a)=>!!n&&a.indexOf(n)===o,r=e.map(n=>n.audioCodec).filter(i),s=e.map(n=>n.videoCodec).filter(i);return r.length+s.length===0&&s.push("avc1.42e01e"),new Promise((n,o)=>{const a=l=>{const d=l.shift();this.getMediaKeysPromise(d,r,s).then(c=>n({keySystem:d,mediaKeys:c})).catch(c=>{l.length?a(l):c instanceof pe?o(c):o(new pe({type:bt.KEY_SYSTEM_ERROR,details:tt.KEY_SYSTEM_NO_ACCESS,error:c,fatal:!0},c.message))})};a(t)})}requestMediaKeySystemAccess(t,e){const{requestMediaKeySystemAccessFunc:i}=this.config;if(typeof i!="function"){let r=`Configured requestMediaKeySystemAccess is not a function ${i}`;return fn===null&&self.location.protocol==="http:"&&(r=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(r))}return i(t,e)}getMediaKeysPromise(t,e,i){const r=po(t,e,i,this.config.drmSystemOptions),s=this.keySystemAccessPromises[t];let n=s==null?void 0:s.keySystemAccess;if(!n){this.log(`Requesting encrypted media "${t}" key-system access with config: ${JSON.stringify(r)}`),n=this.requestMediaKeySystemAccess(t,r);const o=this.keySystemAccessPromises[t]={keySystemAccess:n};return n.catch(a=>{this.log(`Failed to obtain access to key-system "${t}": ${a}`)}),n.then(a=>{this.log(`Access for key-system "${a.keySystem}" obtained`);const l=this.fetchServerCertificate(t);return this.log(`Create media-keys for "${t}"`),o.mediaKeys=a.createMediaKeys().then(d=>(this.log(`Media-keys created for "${t}"`),l.then(c=>c?this.setMediaKeysServerCertificate(d,t,c):d))),o.mediaKeys.catch(d=>{this.error(`Failed to create media-keys for "${t}"}: ${d}`)}),o.mediaKeys})}return n.then(()=>s.mediaKeys)}createMediaKeySessionContext({decryptdata:t,keySystem:e,mediaKeys:i}){this.log(`Creating key-system session "${e}" keyId: ${Ie.hexDump(t.keyId||[])}`);const r=i.createSession(),s={decryptdata:t,keySystem:e,mediaKeys:i,mediaKeysSession:r,keyStatus:"status-pending"};return this.mediaKeySessions.push(s),s}renewKeySession(t){const e=t.decryptdata;if(e.pssh){const i=this.createMediaKeySessionContext(t),r=this.getKeyIdString(e),s="cenc";this.keyIdToKeySessionPromise[r]=this.generateRequestWithPreferredKeySession(i,s,e.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(t)}getKeyIdString(t){if(!t)throw new Error("Could not read keyId of undefined decryptdata");if(t.keyId===null)throw new Error("keyId is null");return Ie.hexDump(t.keyId)}updateKeySession(t,e){var i;const r=t.mediaKeysSession;return this.log(`Updating key-session "${r.sessionId}" for keyID ${Ie.hexDump(((i=t.decryptdata)==null?void 0:i.keyId)||[])}
      } (data length: ${e&&e.byteLength})`),r.update(e)}selectKeySystemFormat(t){const e=Object.keys(t.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${t.sn} ${t.type}: ${t.level}) key formats ${e.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(e)),this.keyFormatPromise}getKeyFormatPromise(t){return new Promise((e,i)=>{const r=ir(this.config),s=t.map(fs).filter(n=>!!n&&r.indexOf(n)!==-1);return this.getKeySystemSelectionPromise(s).then(({keySystem:n})=>{const o=ps(n);o?e(o):i(new Error(`Unable to find format for key-system "${n}"`))}).catch(i)})}loadKey(t){const e=t.keyInfo.decryptdata,i=this.getKeyIdString(e),r=`(keyId: ${i} format: "${e.keyFormat}" method: ${e.method} uri: ${e.uri})`;this.log(`Starting session for key ${r}`);let s=this.keyIdToKeySessionPromise[i];return s||(s=this.keyIdToKeySessionPromise[i]=this.getKeySystemForKeyPromise(e).then(({keySystem:n,mediaKeys:o})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${t.frag.sn} ${t.frag.type}: ${t.frag.level} using key ${r}`),this.attemptSetMediaKeys(n,o).then(()=>{this.throwIfDestroyed();const a=this.createMediaKeySessionContext({keySystem:n,mediaKeys:o,decryptdata:e}),l="cenc";return this.generateRequestWithPreferredKeySession(a,l,e.pssh,"playlist-key")}))),s.catch(n=>this.handleError(n))),s}throwIfDestroyed(t="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(t){!this.hls||(this.error(t.message),t instanceof pe?this.hls.trigger(D.ERROR,t.data):this.hls.trigger(D.ERROR,{type:bt.KEY_SYSTEM_ERROR,details:tt.KEY_SYSTEM_NO_KEYS,error:t,fatal:!0}))}getKeySystemForKeyPromise(t){const e=this.getKeyIdString(t),i=this.keyIdToKeySessionPromise[e];if(!i){const r=fs(t.keyFormat),s=r?[r]:ir(this.config);return this.attemptKeySystemAccess(s)}return i}getKeySystemSelectionPromise(t){if(t.length||(t=ir(this.config)),t.length===0)throw new pe({type:bt.KEY_SYSTEM_ERROR,details:tt.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${JSON.stringify({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(t)}_onMediaEncrypted(t){const{initDataType:e,initData:i}=t;if(this.debug(`"${t.type}" event: init data type: "${e}"`),i===null)return;let r,s;if(e==="sinf"&&this.config.drmSystems[Wt.FAIRPLAY]){const d=ie(new Uint8Array(i));try{const c=Fr(JSON.parse(d).sinf),f=En(new Uint8Array(c));if(!f)return;r=f.subarray(8,24),s=Wt.FAIRPLAY}catch(c){this.warn('Failed to parse sinf "encrypted" event message initData');return}}else{const d=Bo(i);if(d===null)return;d.version===0&&d.systemId===hn.WIDEVINE&&d.data&&(r=d.data.subarray(8,24)),s=fo(d.systemId)}if(!s||!r)return;const n=Ie.hexDump(r),{keyIdToKeySessionPromise:o,mediaKeySessions:a}=this;let l=o[n];for(let d=0;d<a.length;d++){const c=a[d],f=c.decryptdata;if(f.pssh||!f.keyId)continue;const h=Ie.hexDump(f.keyId);if(n===h||f.uri.replace(/-/g,"").indexOf(n)!==-1){l=o[h],delete o[h],f.pssh=new Uint8Array(i),f.keyId=r,l=o[n]=l.then(()=>this.generateRequestWithPreferredKeySession(c,e,i,"encrypted-event-key-match"));break}}l||(l=o[n]=this.getKeySystemSelectionPromise([s]).then(({keySystem:d,mediaKeys:c})=>{var f;this.throwIfDestroyed();const h=new gi("ISO-23001-7",n,(f=ps(d))!=null?f:"");return h.pssh=new Uint8Array(i),h.keyId=r,this.attemptSetMediaKeys(d,c).then(()=>{this.throwIfDestroyed();const p=this.createMediaKeySessionContext({decryptdata:h,keySystem:d,mediaKeys:c});return this.generateRequestWithPreferredKeySession(p,e,i,"encrypted-event-no-match")})})),l.catch(d=>this.handleError(d))}_onWaitingForKey(t){this.log(`"${t.type}" event`)}attemptSetMediaKeys(t,e){const i=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${t}"`);const r=Promise.all(i).then(()=>{if(!this.media)throw new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(e)});return this.setMediaKeysQueue.push(r),r.then(()=>{this.log(`Media-keys set for "${t}"`),i.push(r),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(s=>i.indexOf(s)===-1)})}generateRequestWithPreferredKeySession(t,e,i,r){var s,n;const o=(s=this.config.drmSystems)==null||(n=s[t.keySystem])==null?void 0:n.generateRequest;if(o)try{const f=o.call(this.hls,e,i,t);if(!f)throw new Error("Invalid response from configured generateRequest filter");e=f.initDataType,i=t.decryptdata.pssh=f.initData?new Uint8Array(f.initData):null}catch(f){var a;if(this.warn(f.message),(a=this.hls)!=null&&a.config.debug)throw f}if(i===null)return this.log(`Skipping key-session request for "${r}" (no initData)`),Promise.resolve(t);const l=this.getKeyIdString(t.decryptdata);this.log(`Generating key-session request for "${r}": ${l} (init data type: ${e} length: ${i?i.byteLength:null})`);const d=new Yr;t.mediaKeysSession.onmessage=f=>{const h=t.mediaKeysSession;if(!h){d.emit("error",new Error("invalid state"));return}const{messageType:p,message:g}=f;this.log(`"${p}" message event for session "${h.sessionId}" message size: ${g.byteLength}`),p==="license-request"||p==="license-renewal"?this.renewLicense(t,g).catch(x=>{this.handleError(x),d.emit("error",x)}):p==="license-release"?t.keySystem===Wt.FAIRPLAY&&(this.updateKeySession(t,un("acknowledged")),this.removeSession(t)):this.warn(`unhandled media key message type "${p}"`)},t.mediaKeysSession.onkeystatuseschange=f=>{if(!t.mediaKeysSession){d.emit("error",new Error("invalid state"));return}this.onKeyStatusChange(t);const p=t.keyStatus;d.emit("keyStatus",p),p==="expired"&&(this.warn(`${t.keySystem} expired for key ${l}`),this.renewKeySession(t))};const c=new Promise((f,h)=>{d.on("error",h),d.on("keyStatus",p=>{p.startsWith("usable")?f():p==="output-restricted"?h(new pe({type:bt.KEY_SYSTEM_ERROR,details:tt.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):p==="internal-error"?h(new pe({type:bt.KEY_SYSTEM_ERROR,details:tt.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},`key status changed to "${p}"`)):p==="expired"?h(new Error("key expired while generating request")):this.warn(`unhandled key status change "${p}"`)})});return t.mediaKeysSession.generateRequest(e,i).then(()=>{var f;this.log(`Request generated for key-session "${(f=t.mediaKeysSession)==null?void 0:f.sessionId}" keyId: ${l}`)}).catch(f=>{throw new pe({type:bt.KEY_SYSTEM_ERROR,details:tt.KEY_SYSTEM_NO_SESSION,error:f,fatal:!1},`Error generating key-session request: ${f}`)}).then(()=>c).catch(f=>{throw d.removeAllListeners(),this.removeSession(t),f}).then(()=>(d.removeAllListeners(),t))}onKeyStatusChange(t){t.mediaKeysSession.keyStatuses.forEach((e,i)=>{this.log(`key status change "${e}" for keyStatuses keyId: ${Ie.hexDump("buffer"in i?new Uint8Array(i.buffer,i.byteOffset,i.byteLength):new Uint8Array(i))} session keyId: ${Ie.hexDump(new Uint8Array(t.decryptdata.keyId||[]))} uri: ${t.decryptdata.uri}`),t.keyStatus=e})}fetchServerCertificate(t){const e=this.config,i=e.loader,r=new i(e),s=this.getServerCertificateUrl(t);return s?(this.log(`Fetching serverCertificate for "${t}"`),new Promise((n,o)=>{const a={responseType:"arraybuffer",url:s},l=e.certLoadPolicy.default,d={loadPolicy:l,timeout:l.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},c={onSuccess:(f,h,p,g)=>{n(f.data)},onError:(f,h,p,g)=>{o(new pe({type:bt.KEY_SYSTEM_ERROR,details:tt.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:p,response:fe({url:a.url,data:void 0},f)},`"${t}" certificate request failed (${s}). Status: ${f.code} (${f.text})`))},onTimeout:(f,h,p)=>{o(new pe({type:bt.KEY_SYSTEM_ERROR,details:tt.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:p,response:{url:a.url,data:void 0}},`"${t}" certificate request timed out (${s})`))},onAbort:(f,h,p)=>{o(new Error("aborted"))}};r.load(a,d,c)})):Promise.resolve()}setMediaKeysServerCertificate(t,e,i){return new Promise((r,s)=>{t.setServerCertificate(i).then(n=>{this.log(`setServerCertificate ${n?"success":"not supported by CDM"} (${i==null?void 0:i.byteLength}) on "${e}"`),r(t)}).catch(n=>{s(new pe({type:bt.KEY_SYSTEM_ERROR,details:tt.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:n,fatal:!0},n.message))})})}renewLicense(t,e){return this.requestLicense(t,new Uint8Array(e)).then(i=>this.updateKeySession(t,new Uint8Array(i)).catch(r=>{throw new pe({type:bt.KEY_SYSTEM_ERROR,details:tt.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:r,fatal:!0},r.message)}))}setupLicenseXHR(t,e,i,r){const s=this.config.licenseXhrSetup;return s?Promise.resolve().then(()=>{if(!i.decryptdata)throw new Error("Key removed");return s.call(this.hls,t,e,i,r)}).catch(n=>{if(!i.decryptdata)throw n;return t.open("POST",e,!0),s.call(this.hls,t,e,i,r)}).then(n=>(t.readyState||t.open("POST",e,!0),{xhr:t,licenseChallenge:n||r})):(t.open("POST",e,!0),Promise.resolve({xhr:t,licenseChallenge:r}))}requestLicense(t,e){const i=this.config.keyLoadPolicy.default;return new Promise((r,s)=>{const n=this.getLicenseServerUrl(t.keySystem);this.log(`Sending license request to URL: ${n}`);const o=new XMLHttpRequest;o.responseType="arraybuffer",o.onreadystatechange=()=>{if(!this.hls||!t.mediaKeysSession)return s(new Error("invalid state"));if(o.readyState===4)if(o.status===200){this._requestLicenseFailureCount=0;let a=o.response;this.log(`License received ${a instanceof ArrayBuffer?a.byteLength:a}`);const l=this.config.licenseResponseCallback;if(l)try{a=l.call(this.hls,o,n,t)}catch(d){this.error(d)}r(a)}else{const a=i.errorRetry,l=a?a.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>l||o.status>=400&&o.status<500)s(new pe({type:bt.KEY_SYSTEM_ERROR,details:tt.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:o,response:{url:n,data:void 0,code:o.status,text:o.statusText}},`License Request XHR failed (${n}). Status: ${o.status} (${o.statusText})`));else{const d=l-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${d} attempts left`),this.requestLicense(t,e).then(r,s)}}},t.licenseXhr&&t.licenseXhr.readyState!==XMLHttpRequest.DONE&&t.licenseXhr.abort(),t.licenseXhr=o,this.setupLicenseXHR(o,n,t,e).then(({xhr:a,licenseChallenge:l})=>{a.send(l)})})}onMediaAttached(t,e){if(!this.config.emeEnabled)return;const i=e.media;this.media=i,i.addEventListener("encrypted",this.onMediaEncrypted),i.addEventListener("waitingforkey",this.onWaitingForKey)}onMediaDetached(){const t=this.media,e=this.mediaKeySessions;t&&(t.removeEventListener("encrypted",this.onMediaEncrypted),t.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},gi.clearKeyUriToKeyIdMap();const i=e.length;oi.CDMCleanupPromise=Promise.all(e.map(r=>this.removeSession(r)).concat(t==null?void 0:t.setMediaKeys(null).catch(r=>{this.log(`Could not clear media keys: ${r}. media.src: ${t==null?void 0:t.src}`)}))).then(()=>{i&&(this.log("finished closing key sessions and clearing media keys"),e.length=0)}).catch(r=>{this.log(`Could not close sessions and clear media keys: ${r}. media.src: ${t==null?void 0:t.src}`)})}onManifestLoading(){this.keyFormatPromise=null}onManifestLoaded(t,{sessionKeys:e}){if(!(!e||!this.config.emeEnabled)&&!this.keyFormatPromise){const i=e.reduce((r,s)=>(r.indexOf(s.keyFormat)===-1&&r.push(s.keyFormat),r),[]);this.log(`Selecting key-system from session-keys ${i.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(i)}}removeSession(t){const{mediaKeysSession:e,licenseXhr:i}=t;if(e){this.log(`Remove licenses and keys and close session ${e.sessionId}`),e.onmessage=null,e.onkeystatuseschange=null,i&&i.readyState!==XMLHttpRequest.DONE&&i.abort(),t.mediaKeysSession=t.decryptdata=t.licenseXhr=void 0;const r=this.mediaKeySessions.indexOf(t);return r>-1&&this.mediaKeySessions.splice(r,1),e.remove().catch(s=>{this.log(`Could not remove session: ${s}`)}).then(()=>e.close()).catch(s=>{this.log(`Could not close session: ${s}`)})}}}oi.CDMCleanupPromise=void 0;class pe extends Error{constructor(t,e){super(e),this.data=void 0,t.error||(t.error=new Error(e)),this.data=t,t.err=t.error}}const ec=1;var de={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"};const ic="h";class He{constructor(t){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=r=>{try{this.apply(r,{ot:de.MANIFEST,su:!this.initialized})}catch(s){H.warn("Could not generate manifest CMCD data.",s)}},this.applyFragmentData=r=>{try{const s=r.frag,n=this.hls.levels[s.level],o=this.getObjectType(s),a={d:s.duration*1e3,ot:o};(o===de.VIDEO||o===de.AUDIO||o==de.MUXED)&&(a.br=n.bitrate/1e3,a.tb=this.getTopBandwidth(o)/1e3,a.bl=this.getBufferLength(o)),this.apply(r,a)}catch(s){H.warn("Could not generate segment CMCD data.",s)}},this.hls=t;const e=this.config=t.config,{cmcd:i}=e;i!=null&&(e.pLoader=this.createPlaylistLoader(),e.fLoader=this.createFragmentLoader(),this.sid=i.sessionId||He.uuid(),this.cid=i.contentId,this.useHeaders=i.useHeaders===!0,this.registerListeners())}registerListeners(){const t=this.hls;t.on(D.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(D.MEDIA_DETACHED,this.onMediaDetached,this),t.on(D.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const t=this.hls;t.off(D.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(D.MEDIA_DETACHED,this.onMediaDetached,this),t.off(D.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null}onMediaAttached(t,e){this.media=e.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){!this.media||(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(t,e){var i,r;this.audioBuffer=(i=e.tracks.audio)==null?void 0:i.buffer,this.videoBuffer=(r=e.tracks.video)==null?void 0:r.buffer}createData(){var t;return{v:ec,sf:ic,sid:this.sid,cid:this.cid,pr:(t=this.media)==null?void 0:t.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(t,e={}){Jt(e,this.createData());const i=e.ot===de.INIT||e.ot===de.VIDEO||e.ot===de.MUXED;if(this.starved&&i&&(e.bs=!0,e.su=!0,this.starved=!1),e.su==null&&(e.su=this.buffering),this.useHeaders){const r=He.toHeaders(e);if(!Object.keys(r).length)return;t.headers||(t.headers={}),Jt(t.headers,r)}else{const r=He.toQuery(e);if(!r)return;t.url=He.appendQueryToUri(t.url,r)}}getObjectType(t){const{type:e}=t;if(e==="subtitle")return de.TIMED_TEXT;if(t.sn==="initSegment")return de.INIT;if(e==="audio")return de.AUDIO;if(e==="main")return this.hls.audioTracks.length?de.VIDEO:de.MUXED}getTopBandwidth(t){let e=0,i;const r=this.hls;if(t===de.AUDIO)i=r.audioTracks;else{const s=r.maxAutoLevel,n=s>-1?s+1:r.levels.length;i=r.levels.slice(0,n)}for(const s of i)s.bitrate>e&&(e=s.bitrate);return e>0?e:NaN}getBufferLength(t){const e=this.hls.media,i=t===de.AUDIO?this.audioBuffer:this.videoBuffer;return!i||!e?NaN:$t.bufferInfo(i,e.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:t}=this.config,e=this.applyPlaylistData,i=t||this.config.loader;return class{constructor(s){this.loader=void 0,this.loader=new i(s)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(s,n,o){e(s),this.loader.load(s,n,o)}}}createFragmentLoader(){const{fLoader:t}=this.config,e=this.applyFragmentData,i=t||this.config.loader;return class{constructor(s){this.loader=void 0,this.loader=new i(s)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(s,n,o){e(s),this.loader.load(s,n,o)}}}static uuid(){const t=URL.createObjectURL(new Blob),e=t.toString();return URL.revokeObjectURL(t),e.slice(e.lastIndexOf("/")+1)}static serialize(t){const e=[],i=l=>!Number.isNaN(l)&&l!=null&&l!==""&&l!==!1,r=l=>Math.round(l),s=l=>r(l/100)*100,o={br:r,d:r,bl:s,dl:s,mtp:s,nor:l=>encodeURIComponent(l),rtp:s,tb:r},a=Object.keys(t||{}).sort();for(const l of a){let d=t[l];if(!i(d)||l==="v"&&d===1||l=="pr"&&d===1)continue;const c=o[l];c&&(d=c(d));const f=typeof d;let h;l==="ot"||l==="sf"||l==="st"?h=`${l}=${d}`:f==="boolean"?h=l:f==="number"?h=`${l}=${d}`:h=`${l}=${JSON.stringify(d)}`,e.push(h)}return e.join(",")}static toHeaders(t){const e=Object.keys(t),i={},r=["Object","Request","Session","Status"],s=[{},{},{},{}],n={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3};for(const o of e){const a=n[o]!=null?n[o]:1;s[a][o]=t[o]}for(let o=0;o<s.length;o++){const a=He.serialize(s[o]);a&&(i[`CMCD-${r[o]}`]=a)}return i}static toQuery(t){return`CMCD=${encodeURIComponent(He.serialize(t))}`}static appendQueryToUri(t,e){if(!e)return t;const i=t.includes("?")?"&":"?";return`${t}${i}${e}`}}const rc=3e5;class sc{constructor(t){this.hls=void 0,this.log=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this.pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=t,this.log=H.log.bind(H,"[content-steering]:"),this.registerListeners()}registerListeners(){const t=this.hls;t.on(D.MANIFEST_LOADING,this.onManifestLoading,this),t.on(D.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(D.MANIFEST_PARSED,this.onManifestParsed,this),t.on(D.ERROR,this.onError,this)}unregisterListeners(){const t=this.hls;!t||(t.off(D.MANIFEST_LOADING,this.onManifestLoading,this),t.off(D.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(D.MANIFEST_PARSED,this.onManifestParsed,this),t.off(D.ERROR,this.onError,this))}startLoad(){if(this.started=!0,self.clearTimeout(this.reloadTimer),this.enabled&&this.uri)if(this.updated){const t=Math.max(this.timeToLoad*1e3-(performance.now()-this.updated),0);this.scheduleRefresh(this.uri,t)}else this.loadSteeringManifest(this.uri)}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),self.clearTimeout(this.reloadTimer)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(t){const e=this.levels;e&&(this.levels=e.filter(i=>i!==t))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(t,e){const{contentSteering:i}=e;i!==null&&(this.pathwayId=i.pathwayId,this.uri=i.uri,this.started&&this.startLoad())}onManifestParsed(t,e){this.audioTracks=e.audioTracks,this.subtitleTracks=e.subtitleTracks}onError(t,e){const{errorAction:i}=e;if((i==null?void 0:i.action)===ue.SendAlternateToPenaltyBox&&i.flags===Ee.MoveAllAlternatesMatchingHost){let r=this.pathwayPriority;const s=this.pathwayId;this.penalizedPathways[s]||(this.penalizedPathways[s]=performance.now()),!r&&this.levels&&(r=this.levels.reduce((n,o)=>(n.indexOf(o.pathwayId)===-1&&n.push(o.pathwayId),n),[])),r&&r.length>1&&(this.updatePathwayPriority(r),i.resolved=this.pathwayId!==s)}}filterParsedLevels(t){this.levels=t;let e=this.getLevelsForPathway(this.pathwayId);if(e.length===0){const i=t[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${i}"`),e=this.getLevelsForPathway(i),this.pathwayId=i}return e.length!==t.length?(this.log(`Found ${e.length}/${t.length} levels in Pathway "${this.pathwayId}"`),e):t}getLevelsForPathway(t){return this.levels===null?[]:this.levels.filter(e=>t===e.pathwayId)}updatePathwayPriority(t){this.pathwayPriority=t;let e;const i=this.penalizedPathways,r=performance.now();Object.keys(i).forEach(s=>{r-i[s]>rc&&delete i[s]});for(let s=0;s<t.length;s++){const n=t[s];if(i[n])continue;if(n===this.pathwayId)return;const o=this.hls.nextLoadLevel,a=this.hls.levels[o];if(e=this.getLevelsForPathway(n),e.length>0){this.log(`Setting Pathway to "${n}"`),this.pathwayId=n,this.hls.trigger(D.LEVELS_UPDATED,{levels:e});const l=this.hls.levels[o];a&&l&&this.levels&&(l.attrs["STABLE-VARIANT-ID"]!==a.attrs["STABLE-VARIANT-ID"]&&l.bitrate!==a.bitrate&&this.log(`Unstable Pathways change from bitrate ${a.bitrate} to ${l.bitrate}`),this.hls.nextLoadLevel=o);break}}}clonePathways(t){const e=this.levels;if(!e)return;const i={},r={};t.forEach(s=>{const{ID:n,"BASE-ID":o,"URI-REPLACEMENT":a}=s;if(e.some(d=>d.pathwayId===n))return;const l=this.getLevelsForPathway(o).map(d=>{const c=Jt({},d);c.details=void 0,c.url=sa(d.uri,d.attrs["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",a);const f=new Ht(d.attrs);f["PATHWAY-ID"]=n;const h=f.AUDIO&&`${f.AUDIO}_clone_${n}`,p=f.SUBTITLES&&`${f.SUBTITLES}_clone_${n}`;h&&(i[f.AUDIO]=h,f.AUDIO=h),p&&(r[f.SUBTITLES]=p,f.SUBTITLES=p),c.attrs=f;const g=new yi(c);return ji(g,"audio",h),ji(g,"text",p),g});e.push(...l),sn(this.audioTracks,i,a,n),sn(this.subtitleTracks,r,a,n)})}loadSteeringManifest(t){const e=this.hls.config,i=e.loader;this.loader&&this.loader.destroy(),this.loader=new i(e);let r;try{r=new self.URL(t)}catch(d){this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${t}`);return}if(r.protocol!=="data:"){const d=(this.hls.bandwidthEstimate||e.abrEwmaDefaultEstimate)|0;r.searchParams.set("_HLS_pathway",this.pathwayId),r.searchParams.set("_HLS_throughput",""+d)}const s={responseType:"json",url:r.href},n=e.steeringManifestLoadPolicy.default,o=n.errorRetry||n.timeoutRetry||{},a={loadPolicy:n,timeout:n.maxLoadTimeMs,maxRetry:o.maxNumRetry||0,retryDelay:o.retryDelayMs||0,maxRetryDelay:o.maxRetryDelayMs||0},l={onSuccess:(d,c,f,h)=>{this.log(`Loaded steering manifest: "${r}"`);const p=d.data;if(p.VERSION!==1){this.log(`Steering VERSION ${p.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=p.TTL;const{"RELOAD-URI":g,"PATHWAY-CLONES":x,"PATHWAY-PRIORITY":E}=p;if(g)try{this.uri=new self.URL(g,r).href}catch(k){this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${g}`);return}this.scheduleRefresh(this.uri||f.url),x&&this.clonePathways(x),E&&this.updatePathwayPriority(E)},onError:(d,c,f,h)=>{if(this.log(`Error loading steering manifest: ${d.code} ${d.text} (${c.url})`),this.stopLoad(),d.code===410){this.enabled=!1,this.log(`Steering manifest ${c.url} no longer available`);return}let p=this.timeToLoad*1e3;if(d.code===429){const g=this.loader;if(typeof(g==null?void 0:g.getResponseHeader)=="function"){const x=g.getResponseHeader("Retry-After");x&&(p=parseFloat(x)*1e3)}this.log(`Steering manifest ${c.url} rate limited`);return}this.scheduleRefresh(this.uri||c.url,p)},onTimeout:(d,c,f)=>{this.log(`Timeout loading steering manifest (${c.url})`),this.scheduleRefresh(this.uri||c.url)}};this.log(`Requesting steering manifest: ${r}`),this.loader.load(s,a,l)}scheduleRefresh(t,e=this.timeToLoad*1e3){self.clearTimeout(this.reloadTimer),this.reloadTimer=self.setTimeout(()=>{this.loadSteeringManifest(t)},e)}}function sn(u,t,e,i){!u||Object.keys(t).forEach(r=>{const s=u.filter(n=>n.groupId===r).map(n=>{const o=Jt({},n);return o.details=void 0,o.attrs=new Ht(o.attrs),o.url=o.attrs.URI=sa(n.url,n.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",e),o.groupId=o.attrs["GROUP-ID"]=t[r],o.attrs["PATHWAY-ID"]=i,o});u.push(...s)})}function sa(u,t,e,i){const{HOST:r,PARAMS:s,[e]:n}=i;let o;t&&(o=n==null?void 0:n[t],o&&(u=o));const a=new self.URL(u);return r&&!o&&(a.host=r),s&&Object.keys(s).sort().forEach(l=>{l&&a.searchParams.set(l,s[l])}),a.href}const nc=/^age:\s*[\d.]+\s*$/im;class na{constructor(t){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=t&&t.xhrSetup||null,this.stats=new Gi,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null}abortInternal(){const t=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),t&&(t.onreadystatechange=null,t.onprogress=null,t.readyState!==4&&(this.stats.aborted=!0,t.abort()))}abort(){var t;this.abortInternal(),(t=this.callbacks)!=null&&t.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(t,e,i){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=t,this.config=e,this.callbacks=i,this.loadInternal()}loadInternal(){const{config:t,context:e}=this;if(!t)return;const i=this.loader=new self.XMLHttpRequest,r=this.stats;r.loading.first=0,r.loaded=0;const s=this.xhrSetup;s?Promise.resolve().then(()=>{if(!this.stats.aborted)return s(i,e.url)}).catch(n=>(i.open("GET",e.url,!0),s(i,e.url))).then(()=>{this.stats.aborted||this.openAndSendXhr(i,e,t)}).catch(n=>{this.callbacks.onError({code:i.status,text:n.message},e,i,r)}):this.openAndSendXhr(i,e,t)}openAndSendXhr(t,e,i){t.readyState||t.open("GET",e.url,!0);const r=this.context.headers,{maxTimeToFirstByteMs:s,maxLoadTimeMs:n}=i.loadPolicy;if(r)for(const o in r)t.setRequestHeader(o,r[o]);e.rangeEnd&&t.setRequestHeader("Range","bytes="+e.rangeStart+"-"+(e.rangeEnd-1)),t.onreadystatechange=this.readystatechange.bind(this),t.onprogress=this.loadprogress.bind(this),t.responseType=e.responseType,self.clearTimeout(this.requestTimeout),i.timeout=s&&_t(s)?s:n,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),i.timeout),t.send()}readystatechange(){const{context:t,loader:e,stats:i}=this;if(!t||!e)return;const r=e.readyState,s=this.config;if(!i.aborted&&r>=2&&(i.loading.first===0&&(i.loading.first=Math.max(self.performance.now(),i.loading.start),s.timeout!==s.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),s.timeout=s.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.loadPolicy.maxLoadTimeMs-(i.loading.first-i.loading.start)))),r===4)){self.clearTimeout(this.requestTimeout),e.onreadystatechange=null,e.onprogress=null;const n=e.status,o=e.responseType!=="text";if(n>=200&&n<300&&(o&&e.response||e.responseText!==null)){i.loading.end=Math.max(self.performance.now(),i.loading.first);const a=o?e.response:e.responseText,l=e.responseType==="arraybuffer"?a.byteLength:a.length;if(i.loaded=i.total=l,i.bwEstimate=i.total*8e3/(i.loading.end-i.loading.first),!this.callbacks)return;const d=this.callbacks.onProgress;if(d&&d(i,t,a,e),!this.callbacks)return;const c={url:e.responseURL,data:a,code:n};this.callbacks.onSuccess(c,i,t,e)}else{const a=s.loadPolicy.errorRetry,l=i.retry;Ui(a,l,!1,n)?this.retry(a):(H.error(`${n} while loading ${t.url}`),this.callbacks.onError({code:n,text:e.statusText},t,e,i))}}}loadtimeout(){var t;const e=(t=this.config)==null?void 0:t.loadPolicy.timeoutRetry,i=this.stats.retry;if(Ui(e,i,!0))this.retry(e);else{H.warn(`timeout while loading ${this.context.url}`);const r=this.callbacks;r&&(this.abortInternal(),r.onTimeout(this.stats,this.context,this.loader))}}retry(t){const{context:e,stats:i}=this;this.retryDelay=Ur(t,i.retry),i.retry++,H.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${e.url}, retrying ${i.retry}/${t.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(t){const e=this.stats;e.loaded=t.loaded,t.lengthComputable&&(e.total=t.total)}getCacheAge(){let t=null;if(this.loader&&nc.test(this.loader.getAllResponseHeaders())){const e=this.loader.getResponseHeader("age");t=e?parseFloat(e):null}return t}getResponseHeader(t){return this.loader&&new RegExp(`^${t}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(t):null}}function ac(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(u){}return!1}const oc=/(\d+)-(\d+)\/(\d+)/;class nn{constructor(t){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=t.fetchSetup||uc,this.controller=new self.AbortController,this.stats=new Gi}destroy(){this.loader=this.callbacks=null,this.abortInternal()}abortInternal(){const t=this.response;t!=null&&t.ok||(this.stats.aborted=!0,this.controller.abort())}abort(){var t;this.abortInternal(),(t=this.callbacks)!=null&&t.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(t,e,i){const r=this.stats;if(r.loading.start)throw new Error("Loader can only be used once.");r.loading.start=self.performance.now();const s=lc(t,this.controller.signal),n=i.onProgress,o=t.responseType==="arraybuffer",a=o?"byteLength":"length",{maxTimeToFirstByteMs:l,maxLoadTimeMs:d}=e.loadPolicy;this.context=t,this.config=e,this.callbacks=i,this.request=this.fetchSetup(t,s),self.clearTimeout(this.requestTimeout),e.timeout=l&&_t(l)?l:d,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),i.onTimeout(r,t,this.response)},e.timeout),self.fetch(this.request).then(c=>{this.response=this.loader=c;const f=Math.max(self.performance.now(),r.loading.start);if(self.clearTimeout(this.requestTimeout),e.timeout=d,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),i.onTimeout(r,t,this.response)},d-(f-r.loading.start)),!c.ok){const{status:h,statusText:p}=c;throw new hc(p||"fetch, bad network response",h,c)}return r.loading.first=f,r.total=cc(c.headers)||r.total,n&&_t(e.highWaterMark)?this.loadProgressively(c,r,t,e.highWaterMark,n):o?c.arrayBuffer():t.responseType==="json"?c.json():c.text()}).then(c=>{const{response:f}=this;self.clearTimeout(this.requestTimeout),r.loading.end=Math.max(self.performance.now(),r.loading.first);const h=c[a];h&&(r.loaded=r.total=h);const p={url:f.url,data:c,code:f.status};n&&!_t(e.highWaterMark)&&n(r,t,c,f),i.onSuccess(p,r,t,f)}).catch(c=>{if(self.clearTimeout(this.requestTimeout),r.aborted)return;const f=c&&c.code||0,h=c?c.message:null;i.onError({code:f,text:h},t,c?c.details:null,r)})}getCacheAge(){let t=null;if(this.response){const e=this.response.headers.get("age");t=e?parseFloat(e):null}return t}getResponseHeader(t){return this.response?this.response.headers.get(t):null}loadProgressively(t,e,i,r=0,s){const n=new Yn,o=t.body.getReader(),a=()=>o.read().then(l=>{if(l.done)return n.dataLength&&s(e,i,n.flush(),t),Promise.resolve(new ArrayBuffer(0));const d=l.value,c=d.length;return e.loaded+=c,c<r||n.dataLength?(n.push(d),n.dataLength>=r&&s(e,i,n.flush(),t)):s(e,i,d,t),a()}).catch(()=>Promise.reject());return a()}}function lc(u,t){const e={method:"GET",mode:"cors",credentials:"same-origin",signal:t,headers:new self.Headers(Jt({},u.headers))};return u.rangeEnd&&e.headers.set("Range","bytes="+u.rangeStart+"-"+String(u.rangeEnd-1)),e}function dc(u){const t=oc.exec(u);if(t)return parseInt(t[2])-parseInt(t[1])+1}function cc(u){const t=u.get("Content-Range");if(t){const i=dc(t);if(_t(i))return i}const e=u.get("Content-Length");if(e)return parseInt(e)}function uc(u,t){return new self.Request(u.url,t)}class hc extends Error{constructor(t,e,i){super(t),this.code=void 0,this.details=void 0,this.code=e,this.details=i}}const fc=/\s/,pc={newCue(u,t,e,i){const r=[];let s,n,o,a,l;const d=self.VTTCue||self.TextTrackCue;for(let f=0;f<i.rows.length;f++)if(s=i.rows[f],o=!0,a=0,l="",!s.isEmpty()){var c;for(let g=0;g<s.chars.length;g++)fc.test(s.chars[g].uchar)&&o?a++:(l+=s.chars[g].uchar,o=!1);s.cueStartTime=t,t===e&&(e+=1e-4),a>=16?a--:a++;const h=ta(l.trim()),p=Zr(t,e,h);u!=null&&(c=u.cues)!=null&&c.getCueById(p)||(n=new d(t,e,h),n.id=p,n.line=f+1,n.align="left",n.position=10+Math.min(80,Math.floor(a*8/32)*10),r.push(n))}return u&&r.length&&(r.sort((f,h)=>f.line==="auto"||h.line==="auto"?0:f.line>8&&h.line>8?h.line-f.line:f.line-h.line),r.forEach(f=>Ln(u,f))),r}},mc={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},gc=fe(fe({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:na,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:xd,bufferController:Rd,capLevelController:Xr,errorController:hl,fpsController:tc,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:fn,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0,certLoadPolicy:{default:mc},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},yc()),{},{subtitleStreamController:Ad,subtitleTrackController:Id,timelineController:Xd,audioStreamController:bd,audioTrackController:Td,emeController:oi,cmcdController:He,contentSteeringController:sc});function yc(){return{cueHandler:pc,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function vc(u,t){if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(t.liveMaxLatencyDurationCount!==void 0&&(t.liveSyncDurationCount===void 0||t.liveMaxLatencyDurationCount<=t.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(t.liveMaxLatencyDuration!==void 0&&(t.liveSyncDuration===void 0||t.liveMaxLatencyDuration<=t.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const e=Pr(u),i=["manifest","level","frag"],r=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return i.forEach(s=>{const n=`${s==="level"?"playlist":s}LoadPolicy`,o=t[n]===void 0,a=[];r.forEach(l=>{const d=`${s}Loading${l}`,c=t[d];if(c!==void 0&&o){a.push(d);const f=e[n].default;switch(t[n]={default:f},l){case"TimeOut":f.maxLoadTimeMs=c,f.maxTimeToFirstByteMs=c;break;case"MaxRetry":f.errorRetry.maxNumRetry=c,f.timeoutRetry.maxNumRetry=c;break;case"RetryDelay":f.errorRetry.retryDelayMs=c,f.timeoutRetry.retryDelayMs=c;break;case"MaxRetryTimeout":f.errorRetry.maxRetryDelayMs=c,f.timeoutRetry.maxRetryDelayMs=c;break}}}),a.length&&H.warn(`hls.js config: "${a.join('", "')}" setting(s) are deprecated, use "${n}": ${JSON.stringify(t[n])}`)}),fe(fe({},e),t)}function Pr(u){return u&&typeof u=="object"?Array.isArray(u)?u.map(Pr):Object.keys(u).reduce((t,e)=>(t[e]=Pr(u[e]),t),{}):u}function _c(u){const t=u.loader;t!==nn&&t!==na?(H.log("[config]: Custom loader detected, cannot enable progressive streaming"),u.progressive=!1):ac()&&(u.loader=nn,u.progressive=!0,u.enableSoftwareAES=!0,H.log("[config]: Progressive streaming enabled, using FetchLoader"))}class Ke{static get version(){return"1.4.4"}static isSupported(){return kl()}static get Events(){return D}static get ErrorTypes(){return bt}static get ErrorDetails(){return tt}static get DefaultConfig(){return Ke.defaultConfig?Ke.defaultConfig:gc}static set DefaultConfig(t){Ke.defaultConfig=t}constructor(t={}){this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new Yr,this._autoLevelCapping=void 0,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null,io(t.debug||!1,"Hls instance");const e=this.config=vc(Ke.DefaultConfig,t);this.userConfig=t,this._autoLevelCapping=-1,e.progressive&&_c(e);const{abrController:i,bufferController:r,capLevelController:s,errorController:n,fpsController:o}=e,a=new n(this),l=this.abrController=new i(this),d=this.bufferController=new r(this),c=this.capLevelController=new s(this),f=new o(this),h=new Wo(this),p=new Qo(this),g=e.contentSteeringController,x=g?new g(this):null,E=this.levelController=new pl(this,x),k=new ml(this),O=new yl(this.config),T=this.streamController=new vd(this,k,O);c.setStreamController(T),f.setStreamController(T);const R=[h,E,T];x&&R.splice(1,0,x),this.networkControllers=R;const C=[l,d,c,f,p,k];this.audioTrackController=this.createController(e.audioTrackController,R);const b=e.audioStreamController;b&&R.push(new b(this,k,O)),this.subtitleTrackController=this.createController(e.subtitleTrackController,R);const A=e.subtitleStreamController;A&&R.push(new A(this,k,O)),this.createController(e.timelineController,C),O.emeController=this.emeController=this.createController(e.emeController,C),this.cmcdController=this.createController(e.cmcdController,C),this.latencyController=this.createController(Jo,C),this.coreComponents=C,R.push(a);const L=a.onErrorOut;typeof L=="function"&&this.on(D.ERROR,L,a)}createController(t,e){if(t){const i=new t(this);return e&&e.push(i),i}return null}on(t,e,i=this){this._emitter.on(t,e,i)}once(t,e,i=this){this._emitter.once(t,e,i)}removeAllListeners(t){this._emitter.removeAllListeners(t)}off(t,e,i=this,r){this._emitter.off(t,e,i,r)}listeners(t){return this._emitter.listeners(t)}emit(t,e,i){return this._emitter.emit(t,e,i)}trigger(t,e){if(this.config.debug)return this.emit(t,t,e);try{return this.emit(t,t,e)}catch(i){H.error("An internal error happened while handling event "+t+'. Error message: "'+i.message+'". Here is a stacktrace:',i),this.trigger(D.ERROR,{type:bt.OTHER_ERROR,details:tt.INTERNAL_EXCEPTION,fatal:!1,event:t,error:i})}return!1}listenerCount(t){return this._emitter.listenerCount(t)}destroy(){H.log("destroy"),this.trigger(D.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(e=>e.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(e=>e.destroy()),this.coreComponents.length=0;const t=this.config;t.xhrSetup=t.fetchSetup=void 0,this.userConfig=null}attachMedia(t){H.log("attachMedia"),this._media=t,this.trigger(D.MEDIA_ATTACHING,{media:t})}detachMedia(){H.log("detachMedia"),this.trigger(D.MEDIA_DETACHING,void 0),this._media=null}loadSource(t){this.stopLoad();const e=this.media,i=this.url,r=this.url=Nr.buildAbsoluteURL(self.location.href,t,{alwaysNormalize:!0});H.log(`loadSource:${r}`),e&&i&&(i!==r||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(e)),this.trigger(D.MANIFEST_LOADING,{url:t})}startLoad(t=-1){H.log(`startLoad(${t})`),this.networkControllers.forEach(e=>{e.startLoad(t)})}stopLoad(){H.log("stopLoad"),this.networkControllers.forEach(t=>{t.stopLoad()})}swapAudioCodec(){H.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){H.log("recoverMediaError");const t=this._media;this.detachMedia(),t&&this.attachMedia(t)}removeLevel(t,e=0){this.levelController.removeLevel(t,e)}get levels(){const t=this.levelController.levels;return t||[]}get currentLevel(){return this.streamController.currentLevel}set currentLevel(t){H.log(`set currentLevel:${t}`),this.loadLevel=t,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(t){H.log(`set nextLevel:${t}`),this.levelController.manualLevel=t,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(t){H.log(`set loadLevel:${t}`),this.levelController.manualLevel=t}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(t){this.levelController.nextLoadLevel=t}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(t){H.log(`set firstLevel:${t}`),this.levelController.firstLevel=t}get startLevel(){return this.levelController.startLevel}set startLevel(t){H.log(`set startLevel:${t}`),t!==-1&&(t=Math.max(t,this.minAutoLevel)),this.levelController.startLevel=t}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(t){const e=!!t;e!==this.config.capLevelToPlayerSize&&(e?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=e)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:t}=this.abrController;return t?t.getEstimate():NaN}get ttfbEstimate(){const{bwEstimator:t}=this.abrController;return t?t.getEstimateTTFB():NaN}set autoLevelCapping(t){this._autoLevelCapping!==t&&(H.log(`set autoLevelCapping:${t}`),this._autoLevelCapping=t)}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(t){Rr.indexOf(t)>-1&&(this._maxHdcpLevel=t)}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:t,config:{minAutoBitrate:e}}=this;if(!t)return 0;const i=t.length;for(let r=0;r<i;r++)if(t[r].maxBitrate>=e)return r;return 0}get maxAutoLevel(){const{levels:t,autoLevelCapping:e,maxHdcpLevel:i}=this;let r;if(e===-1&&t&&t.length?r=t.length-1:r=e,i)for(let s=r;s--;){const n=t[s].attrs["HDCP-LEVEL"];if(n&&n<=i)return s}return r}get nextAutoLevel(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)}set nextAutoLevel(t){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,t)}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get audioTracks(){const t=this.audioTrackController;return t?t.audioTracks:[]}get audioTrack(){const t=this.audioTrackController;return t?t.audioTrack:-1}set audioTrack(t){const e=this.audioTrackController;e&&(e.audioTrack=t)}get subtitleTracks(){const t=this.subtitleTrackController;return t?t.subtitleTracks:[]}get subtitleTrack(){const t=this.subtitleTrackController;return t?t.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(t){const e=this.subtitleTrackController;e&&(e.subtitleTrack=t)}get subtitleDisplay(){const t=this.subtitleTrackController;return t?t.subtitleDisplay:!1}set subtitleDisplay(t){const e=this.subtitleTrackController;e&&(e.subtitleDisplay=t)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(t){this.config.lowLatencyMode=t}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}}Ke.defaultConfig=void 0;function xc(u){switch(u){case 1:case 2:case 3:return 0;case 4:case 5:return 1;default:return 0}}function Ec(u){if(typeof u!="string")return[];const t=u.matchAll(new RegExp('<d (?:.*? )??p="(?<p>.+?)"(?: .*?)?>(?<text>.+?)<\\/d>',"gs"));return Array.from(t).map(e=>{const i=e.groups.p.split(",");return i.length>=8?{text:e.groups.text.trim().replaceAll("&quot;",'"').replaceAll("&apos;","'").replaceAll("&lt;","<").replaceAll("&gt;",">").replaceAll("&amp;","&"),time:Number(i[0]),mode:xc(Number(i[1])),fontSize:Number(i[2]),color:`#${Number(i[3]).toString(16)}`,timestamp:Number(i[4]),pool:Number(i[5]),userID:i[6],rowID:Number(i[7])}:null}).filter(Boolean)}var aa={exports:{}};(function(u,t){/*!
 * artplayer-plugin-danmuku.js v5.1.4
 * Github: https://github.com/zhw2590582/ArtPlayer
 * (c) 2017-2024 Harvey Zack
 * Released under the MIT License.
 */(function(e,i,r,s,n){var o=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:typeof Oi!="undefined"?Oi:{},a=typeof o[s]=="function"&&o[s],l=a.cache||{},d=typeof Pi=="function"&&Pi.bind(u);function c(p,g){if(!l[p]){if(!e[p]){var x=typeof o[s]=="function"&&o[s];if(!g&&x)return x(p,!0);if(a)return a(p,!0);if(d&&typeof p=="string")return d(p);var E=Error("Cannot find module '"+p+"'");throw E.code="MODULE_NOT_FOUND",E}O.resolve=function(T){var R=e[p][1][T];return R!=null?R:T},O.cache={};var k=l[p]=new c.Module(p);e[p][0].call(k.exports,O,k,k.exports,this)}return l[p].exports;function O(T){var R=O.resolve(T);return R===!1?{}:c(R)}}c.isParcelRequire=!0,c.Module=function(p){this.id=p,this.bundle=c,this.exports={}},c.modules=e,c.cache=l,c.parent=a,c.register=function(p,g){e[p]=[function(x,E){E.exports=g},{}]},Object.defineProperty(c,"root",{get:function(){return o[s]}}),o[s]=c;for(var f=0;f<i.length;f++)c(i[f]);if(r){var h=c(r);u.exports=h}})({bgm6t:[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>f);var n=e("./danmuku"),o=s.interopDefault(n),a=e("./setting"),l=s.interopDefault(a),d=e("./heatmap"),c=s.interopDefault(d);function f(h){return p=>{let g=new o.default(p,h),x=new l.default(p,g);return g.option.heatmap&&(0,c.default)(p,g,g.option.heatmap),{name:"artplayerPluginDanmuku",emit:g.emit.bind(g),load:g.load.bind(g),config:g.config.bind(g),hide:g.hide.bind(g),show:g.show.bind(g),reset:g.reset.bind(g),mount:x.mount.bind(x),get option(){return g.option},get isHide(){return g.isHide},get isStop(){return g.isStop}}}}f.icons=l.default.icons,typeof window!="undefined"&&(window.artplayerPluginDanmuku=f)},{"./danmuku":"4ns48","./setting":"lO8OT","./heatmap":"8AxLD","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"4ns48":[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r);var n=e("./bilibili"),o=e("bundle-text:./worker"),a=s.interopDefault(o);class l{constructor(c,f){let{constructor:h,template:p}=c;this.utils=h.utils,this.validator=h.validator,this.$danmuku=p.$danmuku,this.$player=p.$player,this.art=c,this.queue=[],this.$refs=[],this.isStop=!1,this.isHide=!1,this.timer=null,this.index=0,this.option=l.option,this.states={wait:[],ready:[],emit:[],stop:[]},this.config(f),this.worker=new Worker(URL.createObjectURL(new Blob([a.default]))),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this.reset=this.reset.bind(this),this.resize=this.resize.bind(this),this.destroy=this.destroy.bind(this),c.on("video:play",this.start),c.on("video:playing",this.start),c.on("video:pause",this.stop),c.on("video:waiting",this.stop),c.on("destroy",this.destroy),c.on("resize",this.resize),this.load()}static get option(){return{danmuku:[],speed:5,margin:[10,"25%"],opacity:1,color:"#FFFFFF",mode:0,modes:[0,1,2],fontSize:25,antiOverlap:!0,synchronousPlayback:!1,mount:void 0,heatmap:!1,width:512,points:[],filter:()=>!0,beforeEmit:()=>!0,beforeVisible:()=>!0,visible:!0,emitter:!0,maxLength:200,lockTime:5,theme:"dark",OPACITY:{},FONT_SIZE:{},MARGIN:{},SPEED:{},COLOR:[]}}static get scheme(){return{danmuku:"array|function|string",speed:"number",margin:"array",opacity:"number",color:"string",mode:"number",modes:"array",fontSize:"number|string",antiOverlap:"boolean",synchronousPlayback:"boolean",mount:"?htmldivelement|string",heatmap:"object|boolean",width:"number",points:"array",filter:"function",beforeEmit:"function",beforeVisible:"function",visible:"boolean",emitter:"boolean",maxLength:"number",lockTime:"number",theme:"string",OPACITY:"object",FONT_SIZE:"object",MARGIN:"object",SPEED:"object",COLOR:"array"}}static get cssText(){return' user-select: none; position: absolute; white-space: pre; pointer-events: none; perspective: 500px; display: inline-block; will-change: transform; font-weight: normal; line-height: 1.125; visibility: hidden; font-family: SimHei, "Microsoft JhengHei", Arial, Helvetica, sans-serif; text-shadow: rgb(0, 0, 0) 1px 0px 1px, rgb(0, 0, 0) 0px 1px 1px, rgb(0, 0, 0) 0px -1px 1px, rgb(0, 0, 0) -1px 0px 1px; '}get isRotate(){var c,f;return(f=(c=this.art.plugins)==null?void 0:c.autoOrientation)==null?void 0:f.state}get marginTop(){let{clamp:c}=this.utils,f=this.option.margin[0],{clientHeight:h}=this.$player;return typeof f=="number"?c(f,0,h):typeof f=="string"&&f.endsWith("%")?c(h*(parseFloat(f)/100),0,h):l.option.margin[0]}get marginBottom(){let{clamp:c}=this.utils,f=this.option.margin[1],{clientHeight:h}=this.$player;return typeof f=="number"?c(f,0,h):typeof f=="string"&&f.endsWith("%")?c(h*(parseFloat(f)/100),0,h):l.option.margin[1]}get fontSize(){let{clamp:c}=this.utils,{clientHeight:f}=this.$player,h=this.option.fontSize;return typeof h=="number"?Math.round(c(h,12,f)):typeof h=="string"&&h.endsWith("%")?Math.round(c(f*(parseFloat(h)/100),12,f)):l.option.fontSize}get $ref(){let c=this.$refs.pop()||document.createElement("div");return c.style.cssText=l.cssText,c.dataset.mode="",c.className="",c}get readys(){let{currentTime:c}=this.art,f=[];return this.filter("ready",h=>f.push(h)),this.filter("wait",h=>{c+.1>=h.time&&h.time>=c-.1&&f.push(h)}),f}get visibles(){let c=[],{clientWidth:f}=this.$player,h=this.getLeft(this.$player);return this.filter("emit",p=>{let g=p.$ref.offsetTop,x=this.getLeft(p.$ref)-h,E=p.$ref.clientHeight,k=p.$ref.clientWidth,O=x+k,T=O/p.$restTime,R={};R.top=g,R.left=x,R.height=E,R.width=k,R.right=f-O,R.speed=T,R.distance=O,R.time=p.$restTime,R.mode=p.mode,c.push(R)}),c}get speed(){return this.option.synchronousPlayback&&this.art.playbackRate?this.option.speed/Number(this.art.playbackRate):this.option.speed}load(c){return zt(this,null,function*(){let{errorHandle:f}=this.utils,h=[],p=c||this.option.danmuku;try{typeof p=="function"?h=yield p():p instanceof Promise?h=yield p:typeof p=="string"?h=yield(0,n.bilibiliDanmuParseFromUrl)(p):Array.isArray(p)&&(h=p),f(Array.isArray(h),"Danmuku need return an array as result"),c===void 0&&(this.reset(),this.queue=[],this.states={wait:[],ready:[],emit:[],stop:[]},this.$refs=[],this.$danmuku.innerText="");for(let g=0;g<h.length;g++){let x=h[g];yield this.emit(x)}this.art.emit("artplayerPluginDanmuku:loaded",this.queue)}catch(g){throw this.art.emit("artplayerPluginDanmuku:error",g),g}return this})}emit(c){return zt(this,null,function*(){let{clamp:f}=this.utils;if(this.validator(c,{text:"string",mode:"?number",color:"?string",time:"?number",border:"?boolean",style:"?object"}),!c.text.trim()||(c.time?c.time=f(c.time,0,1/0):c.time=this.art.currentTime+.5,c.mode===void 0&&(c.mode=this.option.mode),c.style===void 0&&(c.style={}),c.color===void 0&&(c.color=this.option.color),![0,1,2].includes(c.mode)||!this.option.filter(c)))return this;let h=jt(Nt({},c),{$state:"wait",$id:this.index++,$ref:null,$restTime:0,$lastStartTime:0});return this.setState(h,"wait"),this.queue.push(h),this})}config(c){let{clamp:f}=this.utils,{$controlsCenter:h}=this.art.template;return Object.keys(c).some(p=>JSON.stringify(this.option[p])!==JSON.stringify(c[p]))&&(this.option=Object.assign({},l.option,this.option,c),this.validator(this.option,l.scheme),this.option.mode=f(this.option.mode,0,2),this.option.speed=f(this.option.speed,1,10),this.option.opacity=f(this.option.opacity,0,1),this.option.lockTime=f(this.option.lockTime,1,60),this.option.maxLength=f(this.option.maxLength,1,1e3),this.option.mount=this.option.mount||h,c.fontSize&&this.reset(),this.option.visible?this.show():this.hide(),this.art.emit("artplayerPluginDanmuku:config",this.option)),this}getLeft(c){let f=c.getBoundingClientRect();return this.isRotate?f.top:f.left}postMessage(c={}){return new Promise(f=>{c.id=Date.now(),this.worker.postMessage(c),this.worker.onmessage=h=>{let{data:p}=h;p.id===c.id&&f(p)}})}filter(c,f){let h=this.states[c]||[];for(let p=0;p<h.length;p++)f(h[p]);return h}setState(c,f){this.states[c.$state]=this.states[c.$state].filter(h=>h!==c),c.$state=f,c.$ref&&(c.$ref.dataset.state=f),this.states[f].push(c)}makeWait(c){this.setState(c,"wait"),c.$ref&&(c.$ref.style.cssText=l.cssText,c.$ref.style.visibility="hidden",c.$ref.style.marginLeft="0px",c.$ref.style.transform="translateX(0px)",c.$ref.style.transition="transform 0s linear 0s",this.$refs.push(c.$ref),c.$ref=null)}update(){let{setStyles:c}=this.utils;return this.timer=window.requestAnimationFrame(()=>zt(this,null,function*(){if(this.art.playing&&!this.isHide){this.filter("emit",h=>{let p=(Date.now()-h.$lastStartTime)/1e3;h.$restTime-=p,h.$lastStartTime=Date.now(),h.$restTime<=0&&this.makeWait(h)});let f=this.readys;for(let h=0;h<f.length;h++){let p=f[h];if(yield this.option.beforeVisible(p)){let{clientWidth:g,clientHeight:x}=this.$player;p.$ref=this.$ref,p.$ref.innerText=p.text,this.$danmuku.appendChild(p.$ref),p.$ref.style.opacity=this.option.opacity,p.$ref.style.fontSize=`${this.fontSize}px`,p.$ref.style.color=p.color,p.$ref.style.border=p.border?`1px solid ${p.color}`:null,p.$ref.style.backgroundColor=p.border?"rgb(0 0 0 / 50%)":null,c(p.$ref,p.style),p.$lastStartTime=Date.now(),p.$restTime=this.speed;let E=g+p.$ref.clientWidth,{result:k}=yield this.postMessage({type:"getDanmuTop",target:{mode:p.mode,height:p.$ref.clientHeight,speed:E/p.$restTime},visibles:this.visibles,antiOverlap:this.option.antiOverlap,clientWidth:g,clientHeight:x,marginBottom:this.marginBottom,marginTop:this.marginTop});if(p.$ref)if(this.isStop||k===void 0)this.setState(p,"ready"),this.$refs.push(p.$ref),p.$ref=null;else{switch(this.setState(p,"emit"),p.$ref.style.top=`${k}px`,p.$ref.style.visibility="visible",p.$ref.dataset.mode=p.mode,p.mode){case 0:p.$ref.style.left=`${g}px`,p.$ref.style.marginLeft="0px",p.$ref.style.transform=`translateX(${-E}px)`,p.$ref.style.transition=`transform ${p.$restTime}s linear 0s`;break;case 1:case 2:p.$ref.style.left="50%",p.$ref.style.marginLeft=`-${p.$ref.clientWidth/2}px`}this.art.emit("artplayerPluginDanmuku:visible",p)}}}}this.isStop||this.update()})),this}resize(){let{clientWidth:c}=this.$player;this.filter("stop",f=>{f.mode===0&&(f.$ref.style.left=`${c}px`)}),this.filter("emit",f=>{if(f.$lastStartTime=Date.now(),f.mode===0){let h=c+f.$ref.clientWidth;f.$ref.style.left=`${c}px`,f.$ref.style.transform=`translateX(${-h}px)`,f.$ref.style.transition=`transform ${f.$restTime}s linear 0s`}})}continue(){let{clientWidth:c}=this.$player;return this.filter("stop",f=>{if(this.setState(f,"emit"),f.$lastStartTime=Date.now(),f.mode===0){let h=c+f.$ref.clientWidth;f.$ref.style.transform=`translateX(${-h}px)`,f.$ref.style.transition=`transform ${f.$restTime}s linear 0s`}}),this}suspend(){let{clientWidth:c}=this.$player;return this.filter("emit",f=>{if(this.setState(f,"stop"),f.mode===0){let h=c-(this.getLeft(f.$ref)-this.getLeft(this.$player));f.$ref.style.transform=`translateX(${-h}px)`,f.$ref.style.transition="transform 0s linear 0s"}}),this}stop(){return this.isStop=!0,this.suspend(),window.cancelAnimationFrame(this.timer),this.art.emit("artplayerPluginDanmuku:stop"),this}start(){return this.isStop=!1,this.continue(),this.update(),this.art.emit("artplayerPluginDanmuku:start"),this}reset(){return this.queue.forEach(c=>this.makeWait(c)),this.art.emit("artplayerPluginDanmuku:reset"),this}show(){return this.isHide=!1,this.$danmuku.style.opacity=1,this.option.visible=!0,this.art.emit("artplayerPluginDanmuku:show"),this}hide(){return this.isHide=!0,this.$danmuku.style.opacity=0,this.option.visible=!1,this.art.emit("artplayerPluginDanmuku:hide"),this}destroy(){this.stop(),this.worker.terminate(),this.art.off("video:play",this.start),this.art.off("video:playing",this.start),this.art.off("video:pause",this.stop),this.art.off("video:waiting",this.stop),this.art.off("resize",this.reset),this.art.off("destroy",this.destroy),this.art.emit("artplayerPluginDanmuku:destroy")}}r.default=l},{"./bilibili":"f83sx","bundle-text:./worker":"lfIAi","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],f83sx:[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");function n(d){switch(d){case 1:case 2:case 3:default:return 0;case 4:return 2;case 5:return 1}}function o(d){if(typeof d!="string")return[];let c=new RegExp(new RegExp('<d (?:.*? )??p="(?<p>.+?)"(?: .*?)?>(?<text>.+?)<\\/d>',"gs"));return Array.from(d.matchAll(c)).map(f=>{let h=f.groups.p.split(",");return h.length>=8?{text:f.groups.text.trim().replaceAll("&quot;",'"').replaceAll("&apos;","'").replaceAll("&lt;","<").replaceAll("&gt;",">").replaceAll("&amp;","&"),time:Number(h[0]),mode:n(Number(h[1])),fontSize:Number(h[2]),color:`#${Number(h[3]).toString(16)}`,timestamp:Number(h[4]),pool:Number(h[5]),userID:h[6],rowID:Number(h[7])}:null}).filter(Boolean)}function a({data:d}){let{xml:c,id:f}=d;if(!f||!c)return;let h=o(c);self.postMessage({danmus:h,id:f})}function l(d){return new Promise(c=>zt(this,null,function*(){let f=yield fetch(d),h=yield f.text();try{let p=function(){let g=new Blob([` ${n.toString()} ${o.toString()} onmessage = ${a.toString()} `],{type:"application/javascript"});return new Worker(URL.createObjectURL(g))}();p.onmessage=g=>{let{danmus:x,id:E}=g.data;E&&x&&(c(x),p.terminate())},p.postMessage({xml:h,id:Date.now()})}catch(p){c(o(h))}}))}s.defineInteropFlag(r),s.export(r,"bilibiliDanmuParseFromUrl",()=>l)},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"9pCYc":[function(e,i,r){r.interopDefault=function(s){return s&&s.__esModule?s:{default:s}},r.defineInteropFlag=function(s){Object.defineProperty(s,"__esModule",{value:!0})},r.exportAll=function(s,n){return Object.keys(s).forEach(function(o){o==="default"||o==="__esModule"||Object.prototype.hasOwnProperty.call(n,o)||Object.defineProperty(n,o,{enumerable:!0,get:function(){return s[o]}})}),n},r.export=function(s,n,o){Object.defineProperty(s,n,{enumerable:!0,get:o})}},{}],lfIAi:[function(e,i,r){i.exports=`!function(e,t,n,o,i){var r="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},f="function"==typeof r[o]&&r[o],l=f.cache||{},d="undefined"!=typeof module&&"function"==typeof module.require&&module.require.bind(module);function u(t,n){if(!l[t]){if(!e[t]){var i="function"==typeof r[o]&&r[o];if(!n&&i)return i(t,!0);if(f)return f(t,!0);if(d&&"string"==typeof t)return d(t);var h=Error("Cannot find module '"+t+"'");throw h.code="MODULE_NOT_FOUND",h}s.resolve=function(n){var o=e[t][1][n];return null!=o?o:n},s.cache={};var p=l[t]=new u.Module(t);e[t][0].call(p.exports,s,p,p.exports,this)}return l[t].exports;function s(e){var t=s.resolve(e);return!1===t?{}:u(t)}}u.isParcelRequire=!0,u.Module=function(e){this.id=e,this.bundle=u,this.exports={}},u.modules=e,u.cache=l,u.parent=f,u.register=function(t,n){e[t]=[function(e,t){t.exports=n},{}]},Object.defineProperty(u,"root",{get:function(){return r[o]}}),r[o]=u;for(var h=0;h<t.length;h++)u(t[h]);if(n){var p=u(n);"object"==typeof exports&&"undefined"!=typeof module?module.exports=p:"function"==typeof define&&define.amd&&define(function(){return p})}}({"59OZS":[function(e,t,n){function o({target:e,visibles:t,clientWidth:n,clientHeight:o,marginBottom:i,marginTop:r,antiOverlap:f}){let l=o-i,d=t.filter(t=>t.mode===e.mode&&t.top<=l).sort((e,t)=>e.top-t.top);if(0===d.length)return 2===e.mode?l-e.height:r;if(d.unshift({type:"top",top:0,left:0,right:0,height:r,width:n,speed:0,distance:n}),d.push({type:"bottom",top:l,left:0,right:0,height:i,width:n,speed:0,distance:n}),2===e.mode)for(let t=d.length-2;t>=0;t-=1){let n=d[t],o=d[t+1],i=n.top+n.height;if(o.top-i>=e.height)return o.top-e.height}else for(let t=1;t<d.length;t+=1){let n=d[t],o=d[t-1],i=o.top+o.height;if(n.top-i>=e.height)return i}let u=[];for(let e=1;e<d.length-1;e+=1){let t=d[e];if(u.length){let e=u[u.length-1];e[0].top===t.top?e.push(t):u.push([t])}else u.push([t])}if(f)switch(e.mode){case 0:{let t=u.find(t=>t.every(t=>!(n<t.distance)&&(e.speed<t.speed||t.right/(e.speed-t.speed)>t.time)));return t&&t[0]?t[0].top:void 0}case 1:case 2:return}else{switch(e.mode){case 0:u.sort((e,t)=>{let n=Math.min(...t.map(e=>e.right)),o=Math.min(...e.map(e=>e.right));return n*t.length-o*e.length});break;case 1:case 2:u.sort((e,t)=>{let n=Math.max(...t.map(e=>e.width));return Math.max(...e.map(e=>e.width))*e.length-n*t.length})}return u[0][0].top}}onmessage=e=>{let{data:t}=e;if(!t.id||!t.type)return;let n=(0,({getDanmuTop:o})[t.type])(t);self.postMessage({result:n,id:t.id})}},{}]},["59OZS"],"59OZS","parcelRequire4dc0");`},{}],lO8OT:[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r);var n=e("bundle-text:./style.less"),o=s.interopDefault(n),a=e("bundle-text:./img/on.svg"),l=s.interopDefault(a),d=e("bundle-text:./img/off.svg"),c=s.interopDefault(d),f=e("bundle-text:./img/config.svg"),h=s.interopDefault(f),p=e("bundle-text:./img/style.svg"),g=s.interopDefault(p),x=e("bundle-text:./img/mode_0_off.svg"),E=s.interopDefault(x),k=e("bundle-text:./img/mode_0_on.svg"),O=s.interopDefault(k),T=e("bundle-text:./img/mode_1_off.svg"),R=s.interopDefault(T),C=e("bundle-text:./img/mode_1_on.svg"),b=s.interopDefault(C),A=e("bundle-text:./img/mode_2_off.svg"),L=s.interopDefault(A),I=e("bundle-text:./img/mode_2_on.svg"),j=s.interopDefault(I),F=e("bundle-text:./img/check_on.svg"),$=s.interopDefault(F),V=e("bundle-text:./img/check_off.svg"),Q=s.interopDefault(V);if(r.default=class{constructor(z,B){this.art=z,this.danmuku=B,this.utils=z.constructor.utils;let{setStyle:w}=this.utils,{$controlsCenter:P}=z.template;w(P,"display","flex"),this.template={$controlsCenter:P,$mount:P,$danmuku:null,$toggle:null,$config:null,$configPanel:null,$configModes:null,$style:null,$stylePanel:null,$styleModes:null,$colors:null,$opacitySlider:null,$opacityValue:null,$marginSlider:null,$marginValue:null,$fontSizeSlider:null,$fontSizeValue:null,$speedSlider:null,$speedValue:null,$input:null,$send:null},this.slider={opacity:null,margin:null,fontSize:null,speed:null},this.emitting=!1,this.isLock=!1,this.timer=null,this.createTemplate(),this.createSliders(),this.createEvents(),this.mount(this.option.mount),z.on("resize",()=>this.resize()),z.on("fullscreen",G=>this.onFullscreen(G)),z.on("fullscreenWeb",G=>this.onFullscreen(G)),z.proxy(this.template.$config,"mouseenter",()=>{this.onMouseEnter({$control:this.template.$config,$panel:this.template.$configPanel})}),z.proxy(this.template.$style,"mouseenter",()=>{this.onMouseEnter({$control:this.template.$style,$panel:this.template.$stylePanel})})}static get icons(){return{$on:l.default,$off:c.default,$config:h.default,$style:g.default,$mode_0_off:E.default,$mode_0_on:O.default,$mode_1_off:R.default,$mode_1_on:b.default,$mode_2_off:L.default,$mode_2_on:j.default,$check_on:$.default,$check_off:Q.default}}get option(){return this.danmuku.option}get outside(){return this.template.$mount!==this.template.$controlsCenter}get TEMPLATE(){let{option:z}=this;return`<div class="apd-toggle">${l.default}${c.default}</div><div class="apd-config">${h.default}<div class="apd-config-panel"><div class="apd-config-panel-inner"><div class="apd-config-mode">\u6309\u7C7B\u578B\u5C4F\u853D<div class="apd-modes"><div data-mode="0" class="apd-mode">${E.default}${O.default}<div>\u6EDA\u52A8</div></div><div data-mode="1" class="apd-mode">${R.default}${b.default}<div>\u9876\u90E8</div></div><div data-mode="2" class="apd-mode">${L.default}${j.default}<div>\u5E95\u90E8</div></div></div></div><div class="apd-config-other"><div class="apd-other apd-anti-overlap">${$.default}${Q.default} \u9632\u6B62\u5F39\u5E55\u91CD\u53E0</div><div class="apd-other apd-sync-video">${$.default}${Q.default} \u540C\u6B65\u89C6\u9891\u901F\u5EA6</div></div><div class="apd-config-slider apd-config-opacity">\u4E0D\u900F\u660E\u5EA6<div class="apd-slider"></div><div class="apd-value">\u672A\u77E5</div></div><div class="apd-config-slider apd-config-margin">\u663E\u793A\u533A\u57DF<div class="apd-slider"></div><div class="apd-value">\u672A\u77E5</div></div><div class="apd-config-slider apd-config-fontSize">\u5F39\u5E55\u5B57\u53F7<div class="apd-slider"></div><div class="apd-value">\u672A\u77E5</div></div><div class="apd-config-slider apd-config-speed">\u5F39\u5E55\u901F\u5EA6<div class="apd-slider"></div><div class="apd-value">\u672A\u77E5</div></div></div></div></div><div class="apd-emitter"><div class="apd-style">${g.default}<div class="apd-style-panel"><div class="apd-style-panel-inner"><div class="apd-style-mode">\u6A21\u5F0F<div class="apd-modes"><div data-mode="0" class="apd-mode">${O.default}<div>\u6EDA\u52A8</div></div><div data-mode="1" class="apd-mode">${b.default}<div>\u9876\u90E8</div></div><div data-mode="2" class="apd-mode">${j.default}<div>\u5E95\u90E8</div></div></div></div><div class="apd-style-color">\u989C\u8272<div class="apd-colors">${this.COLOR.map(B=>`<div data-color="${B}" class="apd-color" style="background-color: ${B}"></div>`).join("")}</div></div></div></div></div><input class="apd-input" placeholder="\u53D1\u4E2A\u53CB\u5584\u7684\u5F39\u5E55\u89C1\u8BC1\u5F53\u4E0B" autocomplete="off" maxLength="${z.maxLength}" /><div class="apd-send">\u53D1\u9001</div></div>`}get OPACITY(){return Nt({min:0,max:100,steps:[]},this.option.OPACITY)}get FONT_SIZE(){return Nt({min:12,max:120,steps:[]},this.option.FONT_SIZE)}get MARGIN(){return Nt({min:0,max:3,steps:[{name:"1/4",value:[10,"75%"]},{name:"\u534A\u5C4F",value:[10,"50%"]},{name:"3/4",value:[10,"25%"]},{name:"\u6EE1\u5C4F",value:[10,10]}]},this.option.MARGIN)}get SPEED(){return Nt({min:0,max:4,steps:[{name:"\u6781\u6162",value:10},{name:"\u8F83\u6162",value:7.5,hide:!0},{name:"\u9002\u4E2D",value:5},{name:"\u8F83\u5FEB",value:2.5,hide:!0},{name:"\u6781\u5FEB",value:1}]},this.option.SPEED)}get COLOR(){return this.option.COLOR.length?this.option.COLOR:["#FE0302","#FF7204","#FFAA02","#FFD302","#FFFF00","#A0EE00","#00CD00","#019899","#4266BE","#89D5FF","#CC0273","#222222","#9B9B9B","#FFFFFF"]}query(z){let{query:B}=this.utils,{$danmuku:w}=this.template;return B(z,w)}append(z,B){let{append:w}=this.utils;[...z.children].some(P=>P===B)||w(z,B)}setData(z,B){let{$player:w}=this.art.template,{$mount:P}=this.template;w.dataset[z]=B,this.outside&&(P.dataset[z]=B)}createTemplate(){let{createElement:z,tooltip:B}=this.utils,w=z("div");w.className="artplayer-plugin-danmuku",w.innerHTML=this.TEMPLATE,this.template.$danmuku=w,this.template.$toggle=this.query(".apd-toggle"),this.template.$config=this.query(".apd-config"),this.template.$configPanel=this.query(".apd-config-panel"),this.template.$configModes=this.query(".apd-config-mode .apd-modes"),this.template.$style=this.query(".apd-style"),this.template.$stylePanel=this.query(".apd-style-panel"),this.template.$styleModes=this.query(".apd-style-mode .apd-modes"),this.template.$colors=this.query(".apd-colors"),this.template.$antiOverlap=this.query(".apd-anti-overlap"),this.template.$syncVideo=this.query(".apd-sync-video"),this.template.$opacitySlider=this.query(".apd-config-opacity .apd-slider"),this.template.$opacityValue=this.query(".apd-config-opacity .apd-value"),this.template.$marginSlider=this.query(".apd-config-margin .apd-slider"),this.template.$marginValue=this.query(".apd-config-margin .apd-value"),this.template.$fontSizeSlider=this.query(".apd-config-fontSize .apd-slider"),this.template.$fontSizeValue=this.query(".apd-config-fontSize .apd-value"),this.template.$speedSlider=this.query(".apd-config-speed .apd-slider"),this.template.$speedValue=this.query(".apd-config-speed .apd-value"),this.template.$input=this.query(".apd-input"),this.template.$send=this.query(".apd-send");let{$toggle:P}=this.template;this.art.on("artplayerPluginDanmuku:show",()=>{B(P,"\u5173\u95ED\u5F39\u5E55")}),this.art.on("artplayerPluginDanmuku:hide",()=>{B(P,"\u6253\u5F00\u5F39\u5E55")})}createEvents(){let{$toggle:z,$configModes:B,$styleModes:w,$colors:P,$antiOverlap:G,$syncVideo:et,$send:rt,$input:dt}=this.template;this.art.proxy(z,"click",()=>{this.danmuku.config({visible:!this.option.visible}),this.reset()}),this.art.proxy(B,"click",vt=>{let Lt=vt.target.closest(".apd-mode");if(!Lt)return;let xt=Number(Lt.dataset.mode);this.option.modes.includes(xt)?this.danmuku.config({modes:this.option.modes.filter(it=>it!==xt)}):this.danmuku.config({modes:[...this.option.modes,xt]}),this.reset()}),this.art.proxy(G,"click",()=>{this.danmuku.config({antiOverlap:!this.option.antiOverlap}),this.reset()}),this.art.proxy(et,"click",()=>{this.danmuku.config({synchronousPlayback:!this.option.synchronousPlayback}),this.reset()}),this.art.proxy(w,"click",vt=>{let Lt=vt.target.closest(".apd-mode");if(!Lt)return;let xt=Number(Lt.dataset.mode);this.danmuku.config({mode:xt}),this.reset()}),this.art.proxy(P,"click",vt=>{let Lt=vt.target.closest(".apd-color");Lt&&(this.danmuku.config({color:Lt.dataset.color}),this.reset())}),this.art.proxy(rt,"click",()=>this.emit()),this.art.proxy(dt,"keypress",vt=>{vt.key==="Enter"&&(vt.preventDefault(),this.emit())})}createSliders(){this.slider.opacity=this.createSlider(jt(Nt({},this.OPACITY),{container:this.template.$opacitySlider,findIndex:()=>Math.round(100*this.option.opacity),onChange:z=>{let{$opacityValue:B}=this.template;B.textContent=`${z}%`,this.danmuku.config({opacity:z/100})}})),this.slider.margin=this.createSlider(jt(Nt({},this.MARGIN),{container:this.template.$marginSlider,findIndex:()=>this.MARGIN.steps.findIndex(z=>z.value[0]===this.option.margin[0]&&z.value[1]===this.option.margin[1]),onChange:z=>{let B=this.MARGIN.steps[z];if(!B)return;let{$marginValue:w}=this.template;w.textContent=B.name,this.danmuku.config({margin:B.value})}})),this.slider.fontSize=this.createSlider(jt(Nt({},this.FONT_SIZE),{container:this.template.$fontSizeSlider,findIndex:()=>this.danmuku.fontSize,onChange:z=>{let{$fontSizeValue:B}=this.template;B.textContent=`${z}px`,z!==this.danmuku.fontSize&&this.danmuku.config({fontSize:z})}})),this.slider.speed=this.createSlider(jt(Nt({},this.SPEED),{container:this.template.$speedSlider,findIndex:()=>this.SPEED.steps.findIndex(z=>z.value===this.option.speed),onChange:z=>{let B=this.SPEED.steps[z];if(!B)return;let{$speedValue:w}=this.template;w.textContent=B.name,this.danmuku.config({speed:B.value})}}))}createSlider({min:z,max:B,container:w,findIndex:P,onChange:G,steps:et=[]}){let{query:rt,clamp:dt}=this.utils;w.innerHTML=`<div class="apd-slider-line"><div class="apd-slider-points">${et.map(()=>'<div class="apd-slider-point"></div>').join("")}</div><div class="apd-slider-progress"></div></div><div class="apd-slider-dot"></div><div class="apd-slider-steps">${et.map(lt=>lt.hide?"":`<div class="apd-slider-step">${lt.name}</div>`).join("")}</div>`;let vt=rt(".apd-slider-dot",w),Lt=rt(".apd-slider-progress",w),xt=!1;function it(lt=P()){if(lt<z||lt>B)return;let ct=(lt-z)/(B-z);vt.style.left=`${100*ct}%`,et.length===0&&(Lt.style.width=vt.style.left),G(lt)}function at(lt){let{left:ct,width:mt}=w.getBoundingClientRect();it(Math.round(dt(lt.clientX-ct,0,mt)/mt*(B-z)+z))}return this.art.proxy(w,"click",lt=>{at(lt)}),this.art.proxy(w,"mousedown",lt=>{xt=lt.button===0}),this.art.on("document:mousemove",lt=>{xt&&at(lt)}),this.art.on("document:mouseup",lt=>{xt&&(xt=!1,at(lt))}),{reset:it}}onFullscreen(z){let{$danmuku:B,$controlsCenter:w,$mount:P}=this.template;this.outside?z?this.append(w,B):this.append(P,B):this.append(w,B)}onMouseEnter({$control:z,$panel:B}){let{$player:w}=this.art.template,P=z.getBoundingClientRect(),G=B.getBoundingClientRect(),et=w.getBoundingClientRect(),rt=G.width/2-P.width/2,dt=et.left-(P.left-rt),vt=P.right+rt-et.right;dt>0?B.style.left=`${-rt+dt}px`:vt>0?B.style.left=`${-rt-vt}px`:B.style.left=`${-rt}px`}emit(){return zt(this,null,function*(){let{$input:z}=this.template,B=z.value.trim();if(!B.length||this.isLock||this.emitting)return;let w={text:B,mode:this.option.mode,color:this.option.color,time:this.art.currentTime};try{this.emitting=!0;let P=yield this.option.beforeEmit(w);if(this.emitting=!1,P!==!0)return;w.border=!0,delete w.time,this.danmuku.emit(w),z.value="",this.lock()}catch(P){this.emitting=!1}})}lock(){let{addClass:z}=this.utils,{$send:B}=this.template;this.isLock=!0;let w=this.option.lockTime;B.innerText=w,z(B,"apd-lock");let P=()=>{this.timer=setTimeout(()=>{w===0?this.unlock():(w-=1,B.innerText=w,P())},1e3)};P()}unlock(){let{removeClass:z}=this.utils,{$send:B}=this.template;clearTimeout(this.timer),this.isLock=!1,B.innerText="\u53D1\u9001",z(B,"apd-lock")}resize(){if(this.outside||this.art.fullscreen||this.art.fullscreenWeb)return;let{$player:z,$controlsCenter:B}=this.art.template,{$danmuku:w}=this.template;this.art.width<this.option.width?this.append(z,w):this.append(B,w)}reset(){let{inverseClass:z,tooltip:B}=this.utils,{$toggle:w,$colors:P}=this.template;this.slider.opacity.reset(),this.slider.margin.reset(),this.slider.fontSize.reset(),this.slider.speed.reset(),this.setData("danmukuVisible",this.option.visible),this.setData("danmukuMode",this.option.mode),this.setData("danmukuColor",this.option.color),this.setData("danmukuMode0",this.option.modes.includes(0)),this.setData("danmukuMode1",this.option.modes.includes(1)),this.setData("danmukuMode2",this.option.modes.includes(2)),this.setData("danmukuAntiOverlap",this.option.antiOverlap),this.setData("danmukuSyncVideo",this.option.synchronousPlayback),this.setData("danmukuTheme",this.option.theme),this.setData("danmukuEmitter",this.option.emitter);let G=Array.from(P.children).find(et=>et.dataset.color===this.option.color.toUpperCase());G&&z(G,"apd-active"),B(w,this.option.visible?"\u5173\u95ED\u5F39\u5E55":"\u6253\u5F00\u5F39\u5E55"),this.resize()}mount(z){let{errorHandle:B}=this.utils,w=typeof z=="string"?document.querySelector(z):z;B(w,`Can not find the mount point: ${z}`),this.append(w,this.template.$danmuku),this.template.$mount=w,this.reset()}},typeof document!="undefined"){let z="artplayer-plugin-danmuku",B=document.getElementById(z);if(B)B.textContent=o.default;else{let w=document.createElement("style");w.id=z,w.textContent=o.default,document.head.appendChild(w)}}},{"bundle-text:./style.less":"hViDo","bundle-text:./img/on.svg":"9pjcf","bundle-text:./img/off.svg":"b2dkP","bundle-text:./img/config.svg":"l8tyy","bundle-text:./img/style.svg":"5iZC3","bundle-text:./img/mode_0_off.svg":"i0Vut","bundle-text:./img/mode_0_on.svg":"hOSvZ","bundle-text:./img/mode_1_off.svg":"bOXC3","bundle-text:./img/mode_1_on.svg":"lKuh0","bundle-text:./img/mode_2_off.svg":"eB8W6","bundle-text:./img/mode_2_on.svg":"bpe2E","bundle-text:./img/check_on.svg":"kL9zy","bundle-text:./img/check_off.svg":"22xpM","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],hViDo:[function(e,i,r){i.exports='.artplayer-plugin-danmuku{z-index:99;color:#fff;flex-shrink:0;justify-content:center;align-items:center;gap:10px;width:100%;height:32px;font-size:12px;font-weight:300;display:flex;position:relative}.artplayer-plugin-danmuku .apd-icon{cursor:pointer;opacity:.75;fill:#fff;transition:all .2s}.artplayer-plugin-danmuku .apd-icon:hover{opacity:1}.artplayer-plugin-danmuku .apd-config{display:flex;position:relative}.artplayer-plugin-danmuku .apd-config .apd-config-panel{opacity:0;pointer-events:none;width:320px;padding:10px;position:absolute;bottom:24px;left:0}.artplayer-plugin-danmuku .apd-config .apd-config-panel .apd-config-panel-inner{background-color:#000000d9;border-radius:3px;width:100%;padding:10px}.artplayer-plugin-danmuku .apd-config:hover .apd-config-panel{opacity:100;pointer-events:all}.artplayer-plugin-danmuku .apd-config-mode,.artplayer-plugin-danmuku .apd-config-slider,.artplayer-plugin-danmuku .apd-config-other,.artplayer-plugin-danmuku .apd-style-mode{margin-bottom:15px}.artplayer-plugin-danmuku .apd-modes{align-items:center;gap:20px;margin-top:5px;display:flex}.artplayer-plugin-danmuku .apd-modes .apd-mode{cursor:pointer;text-align:center}.artplayer-plugin-danmuku .apd-modes .apd-mode:hover{color:#00a1d6}.artplayer-plugin-danmuku .apd-config-slider{align-items:center;gap:12px;display:flex}.artplayer-plugin-danmuku .apd-config-slider .apd-value{text-align:right;width:32px}.artplayer-plugin-danmuku .apd-slider{cursor:pointer;flex:1;justify-content:center;align-items:center;height:20px;display:flex;position:relative}.artplayer-plugin-danmuku .apd-slider .apd-slider-line{background-color:#ffffff40;border-radius:3px;width:100%;height:2px;position:relative;overflow:hidden}.artplayer-plugin-danmuku .apd-slider .apd-slider-points{justify-content:space-between;align-items:center;display:flex;position:absolute;inset:0}.artplayer-plugin-danmuku .apd-slider .apd-slider-points .apd-slider-point{background-color:#ffffff80;border-radius:50%;width:2px;height:2px}.artplayer-plugin-danmuku .apd-slider .apd-slider-progress{background-color:#00a1d6;width:0%;height:100%}.artplayer-plugin-danmuku .apd-slider .apd-slider-dot{background-color:#00a1d6;border-radius:50%;width:12px;height:12px;position:absolute;left:0%;transform:translate(-6px)}.artplayer-plugin-danmuku .apd-slider .apd-slider-steps{color:#777;justify-content:space-between;align-items:center;width:calc(100% + 32px);display:flex;position:absolute;bottom:-12px}.artplayer-plugin-danmuku .apd-slider .apd-slider-steps .apd-slider-step{text-align:center;flex-shrink:0;width:36px;scale:.95}.artplayer-plugin-danmuku .apd-config-other{align-items:center;gap:20px;display:flex}.artplayer-plugin-danmuku .apd-config-other .apd-check-off,.artplayer-plugin-danmuku .apd-config-other .apd-check-on{width:16px;height:16px}.artplayer-plugin-danmuku .apd-config-other .apd-other{cursor:pointer;align-items:center;gap:2px;display:flex}.artplayer-plugin-danmuku .apd-config-other .apd-other:hover{color:#00a1d6}.artplayer-plugin-danmuku .apd-emitter{background-color:#ffffff40;border-radius:5px;flex:1;align-items:center;height:100%;display:flex}.artplayer-plugin-danmuku .apd-style{justify-content:center;align-items:center;display:flex;position:relative}.artplayer-plugin-danmuku .apd-style .apd-style-panel{opacity:0;pointer-events:none;width:200px;padding:10px;position:absolute;bottom:24px;left:0}.artplayer-plugin-danmuku .apd-style .apd-style-panel .apd-style-panel-inner{background-color:#000000d9;border-radius:3px;width:100%;padding:10px}.artplayer-plugin-danmuku .apd-style:hover .apd-style-panel{opacity:100;pointer-events:all}.artplayer-plugin-danmuku .apd-colors{flex-wrap:wrap;gap:8px;margin-top:5px;display:flex}.artplayer-plugin-danmuku .apd-colors .apd-color{cursor:pointer;border-radius:2px;width:16px;height:16px}.artplayer-plugin-danmuku .apd-colors .apd-color.apd-active{border:1px solid #000;box-shadow:0 0 0 1px #fff}.artplayer-plugin-danmuku .apd-input{color:#fff;background-color:#0000;border:none;outline:none;flex:1;width:auto;min-width:0;height:100%;line-height:1}.artplayer-plugin-danmuku .apd-input::placeholder{color:#ffffff80}.artplayer-plugin-danmuku .apd-send{cursor:pointer;text-shadow:none;background-color:#00a1d6;border-top-right-radius:5px;border-bottom-right-radius:5px;flex-shrink:0;justify-content:center;align-items:center;width:60px;height:100%;display:flex}.artplayer-plugin-danmuku .apd-send.apd-lock{cursor:not-allowed;color:#666;background-color:#e7e7e7}.art-controls-center .apd-emitter{flex:none;width:260px}.art-fullscreen .artplayer-plugin-danmuku,.art-fullscreen-web .artplayer-plugin-danmuku{gap:16px;height:38px}.art-fullscreen .artplayer-plugin-danmuku .apd-config-icon,.art-fullscreen-web .artplayer-plugin-danmuku .apd-config-icon,.art-fullscreen .artplayer-plugin-danmuku .apd-toggle-off,.art-fullscreen-web .artplayer-plugin-danmuku .apd-toggle-off,.art-fullscreen .artplayer-plugin-danmuku .apd-toggle-on,.art-fullscreen-web .artplayer-plugin-danmuku .apd-toggle-on{width:28px;height:28px}.art-fullscreen .artplayer-plugin-danmuku .apd-emitter,.art-fullscreen-web .artplayer-plugin-danmuku .apd-emitter{flex:none;width:400px}.art-video-player>.artplayer-plugin-danmuku{padding:0 10px;position:absolute;bottom:-40px;left:0;right:0}.art-video-player:has(>.artplayer-plugin-danmuku){margin-bottom:40px}[data-danmuku-emitter=false] .apd-emitter{display:none!important}[data-danmuku-emitter=false] .art-controls-center .artplayer-plugin-danmuku{justify-content:flex-end;gap:18px}[data-danmuku-emitter=false].art-fullscreen .art-controls-center .artplayer-plugin-danmuku,[data-danmuku-emitter=false].art-fullscreen-web .art-controls-center .artplayer-plugin-danmuku{gap:24px}[data-danmuku-theme=light]>.artplayer-plugin-danmuku .apd-icon{fill:#333}[data-danmuku-theme=light]>.artplayer-plugin-danmuku .apd-emitter{background-color:#f1f2f3}[data-danmuku-theme=light]>.artplayer-plugin-danmuku .apd-input{color:#000}[data-danmuku-theme=light]>.artplayer-plugin-danmuku .apd-input::placeholder{color:#0000004d}[data-danmuku-visible=false] .apd-toggle-off{display:block}[data-danmuku-visible=false] .apd-toggle-on,[data-danmuku-visible=true] .apd-toggle-off{display:none}[data-danmuku-visible=true] .apd-toggle-on{display:block}[data-danmuku-anti-overlap=false] .apd-anti-overlap .apd-check-on{display:none}[data-danmuku-anti-overlap=false] .apd-anti-overlap .apd-check-off,[data-danmuku-anti-overlap=true] .apd-anti-overlap .apd-check-on{display:block}[data-danmuku-anti-overlap=true] .apd-anti-overlap .apd-check-off,[data-danmuku-sync-video=false] .apd-sync-video .apd-check-on{display:none}[data-danmuku-sync-video=false] .apd-sync-video .apd-check-off,[data-danmuku-sync-video=true] .apd-sync-video .apd-check-on{display:block}[data-danmuku-sync-video=true] .apd-sync-video .apd-check-off{display:none}[data-danmuku-mode0=false] .apd-config-mode .apd-mode-0-off{display:block}[data-danmuku-mode0=false] .apd-config-mode .apd-mode-0-on{display:none}[data-danmuku-mode0=false] .art-danmuku [data-mode="0"]{opacity:0!important}[data-danmuku-mode0=true] .apd-config-mode .apd-mode-0-off{display:none}[data-danmuku-mode0=true] .apd-config-mode .apd-mode-0-on{display:block}[data-danmuku-mode="0"] .apd-style-mode [data-mode="0"]{color:#00a1d6}[data-danmuku-mode="0"] .apd-style-mode [data-mode="0"] path{fill:#00a1d6}[data-danmuku-mode1=false] .apd-config-mode .apd-mode-1-off{display:block}[data-danmuku-mode1=false] .apd-config-mode .apd-mode-1-on{display:none}[data-danmuku-mode1=false] .art-danmuku [data-mode="1"]{opacity:0!important}[data-danmuku-mode1=true] .apd-config-mode .apd-mode-1-off{display:none}[data-danmuku-mode1=true] .apd-config-mode .apd-mode-1-on{display:block}[data-danmuku-mode="1"] .apd-style-mode [data-mode="1"]{color:#00a1d6}[data-danmuku-mode="1"] .apd-style-mode [data-mode="1"] path{fill:#00a1d6}[data-danmuku-mode2=false] .apd-config-mode .apd-mode-2-off{display:block}[data-danmuku-mode2=false] .apd-config-mode .apd-mode-2-on{display:none}[data-danmuku-mode2=false] .art-danmuku [data-mode="2"]{opacity:0!important}[data-danmuku-mode2=true] .apd-config-mode .apd-mode-2-off{display:none}[data-danmuku-mode2=true] .apd-config-mode .apd-mode-2-on{display:block}[data-danmuku-mode="2"] .apd-style-mode [data-mode="2"]{color:#00a1d6}[data-danmuku-mode="2"] .apd-style-mode [data-mode="2"] path{fill:#00a1d6}'},{}],"9pjcf":[function(e,i,r){i.exports='<svg class="apd-icon apd-toggle-on" xmlns="http://www.w3.org/2000/svg" data-pointer="none" viewBox="0 0 24 24" width="24" height="24"><path fill-rule="evenodd" d="M11.989 4.828c-.47 0-.975.004-1.515.012l-1.71-2.566a1.008 1.008 0 0 0-1.678 1.118l.999 1.5c-.681.018-1.403.04-2.164.068a4.013 4.013 0 0 0-3.83 3.44c-.165 1.15-.245 2.545-.245 4.185 0 1.965.115 3.67.35 5.116a4.012 4.012 0 0 0 3.763 3.363l.906.046c1.205.063 1.808.095 3.607.095a.988.988 0 0 0 0-1.975c-1.758 0-2.339-.03-3.501-.092l-.915-.047a2.037 2.037 0 0 1-1.91-1.708c-.216-1.324-.325-2.924-.325-4.798 0-1.563.076-2.864.225-3.904.14-.977.96-1.713 1.945-1.747 2.444-.087 4.465-.13 6.063-.131 1.598 0 3.62.044 6.064.13.96.034 1.71.81 1.855 1.814.075.524.113 1.962.141 3.065v.002c.01.342.017.65.025.88a.987.987 0 1 0 1.974-.068c-.008-.226-.016-.523-.025-.856v-.027c-.03-1.118-.073-2.663-.16-3.276-.273-1.906-1.783-3.438-3.74-3.507-.9-.032-1.743-.058-2.531-.078l1.05-1.46a1.008 1.008 0 0 0-1.638-1.177l-1.862 2.59c-.38-.004-.744-.007-1.088-.007h-.13Zm.521 4.775h-1.32v4.631h2.222v.847h-2.618v1.078h2.618l.003.678c.36.026.714.163 1.01.407h.11v-1.085h2.694v-1.078h-2.695v-.847H16.8v-4.63h-1.276a8.59 8.59 0 0 0 .748-1.42L15.183 7.8a14.232 14.232 0 0 1-.814 1.804h-1.518l.693-.308a8.862 8.862 0 0 0-.814-1.408l-1.045.352c.297.396.572.847.825 1.364Zm-4.18 3.564.154-1.485h1.98V8.294h-3.2v.98H9.33v1.43H7.472l-.308 3.453h2.277c0 1.166-.044 1.925-.12 2.277-.078.352-.386.528-.936.528-.308 0-.616-.022-.902-.055l.297 1.067.062.005c.285.02.551.04.818.04 1.001-.067 1.562-.419 1.694-1.057.11-.638.176-1.903.176-3.795h-2.2Zm7.458.11v-.858h-1.254v.858h1.254Zm-2.376-.858v.858h-1.199v-.858h1.2Zm-1.199-.946h1.2v-.902h-1.2v.902Zm2.321 0v-.902h1.254v.902h-1.254Z" clip-rule="evenodd"/><path fill="#00AEEC" fill-rule="evenodd" d="M22.846 14.627a1 1 0 0 0-1.412.075l-5.091 5.703-2.216-2.275-.097-.086-.008-.005a1 1 0 0 0-1.322 1.493l2.963 3.041.093.083.007.005a1 1 0 0 0 1.354-.124l5.81-6.505.08-.102.005-.008a1 1 0 0 0-.166-1.295Z" clip-rule="evenodd"/></svg>'},{}],b2dkP:[function(e,i,r){i.exports='<svg class="apd-icon apd-toggle-off" xmlns="http://www.w3.org/2000/svg" data-pointer="none" viewBox="0 0 24 24" width="24" height="24"><path fill-rule="evenodd" d="m8.085 4.891-.999-1.499a1.008 1.008 0 0 1 1.679-1.118l1.709 2.566c.54-.008 1.045-.012 1.515-.012h.13c.345 0 .707.003 1.088.007l1.862-2.59a1.008 1.008 0 0 1 1.637 1.177l-1.049 1.46c.788.02 1.631.046 2.53.078 1.958.069 3.468 1.6 3.74 3.507.088.613.13 2.158.16 3.276l.001.027c.01.333.017.63.025.856a.987.987 0 0 1-1.974.069c-.008-.23-.016-.539-.025-.881v-.002c-.028-1.103-.066-2.541-.142-3.065-.143-1.004-.895-1.78-1.854-1.813a179.14 179.14 0 0 0-6.064-.131c-1.598 0-3.619.044-6.063.13a2.037 2.037 0 0 0-1.945 1.748c-.15 1.04-.225 2.341-.225 3.904 0 1.874.11 3.474.325 4.798.154.949.95 1.66 1.91 1.708a97.58 97.58 0 0 0 5.416.139.988.988 0 0 1 0 1.975 99.78 99.78 0 0 1-5.513-.141A4.012 4.012 0 0 1 2.197 17.7c-.236-1.446-.351-3.151-.351-5.116 0-1.64.08-3.035.245-4.184A4.013 4.013 0 0 1 5.92 4.96c.761-.027 1.483-.05 2.164-.069Zm4.436 4.707h-1.32v4.63h2.222v.848h-2.618v1.078h2.431a5.01 5.01 0 0 1 3.575-3.115V9.598h-1.276a8.59 8.59 0 0 0 .748-1.42l-1.089-.384a14.232 14.232 0 0 1-.814 1.804h-1.518l.693-.308a8.862 8.862 0 0 0-.814-1.408l-1.045.352c.297.396.572.847.825 1.364Zm-4.18 3.564.154-1.485h1.98V8.289h-3.2v.979h2.067v1.43H7.483l-.308 3.454h2.277c0 1.166-.044 1.925-.12 2.277-.078.352-.386.528-.936.528-.308 0-.616-.022-.902-.055l.297 1.067.062.004c.285.02.551.04.818.04 1.001-.066 1.562-.418 1.694-1.056.11-.638.176-1.903.176-3.795h-2.2Zm7.458.11v-.858h-1.254v.858H15.8Zm-2.376-.858v.858h-1.199v-.858h1.2Zm-1.199-.946h1.2v-.902h-1.2v.902Zm2.321 0v-.902H15.8v.902h-1.254Zm3.517 10.594a4 4 0 1 0 0-8 4 4 0 0 0 0 8Zm-.002-1.502a2.5 2.5 0 0 1-2.217-3.657l3.326 3.398a2.49 2.49 0 0 1-1.109.259Zm2.5-2.5c0 .42-.103.815-.286 1.162l-3.328-3.401a2.5 2.5 0 0 1 3.614 2.239Z" clip-rule="evenodd"/></svg>'},{}],l8tyy:[function(e,i,r){i.exports='<svg class="apd-icon apd-config-icon" xmlns="http://www.w3.org/2000/svg" data-pointer="none" viewBox="0 0 24 24" width="24" height="24"><path fill-rule="evenodd" d="m15.645 4.881 1.06-1.473a.998.998 0 1 0-1.622-1.166L13.22 4.835a110.67 110.67 0 0 0-1.1-.007h-.131c-.47 0-.975.004-1.515.012L8.783 2.3A.998.998 0 0 0 7.12 3.408l.988 1.484c-.688.019-1.418.042-2.188.069a4.013 4.013 0 0 0-3.83 3.44c-.165 1.15-.245 2.545-.245 4.185 0 1.965.115 3.67.35 5.116a4.012 4.012 0 0 0 3.763 3.363 99.78 99.78 0 0 0 5.513.141.988.988 0 0 0 0-1.975 97.58 97.58 0 0 1-5.416-.139 2.037 2.037 0 0 1-1.91-1.708c-.216-1.324-.325-2.924-.325-4.798 0-1.563.076-2.864.225-3.904.14-.977.96-1.713 1.945-1.747 2.444-.087 4.465-.13 6.063-.131 1.598 0 3.62.044 6.064.13.96.034 1.71.81 1.855 1.814.075.524.113 1.962.141 3.065v.002c.005.183.01.07.014-.038.004-.096.008-.189.011-.081a.987.987 0 1 0 1.974-.069c-.004-.105-.007-.009-.011.09a2.175 2.175 0 0 1-.007.135l-.002.01a.574.574 0 0 1-.005-.091v-.027c-.03-1.118-.073-2.663-.16-3.276-.273-1.906-1.783-3.438-3.74-3.507-.905-.032-1.752-.058-2.543-.079Zm-3.113 4.703h-1.307v4.643h2.2v.04l.651-1.234c.113-.215.281-.389.482-.509v-.11h.235c.137-.049.283-.074.433-.074h1.553V9.584h-1.264a8.5 8.5 0 0 0 .741-1.405l-1.078-.381c-.24.631-.501 1.23-.806 1.786h-1.503l.686-.305a8.613 8.613 0 0 0-.806-1.394l-1.034.348c.294.392.566.839.817 1.35Zm-1.7 5.502h2.16l-.564 1.068h-1.595v-1.068Zm-2.498-1.863.152-1.561h1.96V8.289H7.277v.969h2.048v1.435h-1.84l-.306 3.51h2.254c0 1.155-.043 1.906-.12 2.255-.076.348-.38.523-.925.523-.305 0-.61-.022-.893-.055l.294 1.056.061.005c.282.02.546.039.81.039.991-.065 1.547-.414 1.677-1.046.11-.631.175-1.883.175-3.757H8.334Zm5.09-.8v.85h-1.188v-.85h1.187Zm-1.188-.955h1.187v-.893h-1.187v.893Zm2.322.007v-.893h1.241v.893h-1.241Zm.528 2.757a1.26 1.26 0 0 1 1.087-.627l4.003-.009a1.26 1.26 0 0 1 1.094.63l1.721 2.982c.226.39.225.872-.001 1.263l-1.743 3a1.26 1.26 0 0 1-1.086.628l-4.003.009a1.26 1.26 0 0 1-1.094-.63l-1.722-2.982a1.26 1.26 0 0 1 .002-1.263l1.742-3Zm1.967.858a1.26 1.26 0 0 0-1.08.614l-.903 1.513a1.26 1.26 0 0 0-.002 1.289l.885 1.492c.227.384.64.62 1.086.618l2.192-.005a1.26 1.26 0 0 0 1.08-.615l.904-1.518a1.26 1.26 0 0 0 .001-1.288l-.884-1.489a1.26 1.26 0 0 0-1.086-.616l-2.193.005Zm2.517 2.76a1.4 1.4 0 1 1-2.8 0 1.4 1.4 0 0 1 2.8 0Z" clip-rule="evenodd"/></svg>'},{}],"5iZC3":[function(e,i,r){i.exports='<svg class="apd-icon apd-style-icon" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" data-pointer="none" style="enable-background:new 0 0 22 22" viewBox="0 0 22 22" width="36" height="24"><path d="M17 16H5c-.55 0-1 .45-1 1s.45 1 1 1h12c.55 0 1-.45 1-1s-.45-1-1-1zM6.96 15c.39 0 .74-.24.89-.6l.65-1.6h5l.66 1.6c.15.36.5.6.89.6.69 0 1.15-.71.88-1.34l-3.88-8.97C11.87 4.27 11.46 4 11 4s-.87.27-1.05.69l-3.88 8.97c-.27.63.2 1.34.89 1.34zM11 5.98 12.87 11H9.13L11 5.98z"/></svg>'},{}],i0Vut:[function(e,i,r){i.exports='<svg class="apd-icon apd-mode-0-off" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" data-pointer="none" style="enable-background:new 0 0 28 28" viewBox="0 0 28 28" width="28" height="28"><path d="M23 15c1.487 0 2.866.464 4 1.255V7a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v14a4 4 0 0 0 4 4h11.674A7 7 0 0 1 23 15zM11 9h6a1 1 0 0 1 0 2h-6a1 1 0 0 1 0-2zm-3 2H6V9h2v2zm4 4h-2v-2h2v2zm2-1a1 1 0 0 1 1-1h1a1 1 0 0 1 0 2h-1a1 1 0 0 1-1-1z" fill="#00AEEC"/><path d="M26.536 18.464a5 5 0 0 0-7.071 0 5 5 0 0 0 0 7.071 5 5 0 1 0 7.071-7.071zm-5.657 5.657a3 3 0 0 1-.586-3.415l4.001 4.001a3 3 0 0 1-3.415-.586zm4.829-.827-4.001-4.001a3.002 3.002 0 0 1 4.001 4.001z" fill="#00AEEC"/></svg>'},{}],hOSvZ:[function(e,i,r){i.exports='<svg class="apd-icon apd-mode-0-on" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" data-pointer="none" style="enable-background:new 0 0 28 28" viewBox="0 0 28 28" width="28" height="28"><path d="M23 3H5a4 4 0 0 0-4 4v14a4 4 0 0 0 4 4h18a4 4 0 0 0 4-4V7a4 4 0 0 0-4-4zM11 9h6a1 1 0 0 1 0 2h-6a1 1 0 0 1 0-2zm-3 2H6V9h2v2zm4 4h-2v-2h2v2zm9 0h-6a1 1 0 0 1 0-2h6a1 1 0 0 1 0 2z" fill="#FFF"/></svg>'},{}],bOXC3:[function(e,i,r){i.exports='<svg class="apd-icon apd-mode-1-off" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" data-pointer="none" style="enable-background:new 0 0 28 28" viewBox="0 0 28 28" width="28" height="28"><path d="M23 15c1.487 0 2.866.464 4 1.255V7a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v14a4 4 0 0 0 4 4h11.674A7 7 0 0 1 23 15zm-4-8h2v2h-2V7zM9 9H7V7h2v2zm4 0h-2V7h2v2zm2-2h2v2h-2V7z" fill="#00AEEC"/><path d="M26.536 18.464a5 5 0 0 0-7.071 0 5 5 0 0 0 0 7.071 5 5 0 1 0 7.071-7.071zm-5.657 5.657a3 3 0 0 1-.586-3.415l4.001 4.001a3 3 0 0 1-3.415-.586zm4.829-.827-4.001-4.001a3.002 3.002 0 0 1 4.001 4.001z" fill="#00AEEC"/></svg>'},{}],lKuh0:[function(e,i,r){i.exports='<svg class="apd-icon apd-mode-1-on" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" data-pointer="none" style="enable-background:new 0 0 28 28" viewBox="0 0 28 28" width="28" height="28"><path d="M23 3H5a4 4 0 0 0-4 4v14a4 4 0 0 0 4 4h18a4 4 0 0 0 4-4V7a4 4 0 0 0-4-4zM9 9H7V7h2v2zm4 0h-2V7h2v2zm4 0h-2V7h2v2zm4 0h-2V7h2v2z" fill="#FFF"/></svg>'},{}],eB8W6:[function(e,i,r){i.exports='<svg class="apd-icon apd-mode-2-off" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" data-pointer="none" style="enable-background:new 0 0 28 28" viewBox="0 0 28 28" width="28" height="28"><path d="M23 15c1.487 0 2.866.464 4 1.255V7a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v14a4 4 0 0 0 4 4h11.674A7 7 0 0 1 23 15zM9 21H7v-2h2v2zm4 0h-2v-2h2v2z" fill="#00AEEC"/><path d="M26.536 18.464a5 5 0 0 0-7.071 0 5 5 0 0 0 0 7.071 5 5 0 1 0 7.071-7.071zm-5.657 5.657a3 3 0 0 1-.586-3.415l4.001 4.001a3 3 0 0 1-3.415-.586zm4.829-.827-4.001-4.001a3.002 3.002 0 0 1 4.001 4.001z" fill="#00AEEC"/></svg>'},{}],bpe2E:[function(e,i,r){i.exports='<svg class="apd-icon apd-mode-2-on" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" data-pointer="none" style="enable-background:new 0 0 28 28" viewBox="0 0 28 28" width="28" height="28"><path d="M23 3H5a4 4 0 0 0-4 4v14a4 4 0 0 0 4 4h18a4 4 0 0 0 4-4V7a4 4 0 0 0-4-4zM9 21H7v-2h2v2zm4 0h-2v-2h2v2zm4 0h-2v-2h2v2zm4 0h-2v-2h2v2z" fill="#FFF"/></svg>'},{}],kL9zy:[function(e,i,r){i.exports='<svg class="apd-icon apd-check-on" xmlns="http://www.w3.org/2000/svg" data-pointer="none" viewBox="0 0 32 32" width="32" height="32"><path d="m13 18.25-1.8-1.8c-.6-.6-1.65-.6-2.25 0s-.6 1.5 0 2.25l2.85 2.85c.318.318.762.468 1.2.448.438.02.882-.13 1.2-.448l8.85-8.85c.6-.6.6-1.65 0-2.25s-1.65-.6-2.25 0l-7.8 7.8zM8 4h16c2.21 0 4 1.79 4 4v16c0 2.21-1.79 4-4 4H8c-2.21 0-4-1.79-4-4V8c0-2.21 1.79-4 4-4z" fill="#00AEEC"/></svg>'},{}],"22xpM":[function(e,i,r){i.exports='<svg class="apd-icon apd-check-off" xmlns="http://www.w3.org/2000/svg" data-pointer="none" viewBox="0 0 32 32" width="32" height="32"><path d="M8 6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2H8zm0-2h16c2.21 0 4 1.79 4 4v16c0 2.21-1.79 4-4 4H8c-2.21 0-4-1.79-4-4V8c0-2.21 1.79-4 4-4z" fill="#FFF"/></svg>'},{}],"8AxLD":[function(e,i,r){var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"default",()=>a);let n={map:(l,d,c,f,h)=>(l-d)*(h-f)/(c-d)+f,range(l,d,c){let f=Math.round(l/c)*c;return Array.from({length:Math.floor((d-l)/c)},(h,p)=>p*c+f)}},o=(l,d)=>{let c=d[0]-l[0],f=d[1]-l[1];return{length:Math.sqrt(Math.pow(c,2)+Math.pow(f,2)),angle:Math.atan2(f,c)}};function a(l,d,c){let{query:f}=l.constructor.utils;l.controls.add({name:"heatmap",position:"top",html:"",style:{position:"absolute",top:"-100px",left:"0px",right:"0px",height:"100px",width:"100%",pointerEvents:"none"},mounted(h){let p=null,g=null;function x(E=[]){if(p=null,g=null,h.innerHTML="",!l.duration||l.option.isLive)return;let k={w:h.offsetWidth,h:h.offsetHeight},O={xMin:0,xMax:k.w,yMin:0,yMax:128,scale:.25,opacity:.2,minHeight:Math.floor(.05*k.h),sampling:Math.floor(k.w/100),smoothing:.2,flattening:.2};typeof c=="object"&&Object.assign(O,c);let T=[];if(Array.isArray(E)&&E.length)T=[...E];else{let $=l.duration/k.w;for(let V=0;V<=k.w;V+=O.sampling){let Q=d.queue.filter(({time:z})=>z>V*$&&z<=(V+O.sampling)*$).length;T.push([V,Q])}}if(T.length===0)return;let R=T[T.length-1],C=R[0],b=R[1];C!==k.w&&T.push([k.w,b]);let A=T.map($=>$[1]),L=(Math.min(...A)+Math.max(...A))/2;for(let $=0;$<T.length;$++){let V=T[$],Q=V[1];V[1]=Q*(Q>L?1+O.scale:1-O.scale)+O.minHeight}let I=($,V,Q,z)=>{let B=o(V||$,Q||$),w=n.map(Math.cos(B.angle)*O.flattening,0,1,1,0),P=B.angle*w+(z?Math.PI:0),G=B.length*O.smoothing;return[$[0]+Math.cos(P)*G,$[1]+Math.sin(P)*G]},j=($,V,Q)=>{let z=I(Q[V-1],Q[V-2],$),B=I($,Q[V-1],Q[V+1],!0),w=V===Q.length-1?" z":"";return`C ${z[0]},${z[1]} ${B[0]},${B[1]} ${$[0]},${$[1]}${w}`},F=T.map($=>[n.map($[0],O.xMin,O.xMax,0,k.w),n.map($[1],O.yMin,O.yMax,k.h,0)]).reduce(($,V,Q,z)=>Q===0?`M ${z[z.length-1][0]},${k.h} L ${V[0]},${k.h} L ${V[0]},${V[1]}`:`${$} ${j(V,Q,z)}`,"");h.innerHTML=`<svg viewBox="0 0 ${k.w} ${k.h}"><defs><linearGradient id="heatmap-solids" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" style="stop-color:var(--art-theme);stop-opacity:${O.opacity}" /><stop offset="0%" style="stop-color:var(--art-theme);stop-opacity:${O.opacity}" id="heatmap-start" /><stop offset="0%" style="stop-color:var(--art-progress-color);stop-opacity:1" id="heatmap-stop" /><stop offset="100%" style="stop-color:var(--art-progress-color);stop-opacity:1" /></linearGradient></defs><path fill="url(#heatmap-solids)" d="${F}"></path></svg>`,p=f("#heatmap-start",h),g=f("#heatmap-stop",h),p.setAttribute("offset",`${100*l.played}%`),g.setAttribute("offset",`${100*l.played}%`)}l.on("video:timeupdate",()=>{p&&g&&(p.setAttribute("offset",`${100*l.played}%`),g.setAttribute("offset",`${100*l.played}%`))}),l.on("setBar",(E,k)=>{p&&g&&E==="played"&&(p.setAttribute("offset",`${100*k}%`),g.setAttribute("offset",`${100*k}%`))}),l.on("ready",()=>x()),l.on("resize",()=>x()),l.on("artplayerPluginDanmuku:loaded",()=>x()),l.on("artplayerPluginDanmuku:points",E=>x(E))}})}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}]},["bgm6t"],"bgm6t","parcelRequire4dc0")})(aa);var bc=Or(aa.exports);function Tc(u){let t=bc({danmuku:[],speed:5,opacity:1,fontSize:25,color:"#FFFFFF",mode:0,margin:[10,"25%"],antiOverlap:!0,useWorker:!0,synchronousPlayback:!1,filter:e=>e.text.length<50,lockTime:5,maxLength:100,minWidth:200,maxWidth:600,theme:"light",heatmap:!0,beforeEmit:e=>!!e.text.trim()});u.plugins.add(t),u.on("artplayerPluginDanmuku:emit",e=>{console.info("\u65B0\u589E\u5F39\u5E55",e)}),u.on("artplayerPluginDanmuku:error",e=>{console.info("\u52A0\u8F7D\u9519\u8BEF",e)}),u.on("artplayerPluginDanmuku:config",e=>{})}const De=u=>(ba("data-v-4774810c"),u=u(),Ta(),u),Sc=De(()=>Kt("div",{class:"artplayer-app"},null,-1)),Ac={key:0,class:"zfile-video-switch-tools"},Lc=De(()=>Kt("img",{src:Da,alt:"\u4E0B\u8F7D"},null,-1)),Ic=De(()=>Kt("img",{src:ka,alt:"\u8FC5\u96F7"},null,-1)),wc=De(()=>Kt("img",{src:Ca,alt:"motrix"},null,-1)),Rc=De(()=>Kt("img",{src:Ma,alt:"PotPlayer"},null,-1)),Dc=De(()=>Kt("img",{src:Pa,alt:"IINA"},null,-1)),kc=De(()=>Kt("img",{src:Oa,alt:"VLC"},null,-1)),Cc=De(()=>Kt("img",{src:Na,alt:"nPlayer"},null,-1)),Mc=De(()=>Kt("img",{src:Fa,alt:"MXPlayer(Free)"},null,-1)),Pc=De(()=>Kt("img",{src:Ba,alt:"MXPlayer(Pro)"},null,-1)),Oc={__name:"VideoPlayer",setup(u){let t=wa();ya();let{getPathPwd:e}=Ia(),{currentPath:i,storageKey:r}=va(),s=Sa(),n=Aa();const o=I=>{let j=[];return s.filterFileByType("video").forEach(F=>{j.push({default:F.name===I,html:F.name,url:F.url})}),j};let a=_a(null);const l=I=>{switch(I){case"download":window.location=a.value.url;break;case"thunder":window.location=`thunder://${btoa("AA"+a.value.url+"ZZ")}`;break;case"motrix":window.location=`motrix://new-task?uri=${encodeURIComponent(a.value.url)}&out=${encodeURIComponent(a.value.name)}`;break;case"potplayer":window.location=`potplayer://${a.value.url}`;break;case"iina":window.location=`iina://weblink?url=${encodeURIComponent(a.value.url)}`;break;case"vlc":window.location=`vlc://${a.value.url}`;break;case"nplayer":window.location=`nplayer-${a.value.url}`;break;case"mxplayer":window.location="intent:"+a.value.url+"#Intent;package=com.mxtech.videoplayer.ad;S.title="+a.value.name+";end";break;case"mxplayer-pro":window.location="intent:"+a.value.url+"#Intent;package=com.mxtech.videoplayer.pro;S.title="+a.value.name+";end";break}},d=I=>{let j=s.filterFileByType("video");c();for(let F=0;F<j.length;F++)if(j[F].name===I)return{prev:j[F-1]||null,next:j[F+1]||null}},c=()=>{let I=JSON.parse(localStorage.getItem("_h5_player_play_progress_"));if(I){for(let j of Object.keys(I))j.endsWith(I[j].progress)&&delete I[j];localStorage.setItem("_h5_player_play_progress_",JSON.stringify(I))}},f=I=>{let j=[];return s.fileList.find(F=>{let $=I.split(".")[0],V=F.name;(V===I+".vtt"||V===I+".srt"||V===I+".ass"||V===$+".vtt"||V===$+".srt"||V===$+".ass")&&j.push({default:j.length===0,url:F.url,html:V})}),j.length>0&&j.push({url:"",html:"\u5173\u95ED\u5B57\u5E55"}),j};let h='<i class="art-icon art-icon-not-hidden"><svg t="1662978336444" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="968" width="128" height="128"><path d="M711.456 377.184c32.736 31.52 60.928 72.256 84.64 122.208a40.64 40.64 0 0 1 0 34.72c-63.776 135.04-160.48 202.528-290.112 202.528-46.752 0-89.248-8.832-127.456-26.464l37.184-37.184c27.52 10.048 57.6 15.104 90.272 15.104 108.864 0 188.48-55.168 244.608-171.296-21.088-43.584-45.44-78.56-73.44-105.28l34.304-34.336z m13.024-122.816l28.768 28.8a5.376 5.376 0 0 1 0 7.616L272.96 771.04a5.408 5.408 0 0 1-7.648 0l-28.8-28.8a5.376 5.376 0 0 1 0-7.616l71.36-71.36c-35.84-32.384-66.56-75.392-92.032-129.088a40.64 40.64 0 0 1 0-34.72C279.68 364.48 376.384 296.96 505.984 296.96c50.752 0 96.448 10.4 137.12 31.168l73.76-73.728a5.376 5.376 0 0 1 7.616 0z m-218.496 91.136c-108.8 0-188.416 55.168-244.608 171.296 22.944 47.36 49.792 84.608 80.928 112.096l56.256-56.256a118.688 118.688 0 0 1 160.576-160.576l47.424-47.424c-30.336-12.832-63.776-19.136-100.576-19.136z m-70.016 137.088a75.616 75.616 0 0 0-4.64 57.28l95.04-95.04a75.616 75.616 0 0 0-90.4 37.76z m60.416 109.504a75.456 75.456 0 0 0 82.144-82.112l35.616-35.616a118.72 118.72 0 0 1-153.376 153.344l35.616-35.616z" p-id="969"></path></svg></i>',p='<i class="art-icon art-icon-hidden"><svg t="1662978261880" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4451" width="128" height="128"><path d="M512.032 648a136.128 136.128 0 0 1-136-136c0-74.976 60.992-136 136-136s136 61.024 136 136a136.128 136.128 0 0 1-136 136z m0-224c-48.544 0-88 39.456-88 88s39.456 88 88 88 88-39.456 88-88-39.456-88-88-88z" p-id="4452"></path><path d="M512.032 743.616a327.68 327.68 0 0 1-231.872-95.616L142.88 512l137.28-136a327.68 327.68 0 0 1 231.872-95.584c87.328 0 169.664 33.952 231.872 95.584l137.28 136-137.28 136a327.52 327.52 0 0 1-231.872 95.616zM206.528 512l107.424 101.952c53.152 52.672 123.488 81.696 198.048 81.696s144.896-29.024 198.08-81.696L817.536 512l-107.424-101.952c-53.152-52.672-123.488-81.696-198.048-81.696s-144.896 29.024-198.08 81.696L206.528 512z" p-id="4453"></path></svg></i>',g='<i class="art-icon art-icon-video-list"><svg t="1650551038453" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="12028" width="20" height="20"><path d="M111.395066 179.64038l801.208844 0 0 87.866187-801.208844 0 0-87.866187Z" p-id="12029"></path><path d="M111.395066 468.067418l801.208844 0 0 87.866187-801.208844 0 0-87.866187Z" p-id="12030"></path><path d="M111.395066 756.493433l801.208844 0 0 87.866187-801.208844 0 0-87.866187Z" p-id="12031"></path></svg></i>',x=`<i class="art-icon art-icon-subtitle"><svg xmlns="http://www.w3.org/2000/svg" height="22" width="22" viewBox="0 0 48 48">
    <path d="M0 0h48v48H0z" fill="none"></path>
    <path d="M40 8H8c-2.21 0-4 1.79-4 4v24c0 2.21 1.79 4 4 4h32c2.21 0 4-1.79 4-4V12c0-2.21-1.79-4-4-4zM8 24h8v4H8v-4zm20 12H8v-4h20v4zm12 0h-8v-4h8v4zm0-8H20v-4h20v4z"></path>
</svg></i>`,E='<i class="art-icon art-icon-next-video"><svg height="25" width="25"  viewBox="0 0 22 22"><path d="M16 5a1 1 0 00-1 1v4.615a1.431 1.431 0 00-.615-.829L7.21 5.23A1.439 1.439 0 005 6.445v9.11a1.44 1.44 0 002.21 1.215l7.175-4.555a1.436 1.436 0 00.616-.828V16a1 1 0 002 0V6C17 5.448 16.552 5 16 5z"></path></svg></i>',k='<i class="art-icon art-icon-prev-video" style="transform: scale(-1,1);"><svg height="25" width="25"  viewBox="0 0 22 22"><path d="M16 5a1 1 0 00-1 1v4.615a1.431 1.431 0 00-.615-.829L7.21 5.23A1.439 1.439 0 005 6.445v9.11a1.44 1.44 0 002.21 1.215l7.175-4.555a1.436 1.436 0 00.616-.828V16a1 1 0 002 0V6C17 5.448 16.552 5 16 5z"></path></svg></i>';const O=tr("zfile-video-auto-player-next",!1),T=tr("zfile-video-auto-player",!1),R=tr("zfile-video-hiddle-tools",!1);let C=null;const b=(I,j)=>zt(this,null,function*(){var w;a.value={name:I,url:j},document.querySelector(".zfile-video-dialog .el-dialog__title").innerHTML=I,C&&C.destroy();let F="mp4";I.toLowerCase().endsWith("flv")?F="flv":I.toLowerCase().endsWith("m3u8")&&(F="m3u8"),t.removeDuplicateSeparator(`${i.value}/${I}`);let $=t.removeDuplicateSeparator(`${i.value}/__${I}__/video.m3u8`),V={storageKey:r.value,path:$,password:e()},Q=yield La(V);((w=Q==null?void 0:Q.data)==null?void 0:w.code)===0&&(console.log("\u68C0\u6D4B\u5230\u5F53\u524D\u4E3A h5ai_dplayer \u517C\u5BB9\u6A21\u5F0F, \u66FF\u6362\u64AD\u653E\u6587\u4EF6\u4E3A: "+$),F="m3u8");let z={container:".artplayer-app",title:I,url:a.value.url,type:F,setting:!0,playbackRate:!0,flip:!0,fullscreen:!0,fastForward:!0,autoOrientation:!0,aspectRatio:!0,fullscreenWeb:!0,theme:"#23ade5",lock:!0,subtitleOffset:!0,miniProgressBar:!0,autoplay:T.value,whitelist:["*"],airplay:!0,moreVideoAttr:{"x5-video-player-type":"h5","x5-video-player-fullscreen":!1,"x5-video-orientation":"portraint",preload:"metadata",crossOrigin:"anonymous"},customType:{flv:function(P,G){if(cs.isSupported()){const et=cs.createPlayer({type:"flv",url:G});et.attachMediaElement(P),et.load()}else C.notice.show="\u4E0D\u652F\u6301\u64AD\u653E\u683C\u5F0F\uFF1Aflv"},m3u8:function(P,G){if(Ke.isSupported()){const et=new Ke({xhrSetup:(rt,dt)=>{let vt=dt.substring(dt.lastIndexOf("/")+1);if(dt!==G){let Lt=s.getFileUrlByName(vt);Lt?rt.open("GET",Lt,!0):rt.open("GET",dt,!0)}}});et.loadSource(G),et.attachMedia(P)}else{const et=P.canPlayType("application/vnd.apple.mpegurl");et==="probably"||et=="maybe"?P.src=G:C.notice.show="\u4E0D\u652F\u6301\u64AD\u653E\u683C\u5F0F\uFF1Am3u8"}}},contextmenu:[{html:"\u4E0B\u8F7D",click:function(){window.open(j)}}],settings:[{html:"\u81EA\u52A8\u64AD\u653E",tooltip:T.value?"\u5F00\u542F":"\u5173\u95ED",icon:'<img width="22" heigth="22" src="data:image/svg+xml;base64,Cjxzdmcgdmlld0JveD0iMCAwIDgwIDgwIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj48ZGVmcz48cGF0aCBpZD0icGlkLTY0LXN2Z28tYSIgZD0iTTAgMGg4MHY4MEgweiI+PC9wYXRoPjxwYXRoIGQ9Ik01Mi41NDYgOC4wMTRhMy45OTggMy45OTggMCAwMTQuMjIyIDMuMDc3Yy4xMDQuNDQ2LjA5My44MDguMDM5IDEuMTM4YTIuNzQgMi43NCAwIDAxLS4zMTIuODgxYy0uMDczLjEzMi0uMTYuMjU0LS4yNDYuMzc2bC0uMjU3LjM2Ni0uNTIxLjczYy0uNy45NjktMS40MTUgMS45MjYtMi4xNTQgMi44NjZsLS4wMTUuMDJhMjQwLjk0NSAyNDAuOTQ1IDAgMDE1Ljk4Ni4zNDFsMS42NDMuMTIzLjgyMi4wNjYuNDEuMDM0LjIwNi4wMTguMTAzLjAwOC4xMTUuMDEyYzEuMjY2LjExNiAyLjUxNi40NSAzLjY3Ny45NzVhMTEuNjYzIDExLjY2MyAwIDAxMy4xNjYgMi4xMTRjLjkzMS44NyAxLjcxOSAxLjg5NSAyLjMyMSAzLjAyMmExMS41OTUgMTEuNTk1IDAgMDExLjIyNCAzLjYxM2MuMDMuMTU3LjA0Ni4zMTYuMDY4LjQ3NGwuMDE1LjExOS4wMTMuMTEyLjAyMi4yMDYuMDg1LjgyMi4xNTkgMS42NDZjLjEgMS4wOTguMTkgMi4xOTguMjcgMy4yOTguMzE1IDQuNC40NjMgOC44MjkuMzYgMTMuMjU1YTE2Ni40ODkgMTY2LjQ4OSAwIDAxLS44NDMgMTMuMjEzYy0uMDEyLjEyNy0uMDM0LjI5Ny0uMDUzLjQ1NGE3LjU4OSA3LjU4OSAwIDAxLS4wNzIuNDc1bC0uMDQuMjM3LS4wNS4yMzZhMTEuNzYyIDExLjc2MiAwIDAxLS43NCAyLjI4NyAxMS43NTUgMTEuNzU1IDAgMDEtNS4xMTggNS41NyAxMS43MDUgMTEuNzA1IDAgMDEtMy42MjMgMS4yNjNjLS4xNTguMDI0LS4zMTYuMDUyLS40NzUuMDcybC0uNDc3LjA1My0uODIxLjA3MS0xLjY0NC4xMzRjLTEuMDk2LjA4Ni0yLjE5Mi4xNi0zLjI4OC4yM2EyNjAuMDggMjYwLjA4IDAgMDEtNi41NzguMzI1Yy04Ljc3Mi4zMjQtMTcuNTQ2LjIyLTI2LjMxMy0uMzAyYTI0Mi40NTggMjQyLjQ1OCAwIDAxLTMuMjg3LS4yMmwtMS42NDMtLjEyOS0uODIyLS4wNjktLjQxLS4wMzUtLjIwNi0uMDE4Yy0uMDY4LS4wMDYtLjEzMy0uMDEtLjIxOC0uMDJhMTEuNTY2IDExLjU2NiAwIDAxLTMuNy0uOTkyIDExLjczMiAxMS43MzIgMCAwMS01LjQ5Ny01LjE3OCAxMS43MyAxMS43MyAwIDAxLTEuMjE1LTMuNjI3Yy0uMDI0LS4xNTgtLjA1MS0uMzE2LS4wNjctLjQ3NWwtLjAyNi0uMjM4LS4wMTMtLjExOS0uMDEtLjEwMy0uMDctLjgyMy0uMTMyLTEuNjQ4YTE5MC42MzcgMTkwLjYzNyAwIDAxLS4yMi0zLjI5OGMtLjI1Ni00LjM5OS0uMzU4LTguODE3LS4yNTgtMTMuMjMzLjA5OS00LjQxMi4zNzItOC44MTEuNzg4LTEzLjE5N2ExMS42NSAxMS42NSAwIDAxMy4wMzktNi44MzUgMTEuNTg1IDExLjU4NSAwIDAxNi41NzItMy41NjNjLjE1Ny0uMDIzLjMxMi0uMDUxLjQ3LS4wN2wuNDctLjA1LjgyLS4wNyAxLjY0My0uMTNhMjI4LjQ5MyAyMjguNDkzIDAgMDE2LjY0Ny0uNDA1bC0uMDQxLS4wNWE4OC4xNDUgODguMTQ1IDAgMDEtMi4xNTQtMi44NjdsLS41Mi0uNzMtLjI1OC0uMzY2Yy0uMDg2LS4xMjItLjE3My0uMjQ0LS4yNDYtLjM3NmEyLjc0IDIuNzQgMCAwMS0uMzEyLS44ODEgMi44MDggMi44MDggMCAwMS4wNC0xLjEzOCAzLjk5OCAzLjk5OCAwIDAxNC4yMi0zLjA3NyAyLjggMi44IDAgMDExLjA5My4zMTNjLjI5NC4xNTUuNTM4LjM0Ny43NDIuNTY4LjEwMi4xMS4xOS4yMy4yOC4zNWwuMjcuMzU5LjUzMi43MmE4OC4wNTkgODguMDU5IDAgMDEyLjA2IDIuOTM2IDczLjAzNiA3My4wMzYgMCAwMTEuOTI5IDMuMDNjLjE4Ny4zMTMuMzczLjYyOC41NTYuOTQ1IDIuNzI0LS4wNDcgNS40NDctLjA1NiA4LjE3LS4wMzguNzQ4LjAwNiAxLjQ5Ni4wMTUgMi4yNDQuMDI2LjE4LS4zMTMuMzY0LS42MjQuNTQ5LS45MzRhNzMuMjgxIDczLjI4MSAwIDAxMS45My0zLjAzIDg4LjczNyA4OC43MzcgMCAwMTIuMDU5LTIuOTM1bC41MzMtLjcyLjI2OC0uMzU5Yy4wOS0uMTIuMTc5LS4yNC4yODEtLjM1YTIuOCAyLjggMCAwMTEuODM0LS44ODF6TTMwLjEzIDM0LjYzMWE0IDQgMCAwMC0uNDE4IDEuNDIgOTEuMTU3IDkxLjE1NyAwIDAwLS40NDYgOS4xMjhjMCAyLjgyOC4xMjEgNS42NTYuMzY0IDguNDgzbC4xMSAxLjIxMmE0IDQgMCAwMDUuODU4IDMuMTQzYzIuODItMS40OTggNS41NS0zLjAzMyA4LjE5My00LjYwNmExNzcuNDEgMTc3LjQxIDAgMDA1Ljg5Ni0zLjY2NmwxLjQzNC0uOTQyYTQgNCAwIDAwLjA0Ny02LjYzMiAxMzcuNzAzIDEzNy43MDMgMCAwMC03LjM3Ny00LjcwOCAxNDYuODggMTQ2Ljg4IDAgMDAtNi44NzktMy44NDlsLTEuNC0uNzI1YTQgNCAwIDAwLTUuMzgyIDEuNzQyeiIgaWQ9InBpZC02NC1zdmdvLWQiPjwvcGF0aD48ZmlsdGVyIHg9Ii0xNS40JSIgeT0iLTE2LjMlIiB3aWR0aD0iMTMwLjklIiBoZWlnaHQ9IjEzMi41JSIgZmlsdGVyVW5pdHM9Im9iamVjdEJvdW5kaW5nQm94IiBpZD0icGlkLTY0LXN2Z28tYyI+PGZlT2Zmc2V0IGR5PSIyIiBpbj0iU291cmNlQWxwaGEiIHJlc3VsdD0ic2hhZG93T2Zmc2V0T3V0ZXIxIj48L2ZlT2Zmc2V0PjxmZUdhdXNzaWFuQmx1ciBzdGREZXZpYXRpb249IjEiIGluPSJzaGFkb3dPZmZzZXRPdXRlcjEiIHJlc3VsdD0ic2hhZG93Qmx1ck91dGVyMSI+PC9mZUdhdXNzaWFuQmx1cj48ZmVDb2xvck1hdHJpeCB2YWx1ZXM9IjAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAuMyAwIiBpbj0ic2hhZG93Qmx1ck91dGVyMSIgcmVzdWx0PSJzaGFkb3dNYXRyaXhPdXRlcjEiPjwvZmVDb2xvck1hdHJpeD48ZmVPZmZzZXQgaW49IlNvdXJjZUFscGhhIiByZXN1bHQ9InNoYWRvd09mZnNldE91dGVyMiI+PC9mZU9mZnNldD48ZmVHYXVzc2lhbkJsdXIgc3RkRGV2aWF0aW9uPSIzLjUiIGluPSJzaGFkb3dPZmZzZXRPdXRlcjIiIHJlc3VsdD0ic2hhZG93Qmx1ck91dGVyMiI+PC9mZUdhdXNzaWFuQmx1cj48ZmVDb2xvck1hdHJpeCB2YWx1ZXM9IjAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAuMiAwIiBpbj0ic2hhZG93Qmx1ck91dGVyMiIgcmVzdWx0PSJzaGFkb3dNYXRyaXhPdXRlcjIiPjwvZmVDb2xvck1hdHJpeD48ZmVNZXJnZT48ZmVNZXJnZU5vZGUgaW49InNoYWRvd01hdHJpeE91dGVyMSI+PC9mZU1lcmdlTm9kZT48ZmVNZXJnZU5vZGUgaW49InNoYWRvd01hdHJpeE91dGVyMiI+PC9mZU1lcmdlTm9kZT48L2ZlTWVyZ2U+PC9maWx0ZXI+PC9kZWZzPjxnIGZpbGw9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCIgb3BhY2l0eT0iLjgiPjxtYXNrIGlkPSJwaWQtNjQtc3Znby1iIiBmaWxsPSIjZmZmIj48dXNlIHhsaW5rOmhyZWY9IiNwaWQtNjQtc3Znby1hIj48L3VzZT48L21hc2s+PGcgbWFzaz0idXJsKCNwaWQtNjQtc3Znby1iKSI+PHVzZSBmaWxsPSIjMDAwIiBmaWx0ZXI9InVybCgjcGlkLTY0LXN2Z28tYykiIHhsaW5rOmhyZWY9IiNwaWQtNjQtc3Znby1kIj48L3VzZT48dXNlIGZpbGw9IiNGRkYiIHhsaW5rOmhyZWY9IiNwaWQtNjQtc3Znby1kIj48L3VzZT48L2c+PC9nPjwvc3ZnPg==">',switch:T.value,onSwitch:function(P,G,et){const rt=!P.switch;return T.value=rt,C.autoplay=rt,P.tooltip=rt?"\u5F00\u542F":"\u5173\u95ED",rt}},{html:"\u81EA\u52A8\u64AD\u653E\u4E0B\u4E00\u4E2A\u89C6\u9891",tooltip:O.value?"\u5F00\u542F":"\u5173\u95ED",icon:'<img width="22" heigth="22" src="data:image/svg+xml;base64,Cjxzdmcgdmlld0JveD0iMCAwIDgwIDgwIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj48ZGVmcz48cGF0aCBpZD0icGlkLTY0LXN2Z28tYSIgZD0iTTAgMGg4MHY4MEgweiI+PC9wYXRoPjxwYXRoIGQ9Ik01Mi41NDYgOC4wMTRhMy45OTggMy45OTggMCAwMTQuMjIyIDMuMDc3Yy4xMDQuNDQ2LjA5My44MDguMDM5IDEuMTM4YTIuNzQgMi43NCAwIDAxLS4zMTIuODgxYy0uMDczLjEzMi0uMTYuMjU0LS4yNDYuMzc2bC0uMjU3LjM2Ni0uNTIxLjczYy0uNy45NjktMS40MTUgMS45MjYtMi4xNTQgMi44NjZsLS4wMTUuMDJhMjQwLjk0NSAyNDAuOTQ1IDAgMDE1Ljk4Ni4zNDFsMS42NDMuMTIzLjgyMi4wNjYuNDEuMDM0LjIwNi4wMTguMTAzLjAwOC4xMTUuMDEyYzEuMjY2LjExNiAyLjUxNi40NSAzLjY3Ny45NzVhMTEuNjYzIDExLjY2MyAwIDAxMy4xNjYgMi4xMTRjLjkzMS44NyAxLjcxOSAxLjg5NSAyLjMyMSAzLjAyMmExMS41OTUgMTEuNTk1IDAgMDExLjIyNCAzLjYxM2MuMDMuMTU3LjA0Ni4zMTYuMDY4LjQ3NGwuMDE1LjExOS4wMTMuMTEyLjAyMi4yMDYuMDg1LjgyMi4xNTkgMS42NDZjLjEgMS4wOTguMTkgMi4xOTguMjcgMy4yOTguMzE1IDQuNC40NjMgOC44MjkuMzYgMTMuMjU1YTE2Ni40ODkgMTY2LjQ4OSAwIDAxLS44NDMgMTMuMjEzYy0uMDEyLjEyNy0uMDM0LjI5Ny0uMDUzLjQ1NGE3LjU4OSA3LjU4OSAwIDAxLS4wNzIuNDc1bC0uMDQuMjM3LS4wNS4yMzZhMTEuNzYyIDExLjc2MiAwIDAxLS43NCAyLjI4NyAxMS43NTUgMTEuNzU1IDAgMDEtNS4xMTggNS41NyAxMS43MDUgMTEuNzA1IDAgMDEtMy42MjMgMS4yNjNjLS4xNTguMDI0LS4zMTYuMDUyLS40NzUuMDcybC0uNDc3LjA1My0uODIxLjA3MS0xLjY0NC4xMzRjLTEuMDk2LjA4Ni0yLjE5Mi4xNi0zLjI4OC4yM2EyNjAuMDggMjYwLjA4IDAgMDEtNi41NzguMzI1Yy04Ljc3Mi4zMjQtMTcuNTQ2LjIyLTI2LjMxMy0uMzAyYTI0Mi40NTggMjQyLjQ1OCAwIDAxLTMuMjg3LS4yMmwtMS42NDMtLjEyOS0uODIyLS4wNjktLjQxLS4wMzUtLjIwNi0uMDE4Yy0uMDY4LS4wMDYtLjEzMy0uMDEtLjIxOC0uMDJhMTEuNTY2IDExLjU2NiAwIDAxLTMuNy0uOTkyIDExLjczMiAxMS43MzIgMCAwMS01LjQ5Ny01LjE3OCAxMS43MyAxMS43MyAwIDAxLTEuMjE1LTMuNjI3Yy0uMDI0LS4xNTgtLjA1MS0uMzE2LS4wNjctLjQ3NWwtLjAyNi0uMjM4LS4wMTMtLjExOS0uMDEtLjEwMy0uMDctLjgyMy0uMTMyLTEuNjQ4YTE5MC42MzcgMTkwLjYzNyAwIDAxLS4yMi0zLjI5OGMtLjI1Ni00LjM5OS0uMzU4LTguODE3LS4yNTgtMTMuMjMzLjA5OS00LjQxMi4zNzItOC44MTEuNzg4LTEzLjE5N2ExMS42NSAxMS42NSAwIDAxMy4wMzktNi44MzUgMTEuNTg1IDExLjU4NSAwIDAxNi41NzItMy41NjNjLjE1Ny0uMDIzLjMxMi0uMDUxLjQ3LS4wN2wuNDctLjA1LjgyLS4wNyAxLjY0My0uMTNhMjI4LjQ5MyAyMjguNDkzIDAgMDE2LjY0Ny0uNDA1bC0uMDQxLS4wNWE4OC4xNDUgODguMTQ1IDAgMDEtMi4xNTQtMi44NjdsLS41Mi0uNzMtLjI1OC0uMzY2Yy0uMDg2LS4xMjItLjE3My0uMjQ0LS4yNDYtLjM3NmEyLjc0IDIuNzQgMCAwMS0uMzEyLS44ODEgMi44MDggMi44MDggMCAwMS4wNC0xLjEzOCAzLjk5OCAzLjk5OCAwIDAxNC4yMi0zLjA3NyAyLjggMi44IDAgMDExLjA5My4zMTNjLjI5NC4xNTUuNTM4LjM0Ny43NDIuNTY4LjEwMi4xMS4xOS4yMy4yOC4zNWwuMjcuMzU5LjUzMi43MmE4OC4wNTkgODguMDU5IDAgMDEyLjA2IDIuOTM2IDczLjAzNiA3My4wMzYgMCAwMTEuOTI5IDMuMDNjLjE4Ny4zMTMuMzczLjYyOC41NTYuOTQ1IDIuNzI0LS4wNDcgNS40NDctLjA1NiA4LjE3LS4wMzguNzQ4LjAwNiAxLjQ5Ni4wMTUgMi4yNDQuMDI2LjE4LS4zMTMuMzY0LS42MjQuNTQ5LS45MzRhNzMuMjgxIDczLjI4MSAwIDAxMS45My0zLjAzIDg4LjczNyA4OC43MzcgMCAwMTIuMDU5LTIuOTM1bC41MzMtLjcyLjI2OC0uMzU5Yy4wOS0uMTIuMTc5LS4yNC4yODEtLjM1YTIuOCAyLjggMCAwMTEuODM0LS44ODF6TTMwLjEzIDM0LjYzMWE0IDQgMCAwMC0uNDE4IDEuNDIgOTEuMTU3IDkxLjE1NyAwIDAwLS40NDYgOS4xMjhjMCAyLjgyOC4xMjEgNS42NTYuMzY0IDguNDgzbC4xMSAxLjIxMmE0IDQgMCAwMDUuODU4IDMuMTQzYzIuODItMS40OTggNS41NS0zLjAzMyA4LjE5My00LjYwNmExNzcuNDEgMTc3LjQxIDAgMDA1Ljg5Ni0zLjY2NmwxLjQzNC0uOTQyYTQgNCAwIDAwLjA0Ny02LjYzMiAxMzcuNzAzIDEzNy43MDMgMCAwMC03LjM3Ny00LjcwOCAxNDYuODggMTQ2Ljg4IDAgMDAtNi44NzktMy44NDlsLTEuNC0uNzI1YTQgNCAwIDAwLTUuMzgyIDEuNzQyeiIgaWQ9InBpZC02NC1zdmdvLWQiPjwvcGF0aD48ZmlsdGVyIHg9Ii0xNS40JSIgeT0iLTE2LjMlIiB3aWR0aD0iMTMwLjklIiBoZWlnaHQ9IjEzMi41JSIgZmlsdGVyVW5pdHM9Im9iamVjdEJvdW5kaW5nQm94IiBpZD0icGlkLTY0LXN2Z28tYyI+PGZlT2Zmc2V0IGR5PSIyIiBpbj0iU291cmNlQWxwaGEiIHJlc3VsdD0ic2hhZG93T2Zmc2V0T3V0ZXIxIj48L2ZlT2Zmc2V0PjxmZUdhdXNzaWFuQmx1ciBzdGREZXZpYXRpb249IjEiIGluPSJzaGFkb3dPZmZzZXRPdXRlcjEiIHJlc3VsdD0ic2hhZG93Qmx1ck91dGVyMSI+PC9mZUdhdXNzaWFuQmx1cj48ZmVDb2xvck1hdHJpeCB2YWx1ZXM9IjAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAuMyAwIiBpbj0ic2hhZG93Qmx1ck91dGVyMSIgcmVzdWx0PSJzaGFkb3dNYXRyaXhPdXRlcjEiPjwvZmVDb2xvck1hdHJpeD48ZmVPZmZzZXQgaW49IlNvdXJjZUFscGhhIiByZXN1bHQ9InNoYWRvd09mZnNldE91dGVyMiI+PC9mZU9mZnNldD48ZmVHYXVzc2lhbkJsdXIgc3RkRGV2aWF0aW9uPSIzLjUiIGluPSJzaGFkb3dPZmZzZXRPdXRlcjIiIHJlc3VsdD0ic2hhZG93Qmx1ck91dGVyMiI+PC9mZUdhdXNzaWFuQmx1cj48ZmVDb2xvck1hdHJpeCB2YWx1ZXM9IjAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAuMiAwIiBpbj0ic2hhZG93Qmx1ck91dGVyMiIgcmVzdWx0PSJzaGFkb3dNYXRyaXhPdXRlcjIiPjwvZmVDb2xvck1hdHJpeD48ZmVNZXJnZT48ZmVNZXJnZU5vZGUgaW49InNoYWRvd01hdHJpeE91dGVyMSI+PC9mZU1lcmdlTm9kZT48ZmVNZXJnZU5vZGUgaW49InNoYWRvd01hdHJpeE91dGVyMiI+PC9mZU1lcmdlTm9kZT48L2ZlTWVyZ2U+PC9maWx0ZXI+PC9kZWZzPjxnIGZpbGw9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCIgb3BhY2l0eT0iLjgiPjxtYXNrIGlkPSJwaWQtNjQtc3Znby1iIiBmaWxsPSIjZmZmIj48dXNlIHhsaW5rOmhyZWY9IiNwaWQtNjQtc3Znby1hIj48L3VzZT48L21hc2s+PGcgbWFzaz0idXJsKCNwaWQtNjQtc3Znby1iKSI+PHVzZSBmaWxsPSIjMDAwIiBmaWx0ZXI9InVybCgjcGlkLTY0LXN2Z28tYykiIHhsaW5rOmhyZWY9IiNwaWQtNjQtc3Znby1kIj48L3VzZT48dXNlIGZpbGw9IiNGRkYiIHhsaW5rOmhyZWY9IiNwaWQtNjQtc3Znby1kIj48L3VzZT48L2c+PC9nPjwvc3ZnPg==">',switch:O.value,onSwitch:function(P,G,et){const rt=!P.switch;return O.value=rt,P.tooltip=rt?"\u5F00\u542F":"\u5173\u95ED",rt}}],controls:[{position:"right",html:"\u4E0A\u4F20\u5F39\u5E55",click:function(){const P=document.createElement("input");P.type="file",P.accept="text/xml",P.addEventListener("change",()=>{const G=new FileReader;G.onload=()=>{const et=G.result;let rt=Ec(et);console.log(rt),C.plugins.artplayerPluginDanmuku.config({danmuku:rt}),C.plugins.artplayerPluginDanmuku.load()},G.readAsText(P.files[0])}),P.click()}},{position:"right",html:R.value?h:p,click:function(P,G){R.value=!R.value,G.target.parentNode.parentNode.innerHTML=R.value?h:p}},{name:"video-list",position:"right",html:g,selector:o(I),onSelect:function(P,G){return b(P.html,P.url),g}}]},B=f(I);B.length>0&&B.length>1&&z.controls.push({name:"video-subtitle",position:"right",html:x,selector:B,onSelect:P=>(P.html==="\u5173\u95ED\u5B57\u5E55"?C.subtitle.show=!1:(C.subtitle.show=!0,C.subtitle.url=P.url),x)}),C=new Ua(z),Tc(C),C.on("destory",()=>{}),t.isMobile.value===!1&&C.on("ready",()=>{let P=d(C.option.title);P.prev&&C.controls.add({name:"prev-video",position:"left",index:5,tooltip:"\u64AD\u653E\u4E0A\u4E00\u4E2A",html:k,click:()=>{L()}}),P.next&&C.controls.add({name:"next-video",position:"left",index:15,tooltip:"\u64AD\u653E\u4E0B\u4E00\u4E2A",html:E,click:()=>{A()}})}),C.on("video:ended",()=>{O.value&&A()}),B.length>0&&(C.subtitle.url=B[0].url)}),A=()=>{const I=d(C.option.title).next;I&&b(I.name,I.url)},L=()=>{const I=d(C.option.title).prev;I&&b(I.name,I.url)};return xa(()=>{b(s.currentClickRow.name,s.currentClickRow.url)}),(I,j)=>{const F=ma,$=ga;return hi(),fi("div",null,[Sc,Pe(a)&&Pe(t).isMobile.value?(hi(),fi("div",Ac,[_e(F,{disabled:!d(Pe(a).name).prev,icon:Pe(za),onClick:L},{default:Qt(()=>[xe("\u4E0A\u4E00\u4E2A\u89C6\u9891")]),_:1},8,["disabled","icon"]),_e(F,{disabled:!d(Pe(a).name).next,icon:Pe(qa),onClick:A},{default:Qt(()=>[xe("\u4E0B\u4E00\u4E2A\u89C6\u9891")]),_:1},8,["disabled","icon"])])):ls("",!0),Kt("div",{class:ds(["zfile-video-tools",Pe(R)?"hidden-important":""])},[Pe(n).permission.download?(hi(),fi(Ea,{key:0},[Kt("div",{class:"zfile-video-tools-item",onClick:j[0]||(j[0]=V=>l("download"))},[_e($,{placement:"top"},{content:Qt(()=>[xe(" \u76F4\u63A5\u4E0B\u8F7D ")]),default:Qt(()=>[Lc]),_:1})]),Kt("div",{class:"zfile-video-tools-item",onClick:j[1]||(j[1]=V=>l("thunder"))},[_e($,{placement:"top"},{content:Qt(()=>[xe(" \u4F7F\u7528\u8FC5\u96F7\u4E0B\u8F7D ")]),default:Qt(()=>[Ic]),_:1})]),Kt("div",{class:"zfile-video-tools-item",onClick:j[2]||(j[2]=V=>l("motrix"))},[_e($,{placement:"top"},{content:Qt(()=>[xe(" \u4F7F\u7528 motrix \u4E0B\u8F7D ")]),default:Qt(()=>[wc]),_:1})])],64)):ls("",!0),Kt("div",{class:"zfile-video-tools-item",onClick:j[3]||(j[3]=V=>l("potplayer"))},[_e($,{placement:"top"},{content:Qt(()=>[xe(" \u4F7F\u7528 PotPlayer \u64AD\u653E ")]),default:Qt(()=>[Rc]),_:1})]),Kt("div",{class:"zfile-video-tools-item",onClick:j[4]||(j[4]=V=>l("iina"))},[_e($,{placement:"top"},{content:Qt(()=>[xe(" \u4F7F\u7528 IINA \u64AD\u653E ")]),default:Qt(()=>[Dc]),_:1})]),Kt("div",{class:"zfile-video-tools-item",onClick:j[5]||(j[5]=V=>l("vlc"))},[_e($,{placement:"top"},{content:Qt(()=>[xe(" \u4F7F\u7528 VLC \u64AD\u653E ")]),default:Qt(()=>[kc]),_:1})]),Kt("div",{class:"zfile-video-tools-item",onClick:j[6]||(j[6]=V=>l("nplayer"))},[_e($,{placement:"top"},{content:Qt(()=>[xe(" \u4F7F\u7528 nPlayer \u64AD\u653E ")]),default:Qt(()=>[Cc]),_:1})]),Kt("div",{class:"zfile-video-tools-item",onClick:j[7]||(j[7]=V=>l("mxplayer"))},[_e($,{placement:"top"},{content:Qt(()=>[xe(" \u4F7F\u7528 MXPlayer(Free) \u64AD\u653E ")]),default:Qt(()=>[Mc]),_:1})]),Kt("div",{class:"zfile-video-tools-item",onClick:j[8]||(j[8]=V=>l("mxplayer-pro"))},[_e($,{placement:"top"},{content:Qt(()=>[xe(" \u4F7F\u7528 MXPlayer(Pro) \u64AD\u653E ")]),default:Qt(()=>[Pc]),_:1})])],2),Kt("div",{class:ds(["zfile-video-tools-tips",Pe(R)?"hidden-important":""])}," tips: \u53EF\u70B9\u51FB\u4E0A\u65B9\u7684\u8F6F\u4EF6\u56FE\u6807\u8FDB\u884C\u4E0B\u8F7D\u64AD\u653E, \u672C\u5730\u64AD\u653E\u5668\u89E3\u7801\u6548\u679C\u66F4\u4F73. ",2)])}}};var cu=Ra(Oc,[["__scopeId","data-v-4774810c"]]);export{cu as default};
